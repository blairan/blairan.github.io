<?xml version="1.0" encoding="utf-8"?>
<search> 
  
  
    
    <entry>
      <title>MPU-6050加速度-陀螺儀-溫度傳感器-micropython</title>
      <link href="/2021/09/10/mpu-6050-jia-su-du-tuo-luo-yi-wen-du-chuan-gan-qi-micropython/"/>
      <url>/2021/09/10/mpu-6050-jia-su-du-tuo-luo-yi-wen-du-chuan-gan-qi-micropython/</url>
      
        <content type="html"><![CDATA[<h2 id="MPU-6050加速度-陀螺儀-溫度傳感器-micropython"><a href="#MPU-6050加速度-陀螺儀-溫度傳感器-micropython" class="headerlink" title="MPU-6050加速度-陀螺儀-溫度傳感器-micropython"></a>MPU-6050加速度-陀螺儀-溫度傳感器-micropython</h2><h6 id="tags-micropython-mpu-6050"><a href="#tags-micropython-mpu-6050" class="headerlink" title="tags: micropython mpu-6050"></a>tags: <code>micropython</code> <code>mpu-6050</code></h6><p><a href="https://draft.blogger.com/blog/post/edit/6280040346040914276/7574901053087696690#"><img src="https://1.bp.blogspot.com/-vLDJAqcfOeU/YTrKHZdaKqI/AAAAAAAAe5g/kIY1BLNq_9Y7NrutJsQzYbPDZ02howdIgCNcBGAsYHQ/w406-h227/mpu6050.jpg"></a></p><h2 id="實驗目標"><a href="#實驗目標" class="headerlink" title="實驗目標:"></a>實驗目標:</h2><p>MPU-6050 IMU（慣性測量單元）是一個 3 軸加速度計和 3 軸陀螺儀傳感器。加速度計測量重力加速度，陀螺儀測量旋轉速度。此外，該模塊還測量溫度。該傳感器非常適合確定移動物體的方向。</p><h2 id="MPU-6050簡介"><a href="#MPU-6050簡介" class="headerlink" title="MPU-6050簡介"></a>MPU-6050簡介</h2><p>MPU-6050 是一個帶有 3 軸加速度計和 3 軸陀螺儀的模組。</p><p><strong>陀螺儀</strong>-用於測量旋轉速度 (rad/s)，這是角度位置沿 X、Y 和 Z 軸（滾動、俯仰和偏航）隨時間的變化。這使我們能夠確定物體的方向。</p><p><strong>加速度計</strong>-測量加速度它可以感應重力 (9.8m/s2) 等靜態力或振動或運動等動態力。 </p><p>MPU-6050 測量 X、Y 和 Z 軸上的加速度。理想情況下，在靜態物體中，Z 軸上的加速度等於重力，並且在 X 和 Y 軸上應為零。<br><strong>加速度計</strong>-可以使用三角法計算橫滾角和俯仰角。但無法計算偏航。</p><p><a href="https://draft.blogger.com/blog/post/edit/6280040346040914276/7574901053087696690#"><img src="https://1.bp.blogspot.com/-u8-QyUWHTwI/YTrKgEmaSII/AAAAAAAAe5o/3EOJc0UTKPUQY1FE1LjaMLpJXF-WUeGJwCNcBGAsYHQ/w403-h368/MPU6050-Module-Gyroscope-Axis.jpg"></a></p><h2 id="接線"><a href="#接線" class="headerlink" title="接線"></a>接線</h2><p><a href="https://draft.blogger.com/blog/post/edit/6280040346040914276/7574901053087696690#"><img src="https://1.bp.blogspot.com/-Jzy9JzxJVRI/YTrMxxtTrRI/AAAAAAAAe54/GM3Hk8tPHz0oT7ezO6IWl0iy3GS2xOh5gCNcBGAsYHQ/w1403-h530/MPU6050.jpg"></a></p><h2 id="須匯入的程式庫"><a href="#須匯入的程式庫" class="headerlink" title="須匯入的程式庫"></a>須匯入的程式庫</h2><p><strong><em>新開一個mpu6050.py和main.py放一起,並上傳到ESP32板上</em></strong></p><h3 id="程式碼"><a href="#程式碼" class="headerlink" title="程式碼"></a>程式碼</h3><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> machine<span class="token keyword">class</span> <span class="token class-name">accel</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">def</span> __init__<span class="token punctuation">(</span>self<span class="token punctuation">,</span> i2c<span class="token punctuation">,</span> addr<span class="token operator">=</span><span class="token number">0x68</span><span class="token punctuation">)</span><span class="token punctuation">:</span>        self<span class="token punctuation">.</span>iic <span class="token operator">=</span> i2c        self<span class="token punctuation">.</span>addr <span class="token operator">=</span> addr        self<span class="token punctuation">.</span>iic<span class="token punctuation">.</span>start<span class="token punctuation">(</span><span class="token punctuation">)</span>        self<span class="token punctuation">.</span>iic<span class="token punctuation">.</span>writeto<span class="token punctuation">(</span>self<span class="token punctuation">.</span>addr<span class="token punctuation">,</span> <span class="token builtin">bytearray</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">107</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span>        self<span class="token punctuation">.</span>iic<span class="token punctuation">.</span>stop<span class="token punctuation">(</span><span class="token punctuation">)</span>      <span class="token keyword">def</span> get_raw_values<span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>        self<span class="token punctuation">.</span>iic<span class="token punctuation">.</span>start<span class="token punctuation">(</span><span class="token punctuation">)</span>        a <span class="token operator">=</span> self<span class="token punctuation">.</span>iic<span class="token punctuation">.</span>readfrom_mem<span class="token punctuation">(</span>self<span class="token punctuation">.</span>addr<span class="token punctuation">,</span> <span class="token number">0x3B</span><span class="token punctuation">,</span> <span class="token number">14</span><span class="token punctuation">)</span>        self<span class="token punctuation">.</span>iic<span class="token punctuation">.</span>stop<span class="token punctuation">(</span><span class="token punctuation">)</span>        <span class="token keyword">return</span> a      <span class="token keyword">def</span> get_ints<span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>        b <span class="token operator">=</span> self<span class="token punctuation">.</span>get_raw_values<span class="token punctuation">(</span><span class="token punctuation">)</span>        c <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>        <span class="token keyword">for</span> i <span class="token keyword">in</span> b<span class="token punctuation">:</span>            c<span class="token punctuation">.</span>append<span class="token punctuation">(</span>i<span class="token punctuation">)</span>        <span class="token keyword">return</span> c      <span class="token keyword">def</span> bytes_toint<span class="token punctuation">(</span>self<span class="token punctuation">,</span> firstbyte<span class="token punctuation">,</span> secondbyte<span class="token punctuation">)</span><span class="token punctuation">:</span>        <span class="token keyword">if</span> <span class="token keyword">not</span> firstbyte <span class="token operator">&amp;</span> <span class="token number">0x80</span><span class="token punctuation">:</span>            <span class="token keyword">return</span> firstbyte <span class="token operator">&lt;&lt;</span> <span class="token number">8</span> <span class="token operator">|</span> secondbyte        <span class="token keyword">return</span> <span class="token operator">-</span> <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">(</span>firstbyte <span class="token operator">^</span> <span class="token number">255</span><span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> <span class="token number">8</span><span class="token punctuation">)</span> <span class="token operator">|</span> <span class="token punctuation">(</span>secondbyte <span class="token operator">^</span> <span class="token number">255</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span>      <span class="token keyword">def</span> get_values<span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>        raw_ints <span class="token operator">=</span> self<span class="token punctuation">.</span>get_raw_values<span class="token punctuation">(</span><span class="token punctuation">)</span>        vals <span class="token operator">=</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span>        vals<span class="token punctuation">[</span><span class="token string">"AcX"</span><span class="token punctuation">]</span> <span class="token operator">=</span> self<span class="token punctuation">.</span>bytes_toint<span class="token punctuation">(</span>raw_ints<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> raw_ints<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span>        vals<span class="token punctuation">[</span><span class="token string">"AcY"</span><span class="token punctuation">]</span> <span class="token operator">=</span> self<span class="token punctuation">.</span>bytes_toint<span class="token punctuation">(</span>raw_ints<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">,</span> raw_ints<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">)</span>        vals<span class="token punctuation">[</span><span class="token string">"AcZ"</span><span class="token punctuation">]</span> <span class="token operator">=</span> self<span class="token punctuation">.</span>bytes_toint<span class="token punctuation">(</span>raw_ints<span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">]</span><span class="token punctuation">,</span> raw_ints<span class="token punctuation">[</span><span class="token number">5</span><span class="token punctuation">]</span><span class="token punctuation">)</span>        vals<span class="token punctuation">[</span><span class="token string">"Tmp"</span><span class="token punctuation">]</span> <span class="token operator">=</span> self<span class="token punctuation">.</span>bytes_toint<span class="token punctuation">(</span>            raw_ints<span class="token punctuation">[</span><span class="token number">6</span><span class="token punctuation">]</span><span class="token punctuation">,</span> raw_ints<span class="token punctuation">[</span><span class="token number">7</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token number">340.00</span> <span class="token operator">+</span> <span class="token number">36.53</span>        vals<span class="token punctuation">[</span><span class="token string">"GyX"</span><span class="token punctuation">]</span> <span class="token operator">=</span> self<span class="token punctuation">.</span>bytes_toint<span class="token punctuation">(</span>raw_ints<span class="token punctuation">[</span><span class="token number">8</span><span class="token punctuation">]</span><span class="token punctuation">,</span> raw_ints<span class="token punctuation">[</span><span class="token number">9</span><span class="token punctuation">]</span><span class="token punctuation">)</span>        vals<span class="token punctuation">[</span><span class="token string">"GyY"</span><span class="token punctuation">]</span> <span class="token operator">=</span> self<span class="token punctuation">.</span>bytes_toint<span class="token punctuation">(</span>raw_ints<span class="token punctuation">[</span><span class="token number">10</span><span class="token punctuation">]</span><span class="token punctuation">,</span> raw_ints<span class="token punctuation">[</span><span class="token number">11</span><span class="token punctuation">]</span><span class="token punctuation">)</span>        vals<span class="token punctuation">[</span><span class="token string">"GyZ"</span><span class="token punctuation">]</span> <span class="token operator">=</span> self<span class="token punctuation">.</span>bytes_toint<span class="token punctuation">(</span>raw_ints<span class="token punctuation">[</span><span class="token number">12</span><span class="token punctuation">]</span><span class="token punctuation">,</span> raw_ints<span class="token punctuation">[</span><span class="token number">13</span><span class="token punctuation">]</span><span class="token punctuation">)</span>        <span class="token keyword">return</span> vals  <span class="token comment"># returned in range of Int16</span>        <span class="token comment"># -32768 to 32767</span>      <span class="token keyword">def</span> val_test<span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>  <span class="token comment"># ONLY FOR TESTING! Also, fast reading sometimes crashes IIC</span>        <span class="token keyword">from</span> time <span class="token keyword">import</span> sleep        <span class="token keyword">while</span> <span class="token number">1</span><span class="token punctuation">:</span>            <span class="token keyword">print</span><span class="token punctuation">(</span>self<span class="token punctuation">.</span>get_values<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>            sleep<span class="token punctuation">(</span><span class="token number">0.05</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="主程式1"><a href="#主程式1" class="headerlink" title="主程式1"></a>主程式1</h2><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">from</span> machine <span class="token keyword">import</span> Pin<span class="token punctuation">,</span> I2C<span class="token keyword">from</span> time <span class="token keyword">import</span> sleep<span class="token keyword">import</span> mpu6050  i2c <span class="token operator">=</span> I2C<span class="token punctuation">(</span>scl<span class="token operator">=</span>Pin<span class="token punctuation">(</span><span class="token number">22</span><span class="token punctuation">)</span><span class="token punctuation">,</span> sda<span class="token operator">=</span>Pin<span class="token punctuation">(</span><span class="token number">21</span><span class="token punctuation">)</span><span class="token punctuation">)</span>mpu <span class="token operator">=</span> mpu6050<span class="token punctuation">.</span>accel<span class="token punctuation">(</span>i2c<span class="token punctuation">)</span><span class="token keyword">while</span> <span class="token boolean">True</span><span class="token punctuation">:</span>    mpuVal <span class="token operator">=</span> mpu<span class="token punctuation">.</span>get_values<span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"GX:&#123;:.1f&#125;/ GY:&#123;:.1f&#125;/ GZ:&#123;&#125;"</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>mpuVal<span class="token punctuation">[</span><span class="token string">'GyX'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>mpuVal<span class="token punctuation">[</span><span class="token string">'GyY'</span><span class="token punctuation">]</span>\<span class="token punctuation">,</span>mpuVal<span class="token punctuation">[</span><span class="token string">'GyX'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span> mpuVal<span class="token punctuation">[</span><span class="token string">'GyZ'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"AX:&#123;:.1f&#125;/ AY:&#123;:.1f&#125;/ AZ:&#123;:.1f&#125;"</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>mpuVal<span class="token punctuation">[</span><span class="token string">'AcX'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>\mpuVal<span class="token punctuation">[</span><span class="token string">'AcY'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> mpuVal<span class="token punctuation">[</span><span class="token string">'AcZ'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span>    sleep<span class="token punctuation">(</span><span class="token number">0.5</span><span class="token punctuation">)</span>    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"-"</span><span class="token operator">*</span><span class="token number">10</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="結果"><a href="#結果" class="headerlink" title="結果"></a>結果</h2><p><a href="https://draft.blogger.com/blog/post/edit/6280040346040914276/7574901053087696690#"><img src="https://1.bp.blogspot.com/-N_i09FWlltk/YTsA07RtbOI/AAAAAAAAe6Y/BwbDWlzg2ToB2KsyI1TLYKLVfACebZ0rwCNcBGAsYHQ/w418-h297/AXIS.jpg"></a></p><h2 id="量測數值顯示於OLED"><a href="#量測數值顯示於OLED" class="headerlink" title="量測數值顯示於OLED"></a>量測數值顯示於OLED</h2><p>建立<a href="https://draft.blogger.com/blog/post/edit/6280040346040914276/7574901053087696690#">ssd1306.py</a>函式庫並上傳到ESP32</p><h2 id="主程式2"><a href="#主程式2" class="headerlink" title="主程式2"></a>主程式2</h2><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">from</span> machine <span class="token keyword">import</span> Pin<span class="token punctuation">,</span> I2C<span class="token keyword">from</span> time <span class="token keyword">import</span> sleep<span class="token keyword">import</span> mpu6050<span class="token keyword">import</span> ssd1306i2c <span class="token operator">=</span> I2C<span class="token punctuation">(</span>scl<span class="token operator">=</span>Pin<span class="token punctuation">(</span><span class="token number">22</span><span class="token punctuation">)</span><span class="token punctuation">,</span> sda<span class="token operator">=</span>Pin<span class="token punctuation">(</span><span class="token number">21</span><span class="token punctuation">)</span><span class="token punctuation">)</span>width<span class="token operator">=</span><span class="token number">128</span> <span class="token comment">#oled高</span>height<span class="token operator">=</span><span class="token number">64</span> <span class="token comment">#oled寛</span>oled<span class="token operator">=</span>ssd1306<span class="token punctuation">.</span>SSD1306_I2C<span class="token punctuation">(</span>width<span class="token punctuation">,</span> height<span class="token punctuation">,</span> i2c<span class="token punctuation">)</span> <span class="token comment">#賦予變數給設制好的ssd1306模組,並給予所須參數</span>oled<span class="token punctuation">.</span>fill<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>mpu <span class="token operator">=</span> mpu6050<span class="token punctuation">.</span>accel<span class="token punctuation">(</span>i2c<span class="token punctuation">)</span><span class="token keyword">while</span> <span class="token boolean">True</span><span class="token punctuation">:</span>    mpuVal <span class="token operator">=</span> mpu<span class="token punctuation">.</span>get_values<span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"GX:&#123;:.1f&#125;/ GY:&#123;:.1f&#125;/ GZ:&#123;&#125;"</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>mpuVal<span class="token punctuation">[</span><span class="token string">'GyX'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>mpuVal<span class="token punctuation">[</span><span class="token string">'GyY'</span><span class="token punctuation">]</span>\<span class="token punctuation">,</span>mpuVal<span class="token punctuation">[</span><span class="token string">'GyX'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span> mpuVal<span class="token punctuation">[</span><span class="token string">'GyZ'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"AX:&#123;:.1f&#125;/ AY:&#123;:.1f&#125;/ AZ:&#123;:.1f&#125;"</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>mpuVal<span class="token punctuation">[</span><span class="token string">'AcX'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>\mpuVal<span class="token punctuation">[</span><span class="token string">'AcY'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> mpuVal<span class="token punctuation">[</span><span class="token string">'AcZ'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span>    oled<span class="token punctuation">.</span>text<span class="token punctuation">(</span><span class="token string">"GX:&#123;:.1f&#125;"</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>mpuVal<span class="token punctuation">[</span><span class="token string">'GyX'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> col<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span>    oled<span class="token punctuation">.</span>text<span class="token punctuation">(</span><span class="token string">"GY:&#123;:.1f&#125;"</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>mpuVal<span class="token punctuation">[</span><span class="token string">'GyY'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">,</span> col<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span>    oled<span class="token punctuation">.</span>text<span class="token punctuation">(</span><span class="token string">"GZ:&#123;:.1f&#125;"</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>mpuVal<span class="token punctuation">[</span><span class="token string">'GyZ'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">20</span><span class="token punctuation">,</span> col<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span>    oled<span class="token punctuation">.</span>text<span class="token punctuation">(</span><span class="token string">"AX:&#123;:.1f&#125;"</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>mpuVal<span class="token punctuation">[</span><span class="token string">'AcX'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">30</span><span class="token punctuation">,</span> col<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span>    oled<span class="token punctuation">.</span>text<span class="token punctuation">(</span><span class="token string">"AY:&#123;:.1f&#125;"</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>mpuVal<span class="token punctuation">[</span><span class="token string">'AcY'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">40</span><span class="token punctuation">,</span> col<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span>    oled<span class="token punctuation">.</span>text<span class="token punctuation">(</span><span class="token string">"AZ:&#123;:.1f&#125;"</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>mpuVal<span class="token punctuation">[</span><span class="token string">'AcZ'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">50</span><span class="token punctuation">,</span> col<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span>    oled<span class="token punctuation">.</span>show<span class="token punctuation">(</span><span class="token punctuation">)</span>    sleep<span class="token punctuation">(</span><span class="token number">0.5</span><span class="token punctuation">)</span>    oled<span class="token punctuation">.</span>fill<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"-"</span><span class="token operator">*</span><span class="token number">10</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="結果2"><a href="#結果2" class="headerlink" title="結果2"></a>結果2</h2><p><a href="https://draft.blogger.com/blog/post/edit/6280040346040914276/7574901053087696690#"><img src="https://lh3.googleusercontent.com/-zOzUkgZHFA4/YTsNNLyBdQI/AAAAAAAAe6g/McELLZrF49kg6k-8iBojWybmlwAUcrteACNcBGAsYHQ/s1600/1631259935101215-0.png"></a></p>]]></content>
      
      
      <categories>
          
          <category> micropython </category>
          
          <category> esp32 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> mpu6050 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>MPU-6050加速度-陀螺儀-溫度傳感器-ESP32</title>
      <link href="/2021/09/10/mpu-6050-jia-su-du-tuo-luo-yi-wen-du-chuan-gan-qi-esp32/"/>
      <url>/2021/09/10/mpu-6050-jia-su-du-tuo-luo-yi-wen-du-chuan-gan-qi-esp32/</url>
      
        <content type="html"><![CDATA[<h1 id="MPU-6050加速度-陀螺儀-溫度傳感器-ESP32"><a href="#MPU-6050加速度-陀螺儀-溫度傳感器-ESP32" class="headerlink" title="MPU-6050加速度-陀螺儀-溫度傳感器-ESP32"></a>MPU-6050加速度-陀螺儀-溫度傳感器-ESP32</h1><p><a href="https://draft.blogger.com/blog/post/edit/3809681606094011522/9006409806488393795#"><img src="https://1.bp.blogspot.com/-vLDJAqcfOeU/YTrKHZdaKqI/AAAAAAAAe5g/kIY1BLNq_9Y7NrutJsQzYbPDZ02howdIgCNcBGAsYHQ/w406-h227/mpu6050.jpg"></a></p><h2 id="實驗目標"><a href="#實驗目標" class="headerlink" title="實驗目標:"></a>實驗目標:</h2><p>MPU-6050 IMU（慣性測量單元）是一個 3 軸加速度計和 3 軸陀螺儀傳感器。加速度計測量重力加速度，陀螺儀測量旋轉速度。此外，該模塊還測量溫度。該傳感器非常適合確定移動物體的方向。</p><h2 id="MPU-6050簡介"><a href="#MPU-6050簡介" class="headerlink" title="MPU-6050簡介"></a>MPU-6050簡介</h2><p>MPU-6050 是一個帶有 3 軸加速度計和 3 軸陀螺儀的模組。</p><p><strong>陀螺儀</strong>-用於測量旋轉速度 (rad/s)，這是角度位置沿 X、Y 和 Z 軸（滾動、俯仰和偏航）隨時間的變化。這使我們能夠確定物體的方向。</p><p><strong>加速度計</strong>-測量加速度它可以感應重力 (9.8m/s2) 等靜態力或振動或運動等動態力。 </p><p>MPU-6050 測量 X、Y 和 Z 軸上的加速度。理想情況下，在靜態物體中，Z 軸上的加速度等於重力，並且在 X 和 Y 軸上應為零。<br><strong>加速度計</strong>-可以使用三角法計算橫滾角和俯仰角。但無法計算偏航。</p><p><a href="https://draft.blogger.com/blog/post/edit/3809681606094011522/9006409806488393795#"><img src="https://1.bp.blogspot.com/-u8-QyUWHTwI/YTrKgEmaSII/AAAAAAAAe5o/3EOJc0UTKPUQY1FE1LjaMLpJXF-WUeGJwCNcBGAsYHQ/w403-h368/MPU6050-Module-Gyroscope-Axis.jpg"></a></p><h2 id="接線"><a href="#接線" class="headerlink" title="接線"></a>接線</h2><p><a href="https://draft.blogger.com/blog/post/edit/3809681606094011522/9006409806488393795#"><img src="https://1.bp.blogspot.com/-Jzy9JzxJVRI/YTrMxxtTrRI/AAAAAAAAe54/GM3Hk8tPHz0oT7ezO6IWl0iy3GS2xOh5gCNcBGAsYHQ/w1272-h481/MPU6050.jpg"></a></p><h2 id="須匯入的程式庫"><a href="#須匯入的程式庫" class="headerlink" title="須匯入的程式庫"></a>須匯入的程式庫</h2><p><a href="https://draft.blogger.com/blog/post/edit/3809681606094011522/9006409806488393795#">Adafruit_MPU6050</a></p><p><a href="https://draft.blogger.com/blog/post/edit/3809681606094011522/9006409806488393795#">Adafruit_Sensor</a></p><p><a href="https://draft.blogger.com/blog/post/edit/3809681606094011522/9006409806488393795#">Adafruit_SSD1306</a>-後半段會用到</p><h2 id="程式碼1"><a href="#程式碼1" class="headerlink" title="程式碼1"></a>程式碼1</h2><h3 id="使用範例並上傳"><a href="#使用範例並上傳" class="headerlink" title="使用範例並上傳"></a>使用範例並上傳</h3><pre class="line-numbers language-c#" data-language="c#"><code class="language-c#">#include &lt;Arduino.h&gt;&#x2F;&#x2F;包含 MPU-6050 傳感器所需的庫：Adafruit_MPU6050 和 Adafruit_Sensor。#include &lt;Adafruit_MPU6050.h&gt;#include &lt;Adafruit_Sensor.h&gt;&#x2F;&#x2F;創建一個名為 mpu 的 Adafruit_MPU6050 對象來處理傳感器。Adafruit_MPU6050 mpu;void setup() &#123;  Serial.begin(115200);  &#x2F;&#x2F;初始化 MPU-6050 傳感器。  if (!mpu.begin()) &#123;    Serial.println(&quot;Sensor init failed&quot;);    while (1)      yield();  &#125;  Serial.println(&quot;Found a MPU-6050 sensor&quot;);&#125;void loop() &#123;  &#x2F;&#x2F;使用當前讀數獲取新的傳感器事件。  sensors_event_t a, g, temp;  mpu.getEvent(&amp;a, &amp;g, &amp;temp);  &#x2F;&#x2F;列出加速度值  Serial.print(&quot;Accelerometer &quot;);  Serial.print(&quot;X: &quot;);  Serial.print(a.acceleration.x, 1);  Serial.print(&quot; m&#x2F;s^2, &quot;);  Serial.print(&quot;Y: &quot;);  Serial.print(a.acceleration.y, 1);  Serial.print(&quot; m&#x2F;s^2, &quot;);  Serial.print(&quot;Z: &quot;);  Serial.print(a.acceleration.z, 1);  Serial.println(&quot; m&#x2F;s^2&quot;);  &#x2F;&#x2F;列出陀螺儀值  Serial.print(&quot;Gyroscope &quot;);  Serial.print(&quot;X: &quot;);  Serial.print(g.gyro.x, 1);  Serial.print(&quot; rps, &quot;);  Serial.print(&quot;Y: &quot;);  Serial.print(g.gyro.y, 1);  Serial.print(&quot; rps, &quot;);  Serial.print(&quot;Z: &quot;);  Serial.print(g.gyro.z, 1);  Serial.println(&quot; rps&quot;);  &#x2F;&#x2F;列出溫度值  Serial.print(&quot;Temperture &quot;);  Serial.print(temp.temperature);  Serial.println(&quot; degC&quot;);  delay(500);&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="結果1"><a href="#結果1" class="headerlink" title="結果1"></a>結果1</h2><p>移動傳感器可以得到一連串的數值</p><p><a href="https://draft.blogger.com/blog/post/edit/3809681606094011522/9006409806488393795#"><img src="https://1.bp.blogspot.com/-nwWOKArHvRs/YTrWSN3ubqI/AAAAAAAAe6A/67EVTgLVzyc1wwpcGPY6T3ogQRq99VECgCNcBGAsYHQ/w503-h242/1.jpg"></a></p><hr><h2 id="量測數值顯示於OLED"><a href="#量測數值顯示於OLED" class="headerlink" title="量測數值顯示於OLED"></a>量測數值顯示於OLED</h2><h3 id="匯入Adafruit-SSD1306函式庫後"><a href="#匯入Adafruit-SSD1306函式庫後" class="headerlink" title="匯入Adafruit_SSD1306函式庫後"></a>匯入<a href="https://draft.blogger.com/blog/post/edit/3809681606094011522/9006409806488393795#">Adafruit_SSD1306</a>函式庫後</h3><h2 id="程式碼2"><a href="#程式碼2" class="headerlink" title="程式碼2"></a>程式碼2</h2><h3 id="使用範例並上傳-1"><a href="#使用範例並上傳-1" class="headerlink" title="使用範例並上傳"></a>使用範例並上傳</h3><pre class="line-numbers language-c#" data-language="c#"><code class="language-c#">#include &lt;Arduino.h&gt;&#x2F;&#x2F;包含 MPU-6050 傳感器所需的庫：Adafruit_MPU6050 和 Adafruit_Sensor。#include &lt;Adafruit_MPU6050.h&gt;#include &lt;Adafruit_Sensor.h&gt;&#x2F;&#x2F;引進SSD1306所須使用的函式庫#include &lt;Wire.h&gt;#include &lt;Adafruit_GFX.h&gt;#include &lt;Adafruit_SSD1306.h&gt;&#x2F;&#x2F;創建一個名為 mpu 的 Adafruit_MPU6050 對象來處理傳感器。Adafruit_MPU6050 mpu;&#x2F;&#x2F;設定OLED的寛高#define SCREEN_WIDTH 128 &#x2F;&#x2F; OLED display width, in pixels#define SCREEN_HEIGHT 64 &#x2F;&#x2F; OLED display height, in pixels#define OLED_RESET -1 &#x2F;&#x2F; Reset pin # (or -1 if sharing Arduino reset pin)#define SCREEN_ADDRESS 0x3C &#x2F;&#x2F;&#x2F;&lt; See datasheet for Address; 0x3D for 128x64, 0x3C for 128x32Adafruit_SSD1306 display(SCREEN_WIDTH, SCREEN_HEIGHT, &amp;Wire, OLED_RESET);&#x2F;&#x2F; SSD1306_SWITCHCAPVCC &#x3D; generate display voltage from 3.3V internally  void setup() &#123;  Serial.begin(115200);  &#x2F;&#x2F;初始化 MPU-6050 傳感器。  if (!mpu.begin()) &#123;    Serial.println(&quot;Sensor init failed&quot;);    while (1)      yield();  &#125;  Serial.println(&quot;Found a MPU-6050 sensor&quot;);  if (!display.begin(SSD1306_SWITCHCAPVCC, 0x3C)) &#123; &#x2F;&#x2F; Address 0x3C for 128x32  Serial.println(F(&quot;SSD1306 allocation failed&quot;));  for (;;)    ; &#x2F;&#x2F; Don&#39;t proceed, loop forever  &#125;  display.display();  &#x2F;&#x2F;設置顯示的字體大小和顏色  delay(500); &#x2F;&#x2F; Pause for 2 seconds  display.setTextSize(1);  display.setTextColor(WHITE);  display.setRotation(0);&#125;void loop() &#123;  &#x2F;&#x2F;使用當前讀數獲取新的傳感器事件。  sensors_event_t a, g, temp;  mpu.getEvent(&amp;a, &amp;g, &amp;temp);  &#x2F;&#x2F;初始化後清屏  display.clearDisplay();  &#x2F;&#x2F;將顯示光標設置為 (0,0)  display.setCursor(0, 0);    &#x2F;&#x2F;列出加速度值  Serial.print(&quot;Accelerometer &quot;);  Serial.print(&quot;X: &quot;);  Serial.print(a.acceleration.x, 1);  Serial.print(&quot; m&#x2F;s^2, &quot;);  Serial.print(&quot;Y: &quot;);  Serial.print(a.acceleration.y, 1);  Serial.print(&quot; m&#x2F;s^2, &quot;);  Serial.print(&quot;Z: &quot;);  Serial.print(a.acceleration.z, 1);  Serial.println(&quot; m&#x2F;s^2&quot;);    &#x2F;&#x2F;OLED上顯示加速度  display.println(&quot;Accelerometer - m&#x2F;s^2&quot;);  display.print(a.acceleration.x, 1);  display.print(&quot;, &quot;);  display.print(a.acceleration.y, 1);  display.print(&quot;, &quot;);  display.print(a.acceleration.z, 1);  display.println(&quot;&quot;);    &#x2F;&#x2F;列出陀螺儀值  Serial.print(&quot;Gyroscope &quot;);  Serial.print(&quot;X: &quot;);  Serial.print(g.gyro.x, 1);  Serial.print(&quot; rps, &quot;);  Serial.print(&quot;Y: &quot;);  Serial.print(g.gyro.y, 1);  Serial.print(&quot; rps, &quot;);  Serial.print(&quot;Z: &quot;);  Serial.print(g.gyro.z, 1);  Serial.println(&quot; rps&quot;);    &#x2F;&#x2F;OLED上顯示陀螺儀  display.println(&quot;Gyroscope - rps&quot;);  display.print(g.gyro.x, 1);  display.print(&quot;, &quot;);  display.print(g.gyro.y, 1);  display.print(&quot;, &quot;);  display.print(g.gyro.z, 1);  display.println(&quot;&quot;);    display.display();  &#x2F;&#x2F;列出溫度值  Serial.print(&quot;Temperture &quot;);  Serial.print(temp.temperature);  Serial.println(&quot; degC&quot;);  delay(500);&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="結果2"><a href="#結果2" class="headerlink" title="結果2"></a>結果2</h2><p><a href="https://draft.blogger.com/blog/post/edit/3809681606094011522/9006409806488393795#"><img src="https://lh3.googleusercontent.com/-KQTNRSGg3Ng/YTrulDcPSDI/AAAAAAAAe6I/AkdcixxEVEEvTr9S-74ttZ_6ckj9UiuJwCNcBGAsYHQ/w340-h718/1631252067181599-0.png"></a></p>]]></content>
      
      
      <categories>
          
          <category> esp32 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> mpu6050 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ESP-01S燒錄固件</title>
      <link href="/2021/09/09/esp-01s-shao-lu-gu-jian/"/>
      <url>/2021/09/09/esp-01s-shao-lu-gu-jian/</url>
      
        <content type="html"><![CDATA[<h1 id="ESP-01S燒錄固件"><a href="#ESP-01S燒錄固件" class="headerlink" title="ESP-01S燒錄固件"></a>ESP-01S燒錄固件</h1><h6 id="tags-esp8266-esp-01s"><a href="#tags-esp8266-esp-01s" class="headerlink" title="tags: esp8266 esp-01s"></a>tags: <code>esp8266</code> <code>esp-01s</code></h6><h3 id=""><a href="#" class="headerlink" title=""></a></h3><p><a href="https://lh3.googleusercontent.com/-F1HF0hnInPA/YHF7-0mNiDI/AAAAAAAAeEM/LdWcFx7K_u42Lxo56UDt4jPQj9hYi7nzQCNcBGAsYHQ/s1600/1618050040927051-0.png"><img src="https://lh3.googleusercontent.com/-F1HF0hnInPA/YHF7-0mNiDI/AAAAAAAAeEM/LdWcFx7K_u42Lxo56UDt4jPQj9hYi7nzQCNcBGAsYHQ/w180-h320/1618050040927051-0.png"></a></p><p><a href="https://lh3.googleusercontent.com/-_wOpaSEbZmQ/YHF79VmmpOI/AAAAAAAAeEE/b7hkFdVGLnARPBM5DmbKhieQ8FWbyXK8gCNcBGAsYHQ/s1600/1618050034996435-2.png"><img src="https://lh3.googleusercontent.com/-_wOpaSEbZmQ/YHF79VmmpOI/AAAAAAAAeEE/b7hkFdVGLnARPBM5DmbKhieQ8FWbyXK8gCNcBGAsYHQ/w173-h307/1618050034996435-2.png"></a><a href="https://lh3.googleusercontent.com/-0CbaIZH0aLo/YHF7-MaCTFI/AAAAAAAAeEI/78bL1qrM1NYdE0gf9jrW19zEYFwtCaw5wCNcBGAsYHQ/s1600/1618050038056312-1.png"><img src="https://lh3.googleusercontent.com/-0CbaIZH0aLo/YHF7-MaCTFI/AAAAAAAAeEI/78bL1qrM1NYdE0gf9jrW19zEYFwtCaw5wCNcBGAsYHQ/w177-h315/1618050038056312-1.png"></a>  </p><p>\</p><h2 id="1-下載所須軟件"><a href="#1-下載所須軟件" class="headerlink" title="1.下載所須軟件"></a>1.下載所須軟件</h2><p><a href="https://pan.baidu.com/s/14076XZTtSIxsHQ7HFq2NNA">https://pan.baidu.com/s/14076XZTtSIxsHQ7HFq2NNA </a></p><p>提取码：szw4</p><h2 id="2-燒錄步驟-視頻"><a href="#2-燒錄步驟-視頻" class="headerlink" title="2.燒錄步驟-視頻"></a>2.燒錄步驟-視頻</h2><hr><h2 id="實驗視頻"><a href="#實驗視頻" class="headerlink" title="[實驗視頻] "></a>[實驗視頻] </h2><div class="video-container"><iframe src="https://www.youtube.com/embed/NDTrCgOkQDo" frameborder="0" loading="lazy" allowfullscreen></iframe></div>  <h2 id="3-遇到ESP8266-DOWNOAD-TOOL打不開怎麼辦"><a href="#3-遇到ESP8266-DOWNOAD-TOOL打不開怎麼辦" class="headerlink" title="3.遇到ESP8266 DOWNOAD TOOL打不開怎麼辦"></a>3.遇到ESP8266 DOWNOAD TOOL打不開怎麼辦</h2><h4 id="請到-lt-開始-gt-–-lt-設定-gt-–-lt-時間與語言-gt-–-lt-地區-gt-–-lt-相關設定-gt-–-lt-地區-gt-–-lt-系統管理-gt"><a href="#請到-lt-開始-gt-–-lt-設定-gt-–-lt-時間與語言-gt-–-lt-地區-gt-–-lt-相關設定-gt-–-lt-地區-gt-–-lt-系統管理-gt" class="headerlink" title="請到&lt;開始&gt;–&lt;設定&gt;–&lt;時間與語言&gt;–&lt;地區&gt;–&lt;相關設定&gt;–&lt;地區&gt;–&lt;系統管理&gt;"></a>請到&lt;開始&gt;–&lt;設定&gt;–&lt;時間與語言&gt;–&lt;地區&gt;–&lt;相關設定&gt;–&lt;地區&gt;–&lt;系統管理&gt;</h4><h4 id="–-lt-變更系統地區設定-gt-–-lt-格式-gt-改成-lt-中文-簡體-中國-gt-因為這軟件是大陸製"><a href="#–-lt-變更系統地區設定-gt-–-lt-格式-gt-改成-lt-中文-簡體-中國-gt-因為這軟件是大陸製" class="headerlink" title="–&lt;變更系統地區設定&gt;–&lt;格式&gt;,改成&lt;中文(簡體,中國)&gt;因為這軟件是大陸製"></a><strong>–&lt;變更系統地區設定&gt;–&lt;格式&gt;,改成&lt;中文(簡體,中國)&gt;因為這軟件是大陸製</strong></h4><p><strong>作的，所以必須把地區改為中國才能開啓。</strong></p>]]></content>
      
      
      <categories>
          
          <category> esp8266 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> ESP-01S </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>WEMOS_D1_R2_WIFI測試WIFI功能</title>
      <link href="/2021/09/09/wemos-d1-r2-wifi-ce-shi-wifi-gong-neng/"/>
      <url>/2021/09/09/wemos-d1-r2-wifi-ce-shi-wifi-gong-neng/</url>
      
        <content type="html"><![CDATA[<h1 id="WEMOS-D1-R2-WIFI測試WIFI功能"><a href="#WEMOS-D1-R2-WIFI測試WIFI功能" class="headerlink" title="WEMOS_D1_R2_WIFI測試WIFI功能"></a>WEMOS_D1_R2_WIFI測試WIFI功能</h1><p><strong>WeMos D1 WiFi Arduino UNO 開發板ESP8266 直接用Arduino IDE</strong></p><p><strong><a href="https://draft.blogger.com/blog/post/edit/2883052724878840475/2012246015755250549#"><img src="https://lh3.googleusercontent.com/-RdB-26UI6H8/YJkQTnqUh6I/AAAAAAAAeIA/2rAjRsJoWKoPyLTOn09Ql2xhZIJJYQsCgCNcBGAsYHQ/s1600/1620643913270658-0.png"></a></strong></p><ol><li> <strong>WeMos D1 基於ESP-8266EX</strong></li><li> <strong>Arduino兼容，使用Arduino IDE來編程</strong></li><li> <strong>11 x I/O 引腳</strong></li><li> <strong>1 x ADC 引腳（輸入範圍0-3.3V）</strong></li><li> <strong>支持OTA無線上傳</strong></li><li>**板載5V 1A開關電源（最高輸入電壓24V)<br> **</li></ol><p>上面那些是這款板子的主要介紹，前陣子在淘%買了兩塊，就放著沒動，</p><p>今早心血來潮翻了翻百寶袋，決定拿來把玩，其實有點搞不懂，它到底是</p><p>esp8266還是Arduino，看起來就是像把esp01鑲在arduino uno的</p><p>板子上啊……!!!!!不管了，反正拿到就用吧！</p><p><strong>一些介紹和賣場上都有下面這個提示</strong></p><h2 id="WeMos-D1-安裝教學"><a href="#WeMos-D1-安裝教學" class="headerlink" title="WeMos D1 安裝教學"></a>WeMos D1 安裝教學</h2><p>原廠技術文件說明 <a href="https://draft.blogger.com/blog/post/edit/2883052724878840475/2012246015755250549#">https://www.wemos.cc/product/d1.html</a></p><p>Arduino 安裝說明 <a href="https://draft.blogger.com/blog/post/edit/2883052724878840475/2012246015755250549#">https://www.wemos.cc/tutorial/get-started-arduino.html</a></p><p>NodeMCU 安裝說明  <a href="https://draft.blogger.com/blog/post/edit/2883052724878840475/2012246015755250549#">https://www.wemos.cc/tutorial/get-started-nodemcu.html</a></p><p>教學 <a href="https://draft.blogger.com/blog/post/edit/2883052724878840475/2012246015755250549#">http://www.instructables.com/id/Programming-the-WeMos-Using-Arduino-SoftwareIDE/</a></p><p>相關入門程式開發與說明<a href="https://draft.blogger.com/blog/post/edit/2883052724878840475/2012246015755250549#"> https://github.com/wemos</a></p><p><strong>安裝硬件包後，直接用Arduino IDE 開發，跟Arduino UNO 一樣操作****最便宜的WiFi Arduino 板.</strong></p><hr><h2 id="如何安裝程式庫"><a href="#如何安裝程式庫" class="headerlink" title="如何安裝程式庫"></a>如何安裝程式庫</h2><h3 id="步驟1"><a href="#步驟1" class="headerlink" title="步驟1:"></a>步驟1:</h3><p><strong>偏好設定,在下方額外的開發板管理員網址:輸入如下網址</strong></p><p><strong><a href="http://arduino.esp8266.com/stable/package/_esp8266com/_index.json">http://arduino.esp8266.com/stable/package\_esp8266com\_index.json</a></strong></p><p>**</p><p><a href="https://draft.blogger.com/blog/post/edit/2883052724878840475/2012246015755250549#"><img src="https://1.bp.blogspot.com/-E96XTfrC1-w/YJopm1o80LI/AAAAAAAAeIM/kJ76QffnQ9YXwOOIPDKjsrbVEuPspJdnQCNcBGAsYHQ/w701-h394/1.jpg"></a></p><h3 id="步驟2"><a href="#步驟2" class="headerlink" title="步驟2:"></a>步驟2:</h3><p>到IDE的_工具&gt;&gt;開發板&gt;&gt;開發板管理員 搜尋輸入”esp8266”並選擇安裝</p><p><a href="https://draft.blogger.com/blog/post/edit/2883052724878840475/2012246015755250549#"><img src="https://1.bp.blogspot.com/-0AEyGgEnygE/YJoqh-kLB7I/AAAAAAAAeIU/hoaSoUkNMDYCmkmaMJBe8pLhY-7qNxXYgCNcBGAsYHQ/w650-h366/2.jpg"></a></p><p>_</p><h3 id="步驟4"><a href="#步驟4" class="headerlink" title="步驟4:"></a>步驟4:</h3><p>按照下圖選擇開發板類型 工具&gt;&gt;開發板&gt;&gt;選 WeMos D1 R2</p><p>**</p><p><a href="https://draft.blogger.com/blog/post/edit/2883052724878840475/2012246015755250549#"><img src="https://1.bp.blogspot.com/-6GQ9ywhfmEc/YJorxTeMzsI/AAAAAAAAeIc/rVj4r-ryng4YoF-fas9sis4BtZtvb3yVwCNcBGAsYHQ/w723-h407/3.jpg"></a></p><p>_</p><hr><p>_</p><h3 id="步驟5"><a href="#步驟5" class="headerlink" title="步驟5:"></a>步驟5:</h3><p><strong>選擇”<em>WIFIScan</em>“範例，可搜尋附近可用的WIFI，並顯示於”<em>序列埠監控視窗</em>“</strong></p><p><a href="https://draft.blogger.com/blog/post/edit/2883052724878840475/2012246015755250549#"><img src="https://1.bp.blogspot.com/-xLmmThmFzxM/YJotsue9qnI/AAAAAAAAeIk/dXGmBeLU7Aw3gCNaQ6cDnFC4576QwSikACNcBGAsYHQ/w668-h376/4.jpg"></a></p><hr><p><strong>以下是搜尋附近可用WIFI的範例</strong></p><div class="video-container"><iframe src="https://www.youtube.com/embed/T76myCMsjR0" frameborder="0" loading="lazy" allowfullscreen></iframe></div>]]></content>
      
      
      <categories>
          
          <category> esp8266 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> wifi </tag>
            
            <tag> WEMOS_D1_R2 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Sharp紅外線測距模組-GP2Y0A02YK0F</title>
      <link href="/2021/09/08/sharp-hong-wai-xian-ce-ju-mo-zu-gp2y0a02yk0f/"/>
      <url>/2021/09/08/sharp-hong-wai-xian-ce-ju-mo-zu-gp2y0a02yk0f/</url>
      
        <content type="html"><![CDATA[<h1 id="Sharp紅外線測距模組-GP2Y0A02YK0F"><a href="#Sharp紅外線測距模組-GP2Y0A02YK0F" class="headerlink" title="Sharp紅外線測距模組-GP2Y0A02YK0F"></a>Sharp紅外線測距模組-GP2Y0A02YK0F</h1><hr><p><a href="https://draft.blogger.com/blog/post/edit/6959160158145357673/4207629859466699123#"><img src="https://1.bp.blogspot.com/-E27U2c45YTk/YF_zrDzLiBI/AAAAAAAAd9w/B35SPI2O59cx5HFVCSGC39ARIyicZ5LXQCNcBGAsYHQ/s320/infrared-proximity-sensor-long-range-sharp-gp2y0a02yk0f.jpg"></a></p><hr><p>紅外線測距模組一般有長中短距，這是Sharp公司出的模組，包括較短距離（2 – 15厘米）GP2Y0A51SK0F，中距（10 – 80厘米）GP2Y0A21YK0F和遠距離（20 – 150厘米）GP2Y0A02YK0F。我們還搭載了新款夏普GP2Y0A60SZ模擬距離傳感器（10 – 150厘米），提供最低的最小探測距離，最大探測距離，3 V寬輸出電壓差，高60 Hz採樣速率，低至2.7 V的操作電壓和可選的使能控制，全部採用更小的封裝，可以拿來做為廁所自動沖手感應。</p><hr><h2 id="接線方式"><a href="#接線方式" class="headerlink" title="接線方式"></a>接線方式</h2><p><a href="https://draft.blogger.com/blog/post/edit/6959160158145357673/4207629859466699123#"><img src="https://1.bp.blogspot.com/-Kte32mfT6jA/YF_1Sj0X1XI/AAAAAAAAd94/JyjyLXes3iYBpmgU_n79LQmMCPmZySNPQCNcBGAsYHQ/w463-h287/21402224929894_84.jpg"></a></p><hr><h2 id="程式碼"><a href="#程式碼" class="headerlink" title="程式碼"></a>程式碼</h2><p>下載函式庫</p><p><a href="https://draft.blogger.com/blog/post/edit/6959160158145357673/4207629859466699123#">https://gist.github.com/reefwing/6bb74409774d5152f904</a>  </p><p>依照模組型號在下方程式裡的model寫入規定的值,否則執行測出的距離會不準</p><pre class="line-numbers language-c#" data-language="c#"><code class="language-c#">#include &lt;SharpIR.h&gt;#include &lt;Wire.h&gt;#define IR A2 &#x2F;&#x2F; define signal pin#define model 20150 &#x2F;&#x2F; used 1080 because model GP2Y0A21YK0F is used&#x2F;&#x2F; Sharp IR code for Robojax.com&#x2F;&#x2F; ir: the pin where your sensor is attached&#x2F;&#x2F; model: an int that determines your sensor:  1080 for GP2Y0A21Y&#x2F;&#x2F;                                            20150 for GP2Y0A02Y&#x2F;&#x2F;                                            430 for GP2Y0A41SK   &#x2F;*2 to 15 cm GP2Y0A51SK0F  use 10804 to 30 cm GP2Y0A41SK0F &#x2F; GP2Y0AF30 series  use 43010 to 80 cm GP2Y0A21YK0F  use 108010 to 150 cm GP2Y0A60SZLF use 1015020 to 150 cm GP2Y0A02YK0F use 20150100 to 550 cm GP2Y0A710K0F  use 100550 *&#x2F; SharpIR SharpIR(IR, model);void setup() &#123; Serial.begin(9600); Serial.println(&quot;Robojax Sharp IR  &quot;);&#125;void loop() &#123;  delay(500);     int dis&#x3D;SharpIR.distance();  &#x2F;&#x2F; this returns the distance to the object you&#39;re measuring  Serial.print(&quot;Mean distance: &quot;);  &#x2F;&#x2F; returns it to the serial monitor  Serial.println(dis);&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><div class="video-container"><iframe src="https://www.youtube.com/embed/zyiol8Ugh8M" frameborder="0" loading="lazy" allowfullscreen></iframe></div>]]></content>
      
      
      <categories>
          
          <category> arduino </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Sharp紅外線測距模組 </tag>
            
            <tag> GP2Y0A02YK0F </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>男廁小便池自動感應沖手設備</title>
      <link href="/2021/09/08/nan-ce-xiao-bian-chi-zi-dong-gan-ying-chong-shou-she-bei/"/>
      <url>/2021/09/08/nan-ce-xiao-bian-chi-zi-dong-gan-ying-chong-shou-she-bei/</url>
      
        <content type="html"><![CDATA[<h1 id="男廁小便池自動感應沖手設備"><a href="#男廁小便池自動感應沖手設備" class="headerlink" title="男廁小便池自動感應沖手設備"></a>男廁小便池自動感應沖手設備</h1><p>第一次應女友所托，要在公司的男廁小便池安裝一個自動感應沖水設備一般我們在外的公廁，很少人會在小便後主動去沖水，尤其是用考克。<br>原本我的考量是買一個水閥用arduino nano控制，但仔細評估後，發現水管沒有合適的水閥可裝，想了幾天後，有個靈感告訴我，可以用伺服馬達做個連桿來推拉考克，於是我就從程式開始著手……</p><h2 id="先上安裝好測試的視頻瞧瞧"><a href="#先上安裝好測試的視頻瞧瞧" class="headerlink" title="先上安裝好測試的視頻瞧瞧"></a>先上安裝好測試的視頻瞧瞧</h2><div class="video-container"><iframe src="https://www.youtube.com/embed/3aZeTEXXZ4k" frameborder="0" loading="lazy" allowfullscreen></iframe></div><h2 id="材料"><a href="#材料" class="headerlink" title="材料"></a>材料</h2><p><strong>MG996R x1</strong></p><p><strong>Arduino nano x1</strong></p><p><strong>Sharp 紅外線測距模組 (GP2Y0A02YK0F) x1</strong></p><p><strong>pca9685 x1</strong></p><p><strong>3D列印外殼</strong></p><p><strong>盒-<a href="https://draft.blogger.com/blog/post/edit/6959160158145357673/2013353077496703013#">https://www.tinkercad.com/things/1khLTXx7P3h-irbox</a></strong></p><p><strong>蓋-<a href="https://draft.blogger.com/blog/post/edit/6959160158145357673/2013353077496703013#">https://www.tinkercad.com/things/keXzxpyY8vK-ircover</a></strong></p><p>** 伺服馬達盒-<a href="https://draft.blogger.com/blog/post/edit/6959160158145357673/2013353077496703013#">https://www.tinkercad.com/things/7wSmGhsgi9x-servobracket-2</a>**</p><p><strong>杜邦線 若干</strong></p><p><strong>接線</strong></p><p><a href="https://draft.blogger.com/blog/post/edit/6959160158145357673/2013353077496703013#"><img src="https://lh3.googleusercontent.com/-y_FJdEKKTrI/YGRIihgeTwI/AAAAAAAAd-c/FrxbPjv1ReYcncDWJQRq2M0kgVxyKq-qgCNcBGAsYHQ/s1600/1617184891602974-0.png"></a></p><p>**</p><hr><h2 id="測試紅外線測距模組"><a href="#測試紅外線測距模組" class="headerlink" title="測試紅外線測距模組"></a>測試紅外線測距模組</h2><p>首先先測試紅外線模組的距離，量測現場環境要感應的範圍</p><p>套用在程式裡。</p><p>紅外線模組可參考此篇—<a href="https://draft.blogger.com/blog/post/edit/6959160158145357673/2013353077496703013#">Sharp紅外線模組測試</a></p><p>或是可參考這篇<a href="https://draft.blogger.com/blog/post/edit/6959160158145357673/2013353077496703013#">https://robojax.com/learn/arduino/?vid=robojax-sharp_IR</a></p><hr><h2 id="條件參數設好之後加入伺服馬達的動作角度"><a href="#條件參數設好之後加入伺服馬達的動作角度" class="headerlink" title="條件參數設好之後加入伺服馬達的動作角度"></a>條件參數設好之後加入伺服馬達的動作角度</h2><p>這裡必須配合要裝的環境，修正伺服馬達的運轉角度</p><p>首先要載入pca9685舵控板的庫,配合紅外測距模組的動</p><p>作區間值,使其轉向設定的角度。</p><p><a href="https://draft.blogger.com/blog/post/edit/6959160158145357673/2013353077496703013#"><img src="https://lh3.googleusercontent.com/-OlsGgcbPzvo/YGQmbimGBiI/AAAAAAAAd-Q/Sql6TpYatTEuwQgN9_o17tuWnuJVm5X7gCNcBGAsYHQ/s1600/1617176145655067-0.png"></a></p><p><a href="https://draft.blogger.com/blog/post/edit/6959160158145357673/2013353077496703013#"><img src="https://lh3.googleusercontent.com/-AM3GkPjLb4I/YGQmUbuW_LI/AAAAAAAAd-M/wtm4Us8lnWsnJlOVikMK-3cs7ccslLluQCNcBGAsYHQ/s1600/1617176089549530-1.png"></a></p><hr><h2 id="程式碼"><a href="#程式碼" class="headerlink" title="程式碼"></a>程式碼</h2><pre class="line-numbers language-c#" data-language="c#"><code class="language-c#">#include &lt;SharpIR.h&gt;#include &lt;Wire.h&gt;#include &lt;Adafruit_PWMServoDriver.h&gt;  Adafruit_PWMServoDriver pwm &#x3D; Adafruit_PWMServoDriver();const int servomin&#x3D;150;const int servomax&#x3D;600;int sensor;unsigned long time_old&#x3D;0;#define IR A2 &#x2F;&#x2F; define signal pin#define model 20150 &#x2F;&#x2F; used 1080 because model GP2Y0A21YK0F is used&#x2F;&#x2F; Sharp IR code for Robojax.com&#x2F;&#x2F; ir: the pin where your sensor is attached&#x2F;&#x2F; model: an int that determines your sensor:  1080 for GP2Y0A21Y&#x2F;&#x2F;                                            20150 for GP2Y0A02Y&#x2F;&#x2F;                                            430 for GP2Y0A41SK   &#x2F;*2 to 15 cm GP2Y0A51SK0F  use 10804 to 30 cm GP2Y0A41SK0F &#x2F; GP2Y0AF30 series  use 43010 to 80 cm GP2Y0A21YK0F  use 108010 to 150 cm GP2Y0A60SZLF use 1015020 to 150 cm GP2Y0A02YK0F use 20150100 to 550 cm GP2Y0A710K0F  use 100550 *&#x2F;SharpIR SharpIR(IR, model);void setup() &#123; Serial.begin(9600); Serial.println(&quot;Robojax Sharp IR  &quot;); pwm.begin(); pwm.setOscillatorFrequency(27000000); pwm.setPWMFreq(60); pwm.setPWM(14, 0, 590); delay(10);&#125;void loop() &#123;  delay(500);     int dis&#x3D;SharpIR.distance();  &#x2F;&#x2F; this returns the distance to the object you&#39;re measuring  Serial.print(&quot;Mean distance: &quot;);  &#x2F;&#x2F; returns it to the serial monitor  Serial.println(dis);  if (dis&lt;20)&#123;    Serial.println(&quot;close sw&quot;);  &#125;else if(dis&gt;&#x3D;20 &amp;&amp; dis&lt;&#x3D;70)&#123;    unsigned long time_now&#x3D;millis();    if (time_now-time_old&gt;600)&#123;      Serial.println(&quot;open water&quot;);      pwm.setPWM(14, 0, 300);      delay(6000);      pwm.setPWM(14, 0, 590);      time_now&#x3D;time_old;    &#125;  &#125;  &#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>]]></content>
      
      
      
        <tags>
            
            <tag> GP2Y0A02YK0F </tag>
            
            <tag> Sharp紅外線測距 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Blynk控制adafrit_pixels燈條-ESP32</title>
      <link href="/2021/09/05/blynk-kong-zhi-adafrit-pixels-deng-tiao-esp32/"/>
      <url>/2021/09/05/blynk-kong-zhi-adafrit-pixels-deng-tiao-esp32/</url>
      
        <content type="html"><![CDATA[<h1 id="Blynk控制adafrit-pixels燈條-ESP32"><a href="#Blynk控制adafrit-pixels燈條-ESP32" class="headerlink" title="Blynk控制adafrit_pixels燈條-ESP32"></a>Blynk控制adafrit_pixels燈條-ESP32</h1><h6 id="tags-esp32-ws2812-adafruit-neopixels"><a href="#tags-esp32-ws2812-adafruit-neopixels" class="headerlink" title="tags: esp32 ws2812 adafruit_neopixels"></a>tags: <code>esp32</code> <code>ws2812</code> <code>adafruit_neopixels</code></h6><p><a href="https://draft.blogger.com/blog/post/edit/3809681606094011522/5650765682937321909#"><img src="https://1.bp.blogspot.com/-dibi0v6AESo/YTSc8SBnN0I/AAAAAAAAe5E/z0aDdHCfKO4XEB69iZ9KKHQaws0sU_RtgCNcBGAsYHQ/w351-h468/20210905_153803.jpg"></a></p><h2 id="接線"><a href="#接線" class="headerlink" title="接線"></a><em>接線</em></h2><p><em>將 RGB LED 燈條連接到 ESP32 或 ESP8266 非常簡單。您需要將 5V 施加到 VCC 引腳，GND 到 GND，並將 GPIO 5連接到 IN（數據）引腳。我們將數據引腳連接到 GPIO 5。</em></p><p>_</p><p><a href="https://draft.blogger.com/blog/post/edit/3809681606094011522/5650765682937321909#"><img src="https://1.bp.blogspot.com/-fUXQhZg0HFw/YRXRFihwvBI/AAAAAAAAey0/RH-qjp4k5YIGzTRQ_XXrT2rthb8xEnkLgCNcBGAsYHQ/w418-h314/image.png"></a></p><h2 id="Blynk-App的設置"><a href="#Blynk-App的設置" class="headerlink" title="Blynk App的設置"></a><em>Blynk App的設置</em></h2><p>Blynk 是一個可以在 Android 和 IOS 設備上運行的應用程序，以使用我們的智能手機控制任何物聯網設備。我們可以創建自己的圖形用戶界面來設計 IoT 應用程序 GUI。我們之前將 Blynk 與 ESP32 一起使用，並使用 Blynk 構建了許多其他基於物聯網的項目。  </p><p>在設置之前，從 Google Play 商店下載 Blynk 應用程序（IOS 用戶可以從 Apple Store 下載）並使用您的電子郵件 ID 和密碼註冊。</p><h3 id="創建一個新項目："><a href="#創建一個新項目：" class="headerlink" title="創建一個新項目："></a>創建一個新項目：</h3><p>安裝成功後，打開應用程序並單擊“新建項目”。然後它會彈出一個新的屏幕，我們需要在其中設置項目名稱、電路板和連接類型等參數。對於此項目，選擇設備為“ESP32 Dev Board”，連接類型為 Wi-Fi，然後單擊“創建”。</p><p><a href="https://draft.blogger.com/blog/post/edit/3809681606094011522/5650765682937321909#"><img src="https://iotdesignpro.com/sites/default/files/inline-images/Blynk-Application-Setup.png"></a></p><p>_成功創建項目後，我們將在註冊郵件中收到一個 Authenticate ID。保存身份驗證 ID 以供將來參考。</p><h3 id="創建圖形用戶界面："><a href="#創建圖形用戶界面：" class="headerlink" title="創建圖形用戶界面："></a>創建圖形用戶界面：</h3><p>在 Blynk 中打開項目，單擊“+”號，它將顯示許多小部件。在我們的例子中，我們需要一個被列為“zeRGBa”的 RGB 顏色選擇器和一個用於改變 LED 燈條操作模式的按鈕。</p><p><a href="https://draft.blogger.com/blog/post/edit/3809681606094011522/5650765682937321909#"><img src="https://iotdesignpro.com/sites/default/files/inline-images/Creating-GUI_0.png"></a></p><h3 id="在小部件中設置參數："><a href="#在小部件中設置參數：" class="headerlink" title="在小部件中設置參數："></a>在小部件中設置參數：</h3><p>將小部件拖動到項目後，現在設置其參數，用於將控制值的顏色和模式發送到 ESP32。</p><p>點擊 ZeRGBa，我們將看到一個名為 ZeRGBa 設置的屏幕。然後將輸出選項設置為“虛擬引腳”並將引腳設置為“V2”，如下圖所示。</p><p><a href="https://draft.blogger.com/blog/post/edit/3809681606094011522/5650765682937321909#"><img src="https://1.bp.blogspot.com/-0LzJEeATXZg/YTSj1PJpeLI/AAAAAAAAe5M/TkbTfhzLzY8ylJOpJOqSsp6HBYZtQ0PSgCNcBGAsYHQ/w330-h530/Blynk-Application-Setup-for-Neopixel.jpg"></a></p><hr><h2 id="所須的函式庫"><a href="#所須的函式庫" class="headerlink" title="所須的函式庫"></a>所須的函式庫</h2><p><a href="https://draft.blogger.com/blog/post/edit/3809681606094011522/5650765682937321909#">blynk-library</a></p><p><a href="https://draft.blogger.com/blog/post/edit/3809681606094011522/5650765682937321909#">Adafruit_NeoPixel</a></p><h2 id="完整程式碼"><a href="#完整程式碼" class="headerlink" title="完整程式碼"></a>完整程式碼</h2><pre class="line-numbers language-c++" data-language="c++"><code class="language-c++">#include &lt;BlynkSimpleEsp32.h&gt;#include &lt;WiFi.h&gt;#include &lt;WiFiClient.h&gt;#include &lt;Adafruit_NeoPixel.h&gt;  &#x2F;&#x2F;燈條腳位#define PIN 15&#x2F;&#x2F;共有顆led#define NUM 8&#x2F;&#x2F;設定燈條的相關系數Adafruit_NeoPixel pixels &#x3D; Adafruit_NeoPixel(60, PIN, NEO_GRB + NEO_KHZ800);int data,r,g,b;&#x2F;&#x2F;blynk的獨一authchar auth[] &#x3D; &quot;y79vpg_qnnPpaIGXhTUUnuy6sC6p6zq8&quot;;char ssid[] &#x3D; &quot;---&quot;;char password[] &#x3D; &quot;--------&quot;;  &#x2F;&#x2F;設定燈條接收到的值並反應在燈條上void static1(int r, int g, int b)&#123;  for(int i&#x3D;0;i&lt;&#x3D;NUM;i++)&#123;  pixels.setPixelColor(i, pixels.Color(r,g,b));  pixels.show();  &#125;&#125;&#x2F;&#x2F;blynk小部件設定裡的虛擬引腳  BLYNK_WRITE(V2)&#123;  r &#x3D; param[0].asInt();  g &#x3D; param[1].asInt();  b &#x3D; param[2].asInt();  static1(r,g,b);&#125;  void setup()&#123;  Serial.begin(115200);  &#x2F;&#x2F;blynk初始化    Blynk.begin(auth, ssid, password);&#x2F;&#x2F;燈條初始化  pixels.begin();&#125;void loop()&#123;  Blynk.run();&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><div class="video-container"><iframe src="https://www.youtube.com/embed/AMHgXyRRq10" frameborder="0" loading="lazy" allowfullscreen></iframe></div>]]></content>
      
      
      <categories>
          
          <category> esp32 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> blynk </tag>
            
            <tag> ws2812 </tag>
            
            <tag> adafriut_neopixel </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>紅外線遙控器控制LED-micropython</title>
      <link href="/2021/09/03/hong-wai-xian-yao-kong-qi-kong-zhi-led-micropython/"/>
      <url>/2021/09/03/hong-wai-xian-yao-kong-qi-kong-zhi-led-micropython/</url>
      
        <content type="html"><![CDATA[<h1 id="紅外線遙控接收-micropython"><a href="#紅外線遙控接收-micropython" class="headerlink" title="紅外線遙控接收-micropython"></a>紅外線遙控接收-micropython</h1><h6 id="tags-esp32-vs1838-micropython-紅外線遙控"><a href="#tags-esp32-vs1838-micropython-紅外線遙控" class="headerlink" title="tags: esp32 vs1838 micropython 紅外線遙控"></a>tags: <code>esp32</code> <code>vs1838</code> <code>micropython</code> <code>紅外線遙控</code></h6><p><a href="https://draft.blogger.com/blog/post/edit/6280040346040914276/6224385154468238883#"><img src="https://lh3.googleusercontent.com/-A5q8iXLl2Qo/YTG-S-4KoBI/AAAAAAAAe4w/x_cUvOR-EAwYVEbDwSSF2XNk3Lxa-DEbQCNcBGAsYHQ/s1600/1630649917872814-0.png"></a></p><p>**紅外接收器模塊使用 VS1838 光電二極管紅外接收器。它成本低且易於使用。  </p><p>引腳：<br>它有 3 個引腳，即：<br>G - 接地引腳。<br>V - 電源電壓。<br>S - 為紅外接收信號引腳。**</p><p><strong>上傳</strong><strong><em>micropython_ir Library of Peter Hinch函式庫:</em></strong></p><pre class="line-numbers language-py" data-language="py"><code class="language-py"># MIT License# # Copyright (c) 2020 Peter Hinch# # Permission is hereby granted, free of charge, to any person obtaining a copy# of this software and associated documentation files (the &quot;Software&quot;), to deal# in the Software without restriction, including without limitation the rights# to use, copy, modify, merge, publish, distribute, sublicense, and&#x2F;or sell# copies of the Software, and to permit persons to whom the Software is# furnished to do so, subject to the following conditions:# # The above copyright notice and this permission notice shall be included in all# copies or substantial portions of the Software.# # THE SOFTWARE IS PROVIDED &quot;AS IS&quot;, WITHOUT WARRANTY OF ANY KIND, EXPRESS OR# IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,# FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE# AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER# LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,# OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE# SOFTWARE.  # Author: Peter Hinch# Copyright Peter Hinch 2020-2021 Released under the MIT license# http:&#x2F;&#x2F;github.com&#x2F;peterhinch&#x2F;micropython_ir  from machine import Pinfrom machine import Timerfrom array import arrayfrom utime import ticks_usfrom utime import ticks_diff  # Save RAM# from micropython import alloc\_emergency\_exception_buf# alloc\_emergency\_exception_buf(100)    # On 1st edge start a block timer. While the timer is running, record the time# of each edge. When the timer times out decode the data. Duration must exceed# the worst case block transmission time, but be less than the interval between# a block start and a repeat code start (~108ms depending on protocol)  class IR_RX():    # Result&#x2F;error codes    # Repeat button code    REPEAT &#x3D; -1    # Error codes    BADSTART &#x3D; -2    BADBLOCK &#x3D; -3    BADREP &#x3D; -4    OVERRUN &#x3D; -5    BADDATA &#x3D; -6    BADADDR &#x3D; -7      def __init__(self, pin, nedges, tblock, callback, *args):  # Optional args for callback        self._pin &#x3D; pin        self._nedges &#x3D; nedges        self._tblock &#x3D; tblock        self.callback &#x3D; callback        self.args &#x3D; args        self._errf &#x3D; lambda _ : None        self.verbose &#x3D; False          self._times &#x3D; array(&#39;i&#39;,  (0 for _ in range(nedges + 1)))  # +1 for overrun        pin.irq(handler &#x3D; self._cb_pin, trigger &#x3D; (Pin.IRQ_FALLING | Pin.IRQ_RISING))        self.edge &#x3D; 0        self.tim &#x3D; Timer(-1)  # Sofware timer        self.cb &#x3D; self.decode      # Pin interrupt. Save time of each edge for later decode.    def _cb_pin(self, line):        t &#x3D; ticks_us()        # On overrun ignore pulses until software timer times out        if self.edge &lt;&#x3D; self._nedges:  # Allow 1 extra pulse to record overrun            if not self.edge:  # First edge received                self.tim.init(period&#x3D;self._tblock , mode&#x3D;Timer.ONE_SHOT, callback&#x3D;self.cb)            self._times[self.edge] &#x3D; t            self.edge +&#x3D; 1      def do_callback(self, cmd, addr, ext, thresh&#x3D;0):        self.edge &#x3D; 0        if cmd &gt;&#x3D; thresh:            self.callback(cmd, addr, ext, *self.args)        else:            self._errf(cmd)      def error_function(self, func):        self._errf &#x3D; func      def close(self):        self._pin.irq(handler &#x3D; None)        self.tim.deinit()    class NEC_ABC(IR_RX):    def __init__(self, pin, extended, callback, *args):        # Block lasts &lt;&#x3D; 80ms (extended mode) and has 68 edges        super().__init__(pin, 68, 80, callback, *args)        self._extended &#x3D; extended        self._addr &#x3D; 0      def decode(self, _):        try:            if self.edge &gt; 68:                raise RuntimeError(self.OVERRUN)            width &#x3D; ticks_diff(self._times[1], self._times[0])            if width &lt; 4000:  # 9ms leading mark for all valid data                raise RuntimeError(self.BADSTART)            width &#x3D; ticks_diff(self._times[2], self._times[1])            if width &gt; 3000:  # 4.5ms space for normal data                if self.edge &lt; 68:  # Haven&#39;t received the correct number of edges                    raise RuntimeError(self.BADBLOCK)                # Time spaces only (marks are always 562.5µs)                # Space is 1.6875ms (1) or 562.5µs (0)                # Skip last bit which is always 1                val &#x3D; 0                for edge in range(3, 68 - 2, 2):                    val &gt;&gt;&#x3D; 1                    if ticks_diff(self._times[edge + 1], self._times[edge]) &gt; 1120:                        val &#x3D; 0x80000000            elif width &gt; 1700: # 2.5ms space for a repeat code. Should have exactly 4 edges.                raise RuntimeError(self.REPEAT if self.edge &#x3D;&#x3D; 4 else self.BADREP)  # Treat REPEAT as error.            else:                raise RuntimeError(self.BADSTART)            addr &#x3D; val &amp; 0xff  # 8 bit addr            cmd &#x3D; (val &gt;&gt; 16) &amp; 0xff            if cmd !&#x3D; (val &gt;&gt; 24) ^ 0xff:                raise RuntimeError(self.BADDATA)            if addr !&#x3D; ((val &gt;&gt; 8) ^ 0xff) &amp; 0xff:  # 8 bit addr doesn&#39;t match check                if not self._extended:                    raise RuntimeError(self.BADADDR)                addr |&#x3D; val &amp; 0xff00  # pass assumed 16 bit address to callback            self._addr &#x3D; addr        except RuntimeError as e:            cmd &#x3D; e.args[0]            addr &#x3D; self._addr if cmd &#x3D;&#x3D; self.REPEAT else 0  # REPEAT uses last address        # Set up for new data burst and run user callback        self.do_callback(cmd, addr, 0, self.REPEAT)  class NEC_8(NEC_ABC):    def __init__(self, pin, callback, *args):        super().__init__(pin, False, callback, *args)  class NEC_16(NEC_ABC):    def __init__(self, pin, callback, *args):        super().__init__(pin, True, callback, *args)<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="範例1"><a href="#範例1" class="headerlink" title="範例1"></a><strong>範例1</strong></h2><h3 id="套用以下範例並記下遙控器按鍵的data"><a href="#套用以下範例並記下遙控器按鍵的data" class="headerlink" title="套用以下範例並記下遙控器按鍵的data"></a><strong><em>套用以下範例並記下遙控器按鍵的data</em></strong></h3><pre class="line-numbers language-none"><code class="language-none">from ir_rx import NEC_16from machine import Timerfrom machine import Pin  def callBack(data, addr, ctrl):    if data &gt; 0:        print(&quot;data: &#123;:02x&#125; addr: &#123;:04x&#125;&quot;.format(data, addr))ir &#x3D; NEC_16(Pin(26, Pin.IN), callBack)<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><div class="video-container"><iframe src="https://www.youtube.com/embed/Q6j2Im2r9hw" frameborder="0" loading="lazy" allowfullscreen></iframe></div><h2 id="範例2"><a href="#範例2" class="headerlink" title="範例2:"></a>範例2:</h2><p><strong><em>有了對應鍵的16進制,並存放在dist裡,就可以把它套用在callBack()去作比對</em></strong></p><pre class="line-numbers language-py" data-language="py"><code class="language-py">from ir_rx import NEC_16from machine import Timerfrom machine import Pin  def callBack(data, addr, ctrl):    if data &gt; 0:        # print(&quot;data: &#123;:02x&#125; addr: &#123;:04x&#125;&quot;.format(data, addr))        print(ir_key[data])ir &#x3D; NEC_16(Pin(26, Pin.IN), callBack)  ir_key &#x3D; &#123;    0x16 : &#39;0&#39;,    0x0c : &#39;1&#39;,    0x18 : &#39;2&#39;,    0x5e : &#39;3&#39;,    0x08 : &#39;4&#39;,    0x1c : &#39;5&#39;,    0x5a : &#39;6&#39;,    0x42 : &#39;7&#39;,    0x52 : &#39;8&#39;,    0x4a : &#39;9&#39;,    0x15 : &#39;ok&#39;,    0x40 : &#39;up&#39;,    0x19 : &#39;down&#39;,    0x07 : &#39;left&#39;,    0x09 : &#39;right&#39;,    0x44 : &#39;power&#39;,&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><div class="video-container"><iframe src="https://www.youtube.com/embed/Q6j2Im2r9hw" frameborder="0" loading="lazy" allowfullscreen></iframe></div><hr><h2 id="範例3"><a href="#範例3" class="headerlink" title="範例3:"></a>範例3:</h2><p><strong><em>現在有了精確的數字,可以運用在控制某些例如燈具…等等的物品這裡使用一個簡單的例子,當按下”1”的鍵時,打開esp32的內鍵燈,當按下”2”時,關閉內鍵燈。</em></strong></p><pre class="line-numbers language-py" data-language="py"><code class="language-py">from ir_rx import NEC_16from machine import Timerfrom machine import Pin  led &#x3D; Pin(2, Pin.OUT)def callBack(data, addr, ctrl):    global _data, _addr    _data &#x3D; ir_key[data]    _addr &#x3D; addr    if data &gt; 0:        # print(&quot;data: &#123;:02x&#125; addr: &#123;:04x&#125;&quot;.format(data, addr))        print(_data)ir &#x3D; NEC_16(Pin(26, Pin.IN), callBack)  ir_key &#x3D; &#123;    0x16 : &#39;0&#39;,    0x0c : &#39;1&#39;,    0x18 : &#39;2&#39;,    0x5e : &#39;3&#39;,    0x08 : &#39;4&#39;,    0x1c : &#39;5&#39;,    0x5a : &#39;6&#39;,    0x42 : &#39;7&#39;,    0x52 : &#39;8&#39;,    0x4a : &#39;9&#39;,    0x15 : &#39;ok&#39;,    0x40 : &#39;up&#39;,    0x19 : &#39;down&#39;,    0x07 : &#39;left&#39;,    0x09 : &#39;right&#39;,    0x44 : &#39;power&#39;,&#125;_data &#x3D; 0if _data &#x3D;&#x3D; &quot;1&quot;:    led.on()elif _data &#x3D;&#x3D; &quot;2&quot;:    led.off()<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><div class="video-container"><iframe src="https://www.youtube.com/embed/6t1xMAnKzS8" frameborder="0" loading="lazy" allowfullscreen></iframe></div>]]></content>
      
      
      <categories>
          
          <category> esp32 </category>
          
          <category> micropython </category>
          
      </categories>
      
      
        <tags>
            
            <tag> vs1838 </tag>
            
            <tag> 紅外線遙控 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>紅外線遙控器控制LED-ESP3</title>
      <link href="/2021/09/03/hong-wai-xian-yao-kong-qi-kong-zhi-led-esp3/"/>
      <url>/2021/09/03/hong-wai-xian-yao-kong-qi-kong-zhi-led-esp3/</url>
      
        <content type="html"><![CDATA[<h1 id="紅外線遙控器控制LED-ESP3"><a href="#紅外線遙控器控制LED-ESP3" class="headerlink" title="紅外線遙控器控制LED-ESP3"></a>紅外線遙控器控制LED-ESP3</h1><h6 id="tags-esp32-vs1838-紅外線遙控"><a href="#tags-esp32-vs1838-紅外線遙控" class="headerlink" title="tags: esp32 vs1838 紅外線遙控"></a>tags: <code>esp32</code> <code>vs1838</code> <code>紅外線遙控</code></h6><p><a href="https://draft.blogger.com/blog/post/edit/3809681606094011522/2182248290207799810#"><img src="https://lh3.googleusercontent.com/-AMwtHuHrueA/YTG-qYvDXVI/AAAAAAAAe44/V-Ue5wYV6JwFjK6VxTeu5cMWRw5h5CJVQCNcBGAsYHQ/s1600/1630649998922334-0.png"></a></p><p>**紅外接收器模塊使用 VS1838 光電二極管紅外接收器。它成本低且易於使用。  </p><p>引腳：<br>它有 3 個引腳，即：<br>G - 接地引腳。<br>V - 電源電壓。<br>S——為紅外接收信號引腳。**</p><h2 id="實驗1"><a href="#實驗1" class="headerlink" title="實驗1:"></a><strong>實驗1:</strong></h2><p><strong>接收按鍵值</strong></p><p><strong>先匯入</strong><a href="https://draft.blogger.com/blog/post/edit/3809681606094011522/2182248290207799810#">IRremote.h</a></p><p><strong>上傳此範例</strong></p><pre class="line-numbers language-c++" data-language="c++"><code class="language-c++">#include &lt;IRremote.h&gt;int RECV_PIN &#x3D; 15;IRrecv irrecv(RECV_PIN);decode_results results;void setup()&#123;    Serial.begin(115200);    irrecv.enableIRIn(); &#x2F;&#x2F; 啟動接收器&#125;void loop() &#123;    if (irrecv.decode(&amp;results)) &#123;        Serial.println(results.value);        irrecv.resume(); &#x2F;&#x2F; 接數下一個按鍵值    &#125; delay(100);&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><div class="video-container"><iframe src="https://www.youtube.com/embed/GrntTjzaFfk" frameborder="0" loading="lazy" allowfullscreen></iframe></div><hr><h2 id="實驗2"><a href="#實驗2" class="headerlink" title="實驗2"></a><strong>實驗2</strong></h2><p><strong>以上程式會轉成十進制</strong></p><p><strong>我須要1和2的按鍵來控制燈的明滅</strong></p><p><strong>所以利用剛剛1和2的十進制號碼進行設制</strong></p><pre class="line-numbers language-c++" data-language="c++"><code class="language-c++">#include &lt;IRremote.h&gt;int RECV_PIN &#x3D; 15;const int led &#x3D; LED_BUILTIN;IRrecv irrecv(RECV_PIN);decode_results results;void setup()&#123;    Serial.begin(115200);    irrecv.enableIRIn(); &#x2F;&#x2F; 啟動接收器    pinMode(led, OUTPUT);&#125;  void loop() &#123;    if (irrecv.decode(&amp;results)) &#123;        Serial.println(results.value);        irrecv.resume(); &#x2F;&#x2F; 接數下一個按鍵值    &#125;    delay(100);    if (results.value &#x3D;&#x3D; 16724175)&#123;        digitalWrite(led, HIGH);    &#125;else if (results.value &#x3D;&#x3D; 16718055)&#123;        digitalWrite(led, LOW);    &#125;&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><div class="video-container"><iframe src="https://www.youtube.com/embed/6t1xMAnKzS8" frameborder="0" loading="lazy" allowfullscreen></iframe></div>]]></content>
      
      
      <categories>
          
          <category> esp32 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> vs1838 </tag>
            
            <tag> 紅外線遙控 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>土炮制機械手掌(Hand Robot)+彎曲傳感器-Arduino</title>
      <link href="/2021/09/03/tu-pao-zhi-ji-jie-shou-zhang-hand-robot-wan-qu-chuan-gan-qi-arduino/"/>
      <url>/2021/09/03/tu-pao-zhi-ji-jie-shou-zhang-hand-robot-wan-qu-chuan-gan-qi-arduino/</url>
      
        <content type="html"><![CDATA[<h1 id="土炮制機械手掌-Hand-Robot-彎曲傳感器-Arduino"><a href="#土炮制機械手掌-Hand-Robot-彎曲傳感器-Arduino" class="headerlink" title="土炮制機械手掌(Hand Robot)+彎曲傳感器-Arduino"></a>土炮制機械手掌(Hand Robot)+彎曲傳感器-Arduino</h1><h6 id="tags-arduino-機械手掌-hand-robot"><a href="#tags-arduino-機械手掌-hand-robot" class="headerlink" title="tags: arduino 機械手掌 hand robot"></a>tags: <code>arduino</code> <code>機械手掌</code> <code>hand robot</code></h6><p><a href="https://draft.blogger.com/blog/post/edit/6959160158145357673/7905812487640359234#"><img src="https://lh3.googleusercontent.com/-8Jh_s3fPymc/YKtQv5ooyMI/AAAAAAAAeLk/mforclTeA1g9PMXHLWylim0iDYi7WlubwCNcBGAsYHQ/s1600/1621840029201670-0.png"></a></p><p><strong><em>最近在很多平台上看到機械手掌被廣範使用在義肢上,</em></strong><br><strong><em>使得有須求的人得到一個很好的輔助功能,我自己本身</em></strong><br><strong><em>也是有殘缺的人,雖然不是四肢上,是聽覺有問題,所以能</em></strong><br><strong><em>感同身受,我相信未來能發展到任何殘缺都有能輔助的</em></strong><br><strong>_AI設備可使用。然後這個動機使我也想利用Arduino來_</strong><br><strong><em>做個機械手掌,了解一下箇中原理。</em></strong><br><strong><em>本想用３Ｄ列印手掌出來,但有點擔心要結合關節有難度</em></strong><br><strong><em>於是先用紙板裁剪,這裡要比較留意的是關節處要有足夠</em></strong><br><strong><em>的空間,才能彎曲,用紙板是最簡易的材料,因為紙板折彎後</em></strong><br><strong><em>放開,會自動攤平,其實也可以用實心的海綿,效果應該不錯。</em></strong></p><h2 id="材料"><a href="#材料" class="headerlink" title="材料"></a>材料</h2><ul><li><strong>吸管若干支</strong></li><li><strong>紙箱紙板</strong></li><li><strong>小細線或尼龍線</strong></li><li><strong>伺服馬達 x5</strong></li><li><strong>PCA9685 x1</strong></li><li><strong>Arduino UNO x1</strong></li></ul><p><a href="https://draft.blogger.com/blog/post/edit/6959160158145357673/7905812487640359234#"><img src="https://lh3.googleusercontent.com/-XkV4ELfGyGQ/YKxYCPeN9KI/AAAAAAAAeMQ/s9qcYSHRNfsfx71ZvR3FmBT0xrgCgllYACNcBGAsYHQ/s1600/1621907440062420-0.png"></a></p><p><a href="https://draft.blogger.com/blog/post/edit/6959160158145357673/7905812487640359234#"><img src="https://lh3.googleusercontent.com/-MGnyCZI74_Q/YKxX7tqt25I/AAAAAAAAeMI/LMTCpE02e-Im1LbuqXHsGW9FixFzXbMcQCNcBGAsYHQ/s1600/1621907418074666-1.png"></a></p><p><a href="https://draft.blogger.com/blog/post/edit/6959160158145357673/7905812487640359234#"><img src="https://lh3.googleusercontent.com/-dldn-MG47AU/YKxX2UlpWZI/AAAAAAAAeMA/T7jhXD5fFtQNeUIXJwP9P7bZTjc341x0wCNcBGAsYHQ/s1600/1621907401475330-2.png"></a></p><p><a href="https://draft.blogger.com/blog/post/edit/6959160158145357673/7905812487640359234#"><img src="https://lh3.googleusercontent.com/-1MQth4xwVrY/YKxXyLIoT2I/AAAAAAAAeL8/Zg2w7MBFpNAgvlaCxGcZ9e2NCAXV9MhegCNcBGAsYHQ/s1600/1621907376671852-3.png"></a></p><p><a href="https://draft.blogger.com/blog/post/edit/6959160158145357673/7905812487640359234#"><img src="https://lh3.googleusercontent.com/-qKchUlzBnLk/YKxXritjNxI/AAAAAAAAeL0/9v786lhQG5oyCSWgBM7Z8VJgCc7TDpX9gCNcBGAsYHQ/s1600/1621907321750549-4.png"></a></p><p><a href="https://draft.blogger.com/blog/post/edit/6959160158145357673/7905812487640359234#"><img src="https://lh3.googleusercontent.com/-YxadX-Hyu5I/YKxXeJ2fjuI/AAAAAAAAeLw/0ao8ucVi9z8aw14GWI8VYjvDaR86Kz7_wCNcBGAsYHQ/s1600/1621907297416560-5.png"></a></p><p><a href="https://draft.blogger.com/blog/post/edit/6959160158145357673/7905812487640359234#"><img src="https://lh3.googleusercontent.com/-ASihZR1kTOk/YKxYeitOWkI/AAAAAAAAeMg/89XITznmL1AL18tWlT6gsWoml12c2hI6QCNcBGAsYHQ/s1600/1621907569418731-0.png"></a></p><p><a href="https://draft.blogger.com/blog/post/edit/6959160158145357673/7905812487640359234#"><img src="https://lh3.googleusercontent.com/-YfUNpFuCBsQ/YKxYcH4NrFI/AAAAAAAAeMc/-KEdQQOFtR4RtSb8pezGLpcb4Ai_YvzzgCNcBGAsYHQ/s1600/1621907555196644-1.png"></a></p><p><strong>舵機固定在適當的位置後再來就剩下程式碼</strong></p><hr><h2 id="程式碼"><a href="#程式碼" class="headerlink" title="程式碼"></a>程式碼</h2><pre class="line-numbers language-c#" data-language="c#"><code class="language-c#">#include &lt;Wire.h&gt;#include &lt;Adafruit_PWMServoDriver.h&gt;#define SERVO_FREQ 60 &#x2F;&#x2F; Analog servos run at ~50 Hz updates&#x2F;&#x2F;angleMax&#x3D;600&#x2F;&#x2F;angleMin&#x3D;150Adafruit_PWMServoDriver pwm &#x3D; Adafruit_PWMServoDriver();  int val;void setup()&#123;  Serial.begin(9600);  pwm.begin();  pwm.setOscillatorFrequency(27000000);  pwm.setPWMFreq(SERVO_FREQ);  &#x2F;&#x2F; Analog servos run at ~50 Hz updates  delay(10);&#125;  void loop()&#123;  for (int i &#x3D; 500; i &gt; 200; i-&#x3D;20)  &#123;    pwm.setPWM(1, 0 , i);    delay(50);  &#125;  for (int i &#x3D; 200; i &lt; 500; i+&#x3D;20)  &#123;    pwm.setPWM(1, 0, i);    delay(50);  &#125;  for (int i &#x3D; 500; i &gt; 200; i-&#x3D;20)  &#123;    pwm.setPWM(2, 0 , i);    delay(50);  &#125;  for (int i &#x3D; 200; i &lt; 500; i+&#x3D;20)  &#123;    pwm.setPWM(2, 0, i);    delay(50);  &#125;    for (int i &#x3D; 500; i &gt; 200; i-&#x3D;20)  &#123;    pwm.setPWM(8, 0 , i);    delay(50);  &#125;  for (int i &#x3D; 200; i &lt; 500; i+&#x3D;20)  &#123;    pwm.setPWM(8, 0, i);    delay(50);  &#125;    for (int i &#x3D; 500; i &gt; 200; i-&#x3D;20)  &#123;    pwm.setPWM(9, 0 , i);    delay(50);  &#125;  for (int i &#x3D; 200; i &lt; 500; i+&#x3D;20)  &#123;    pwm.setPWM(9, 0, i);    delay(50);  &#125;    for (int i &#x3D; 500; i &gt; 200; i-&#x3D;20)  &#123;    pwm.setPWM(10, 0 , i);    delay(50);  &#125;  for (int i &#x3D; 200; i &lt; 500; i+&#x3D;20)  &#123;    pwm.setPWM(10, 0, i);    delay(50);  &#125;  for (int j &#x3D; 500; j &gt; 200; j-&#x3D;20)&#123;    pwm.setPWM(1, 0, j);    pwm.setPWM(2, 0, j);    pwm.setPWM(8, 0, j);    pwm.setPWM(9, 0, j);    pwm.setPWM(10, 0, j);    delay(50);  &#125;  for (int j &#x3D; 200; j &lt; 500; j+&#x3D;20)&#123;    pwm.setPWM(1, 0, j);    pwm.setPWM(2, 0, j);    pwm.setPWM(8, 0, j);    pwm.setPWM(9, 0, j);    pwm.setPWM(10, 0, j);    delay(50);  &#125;  for (int j &#x3D; 500; j &gt; 200; j-&#x3D;20)&#123;    pwm.setPWM(1, 0, j);    pwm.setPWM(8, 0, j);    pwm.setPWM(9, 0, j);    pwm.setPWM(10, 0, j);    delay(50);  &#125;  delay(1000);  for (int j &#x3D; 200; j &lt; 500; j+&#x3D;20)&#123;    pwm.setPWM(1, 0, j);    pwm.setPWM(8, 0, j);    pwm.setPWM(9, 0, j);    pwm.setPWM(10, 0, j);    delay(50);  &#125;&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><hr><div class="video-container"><iframe src="https://www.youtube.com/embed/wTggtKVo-J0" frameborder="0" loading="lazy" allowfullscreen></iframe></div><p><strong>使用彎曲傳感器控制控制機械手掌</strong></p><p><strong>首先要先製作彎曲傳感器，然後弄成手套，可參考下篇</strong></p><p><strong>自制彎曲傳感器</strong>-<a href="https://draft.blogger.com/blog/post/edit/6959160158145357673/7905812487640359234?hl=zh-TW#">https://blairandreamwork.blogspot.com/2021/06/blog-post.html</a></p><p><a href="https://draft.blogger.com/blog/post/edit/6959160158145357673/7905812487640359234?hl=zh-TW#"><img src="https://lh3.googleusercontent.com/-D3lE7P9mMmw/YMBU9n19qnI/AAAAAAAAePg/HPT9v777qowytoJeRRA6KTseyVA99vZ3gCNcBGAsYHQ/s1600/1623217351043061-0.png"></a></p><hr><p><strong>像上圖弄好以後，先測量每一個感測器的數值區間，我發現自制的感測器沒有很穩定，數值會有點亂跳，所以我把感測的時間調高一點，不要讓它偵測太頻繁。</strong></p><pre class="line-numbers language-c#" data-language="c#"><code class="language-c#">#include &lt;Wire.h&gt;#include &lt;Adafruit_PWMServoDriver.h&gt;#define SERVO_FREQ 60 &#x2F;&#x2F; Analog servos run at ~50 Hz updates&#x2F;&#x2F;angleMax&#x3D;600&#x2F;&#x2F;angleMin&#x3D;150Adafruit_PWMServoDriver pwm &#x3D; Adafruit_PWMServoDriver();  int valOne;int valTwo;int valthree;int valfour;int valfive;int sensor_One&#x3D;A0;int sensor_Two&#x3D;A1;int sensor_three&#x3D;A2;int sensor_four&#x3D;A3;int sensor_five&#x3D;A6;  void setup()&#123;  Serial.begin(9600);  pinMode(sensor_One, INPUT);  pinMode(sensor_Two, INPUT);  pinMode(sensor_three, INPUT);  pinMode(sensor_four, INPUT);  pinMode(sensor_five, INPUT);  pwm.begin();  pwm.setOscillatorFrequency(27000000);  pwm.setPWMFreq(SERVO_FREQ);  &#x2F;&#x2F; Analog servos run at ~50 Hz updates  delay(10);&#125;void loop()&#123;  valOne&#x3D;analogRead(sensor_One);  valOne&#x3D;map(valOne, 90, 140, 200, 600);  valTwo&#x3D;analogRead(sensor_Two);  valTwo&#x3D;map(valTwo, 90, 140, 200, 600);  valthree&#x3D;analogRead(sensor_three);  valthree&#x3D;map(valthree, 90, 150, 200, 600);  valfour&#x3D;analogRead(sensor_four);  valfour&#x3D;map(valfour, 90, 150, 200, 600);  valfive&#x3D;analogRead(sensor_five);  valfive&#x3D;map(valfive, 90, 150, 200, 600);  if (valOne&lt;200)&#123;    valOne&#x3D;200;  &#125;  if(valOne&gt;600)&#123;    valOne&#x3D;600;  &#125;  Serial.println(valOne);  pwm.setPWM(1, 0, valOne);    if (valTwo&lt;200)&#123;    valTwo&#x3D;200;  &#125;  if(valTwo&gt;600)&#123;    valTwo&#x3D;600;  &#125;  Serial.println(valTwo);  pwm.setPWM(2, 0 ,valTwo);    if (valthree&lt;200)&#123;    valthree&#x3D;200;  &#125;  if(valthree&gt;600)&#123;    valthree&#x3D;600;  &#125;  Serial.println(valthree);  pwm.setPWM(8, 0 ,valthree);    if (valfour&lt;200)&#123;    valfour&#x3D;200;  &#125;  if(valfour&gt;600)&#123;    valfour&#x3D;600;  &#125;  Serial.println(valfour);  pwm.setPWM(9, 0 ,valfour);    if (valfive&lt;200)&#123;    valfive&#x3D;200;  &#125;  if(valfive&gt;600)&#123;    valfive&#x3D;600;  &#125;  Serial.println(valfive);  pwm.setPWM(10, 0 ,valfive);  delay(400);  Serial.println(&quot;------&quot;);&#125;  <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><hr><p><strong>雖然沒有完美，但我想開始著手做３Ｄ列印的機械手掌，並使用市面上的彎曲傳感器試試。</strong></p><div class="video-container"><iframe src="https://www.youtube.com/embed/8QkrvWnMkRA" frameborder="0" loading="lazy" allowfullscreen></iframe></div>]]></content>
      
      
      <categories>
          
          <category> arduino </category>
          
      </categories>
      
      
        <tags>
            
            <tag> hand robot </tag>
            
            <tag> 彎曲傳感器 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>自制彎曲傳感器</title>
      <link href="/2021/09/03/zi-zhi-wan-qu-chuan-gan-qi-arduino/"/>
      <url>/2021/09/03/zi-zhi-wan-qu-chuan-gan-qi-arduino/</url>
      
        <content type="html"><![CDATA[<h1 id="自制彎曲傳感器"><a href="#自制彎曲傳感器" class="headerlink" title="自制彎曲傳感器"></a>自制彎曲傳感器</h1><h6 id="tags-arduino-彎曲傳感器-flex-sensor"><a href="#tags-arduino-彎曲傳感器-flex-sensor" class="headerlink" title="tags: arduino 彎曲傳感器 flex_sensor"></a>tags: <code>arduino</code> <code>彎曲傳感器</code> <code>flex_sensor</code></h6><p><em>前陣子看了平台上一位老師試範超低成本制作彎曲傳感器</em><br><em>主要使用鉛筆碳粉為導體制作彎曲傳感器，決定也來試試</em><br><em>於是買了必須的材料，但可能我沒掌握好技巧，在塗滿碳</em><br><em>粉的紙上始終量不到阻值，插上Arduino也無法讀取到數值</em><br><em>，有點失望之餘但不放棄的翻遍網路資源，發現有一種叫</em><br><em>石墨片的東西，一般是拿來做散熱用的，但它也兼具導電</em><br><em>的特性，有人就拿它來做彎曲傳感器，於是我蝦皮了五片</em><br><em>約200元，制作了一片成功了。</em></p><div class="video-container"><iframe src="https://www.youtube.com/embed/8UyBq3EuvSg" frameborder="0" loading="lazy" allowfullscreen></iframe></div> <p><em>因為前一篇有紀錄我手工做了HandRobot，也想加入彎曲傳感器來控制</em><br><em>一番，這篇就先紀錄如何制成彎曲傳感器。</em></p><h2 id="所須材料"><a href="#所須材料" class="headerlink" title="所須材料"></a>所須材料</h2><ul><li>  <strong>石墨片</strong></li><li>  <strong>塑膠片</strong></li><li>  <strong>軟質資料夾</strong></li><li>  <strong>紙膠帶</strong></li><li>  <strong>透明膠帶</strong></li><li>  <strong>杜邦線</strong></li><li>  <strong>剪刀／美工刀</strong></li></ul><hr><p><a href="https://draft.blogger.com/blog/post/edit/6959160158145357673/9058503509549070481#"><img src="https://lh3.googleusercontent.com/-weHYIvYSE4w/YLcjjRvdUYI/AAAAAAAAePE/W1Fic7dVHiAjgg4ux7ObQgRW-dcE4eQ8gCNcBGAsYHQ/s1600/1622614901889734-0.png"></a></p><p><a href="https://draft.blogger.com/blog/post/edit/6959160158145357673/9058503509549070481#"><img src="https://lh3.googleusercontent.com/--hUt9X9niNU/YLcjdW1qgGI/AAAAAAAAeO8/Pr88EuribcEUZptKjVplNNbAi-xWac6aQCNcBGAsYHQ/s1600/1622614881216679-1.png"></a></p><p><em>石墨片依照10.5公分x1公分裁切，塑膠片10.5x1.3cm裁切</em></p><p><a href="https://draft.blogger.com/blog/post/edit/6959160158145357673/9058503509549070481#"><img src="https://lh3.googleusercontent.com/-VJC7QLGZdXs/YLcjYOh4QcI/AAAAAAAAeO0/P2mUyTpm-UA9c2WLRQiATPt7niU8A2WAgCNcBGAsYHQ/s1600/1622614859874661-2.png"></a></p><p><em>將杜邦線或實心導線剝線約10cm黏於紙膠帶上(紙膠帶最好比石墨片長度長一點)</em></p><p>*<strong>兩導線不要碰觸在一起</strong></p><p><a href="https://draft.blogger.com/blog/post/edit/6959160158145357673/9058503509549070481#"><img src="https://lh3.googleusercontent.com/-xTDGNhvMLdI/YLcjS8bEPmI/AAAAAAAAeOs/RKc-b0OFIrM9a70QvNtTCkLbktUXJ3WjACNcBGAsYHQ/s1600/1622614842294395-3.png"></a></p><p>將石墨片(導電端)覆蓋於兩導線上，導線另一端紙膠帶往下摺，再將左邊往右摺，右邊往左摺，形成包裏住導線狀（見下圖）</p><p><a href="https://draft.blogger.com/blog/post/edit/6959160158145357673/9058503509549070481#"><img src="https://lh3.googleusercontent.com/-AMYVzDf5de0/YLcjORW0uWI/AAAAAAAAeOo/SI7ptJRVgXA6z5UkUpcLM32blkKNwB53ACNcBGAsYHQ/s1600/1622614825498548-4.png"></a></p><p><a href="https://draft.blogger.com/blog/post/edit/6959160158145357673/9058503509549070481#"><img src="https://lh3.googleusercontent.com/-s6Tw9eBSm_g/YLcjKFlzhSI/AAAAAAAAeOg/E1LRu73TdWIXUU_lyV9YLl8KF-MidzDMwCNcBGAsYHQ/s1600/1622614803703709-5.png"></a></p><p>然後兩端用透明膠帶黏住</p><p><a href="https://draft.blogger.com/blog/post/edit/6959160158145357673/9058503509549070481#"><img src="https://lh3.googleusercontent.com/-QI6nCi-BjI8/YLcjEvasU3I/AAAAAAAAeOU/RUxZuvvVoQE6UMPBDY4zznDDE7Up8nZuwCNcBGAsYHQ/s1600/1622614778268390-6.png"></a></p><p>將剛裁好的塑膠片和資料夾剪跟塑膠片一樣長寛，把封裝好的石墨片像三明治這樣夾於中間</p><p><a href="https://draft.blogger.com/blog/post/edit/6959160158145357673/9058503509549070481#"><img src="https://lh3.googleusercontent.com/-UKiFPpgQKfY/YLci-b1hq8I/AAAAAAAAeOM/lGoZ6GuyI78tLlrTjMnc-UtQEw3v8hbVgCNcBGAsYHQ/s1600/1622614761393534-7.png"></a></p><p><a href="https://draft.blogger.com/blog/post/edit/6959160158145357673/9058503509549070481#"><img src="https://lh3.googleusercontent.com/-1R2fHZzB8cM/YLci6LlhuiI/AAAAAAAAeOI/kIz84JS-2pEcid2yfwfrfKe-6mMmUrRnQCNcBGAsYHQ/s1600/1622614744408843-8.png"></a></p><p><a href="https://draft.blogger.com/blog/post/edit/6959160158145357673/9058503509549070481#"><img src="https://lh3.googleusercontent.com/-D23T5DFXP-g/YLci19YnQvI/AAAAAAAAeOE/JrprQbZPEYUl6Rv-AbYy1tFNEzD07mGMgCNcBGAsYHQ/s1600/1622614724811115-9.png"></a></p><p>兩端再用膠帶封住</p><p><a href="https://draft.blogger.com/blog/post/edit/6959160158145357673/9058503509549070481#"><img src="https://lh3.googleusercontent.com/-E86mtiYdIr0/YLciw5O7V4I/AAAAAAAAeOA/ZHeGmGcxcLscXSVbAWJtQ1D6clpm5G6CQCNcBGAsYHQ/s1600/1622614701415792-10.png"></a></p><p><a href="https://draft.blogger.com/blog/post/edit/6959160158145357673/9058503509549070481#"><img src="https://lh3.googleusercontent.com/-7iowwImDqLw/YLcirEQG1GI/AAAAAAAAeN8/hWY8kY14u4UbaxmqlN5XaM89R1FjLNjBgCNcBGAsYHQ/s1600/1622614674841483-11.png"></a></p><hr><h2 id="接線圖"><a href="#接線圖" class="headerlink" title="接線圖"></a>接線圖</h2><p><a href="https://draft.blogger.com/blog/post/edit/6959160158145357673/9058503509549070481#"><img src="https://1.bp.blogspot.com/-BO4fv-os1c0/YLcpnnCMLPI/AAAAAAAAePQ/yVp3vJkEEDU_Td9Sd1GvCxaZhbxmY4kwwCNcBGAsYHQ/w530-h247/%25E5%25BD%258E%25E6%259B%25B2%25E5%2582%25B3%25E6%2584%259F%25E5%2599%25A8%25E6%258E%25A5%25E7%25B7%259A%25E5%259C%2596.jpg"></a></p><hr><h2 id="程式碼"><a href="#程式碼" class="headerlink" title="程式碼"></a>程式碼</h2><pre class="line-numbers language-c#" data-language="c#"><code class="language-c#">int val;int sensor&#x3D;A0;void setup()&#123;  Serial.begin(115200);  pinMode(sensor, INPUT);&#125;void loop() &#123;  val&#x3D;analogRead(sensor);  Serial.println(val);  delay(500);&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>加入伺服馬達</p><p>＊彎曲傳感器量測到的數值不一，所以要自己測量最大和最小值再轉換對應角度</p><pre class="line-numbers language-c#" data-language="c#"><code class="language-c#">#include &lt;Servo.h&gt;Servo myservo;  int sensor&#x3D;A0;int val;  void setup() &#123;  myservo.attach(9);  myservo.write(170);  Serial.begin(9600);&#125;void loop() &#123;  val&#x3D;analogRead(sensor);  val&#x3D;map(val,3, 20, 0, 180);  if (val&gt;180)&#123;    val&#x3D;180;  &#125;  if (val&lt;0)&#123;    val&#x3D;0;  &#125;  myservo.write(val);  Serial.println(val);  delay(450);&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><hr><div class="video-container"><iframe src="https://www.youtube.com/embed/Hnzlbz5yTus" frameborder="0" loading="lazy" allowfullscreen></iframe></div>]]></content>
      
      
      <categories>
          
          <category> arduino </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 彎曲傳感器 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>製作免持紅外線體溫器</title>
      <link href="/2021/09/03/zhi-zuo-mian-chi-hong-wai-xian-ti-wen-qi-arduino/"/>
      <url>/2021/09/03/zhi-zuo-mian-chi-hong-wai-xian-ti-wen-qi-arduino/</url>
      
        <content type="html"><![CDATA[<h1 id="製作免持紅外線體溫器"><a href="#製作免持紅外線體溫器" class="headerlink" title="製作免持紅外線體溫器"></a>製作免持紅外線體溫器</h1><h6 id="tags-arduino"><a href="#tags-arduino" class="headerlink" title="tags: arduino"></a>tags: <code>arduino</code></h6><p>有感於新冠肺病毒的擴散，原本身在台灣感覺還算安全，但隨著時間和政策<br>病毒悄然在台灣擴散，大家出門的基本功就是口罩，酒精，體溫器。身為一<br>個小小班自研創客，當然要把自己在研究的東西用於現實生活上，堅持”不只是玩玩＂的心態。<br>最近二個月公司一早的朝會都固定要量體溫，用手持紅外線測溫，所以我想<br>用３Ｄ列印個外殼，做個掛壁免持的紅外線體溫器給公司同仁使用。</p><p>因為近期網路上已經很多創客大大做出相關成品，我也看中一個”國外”不錯的專案<br>所以我就直接轉成中文把重點轉移過來，當個實作紀錄。</p><p>參考網址：<a href="https://draft.blogger.com/blog/post/edit/6959160158145357673/2369433296544109208#">https://www.instructables.com/DIY-Non-Contact-IR-Thermometer/</a></p><p>（申明：以下紀錄和圖片是基於轉貼大部份和翻為中文，方便自己學習使用</p><p>The following records are based on records and are convenient for self-learning, so use reposting most of the content and some pictures）</p><p>普通的紅外溫度計可以測量新冠患者的體溫，也可能傳播病毒。手持式溫度計的主要缺點是其性能取決於操作者和到額頭的距離。為了解決這些問題，製造了一種可以安裝在牆上的設備，無需操作員即可在公共區域進行發燒篩查。當傳感器與額頭之間的距離足夠時，硬件可以自動測量人體溫度。</p><p><strong><em>所需組件</em></strong>  </p><p>1. Arduino Nano  </p><p>2. GY-906 溫度傳感器  </p><p>3. OLED 顯示器  </p><p>4. IR紅外傳感器  </p><p>5. TP4056 充電器模塊  </p><p>6. 18650 電池  </p><p>7. 18650 電池座  </p><p>8. 5 V DC-DC 升壓轉換器（亞馬遜）  </p><p>9. 切換開關 -15 × 21 毫米  </p><p>10. 5 毫米綠色 LED  </p><p>11. 5 毫米紅色 LED  </p><p>12. 2 x 330 歐姆電阻器  </p><p>13.壓電蜂鳴器  </p><p>14. Header Pins  </p><p>15. 杜邦線  </p><p>16. 跳線  </p><h2 id="第-1-步：它是如何工作的？"><a href="#第-1-步：它是如何工作的？" class="headerlink" title="第 1 步：它是如何工作的？"></a>第 1 步：它是如何工作的？</h2><p><a href="https://draft.blogger.com/blog/post/edit/6959160158145357673/2369433296544109208#"><img src="https://content.instructables.com/ORIG/FKN/640Y/KP9RKLKY/FKN640YKP9RKLKY.jpg?auto=webp&frame=1&width=933&fit=bounds&md=246ad4f70f666e246570b8147de4cdac"></a></p><p>工作原理很簡單，紅外測溫傳感器MLX90614在額頭與傳感器之間的距離（由紅外傳感器測量）匹配設定值時讀取人體溫度。傳感器讀數發送到 Arduino 進行處理，處理後的值顯示在 0.96’ OLED 顯示屏上。  </p><p>除了 OLED 顯示屏外，還使用了兩個 LED 和一個蜂鳴器來指示輸出。  </p><p>1、當體溫正常時，綠色LED（LED1）亮，蜂鳴器鳴叫。  </p><p>2. 當體溫高於 37.7攝氏度時，紅色 LED ( LED2 ) 會亮起，蜂鳴器會發出較長時間的嗶嗶聲。  </p><h2 id="第-2-步：電源"><a href="#第-2-步：電源" class="headerlink" title="第 2 步：電源"></a>第 2 步：電源</h2><p><a href="https://draft.blogger.com/blog/post/edit/6959160158145357673/2369433296544109208#"><img src="https://content.instructables.com/ORIG/FL6/3XIC/KP9RKQ5O/FL63XICKP9RKQ5O.png?auto=webp&frame=1&width=989&fit=bounds&md=f4cb0be5029dc114271993894e131fd1"></a></p><p>整個電路所需的電源由兩節18650電池提供。兩塊電池並聯連接以製作更高容量的電池組以獲得更長的備份時間。電池組由 TP4056 充電器模塊充電。  </p><p>使用升壓轉換器模塊（MT3608）將電池組電壓升至7V。然後升壓轉換器的輸出連接到 Arduino 的 Vin 引腳。  </p><p>一個切換開關放置在充電器模塊 TP4056 輸出和升壓轉換器之間。</p><h2 id="第-3-步：準備-Arduino-和溫度傳感器板"><a href="#第-3-步：準備-Arduino-和溫度傳感器板" class="headerlink" title="第 3 步：準備 Arduino 和溫度傳感器板"></a>第 3 步：準備 Arduino 和溫度傳感器板</h2><p><a href="https://draft.blogger.com/blog/post/edit/6959160158145357673/2369433296544109208#"><img src="https://content.instructables.com/ORIG/F0O/VDDJ/KP9RKQAW/F0OVDDJKP9RKQAW.jpg?auto=webp&frame=1&width=799&height=1024&fit=bounds&md=d8cf21f11e1db08b6ca97c2d682405a8"></a></p><h2 id="第-4-步：MLX90614-紅外溫度傳感器"><a href="#第-4-步：MLX90614-紅外溫度傳感器" class="headerlink" title="第 4 步：MLX90614 紅外溫度傳感器"></a>第 4 步：MLX90614 紅外溫度傳感器</h2><p><a href="https://draft.blogger.com/blog/post/edit/6959160158145357673/2369433296544109208#"><img src="https://content.instructables.com/ORIG/FP0/3KWQ/KP9RKQD4/FP03KWQKP9RKQD4.jpg?auto=webp&frame=1&width=591&fit=bounds&md=d887a37f17bfbfc3f1ca1a27ecac2001"></a></p><p>MLX90614 是一款用於非接觸式溫度測量的紅外測溫儀，能夠測量 -70 至 380°C 之間的溫度。該傳感器採用紅外敏感熱電堆探測器芯片和信號調節ASIC集成在一個芯片中。它基於 Stefan-Boltzmann 定律工作，該定律指出所有物體都會發射 IR 能量，並且該能量的強度將與該物體的溫度成正比。傳感器中的傳感單元測量目標物體發射了多少紅外能量，計算單元使用 17 位內置 ADC 將其轉換為溫度值，並通過 I2C 通信協議輸出數據。  </p><p>傳感器測量物體溫度和環境溫度以校準物體溫度值。 MLX 90614 傳感器可以讀取 -40 到 125 ˚C（-40 到 257 °F）範圍內的環境溫度和 -70 到 380 ˚C（-94 到 716 °F）範圍內的物體溫度。  </p><p>紅外測溫儀與 Arduino 的連接非常簡單，因為它像許多其他組件一樣使用 I2C 通信接口。<br>MLX90614 溫度計有 4 個引腳：VIN、GND、SCL 和 SDA。  </p><p><strong><em>連接應如下所示：</em></strong>  </p><p>Arduino——MLX 90614  </p><p>5V — VIN  </p><p>GDN——GDN  </p><p>A5 —- SCL  </p><p>A4 —- SDA</p><h2 id="步驟-5：準備電池組"><a href="#步驟-5：準備電池組" class="headerlink" title="步驟 5：準備電池組"></a>步驟 5：準備電池組</h2><p><a href="https://draft.blogger.com/blog/post/edit/6959160158145357673/2369433296544109208#"><img src="https://content.instructables.com/ORIG/FQQ/CP6E/KP9RKRBE/FQQCP6EKP9RKRBE.jpg?auto=webp&frame=1&width=410&height=1024&fit=bounds&md=6cdfd2f31060c20fac2ddff3133abb7f"></a></p><p>我們必須將兩個 18650 電池並聯。我用過的電池槽是一個兩槽座，帶有獨立的接線端子用於連接。要進行並聯，請使用一根電線將每側的兩個端子連接在一起。  </p><p>首先在端子上塗抹少量助焊劑，然後使用電線將它們短路。  </p><p>接下來將紅色延長線焊接到正極端子，將黑色電線焊接到電池座的負極端子。</p><h2 id="第-6-步：紅外接近傳感器"><a href="#第-6-步：紅外接近傳感器" class="headerlink" title="第 6 步：紅外接近傳感器"></a>第 6 步：紅外接近傳感器</h2><p><a href="https://draft.blogger.com/blog/post/edit/6959160158145357673/2369433296544109208#"><img src="https://content.instructables.com/ORIG/FV6/ODYQ/KP9RKRHV/FV6ODYQKP9RKRHV.jpg?auto=webp&frame=1&width=594&height=1024&fit=bounds&md=9ac11bdb80f34156dfdadf41cf76f219"></a></p><p>目前，手持體溫計在發燒篩查方面非常流行。但是，手持式溫度計的性能取決於操作者和到額頭的距離。為了克服這些問題，使用紅外線接近傳感器來測量傳感器與額頭之間的距離，當距離足夠時，將感應並顯示溫度讀數。這樣，提高了測量的準確度。  </p><p>您可以通過調節傳感器模塊上的電位器來設置接近傳感器到物體的檢測距離。順時針旋轉電位器將增加檢測距離，逆時針旋轉將減少檢測距離。我已將此距離設置為大約 50 毫米。  </p><p>連接應如下所示：  </p><p>Arduino——紅外傳感器</p><p>3.3V — VCC</p><p>GND——GND  </p><p>D9 —- OUT</p><h2 id="第7步-OLED-Display"><a href="#第7步-OLED-Display" class="headerlink" title="第7步: OLED Display"></a>第7步: OLED Display</h2><p><a href="https://draft.blogger.com/blog/post/edit/6959160158145357673/2369433296544109208#"><img src="https://content.instructables.com/ORIG/FJ4/OEI5/KP9RKQI6/FJ4OEI5KP9RKQI6.jpg?auto=webp&frame=1&width=611&fit=bounds&md=ed51004eeb0b79efc5b1e676c42c0378"></a></p><p>體溫顯示採用0.96’ OLED顯示屏，分辨率為128x64，採用I2C總線與Arduino通信。Arduino Nanno中的兩個引腳SCL（A5），SDA（A4）用於通信。  </p><p>我正在使用 Adafruit_SSD1306 庫來顯示參數。  </p><p>首先，您必須下載 Adafruit_SSD1306。然後安裝它。  </p><p><strong><em>連接應如下所示：</em></strong>  </p><p>Arduino——OLED  </p><p>5V — VCC  </p><p>GND——GND  </p><p>A4—-SDA  </p><p>A5—-SCL</p><h2 id="第8步-LED指示燈"><a href="#第8步-LED指示燈" class="headerlink" title="第8步: LED指示燈"></a>第8步: LED指示燈</h2><p><a href="https://draft.blogger.com/blog/post/edit/6959160158145357673/2369433296544109208#"><img src="https://content.instructables.com/ORIG/FMD/2M2F/KP9RKQLI/FMD2M2FKP9RKQLI.jpg?auto=webp&frame=1&width=785&height=1024&fit=bounds&md=dd1f9e844e5326f077b06fef485a751b"></a></p><p><a href="https://draft.blogger.com/blog/post/edit/6959160158145357673/2369433296544109208#"><img src="https://content.instructables.com/ORIG/F49/O0R3/KP9RKQLE/F49O0R3KP9RKQLE.jpg?auto=webp&frame=1&width=397&height=1024&fit=bounds&md=9e516072d26a901b53d46dbaa83856b5"></a></p><p>兩個LED用於指示體溫是正常還是異常。綠色 LED 指示體溫正常，紅色 LED 指示異常情況（當溫度高於 104 華氏度時）</p><p>綠色 LED ( LED1 ) 連接到 Arduino 數字引腳 D3，紅色 LED ( LED2 ) 連接到 D5。為了限制 LED 的電流，使用了兩個 330 Ω 電阻器。將電阻焊接到 LED 的正極端子。 LED 較長的腳指示正極端子。  </p><p>如上圖所示，將 4 根跳線連接到 LED。這裡我必須使用母-</p><p>母跳線，以便於連接。</p><h2 id="第-9-步：警報蜂鳴器"><a href="#第-9-步：警報蜂鳴器" class="headerlink" title="第 9 步：警報蜂鳴器"></a>第 9 步：警報蜂鳴器</h2><p><a href="https://draft.blogger.com/blog/post/edit/6959160158145357673/2369433296544109208#"><img src="https://content.instructables.com/ORIG/F4T/1EXH/KP9RL19X/F4T1EXHKP9RL19X.jpg?auto=webp&frame=1&width=779&fit=bounds&md=0c7ba48304149e42bcab06324eedf719"></a></p><p>為了在人體篩查期間提供警報，使用了壓電蜂鳴器。蜂鳴器有兩個端子，較長的一端為正極，較短的腳為負極。新蜂鳴器上的貼紙也有“+”標記，表示正極端子。  </p><p>您可以將電線焊接到蜂鳴器引腳上，或者您可以使用我在這裡使用的母跳線。  </p><p>連接應如下所示：  </p><p>Arduino——蜂鳴器  </p><p>D7 – 正極端子  </p><p>GND——負極</p><h2 id="第-10-步：準備擴展板"><a href="#第-10-步：準備擴展板" class="headerlink" title="第 10 步：準備擴展板"></a>第 10 步：準備擴展板</h2><p>如下圖:將5V, GND, SCL, SDA用焊接擴充</p><p><a href="https://draft.blogger.com/blog/post/edit/6959160158145357673/2369433296544109208#"><img src="https://content.instructables.com/ORIG/FZ2/TUB2/KP9RL3QL/FZ2TUB2KP9RL3QL.jpg?auto=webp&frame=1&width=812&fit=bounds&md=f2ac4545b47d3d7410da953e4786eb4a"></a></p><p><a href="https://draft.blogger.com/blog/post/edit/6959160158145357673/2369433296544109208#"><img src="https://content.instructables.com/ORIG/FNK/RFBV/KP9RL259/FNKRFBVKP9RL259.jpg?auto=webp&frame=1&width=384&fit=bounds&md=401b9a5b05849f2801dc8a0956309568"></a></p><h2 id="第-11-步：製作電路"><a href="#第-11-步：製作電路" class="headerlink" title="第 11 步：製作電路"></a>第 11 步：製作電路</h2><p><a href="https://draft.blogger.com/blog/post/edit/6959160158145357673/2369433296544109208#"><img src="https://content.instructables.com/ORIG/FAS/I203/KP9RL1QL/FASI203KP9RL1QL.jpg?auto=webp&frame=1&crop=3:2&width=838&height=1024&fit=bounds&md=524128c12bfb3a5b0bb49ec4692f1d75"></a></p><p><a href="https://draft.blogger.com/blog/post/edit/6959160158145357673/2369433296544109208#"><img src="https://content.instructables.com/ORIG/FSG/V2EB/KP9RKQSZ/FSGV2EBKP9RKQSZ.png?auto=webp&frame=1&width=362&fit=bounds&md=e7e9a0092875544993b9be8d7072a3ce"></a></p><p> 首先，下載 Arduino 草圖並安裝所有庫。  </p><p>下載並安裝以下庫：  </p><p>1. Adafruit-MLX90614-Library：<a href="https://draft.blogger.com/blog/post/edit/6959160158145357673/2369433296544109208#">https://github.com/adafruit/Adafruit-MLX90614-Lib…</a>  </p><p>2. Adafruit_SSD1306 庫：<a href="https://draft.blogger.com/blog/post/edit/6959160158145357673/2369433296544109208#">https://github.com/adafruit/Adafruit_SSD1306</a>  </p><p>3.millisDelay：<a href="https://draft.blogger.com/blog/post/edit/6959160158145357673/2369433296544109208#">https://github.com/ansonhe97/millisDelay</a>  </p><p>使用您的筆記本電腦或台式電腦將 USB 電纜插入 Arduino Nano。  </p><p>設置正確的板子和 COM 端口號並將代碼上傳到 Arduino。</p><hr><p>這裡我先將主要的傳感器做測試，等待列印外殼再做組裝</p><div class="video-container"><iframe src="https://www.youtube.com/embed/LAPAus2xMJ8" frameborder="0" loading="lazy" allowfullscreen></iframe></div><hr><p><strong>6/27</strong></p><p><strong>列印外殼時長28小時,當然我是前後蓋分開印,後蓋印的還不錯,在列前蓋時剩下最後1%時噴頭給我阻塞,心都涼了!!!媽呀~~~~</strong></p><p><strong>7/1</strong></p><p><strong>當我把模組全部裝上機盒時,發現開機後的動作怪怪的,而直接使用電源接在nano上又正常,後來查到是升壓模組進電壓3.7v沒有升壓到7v,後來查一下網路,說升壓模組的調整閥一拿到最好都先逆時針轉20圈以上,再順時針調整,電壓就能往上(調整時調整閥朝自己)。</strong></p><p><strong>7/3</strong></p><p><strong>發現有個缺點,IR模組在光線強的地方會一直自己動作,調了靈敏度也是一樣,不知是傳感器有問題還是….,先買幾個換上再試。</strong></p><p><a href="https://draft.blogger.com/blog/post/edit/6959160158145357673/2369433296544109208#"><img src="https://cf.shopee.tw/file/11e9c94f34a936a6d9aacd4893b9be91"></a></p><p><a href="https://draft.blogger.com/blog/post/edit/6959160158145357673/2369433296544109208#"><img src="https://lh3.googleusercontent.com/--GcWcr76wPw/YOAE5zttu_I/AAAAAAAAeZI/jc8EqqH4ap0udaNtBGp2dvoEWKSeFWqLACNcBGAsYHQ/s1600/1625294021588501-0.png"></a></p><p><a href="https://draft.blogger.com/blog/post/edit/6959160158145357673/2369433296544109208#"><img src="https://lh3.googleusercontent.com/-nLsZ-SyOg40/YN7NHJBac_I/AAAAAAAAeYw/vCmjbHF7rsgIvZvQnUM3qXZKn_RYC-ACgCNcBGAsYHQ/s1600/1625214227181480-1.png"></a></p><div class="video-container"><iframe src="https://www.youtube.com/embed/b029HT_Jpnw" frameborder="0" loading="lazy" allowfullscreen></iframe></div>]]></content>
      
      
      <categories>
          
          <category> arduino </category>
          
      </categories>
      
      
        <tags>
            
            <tag> GY-906 </tag>
            
            <tag> IR紅外傳感器 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>MQTT-Node-RED控制二軸云台-ESP32</title>
      <link href="/2021/09/02/mqtt-node-red-kong-zhi-er-zhou-yun-tai-esp32/"/>
      <url>/2021/09/02/mqtt-node-red-kong-zhi-er-zhou-yun-tai-esp32/</url>
      
        <content type="html"><![CDATA[<h1 id="MQTT-Node-RED控制二軸云台-ESP32"><a href="#MQTT-Node-RED控制二軸云台-ESP32" class="headerlink" title="MQTT-Node-RED控制二軸云台-ESP32"></a>MQTT-Node-RED控制二軸云台-ESP32</h1><h6 id="tags-esp32-servo-node-red-mqtt"><a href="#tags-esp32-servo-node-red-mqtt" class="headerlink" title="tags: esp32 servo node-red mqtt"></a>tags: <code>esp32</code> <code>servo</code> <code>node-red</code> <code>mqtt</code></h6><p><em>伺服馬達對於微控板玩家一定是再熟悉不過，也是入門必學的元件之一，只是特別要注意如果要控制２個以上的伺服馬達，一定要使用外接電源或者PCA9685。</em></p><p><em>伺服馬達有很多款，小型常用的就屬SG-90，它是塑膠齒輪，還有一種是金屬齒輪</em></p><h2 id="伺服馬達的規格"><a href="#伺服馬達的規格" class="headerlink" title="伺服馬達的規格"></a>伺服馬達的規格</h2><h3 id="SG-90規格"><a href="#SG-90規格" class="headerlink" title="SG-90規格"></a>SG-90規格</h3><p><a href="https://draft.blogger.com/blog/post/edit/3809681606094011522/8073202486984569203?hl=zh-TW#"><img src="https://1.bp.blogspot.com/-nxgapjbWx68/YSXYndzzCVI/AAAAAAAAe2s/qsMvSksBD3YRlIHAnQ1wzBKyuROmzx90wCNcBGAsYHQ/w233-h233/dc05cb93dcb58dbc3887b14f60cced9f.jpg"></a></p><ul><li>  工作電壓：4.8V.</li><li>  轉矩：1.8kg-cm</li><li>  運轉速度：0.1秒∕ 60度</li><li>  轉動角度：最大90°</li><li>脈衝寬度範圍：500~2400µs.</li></ul><h3 id="MG90S規格"><a href="#MG90S規格" class="headerlink" title="MG90S規格"></a>MG90S規格</h3><p><a href="https://draft.blogger.com/blog/post/edit/3809681606094011522/8073202486984569203?hl=zh-TW#"><img src="https://1.bp.blogspot.com/-ClUAItIjGJ4/YSXY8XrU1pI/AAAAAAAAe20/pIH_GpNA5Cgnlsx45QZJ1nlS6Uu6_xsdACNcBGAsYHQ/w273-h273/180303000000b-800x800.jpg"></a></p><ul><li>  金屬銅齒、空心杯電機、雙滾珠軸承</li><li>  產品型號：<strong>MG90s</strong>.</li><li>  扭力：2.0kg(4.8v)</li><li>  運轉速度：0.11s(4.8v)</li><li>  轉動角度：最大90°/180°</li><li>舵機類型：數字舵機</li></ul><ol><li> <em>此次實驗以MG-90為主</em></li><li> <em>要控制伺服馬達有兩種方式，一種是利用PWM，另一種是使用現有的庫包來控制，本次實驗以庫包為主</em></li></ol><h2 id="首先安裝"><a href="#首先安裝" class="headerlink" title="首先安裝"></a>首先安裝</h2><p> <a href="https://draft.blogger.com/blog/post/edit/3809681606094011522/8073202486984569203?hl=zh-TW#">ESP32 Arduino Servo Library</a></p><h2 id="接線方式"><a href="#接線方式" class="headerlink" title="接線方式"></a>接線方式</h2><ul><li>  GND -&gt; ESP32 GND pin;</li><li>  Power -&gt; ESP32 VIN pin;</li><li>Signal -&gt; GPIO 13 (or any PWM pin).  <a href="https://draft.blogger.com/blog/post/edit/3809681606094011522/8073202486984569203?hl=zh-TW#"><img src="https://i1.wp.com/randomnerdtutorials.com/wp-content/uploads/2018/05/servo-esp32-schematic.png?w=750&quality=100&strip=all&ssl=1"></a></li></ul><h2 id="進行實驗"><a href="#進行實驗" class="headerlink" title="進行實驗"></a>進行實驗</h2><pre class="line-numbers language-c#" data-language="c#"><code class="language-c#">#include &lt;ESP32Servo.h&gt;Servo myservo;int pos &#x3D; 20;const int pin &#x3D; 12;void setup()&#123;  Serial.begin(115200);  myservo.attach(pin, 500, 2400);&#125;void loop()&#123;  for (pos&#x3D;20; pos&lt;&#x3D;160; pos+&#x3D;3)&#123;    myservo.write(pos);    delay(100);  &#125;  for (pos&#x3D;160; pos&gt;&#x3D;20; pos-&#x3D;3)&#123;    myservo.write(pos);    delay(100);  &#125;&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><hr><h2 id="先備妥樹莓派上所須的軟硬體"><a href="#先備妥樹莓派上所須的軟硬體" class="headerlink" title="先備妥樹莓派上所須的軟硬體"></a><strong>先備妥樹莓派上所須的軟硬體</strong></h2><ol><li> <strong><em>安裝<a href="https://draft.blogger.com/blog/post/edit/3809681606094011522/8073202486984569203?hl=zh-TW#">Mosquitto broker</a>(如果沒玩過樹莓派,請連結<a href="https://draft.blogger.com/blog/post/edit/3809681606094011522/8073202486984569203?hl=zh-TW#">這裡</a>安裝樹莓派系統和<a href="https://draft.blogger.com/blog/post/edit/3809681606094011522/8073202486984569203?hl=zh-TW#">如</a></em></strong></li><li> <strong><em><a href="https://draft.blogger.com/blog/post/edit/3809681606094011522/8073202486984569203?hl=zh-TW#">何使用SSH和VNC鏡像</a>)</em></strong></li><li> <strong><em>安裝 <a href="https://draft.blogger.com/blog/post/edit/3809681606094011522/8073202486984569203?hl=zh-TW#">Node-RED installed</a>  和 <a href="https://draft.blogger.com/blog/post/edit/3809681606094011522/8073202486984569203?hl=zh-TW#">Node-RED Dashboard</a>在樹莓派上。</em></strong></li><li> <strong>_備註:安裝Node-RED時若出現錯誤訊息改用下面所附下載 _****<em>bash &lt;(curl -sL <a href="https://raw.githubusercontent.com/node-red/linux-installers/master/deb/update-nodejs-and-nodered">https://raw.githubusercontent.com/node-red/linux-installers/master/deb/update-nodejs-and-nodered</a>)</em></strong></li></ol><hr><h2 id="布署Node-RED"><a href="#布署Node-RED" class="headerlink" title="布署Node-RED"></a>布署Node-RED</h2><p><a href="https://draft.blogger.com/blog/post/edit/3809681606094011522/8073202486984569203?hl=zh-TW#"><img src="https://1.bp.blogspot.com/-GksKBPZ26_o/YSpWJWFmwhI/AAAAAAAAe4E/6peztH_jPDgTVkrbfKGBriWMdPbxcnCyACNcBGAsYHQ/w731-h411/3.jpg"></a></p><p><a href="https://1.bp.blogspot.com/-bIpsZvvgG6Y/YSpVzj9SmhI/AAAAAAAAe34/-V-RirefCUETcVru84SLRomgYX3EzNOnQCNcBGAsYHQ/s661/1.jpg"><img src="https://1.bp.blogspot.com/-bIpsZvvgG6Y/YSpVzj9SmhI/AAAAAAAAe34/-V-RirefCUETcVru84SLRomgYX3EzNOnQCNcBGAsYHQ/w793-h444/1.jpg"></a></p><p><a href="https://1.bp.blogspot.com/-AS8DJhdGX5Q/YSpV8K4e0hI/AAAAAAAAe38/1h6rhTpCw1wwJ_hmA4QAZDDkU-6MBBANwCNcBGAsYHQ/s654/2.jpg"><img src="https://1.bp.blogspot.com/-AS8DJhdGX5Q/YSpV8K4e0hI/AAAAAAAAe38/1h6rhTpCw1wwJ_hmA4QAZDDkU-6MBBANwCNcBGAsYHQ/w761-h428/2.jpg"></a></p><hr><p><em><strong>須匯入<a href="https://draft.blogger.com/blog/post/edit/3809681606094011522/8073202486984569203?hl=zh-TW#">ESP32Servo.h</a>和<a href="https://draft.blogger.com/blog/post/edit/3809681606094011522/8073202486984569203?hl=zh-TW#">PubSubClient.h</a></strong></em></p><h2 id="程式碼"><a href="#程式碼" class="headerlink" title="程式碼"></a>程式碼</h2><pre class="line-numbers language-c#" data-language="c#"><code class="language-c#">#include &lt;ESP32Servo.h&gt;#include &lt;WiFi.h&gt;#include &lt;PubSubClient.h&gt;  &#x2F;&#x2F;伺服馬達初始化Servo myservoPan, myservoTilt;const int pan &#x3D; 12;const int tilt &#x3D; 13;  const char *ssid &#x3D; &quot;---&quot;;const char *password &#x3D; &quot;----&quot;;const char *mqttServer &#x3D; &quot;192.168.--.--&quot;;&#x2F;&#x2F;wifi客戶端及MQTT客戶端代數WiFiClient espClient;PubSubClient client(espClient);  &#x2F;&#x2F;wifi連線void wifiConn()&#123;  WiFi.begin(ssid, password);  while (WiFi.status() !&#x3D; WL_CONNECTED)&#123;    Serial.print(&quot;.&quot;);    delay(500);  &#125;  Serial.println(&quot;Connected successful!&quot;);  &#x2F;&#x2F; Serial.print(&quot;IP: &quot;);  &#x2F;&#x2F; Serial.println(WiFi.localIP());&#125;    void callBack(char *topic, byte *message, unsigned int length)&#123;  &#x2F;&#x2F;列出mqtt接收到的主題和字元  String msgPan, msgTilt;  Serial.print(&quot;topic: &quot;);  Serial.println(topic);  Serial.print(&quot;message: &quot;);  for (int i &#x3D; 0; i &lt; length; i++)&#123;    Serial.print(char(message[i]));    msgPan +&#x3D; char(message[i]);    msgTilt +&#x3D; char(message[i]);  &#125;  Serial.println();  &#x2F;&#x2F;接收到的字元如果符合就執行相應的動作  if (String(topic) &#x3D;&#x3D; &quot;esp32&#x2F;servoPan&quot;)&#123;    myservoPan.write(msgPan.toInt());    delay(100);  &#125;else if (String(topic) &#x3D;&#x3D; &quot;esp32&#x2F;servoTilt&quot;)&#123;    myservoTilt.write(msgTilt.toInt());    delay(100);  &#125;&#125;  &#x2F;&#x2F;萬一連不上mqtt就重新連線void reconnMqtt()&#123;  while (! client.connected())&#123;    Serial.println(&quot;嚐試連線MQTT...&quot;);    if (client.connect(&quot;esp32Client&quot;))&#123;      Serial.print(&quot;已連線&quot;);      client.subscribe(&quot;esp32&#x2F;servoPan&quot;);      client.subscribe(&quot;esp32&#x2F;servoTilt&quot;);    &#125;else &#123;      Serial.print(&quot;無法連線的原因是: &quot;);      Serial.print(client.state());      delay(2000);    &#125;  &#125;&#125;  void setup()&#123;  Serial.begin(115200);  &#x2F;&#x2F;伺服馬達腳位和範圍  myservoPan.attach(pan, 500, 2400);  myservoTilt.attach(tilt, 500, 2400);  wifiConn();  &#x2F;&#x2F;mqtt初始化  client.setServer(mqttServer, 1883);  &#x2F;&#x2F;監聽訂閱傳來的訊息  client.setCallback(callBack);&#125;void loop()&#123;  if (! client.connected())&#123;    reconnMqtt();  &#125;  client.loop();&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><div class="video-container"><iframe src="https://www.youtube.com/embed/eP2EA1m7cPw" frameborder="0" loading="lazy" allowfullscreen></iframe></div>]]></content>
      
      
      <categories>
          
          <category> micropython </category>
          
          <category> esp32 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> mqtt </tag>
            
            <tag> node-red </tag>
            
            <tag> 二軸云台 </tag>
            
            <tag> servo </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>MQTT&amp;node-RED控制二軸云台-mpython</title>
      <link href="/2021/08/31/mqtt-node-red-kong-zhi-er-zhou-yun-tai-mpython-1/"/>
      <url>/2021/08/31/mqtt-node-red-kong-zhi-er-zhou-yun-tai-mpython-1/</url>
      
        <content type="html"><![CDATA[<h1 id="MQTT-amp-node-RED控制二軸云台-mpython"><a href="#MQTT-amp-node-RED控制二軸云台-mpython" class="headerlink" title="MQTT&amp;node-RED控制二軸云台-mpython"></a>MQTT&amp;node-RED控制二軸云台-mpython</h1><p><a href="https://draft.blogger.com/blog/post/edit/6280040346040914276/4999901201185761586?hl=zh-TW#"><img src="https://lh3.googleusercontent.com/-sqJOZzdBnks/YSjK1HOEkWI/AAAAAAAAe3o/ShJX8l8V20cmENfwoL0iij0uZm_wHfwaQCNcBGAsYHQ/w208-h349/1630063309993121-0.png"></a></p><p><em><strong>承接<a href="https://draft.blogger.com/blog/post/edit/6280040346040914276/4999901201185761586?hl=zh-TW#">使用PWM控制伺服馬達-micropython</a>這篇，透過node-red加入mqtt訂閱主題控制二軸云台</strong></em></p><p><em><strong>有一些感想紀錄下來，我發現其實像mqtt或者wifi連網，大都是固定一個寫法，其它不同的模組分為讀取數值或用數值受控制的元件，只要套用上去就可以。</strong></em></p><p><em><strong>首先主要是被控制的伺服馬達，所以先把它測試一下，參考這篇（<a href="https://draft.blogger.com/blog/post/edit/6280040346040914276/4999901201185761586?hl=zh-TW#">點我</a>）</strong></em></p><p><em><strong>測試好之後，就可以開始加入wifi和mqtt了，但因為我用的是樹莓派建立的ＭQTT，所以這陪分前提是要有樹苺派，如何在樹苺派上建立Ｎode-RED和MQTT，可以參考這篇（<a href="https://draft.blogger.com/blog/post/edit/6280040346040914276/4999901201185761586?hl=zh-TW#">點我</a>）。</strong></em></p><hr><h2 id="Node-RED設定"><a href="#Node-RED設定" class="headerlink" title="Node-RED設定"></a>Node-RED設定</h2><p><a href="https://draft.blogger.com/blog/post/edit/6280040346040914276/4999901201185761586?hl=zh-TW#"><img src="https://1.bp.blogspot.com/-GksKBPZ26_o/YSpWJWFmwhI/AAAAAAAAe4E/6peztH_jPDgTVkrbfKGBriWMdPbxcnCyACNcBGAsYHQ/w654-h368/3.jpg"></a></p><p><a href="https://draft.blogger.com/blog/post/edit/6280040346040914276/4999901201185761586?hl=zh-TW#"><img src="https://1.bp.blogspot.com/-bIpsZvvgG6Y/YSpVzj9SmhI/AAAAAAAAe34/-V-RirefCUETcVru84SLRomgYX3EzNOnQCNcBGAsYHQ/w661-h370/1.jpg"></a></p><p><a href="https://draft.blogger.com/blog/post/edit/6280040346040914276/4999901201185761586?hl=zh-TW#"><img src="https://1.bp.blogspot.com/-AS8DJhdGX5Q/YSpV8K4e0hI/AAAAAAAAe38/1h6rhTpCw1wwJ_hmA4QAZDDkU-6MBBANwCNcBGAsYHQ/w654-h368/2.jpg"></a></p><h2 id="程式碼"><a href="#程式碼" class="headerlink" title="程式碼"></a>程式碼</h2><pre class="line-numbers language-py" data-language="py"><code class="language-py"><span class="token keyword">from</span> machine <span class="token keyword">import</span> SLEEP<span class="token punctuation">,</span> Pin<span class="token punctuation">,</span> PWM<span class="token punctuation">,</span> freq    <span class="token keyword">from</span> time <span class="token keyword">import</span> sleep    <span class="token keyword">from</span> umqtttsimple <span class="token keyword">import</span> MQTTClient    <span class="token keyword">import</span> binascii<span class="token punctuation">,</span> micropython<span class="token punctuation">,</span> network<span class="token punctuation">,</span> time<span class="token punctuation">,</span> socket<span class="token punctuation">,</span> machine    ssid <span class="token operator">=</span> <span class="token string">"------------"</span>    password <span class="token operator">=</span> <span class="token string">"-------"</span>    mqtt_server <span class="token operator">=</span> <span class="token string">"192.168.210.22"</span>    <span class="token comment">#將客戶端ID轉換為16進位,以便MQTT伺服端讀取</span>    mqtt_id <span class="token operator">=</span> binascii<span class="token punctuation">.</span>hexlify<span class="token punctuation">(</span>machine<span class="token punctuation">.</span>unique_id<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>    <span class="token comment">#和Nord-RED上的主題一致</span>    client_servoPan <span class="token operator">=</span> <span class="token string">b'esp32/servoPan'</span>    client_servoTilt <span class="token operator">=</span> <span class="token string">b'esp32/servoTilt'</span>    servo_pan <span class="token operator">=</span> PWM<span class="token punctuation">(</span>Pin<span class="token punctuation">(</span><span class="token number">13</span><span class="token punctuation">)</span><span class="token punctuation">,</span> freq<span class="token operator">=</span><span class="token number">50</span><span class="token punctuation">)</span>    servo_tilt <span class="token operator">=</span> PWM<span class="token punctuation">(</span>Pin<span class="token punctuation">(</span><span class="token number">14</span><span class="token punctuation">)</span><span class="token punctuation">,</span> freq<span class="token operator">=</span><span class="token number">50</span><span class="token punctuation">)</span>    <span class="token comment">#wifi連線</span>    <span class="token keyword">def</span> <span class="token function">wifiConn</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>        wifi <span class="token operator">=</span> network<span class="token punctuation">.</span>WLAN<span class="token punctuation">(</span>network<span class="token punctuation">.</span>STA_IF<span class="token punctuation">)</span>        wifi<span class="token punctuation">.</span>active<span class="token punctuation">(</span><span class="token boolean">True</span><span class="token punctuation">)</span>        wifi<span class="token punctuation">.</span>connect<span class="token punctuation">(</span>ssid<span class="token punctuation">,</span> password<span class="token punctuation">)</span>        <span class="token keyword">while</span> wifi<span class="token punctuation">.</span>isconnected<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token boolean">False</span><span class="token punctuation">:</span>           <span class="token keyword">pass</span>        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"Connected successful!"</span><span class="token punctuation">)</span>        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"IP: &#123;&#125;"</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>wifi<span class="token punctuation">.</span>ifconfig<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>    <span class="token comment">#樹莓派上的mqtt回應訂閱</span>    <span class="token comment"># Duty 就為 2.5％、7.25％、12％，並 x1024 後可以轉換成 PWM Duty填入的數值</span>    <span class="token keyword">def</span> <span class="token function">callBack</span><span class="token punctuation">(</span>topic<span class="token punctuation">,</span> msg<span class="token punctuation">)</span><span class="token punctuation">:</span>       ang0 <span class="token operator">=</span> <span class="token builtin">int</span><span class="token punctuation">(</span><span class="token number">1023</span><span class="token operator">*</span><span class="token number">0.025</span><span class="token punctuation">)</span>       ang90 <span class="token operator">=</span> <span class="token builtin">int</span><span class="token punctuation">(</span><span class="token number">1023</span><span class="token operator">*</span><span class="token number">0.0725</span><span class="token punctuation">)</span>       ang180 <span class="token operator">=</span> <span class="token builtin">int</span><span class="token punctuation">(</span><span class="token number">1023</span><span class="token operator">*</span><span class="token number">0.12</span><span class="token punctuation">)</span>       <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token punctuation">(</span>topic<span class="token punctuation">,</span> msg<span class="token punctuation">)</span><span class="token punctuation">)</span>       <span class="token keyword">if</span> topic <span class="token operator">==</span> client_servoPan<span class="token punctuation">:</span>            servo_pan<span class="token punctuation">.</span>duty<span class="token punctuation">(</span><span class="token builtin">int</span><span class="token punctuation">(</span>msg<span class="token punctuation">)</span><span class="token punctuation">)</span>            sleep<span class="token punctuation">(</span><span class="token number">0.5</span><span class="token punctuation">)</span>        <span class="token keyword">elif</span> topic <span class="token operator">==</span> client_servoTilt<span class="token punctuation">:</span>            servo_tilt<span class="token punctuation">.</span>duty<span class="token punctuation">(</span><span class="token builtin">int</span><span class="token punctuation">(</span>msg<span class="token punctuation">)</span><span class="token punctuation">)</span>            sleep<span class="token punctuation">(</span><span class="token number">0.5</span><span class="token punctuation">)</span>    <span class="token comment">#連線MQTT,連線成功後訂閱主題</span>    <span class="token keyword">def</span> <span class="token function">connToMqtt</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>        <span class="token keyword">try</span><span class="token punctuation">:</span>            client <span class="token operator">=</span> MQTTClient<span class="token punctuation">(</span>mqtt_id<span class="token punctuation">,</span> mqtt_server<span class="token punctuation">)</span>            client<span class="token punctuation">.</span>set_callback<span class="token punctuation">(</span>callBack<span class="token punctuation">)</span>            client<span class="token punctuation">.</span>connect<span class="token punctuation">(</span><span class="token punctuation">)</span>            client<span class="token punctuation">.</span>subscribe<span class="token punctuation">(</span>client_servoPan<span class="token punctuation">)</span>            client<span class="token punctuation">.</span>subscribe<span class="token punctuation">(</span>client_servoTilt<span class="token punctuation">)</span>            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"connect to %s"</span><span class="token operator">%</span>mqtt_server<span class="token punctuation">)</span>            <span class="token keyword">return</span> client            <span class="token comment">#如果無法連線重新連線</span>        <span class="token keyword">except</span> OSError <span class="token keyword">as</span> e<span class="token punctuation">:</span>            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"not to connected for MQTT server!"</span><span class="token punctuation">)</span>            machine<span class="token punctuation">.</span>reset<span class="token punctuation">(</span><span class="token punctuation">)</span>        wifiConn<span class="token punctuation">(</span><span class="token punctuation">)</span>        client <span class="token operator">=</span> connToMqtt<span class="token punctuation">(</span><span class="token punctuation">)</span>        <span class="token keyword">while</span> <span class="token boolean">True</span><span class="token punctuation">:</span>            <span class="token comment">#檢查有無進來的訊息</span>            client<span class="token punctuation">.</span>check_msg<span class="token punctuation">(</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>調過等待時間還是會偶爾抖動，雖然不知道抖動原在哪，先這樣好了，下次再來抓原因。</p>]]></content>
      
      
      <categories>
          
          <category> micropython </category>
          
          <category> esp32 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> mqtt </tag>
            
            <tag> node-red </tag>
            
            <tag> 二軸云台 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>使用PWM控制伺服馬達-micropython</title>
      <link href="/2021/08/31/shi-yong-pwm-kong-zhi-si-fu-ma-da-micropython/"/>
      <url>/2021/08/31/shi-yong-pwm-kong-zhi-si-fu-ma-da-micropython/</url>
      
        <content type="html"><![CDATA[<h1 id="使用PWM控制伺服馬達-micropython"><a href="#使用PWM控制伺服馬達-micropython" class="headerlink" title="使用PWM控制伺服馬達-micropython"></a>使用PWM控制伺服馬達-micropython</h1><h6 id="tags-micropython-servo-pwm"><a href="#tags-micropython-servo-pwm" class="headerlink" title="tags: micropython servo pwm"></a>tags: <code>micropython</code> <code>servo</code> <code>pwm</code></h6><p><a href="https://draft.blogger.com/blog/post/edit/6280040346040914276/5335469614801919559?hl=zh-TW#"><img src="https://1.bp.blogspot.com/-nxgapjbWx68/YSXYndzzCVI/AAAAAAAAe2s/qsMvSksBD3YRlIHAnQ1wzBKyuROmzx90wCNcBGAsYHQ/w233-h233/dc05cb93dcb58dbc3887b14f60cced9f.jpg"></a></p><p><a href="https://draft.blogger.com/blog/post/edit/6280040346040914276/5335469614801919559?hl=zh-TW#"><img src="https://lh3.googleusercontent.com/-KvFNc38Zvsw/YSc_jvO-Z-I/AAAAAAAAe3E/Xf2ZHTfM3HMVetVEdGSkgsNEtmL5KNx9wCNcBGAsYHQ/w450-h329/image.png"></a></p><p><em>伺服電機可以從 0 度旋轉到 180 度，但最多可以旋轉 210 度，具體取決於製造。可以通過將適當寬度的電脈衝應用到其控制引腳來控制這種旋轉程度。伺服每 20 毫秒檢查一次脈衝。 1 ms（1毫秒）寬度的脈衝可以將伺服旋轉到0度，1.5ms可以旋轉到90度（中位），2 ms脈衝可以將其旋轉到180度。</em></p><h3 id="接線方式"><a href="#接線方式" class="headerlink" title="接線方式"></a>接線方式</h3><pre class="line-numbers language-none"><code class="language-none">-   GND -&gt; ESP32 GND pin;-   Power -&gt; ESP32 VIN pin;-   Signal -&gt; GPIO 13 (or any PWM pin).<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p><a href="https://draft.blogger.com/blog/post/edit/6280040346040914276/5335469614801919559?hl=zh-TW#"><img src="https://i1.wp.com/randomnerdtutorials.com/wp-content/uploads/2018/05/servo-esp32-schematic.png?w=750&quality=100&strip=all&ssl=1"></a></p><hr><p>將頻率設置為 50Hz（每 20ms 一個週期），並將佔空值設置在 18（18/1023 * 20ms = 0.35ms）和 115（115/1023 * 20ms = 2.24ms）之間。佔空比可以介於 0 和 1023 之間（包括 0 和 1023）。</p><h3 id="程式碼"><a href="#程式碼" class="headerlink" title="程式碼"></a>程式碼</h3><pre class="line-numbers language-py" data-language="py"><code class="language-py"><span class="token keyword">from</span>   machine   <span class="token keyword">import</span> Pin<span class="token punctuation">,</span> PWM<span class="token punctuation">,</span> freq <span class="token keyword">from</span>   time   <span class="token keyword">import</span> sleepservo <span class="token operator">=</span> PWM<span class="token punctuation">(</span>Pin<span class="token punctuation">(</span><span class="token number">13</span><span class="token punctuation">)</span><span class="token punctuation">,</span> freq<span class="token operator">=</span><span class="token number">50</span><span class="token punctuation">)</span> <span class="token keyword">while</span>   <span class="token boolean">True</span><span class="token punctuation">:</span> <span class="token keyword">for</span> i <span class="token keyword">in</span>   <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">18</span><span class="token punctuation">,</span> <span class="token number">115</span><span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    servo<span class="token punctuation">.</span>duty<span class="token punctuation">(</span>i<span class="token punctuation">)</span> <span class="token keyword">print</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span>    sleep<span class="token punctuation">(</span><span class="token number">0.05</span><span class="token punctuation">)</span> <span class="token keyword">for</span> j <span class="token keyword">in</span>   <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">115</span><span class="token punctuation">,</span> <span class="token number">18</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    servo<span class="token punctuation">.</span>duty<span class="token punctuation">(</span>j<span class="token punctuation">)</span> <span class="token keyword">print</span><span class="token punctuation">(</span>j<span class="token punctuation">)</span>    sleep<span class="token punctuation">(</span><span class="token number">0.05</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><div class="video-container"><iframe src="https://www.youtube.com/embed/RYo2gCq5bHs" frameborder="0" loading="lazy" allowfullscreen></iframe></div>]]></content>
      
      
      <categories>
          
          <category> micropython </category>
          
          <category> esp32 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 伺服馬達 </tag>
            
            <tag> pwm </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>使用AdafriutIO-dashboards控制Neopixel燈條-mpython</title>
      <link href="/2021/08/31/shi-yong-adafriutio-dashboards-kong-zhi-neopixel-deng-tiao-mpython/"/>
      <url>/2021/08/31/shi-yong-adafriutio-dashboards-kong-zhi-neopixel-deng-tiao-mpython/</url>
      
        <content type="html"><![CDATA[<h1 id="使用AdafriutIO-dashboards控制Neopixel燈條—mpython"><a href="#使用AdafriutIO-dashboards控制Neopixel燈條—mpython" class="headerlink" title="使用AdafriutIO-dashboards控制Neopixel燈條—mpython "></a>使用AdafriutIO-dashboards控制Neopixel燈條—mpython </h1><p><a href="https://draft.blogger.com/blog/post/edit/6280040346040914276/9124050194814696260?hl=zh-TW#"><img src="https://lh3.googleusercontent.com/-cVHwv_2MP58/YSIGKZsNVcI/AAAAAAAAe1w/BSS8S2Djsdw_1SEMWfJY1uIktxKS1z32QCNcBGAsYHQ/s1600/1629619750586415-0.png"></a></p><p>原本是打算使用Nord-RED或直接網頁控制，但還沒搞的很懂尤其寫網頁的部份，偶然在網路上搜到原來Adafruit也有出Dashboards但是好像只能試用30天,但是沒關係,多認識一點不同的平台也很好</p><p><a href="https://draft.blogger.com/blog/post/edit/6280040346040914276/9124050194814696260?hl=zh-TW#"><img src="https://blogger.googleusercontent.com/img/a/AVvXsEjlieYsbPBn1UuHG6PZ97RRYbs6KEvN2HxI72y-LJD7L6Ic3sO2YhDqITLgXaCdjXXHJon9tcwguGwpMkfvfWw78X159s06LidRU3hnkIKKUCXSl4vykxg_VeVnMx4P53soBogM859XkN0aIM2llnLBIdDgUNSf8KOgvF7829RFXvZTT5jpS3GoNfuV=w756-h340"></a></p><h2 id="註冊方法"><a href="#註冊方法" class="headerlink" title="註冊方法"></a>註冊方法</h2><p>先到這裡註冊-<a href="https://draft.blogger.com/blog/post/edit/6280040346040914276/9124050194814696260?hl=zh-TW#">https://io.adafruit.com/</a></p><p><strong>接下來，我們在 Adafruit IO 中為 NeoPixels 的顏色創建</strong></p><p><strong>三個“紅色”、“藍色”和“綠色”。</strong></p><p><a href="https://draft.blogger.com/blog/post/edit/6280040346040914276/9124050194814696260?hl=zh-TW#"><img src="https://blogger.googleusercontent.com/img/a/AVvXsEhetlOMC0TagcGwntqDqn7FKiERvA5huakDm1IdKahfIP3bYvvryKTyug_RtOVMlTOcRGiZYj5t4RTiuSdgpWJXtQOTU42LOcYWpGGvtaMfsQJwvLSdSzX8XKZpxKR6F0ftzjHS7_r3tjGgXCqfbD7vrLIYSuCk_giv67Rc1I5ctxClSfiUeiuLgtEt=w705-h396"></a></p><p><strong>然後點進去剛創建好的群組裡,接著下個步驟</strong></p><p><a href="https://draft.blogger.com/blog/post/edit/6280040346040914276/9124050194814696260?hl=zh-TW#"><img src="https://blogger.googleusercontent.com/img/a/AVvXsEj6RG-m_TeWeKqicaJpz9bcBigSrZAfK-WJw5ZbWenwVs1L3juy6DgQQXkuihzYT1-69ahMSWl3Gc28vk_moDEnWlSr6otX3LD7UexOLqfBNkYVg3bBdPs0qD_RhYZtlZj2UmPPFLOaVtNJE9NbilZbm-ooDcZCmiUnIybvd7-immAFtTMgPPgf2CWG=w706-h397"></a></p><p><a href="https://draft.blogger.com/blog/post/edit/6280040346040914276/9124050194814696260?hl=zh-TW#"><img src="https://blogger.googleusercontent.com/img/a/AVvXsEijTp10Lu54QE-xSs5jJfuj77jPINW04CsWA5rRaz9TPUTMC9hojaAJ-fy_7zdeVH1qxsFz6CmPiSQDZ9_I2asrxeC68gexCQPw9-sxcq31s71dOfaDJBN2gOPdlFQXycNKXNlW3iwgMP732kfwdDXYla_7Tch0bnhOPGTNjhxFoybgqQD4SBvFERAN=w717-h346"></a></p><p><a href="https://draft.blogger.com/blog/post/edit/6280040346040914276/9124050194814696260?hl=zh-TW#"><img src="https://blogger.googleusercontent.com/img/a/AVvXsEjzFLj2w4H2uC0NBX5VZhcDqocyQQaipI5FZvp2DE9jz3t4g1fWxNDbYKtEWDGE9UaLyMikn8735cUqoO485LQXvtN8-253MuGS0DlfDTcKQpEGo8hu-jW_FRnJWVxBfmytXIVo_za-xY9zB7wyoDm7UH3Azsxtn8pWJeB6lhastTx1pz3HG7DHKESP=w638-h321"></a></p><p>最後，我們調整塊的設置。每個 RGB 值都是一個從 0 到 255 的整數。我們相應地配置滑塊。完成後，點擊“CREATE  BLOCK”。</p><p><a href="https://draft.blogger.com/blog/post/edit/6280040346040914276/9124050194814696260?hl=zh-TW#"><img src="https://blogger.googleusercontent.com/img/a/AVvXsEhPkZQjS1KUFI0BHw_U53DbxNnecF1yVmoN53ywLBHutePItXyFDDkFawQSuJSqg9LXwyRul9xTBSaKBjUPkag3O6N73NYW7xLVdHGdvxARhmd6MX20m_JX1DehXJmjSLsUcrLgLTe0tlyNbvU-5zG5OOKOioVsbel8Wg5U9qzD9PIhhrFF13QHUkur=w578-h577"></a></p><p><a href="https://draft.blogger.com/blog/post/edit/6280040346040914276/9124050194814696260?hl=zh-TW#"><img src="https://blogger.googleusercontent.com/img/a/AVvXsEipULTiF0bUIzSpuS9rBT74qs50-5AwD-znuzTZenklfN-IUt8xFDlwlEmi6T0Sv3R_C07FevYUug1WhXx0wIoLSGzoKwwYnygOqOBq0hH3KoGjeh9oTL4JYuPM9NCPmxmLKHy_F9oCDKBomsi4UwXRbRt5py0-R-Rh8F0cdgNw-5bNy__xoh82TOA7=w580-h270"></a></p><h2 id="API的key和username"><a href="#API的key和username" class="headerlink" title="API的key和username"></a>API的key和username</h2><p><a href="https://draft.blogger.com/blog/post/edit/6280040346040914276/9124050194814696260?hl=zh-TW#"><img src="https://blogger.googleusercontent.com/img/a/AVvXsEj1e_X33v_8Ph1NqUBt6mxZcJmITGm_8lqSrh-juRffRbcAGzULrQxlpdcsziaTXxu-SaypAufAknZWhR2EohZuiyZMHQxCFAZOXVxsxFF4Sh1NnYgO8W5JIKjDU9ZJ-8qXMFVfeM34uTjC3bdGNCNDzR-cDV2Sv6Ua9nMl9DvbQAPCe9c4FfCs0nov=w721-h349"></a></p><p><a href="https://draft.blogger.com/blog/post/edit/6280040346040914276/9124050194814696260?hl=zh-TW#"><img src="https://blogger.googleusercontent.com/img/a/AVvXsEj0PmRpwogxOdAAC38TA7jiyH4cIcHQmowD8YSHVMBT4ZKsnTXGvjzcExOR8NpUODB3K_D3mMQdV3of2bDlnH9q1orXb6AxbJgz5hXAhFJITGC9LtrN2SWlvVVAsLjuQGFKNKKX7TXdvzIR8_RkgZrn7aC73Qq5wWCzRMUnBD-lyAEHCdIWCSokv7Tf=w735-h356"></a></p><h2 id="程式的部份"><a href="#程式的部份" class="headerlink" title="程式的部份"></a>程式的部份</h2><pre class="line-numbers language-py" data-language="py"><code class="language-py"><span class="token keyword">from</span> machine <span class="token keyword">import</span> Pin<span class="token keyword">from</span> neopixel <span class="token keyword">import</span> NeoPixel<span class="token keyword">from</span> time <span class="token keyword">import</span> sleep<span class="token keyword">import</span> network<span class="token keyword">import</span> urequests <span class="token keyword">as</span> requests<span class="token keyword">import</span> ujson  <span class="token comment"># Wifi credentials</span>wifi_ssid <span class="token operator">=</span> <span class="token string">"C--"</span>wifi_password <span class="token operator">=</span> <span class="token string">"c----------"</span>  <span class="token comment"># Adafruit IO authentication</span>aio_key <span class="token operator">=</span> <span class="token string">"aio_iaRV12GqVjk*************"</span>username <span class="token operator">=</span> <span class="token string">"bl-----"</span>headers <span class="token operator">=</span> <span class="token punctuation">&#123;</span><span class="token string">'X-AIO-Key'</span><span class="token punctuation">:</span> aio_key<span class="token punctuation">,</span> <span class="token string">'Content-Type'</span><span class="token punctuation">:</span> <span class="token string">'application/json'</span><span class="token punctuation">&#125;</span>  <span class="token comment"># Don't forget the NeoPixels!</span>np <span class="token operator">=</span> NeoPixel<span class="token punctuation">(</span>Pin<span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">)</span>feed_names <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'red'</span><span class="token punctuation">,</span> <span class="token string">'green'</span><span class="token punctuation">,</span> <span class="token string">'blue'</span><span class="token punctuation">]</span>rgb_values <span class="token operator">=</span> <span class="token punctuation">&#123;</span><span class="token string">'red'</span><span class="token punctuation">:</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token string">'green'</span><span class="token punctuation">:</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token string">'blue'</span><span class="token punctuation">:</span> <span class="token number">0</span><span class="token punctuation">&#125;</span>  <span class="token comment"># Connect to Wifi</span><span class="token keyword">def</span> wifiConn<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>  wifi <span class="token operator">=</span> network<span class="token punctuation">.</span>WLAN<span class="token punctuation">(</span>network<span class="token punctuation">.</span>STA_IF<span class="token punctuation">)</span>  wifi<span class="token punctuation">.</span>active<span class="token punctuation">(</span><span class="token boolean">True</span><span class="token punctuation">)</span>  wifi<span class="token punctuation">.</span>connect<span class="token punctuation">(</span>wifi_ssid<span class="token punctuation">,</span> wifi_password<span class="token punctuation">)</span>  <span class="token keyword">while</span> wifi<span class="token punctuation">.</span>isconnected<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token boolean">False</span><span class="token punctuation">:</span>      <span class="token keyword">pass</span>  <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"Conn successful!"</span><span class="token punctuation">)</span><span class="token keyword">def</span> create_URL<span class="token punctuation">(</span>feedname<span class="token punctuation">)</span><span class="token punctuation">:</span>    url <span class="token operator">=</span> <span class="token string">"https://io.adafruit.com/api/v2/"</span> <span class="token operator">+</span> username <span class="token operator">+</span> <span class="token string">"feeds"</span> <span class="token operator">+</span> feedname <span class="token operator">+</span> <span class="token string">"data/last"</span>    <span class="token keyword">return</span> url  wifiConn<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token keyword">while</span> <span class="token boolean">True</span><span class="token punctuation">:</span>  <span class="token keyword">for</span> colors <span class="token keyword">in</span> feed_names<span class="token punctuation">:</span>    res <span class="token operator">=</span> requests<span class="token punctuation">.</span>get<span class="token punctuation">(</span>create_URL<span class="token punctuation">(</span>colors<span class="token punctuation">)</span><span class="token punctuation">,</span> headers<span class="token operator">=</span>headers<span class="token punctuation">)</span>    json <span class="token operator">=</span> ujson<span class="token punctuation">.</span>loads<span class="token punctuation">(</span>res<span class="token punctuation">.</span>text<span class="token punctuation">)</span>    rgb_values<span class="token punctuation">[</span>colors<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token builtin">int</span><span class="token punctuation">(</span>json<span class="token punctuation">[</span><span class="token string">'value'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>    <span class="token keyword">print</span><span class="token punctuation">(</span>rgb_values<span class="token punctuation">[</span>colors<span class="token punctuation">]</span><span class="token punctuation">)</span>    <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">8</span><span class="token punctuation">)</span><span class="token punctuation">:</span>      np<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">(</span>rgb_values<span class="token punctuation">[</span><span class="token string">'red'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> rgb_values<span class="token punctuation">[</span><span class="token string">'green'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> rgb_values<span class="token punctuation">[</span><span class="token string">'blue'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>      np<span class="token punctuation">.</span>write<span class="token punctuation">(</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><hr><p>**數組 feed_names 包含我們在 Adafruit IO 中創建的提要的名稱，字典 rgb_values 用於存儲從 Adafruit IO 下載的值。  </p><p>由於我們需要獲取三個提要的值，並且每個提要都有自己的 URL，因此我們創建了一個函數來生成所需的 URL。**</p><pre class="line-numbers language-py" data-language="py"><code class="language-py"><span class="token keyword">def</span> <span class="token function">create_URL</span><span class="token punctuation">(</span>feedname<span class="token punctuation">)</span><span class="token punctuation">:</span>    url <span class="token operator">=</span> <span class="token string">"https://io.adafruit.com/api/v2/"</span> <span class="token operator">+</span> username <span class="token operator">+</span>  <span class="token string">"feeds"</span> <span class="token operator">+</span> feedname <span class="token operator">+</span> <span class="token string">"data/last"</span>    <span class="token keyword">return</span> url<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p><strong>在主循環中，對於每個提要“紅色”、“綠色”和“藍色”，我們向 Adafruit IO 發送一個 HTTP GET 請求，其中包含由 create_URL 函數和標頭字典生成的 URL。</strong></p><pre class="line-numbers language-py" data-language="py"><code class="language-py">response <span class="token operator">=</span> requests<span class="token punctuation">.</span>get<span class="token punctuation">(</span>create_URL<span class="token punctuation">(</span>color<span class="token punctuation">)</span><span class="token punctuation">,</span> headers<span class="token operator">=</span>headers<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p><strong>然後，我們使用 ujson 庫中的加載函數將從 Adafruit IO 接收到的 JSON 文本轉換為 Python 字典。這種轉換稱為解析。</strong></p><pre class="line-numbers language-py" data-language="py"><code class="language-py">parsed <span class="token operator">=</span> ujson<span class="token punctuation">.</span>loads<span class="token punctuation">(</span>response<span class="token punctuation">.</span>text<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p><strong>從解析的 Python 字典中，我們得到提要的最新值（它是一個字符串）並將其轉換為整數。</strong></p><pre class="line-numbers language-py" data-language="py"><code class="language-py">value <span class="token operator">=</span> <span class="token builtin">int</span><span class="token punctuation">(</span>parsed<span class="token punctuation">[</span><span class="token string">'value'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p><strong>將所有 RGB 值保存到字典 rgb_values 後，我們可以相應地設置 NeoPixels 的顏色。</strong></p><div class="video-container"><iframe src="https://www.youtube.com/embed/C0Zg5kyytOs" frameborder="0" loading="lazy" allowfullscreen></iframe></div><p><strong><em>參考</em></strong></p><p><a href="https://draft.blogger.com/blog/post/edit/6280040346040914276/9124050194814696260?hl=zh-TW#">https://gpiocc.github.io/learn/micropython/esp/2020/05/30/martin-ku-control-neopixels-over-the-internet-with-esp32-and-micropython.html</a></p><p>example-<a href="https://draft.blogger.com/blog/post/edit/6280040346040914276/9124050194814696260?hl=zh-TW#">https://github.com/martin-ku-hku/control-neopixels-over-the-internet-with-esp32-and-micropython/blob/master/neopixel_on_off.py</a></p>]]></content>
      
      
      <categories>
          
          <category> micropython </category>
          
          <category> esp32 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> AdafriutIO </tag>
            
            <tag> Neopixel </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>WS2812B燈條實作-miropython</title>
      <link href="/2021/08/31/ws2812b-deng-tiao-shi-zuo-miropython/"/>
      <url>/2021/08/31/ws2812b-deng-tiao-shi-zuo-miropython/</url>
      
        <content type="html"><![CDATA[<h1 id="WS2812B燈條實作-miropython"><a href="#WS2812B燈條實作-miropython" class="headerlink" title="WS2812B燈條實作-miropython"></a>WS2812B燈條實作-miropython</h1><p>在miropython有一個內建的RGB燈條的程式庫，可以很方便的拿來運用<br>但我發現我灌最近新的mpython系統時，沒有支援了，不過沒關係，可以找一下這個庫把它手動上傳到板子上。</p><p><a href="https://draft.blogger.com/blog/post/edit/6280040346040914276/322977569325795009?hl=zh-TW#"><img src="https://lh3.googleusercontent.com/-Us7c722XoqM/YRXSivbTxcI/AAAAAAAAey8/h3Lamsa2HT0RB2NZUNh0pajwCl2NkzCCACNcBGAsYHQ/s1600/1628820075297015-0.png"></a></p><h2 id="neopixel-py程式庫在此下載-neopixel-py"><a href="#neopixel-py程式庫在此下載-neopixel-py" class="headerlink" title="neopixel.py程式庫在此下載-neopixel.py"></a>neopixel.py程式庫在此下載-<a href="https://draft.blogger.com/blog/post/edit/6280040346040914276/322977569325795009?hl=zh-TW#">neopixel.py</a></h2><p>並上傳到板子後</p><p>將 RGB LED 燈條連接到 ESP32 或 ESP8266 非常簡單。您需要將 5V 施加到 VCC 引腳，GND 到 GND，並將 GPIO 5連接到 IN（數據）引腳。我們將數據引腳連接到 GPIO 5。</p><p><a href="https://draft.blogger.com/blog/post/edit/6280040346040914276/322977569325795009?hl=zh-TW#"><img src="https://lh3.googleusercontent.com/-fUXQhZg0HFw/YRXRFihwvBI/AAAAAAAAey0/RH-qjp4k5YIGzTRQ_XXrT2rthb8xEnkLgCNcBGAsYHQ/w503-h378/image.png"></a></p><pre class="line-numbers language-py" data-language="py"><code class="language-py"><span class="token keyword">from</span> machine <span class="token keyword">import</span> Pin<span class="token punctuation">,</span> sleep<span class="token keyword">import</span> neopixel<span class="token keyword">import</span> timen <span class="token operator">=</span> <span class="token number">8</span> <span class="token comment">#燈條數</span>p <span class="token operator">=</span> <span class="token number">5</span> <span class="token comment">#GPIO</span>  np <span class="token operator">=</span> neopixel<span class="token punctuation">.</span>NeoPixel<span class="token punctuation">(</span>Pin<span class="token punctuation">(</span>p<span class="token punctuation">)</span><span class="token punctuation">,</span> n<span class="token punctuation">)</span><span class="token keyword">while</span> <span class="token boolean">True</span><span class="token punctuation">:</span>  <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>n<span class="token punctuation">)</span><span class="token punctuation">:</span>    np<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">,</span> <span class="token number">45</span><span class="token punctuation">,</span> <span class="token number">230</span><span class="token punctuation">)</span>    time<span class="token punctuation">.</span>sleep_ms<span class="token punctuation">(</span><span class="token number">30</span><span class="token punctuation">)</span>    np<span class="token punctuation">.</span>write<span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token keyword">for</span> j <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>n<span class="token punctuation">)</span><span class="token punctuation">:</span>    np<span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span><span class="token number">130</span><span class="token punctuation">,</span><span class="token number">50</span><span class="token punctuation">)</span>    time<span class="token punctuation">.</span>sleep_ms<span class="token punctuation">(</span><span class="token number">60</span><span class="token punctuation">)</span>    np<span class="token punctuation">.</span>write<span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token keyword">for</span> x <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>n<span class="token punctuation">)</span><span class="token punctuation">:</span>      np<span class="token punctuation">[</span>x<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token number">255</span><span class="token punctuation">,</span> <span class="token number">200</span><span class="token punctuation">,</span> <span class="token number">50</span><span class="token punctuation">)</span>      time<span class="token punctuation">.</span>sleep_ms<span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span>      np<span class="token punctuation">.</span>write<span class="token punctuation">(</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>]]></content>
      
      
      <categories>
          
          <category> micropython </category>
          
          <category> esp32 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> WS2812B </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>MQTT-Node-RED顯示超音波測距數據+控制LED-micropython</title>
      <link href="/2021/08/31/mqtt-node-red-xian-shi-chao-yin-bo-ce-ju-shu-ju-kong-zhi-led-micropython/"/>
      <url>/2021/08/31/mqtt-node-red-xian-shi-chao-yin-bo-ce-ju-shu-ju-kong-zhi-led-micropython/</url>
      
        <content type="html"><![CDATA[<h2 id="MQTT-Node-RED顯示超音波測距數據-控制LED-mpython"><a href="#MQTT-Node-RED顯示超音波測距數據-控制LED-mpython" class="headerlink" title="MQTT-Node-RED顯示超音波測距數據+控制LED-mpython"></a>MQTT-Node-RED顯示超音波測距數據+控制LED-mpython</h2><p><a href="https://draft.blogger.com/blog/post/edit/6280040346040914276/737350702666477851?hl=zh-TW#"><img src="https://1.bp.blogspot.com/-jBbqvNqoP68/YQ3-rDZ6tgI/AAAAAAAAeuE/9Cuxom8DbF0mmuBtbd83q_qh8ykGt98GwCNcBGAsYHQ/w282-h320/2.jpg"></a></p><hr><p>超音波測距(SC-SR04)實驗回顧-<a href="https://draft.blogger.com/blog/post/edit/6280040346040914276/737350702666477851?hl=zh-TW#">點我回顧</a></p><p>樹莓派上裝MQTT和Nord-RED回顧<a href="https://draft.blogger.com/blog/post/edit/6280040346040914276/737350702666477851?hl=zh-TW#">-點我回顧</a></p><hr><p>上述兩個都測試好之後就進入主程式部份</p><h2 id="程式"><a href="#程式" class="headerlink" title="程式"></a>程式</h2><pre class="line-numbers language-py" data-language="py"><code class="language-py"><span class="token keyword">from</span> time <span class="token keyword">import</span> sleep<span class="token keyword">from</span> machine <span class="token keyword">import</span> Pin<span class="token punctuation">,</span> ADC<span class="token punctuation">,</span> reset<span class="token keyword">from</span> umqtttsimple <span class="token keyword">import</span> MQTTClient<span class="token keyword">import</span> binascii<span class="token punctuation">,</span> micropython<span class="token punctuation">,</span> network<span class="token punctuation">,</span> time<span class="token punctuation">,</span> socket<span class="token punctuation">,</span> machinessid <span class="token operator">=</span> <span class="token string">"---"</span>password <span class="token operator">=</span> <span class="token string">"---------"</span>mqtt_server <span class="token operator">=</span> <span class="token string">"192.168.--.--"</span><span class="token comment">#將客戶端ID轉換為16進位,以便MQTT伺服端讀取</span>client_id <span class="token operator">=</span> binascii<span class="token punctuation">.</span>hexlify<span class="token punctuation">(</span>machine<span class="token punctuation">.</span>unique_id<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token comment">#和Nord-RED上的主題一致</span>client_adc <span class="token operator">=</span> <span class="token string">b'esp32/value'</span>client_led <span class="token operator">=</span> <span class="token string">b'esp32/output'</span>  led <span class="token operator">=</span> Pin<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> Pin<span class="token punctuation">.</span>OUT<span class="token punctuation">)</span>lastTime <span class="token operator">=</span> <span class="token number">0</span>currentTime <span class="token operator">=</span> time<span class="token punctuation">.</span>time<span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token comment">#wifi連線</span><span class="token keyword">def</span> connectWifi<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">global</span> ssid<span class="token punctuation">,</span> password    wifi <span class="token operator">=</span> network<span class="token punctuation">.</span>WLAN<span class="token punctuation">(</span>network<span class="token punctuation">.</span>STA_IF<span class="token punctuation">)</span>    wifi<span class="token punctuation">.</span>active<span class="token punctuation">(</span><span class="token boolean">True</span><span class="token punctuation">)</span>    wifi<span class="token punctuation">.</span>connect<span class="token punctuation">(</span>ssid<span class="token punctuation">,</span> password<span class="token punctuation">)</span>    <span class="token keyword">while</span> wifi<span class="token punctuation">.</span>isconnected<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token boolean">False</span><span class="token punctuation">:</span>            <span class="token keyword">pass</span>    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"Connected successful!"</span><span class="token punctuation">)</span>    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"IP: &#123;&#125;"</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>wifi<span class="token punctuation">.</span>ifconfig<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token comment">#樹莓派上的mqtt回應訂閱</span><span class="token keyword">def</span> sub_backCall<span class="token punctuation">(</span>topic<span class="token punctuation">,</span> msg<span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">global</span> led    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token punctuation">(</span>topic<span class="token punctuation">,</span> msg<span class="token punctuation">)</span><span class="token punctuation">)</span>    <span class="token keyword">if</span> msg <span class="token operator">==</span> <span class="token string">b"on"</span><span class="token punctuation">:</span>        led<span class="token punctuation">.</span>on<span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token keyword">elif</span> msg <span class="token operator">==</span> <span class="token string">b'off'</span><span class="token punctuation">:</span>        led<span class="token punctuation">.</span>off<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token comment">#連線MQTT,連線成功後訂閱主題</span><span class="token keyword">def</span> connToMqtt<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">try</span><span class="token punctuation">:</span>        client <span class="token operator">=</span> MQTTClient<span class="token punctuation">(</span>client_id<span class="token punctuation">,</span> mqtt_server<span class="token punctuation">)</span>        client<span class="token punctuation">.</span>set_callback<span class="token punctuation">(</span>sub_backCall<span class="token punctuation">)</span>        client<span class="token punctuation">.</span>connect<span class="token punctuation">(</span><span class="token punctuation">)</span>        client<span class="token punctuation">.</span>subscribe<span class="token punctuation">(</span>client_led<span class="token punctuation">)</span>        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"connect to %s"</span><span class="token operator">%</span>mqtt_server<span class="token punctuation">)</span>        <span class="token keyword">return</span> client    <span class="token comment">#如果無法連線重新連線</span>    <span class="token keyword">except</span> OSError <span class="token keyword">as</span> e<span class="token punctuation">:</span>        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"not to connected for MQTT server!"</span><span class="token punctuation">)</span>        machine<span class="token punctuation">.</span>reset<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token comment">#讀取ADC數值</span><span class="token keyword">def</span> readVal<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    adc <span class="token operator">=</span> ADC<span class="token punctuation">(</span>Pin<span class="token punctuation">(</span><span class="token number">36</span><span class="token punctuation">)</span><span class="token punctuation">)</span>    adc<span class="token punctuation">.</span>atten<span class="token punctuation">(</span>ADC<span class="token punctuation">.</span>ATTN_11DB<span class="token punctuation">)</span>    ADC<span class="token punctuation">.</span>width<span class="token punctuation">(</span>ADC<span class="token punctuation">.</span>WIDTH_10BIT<span class="token punctuation">)</span>    <span class="token keyword">while</span> <span class="token boolean">True</span><span class="token punctuation">:</span>        val <span class="token operator">=</span>adc<span class="token punctuation">.</span>read<span class="token punctuation">(</span><span class="token punctuation">)</span>        <span class="token keyword">return</span> valconnectWifi<span class="token punctuation">(</span><span class="token punctuation">)</span>client <span class="token operator">=</span> connToMqtt<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token keyword">while</span> <span class="token boolean">True</span><span class="token punctuation">:</span>    <span class="token comment">#檢查有無進來的訊息</span>    client<span class="token punctuation">.</span>check_msg<span class="token punctuation">(</span><span class="token punctuation">)</span>    value <span class="token operator">=</span> readVal<span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'val = &#123;&#125;'</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span><span class="token punctuation">)</span>    <span class="token comment">#發送可調電阻值到MQTT</span>    client<span class="token punctuation">.</span>publish<span class="token punctuation">(</span>client_adc<span class="token punctuation">,</span> <span class="token builtin">str</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span><span class="token punctuation">)</span>    sleep<span class="token punctuation">(</span><span class="token number">0.05</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><hr><h2 id="Nord-RED布署"><a href="#Nord-RED布署" class="headerlink" title="Nord-RED布署"></a>Nord-RED布署</h2><p>紫色區塊的主題要和程式一致</p><pre class="line-numbers language-py" data-language="py"><code class="language-py">client_adc <span class="token operator">=</span> <span class="token string">b'esp32/value'</span>client_led <span class="token operator">=</span> <span class="token string">b'esp32/output'</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p><a href="https://draft.blogger.com/blog/post/edit/6280040346040914276/737350702666477851?hl=zh-TW#"><img src="https://1.bp.blogspot.com/-UjNJIpcEfoQ/YQ4d5YMNiGI/AAAAAAAAeuM/eymlbVArKiUocFLOe4-azPYExKe4Lw6EwCNcBGAsYHQ/w787-h394/12.jpg"></a></p><p><a href="https://draft.blogger.com/blog/post/edit/6280040346040914276/737350702666477851?hl=zh-TW#"><img src="https://1.bp.blogspot.com/-OqrVh3vHd_g/YQ4e3FAOw8I/AAAAAAAAeuU/qYfEIm7BhegO4SJzdJm7vF5yxX07zbLcACNcBGAsYHQ/w722-h361/11.jpg"></a></p><p>開關Payload要和程式接收到的msg一致</p><p>#樹莓派上的mqtt回應訂閱</p><pre class="line-numbers language-py" data-language="py"><code class="language-py"><span class="token keyword">def</span> sub_backCall<span class="token punctuation">(</span>topic<span class="token punctuation">,</span> msg<span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">global</span> led    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token punctuation">(</span>topic<span class="token punctuation">,</span> msg<span class="token punctuation">)</span><span class="token punctuation">)</span>    <span class="token keyword">if</span> msg <span class="token operator">==</span> <span class="token string">b"on"</span><span class="token punctuation">:</span>        led<span class="token punctuation">.</span>on<span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token keyword">elif</span> msg <span class="token operator">==</span> <span class="token string">b'off'</span><span class="token punctuation">:</span> led<span class="token punctuation">.</span>off<span class="token punctuation">(</span><span class="token punctuation">)</span> <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><a href="https://draft.blogger.com/blog/post/edit/6280040346040914276/737350702666477851?hl=zh-TW#"><img src="https://1.bp.blogspot.com/-GVF0J3-IZjM/YQ4ftmGvlxI/AAAAAAAAeuk/RnerKZrrD348hK5tn-J2zykWTVhv1WLWgCNcBGAsYHQ/w788-h394/13.jpg"></a></p><hr><p><a href="https://draft.blogger.com/blog/post/edit/6280040346040914276/737350702666477851?hl=zh-TW#"><img src="https://1.bp.blogspot.com/-cN8ezhaa6NQ/YQ4gHA57I5I/AAAAAAAAeus/NVh-r4x2VhMFcoUlEP35jIxhxWlcV4dmgCNcBGAsYHQ/w822-h393/1.jpg"></a></p>]]></content>
      
      
      <categories>
          
          <category> micropython </category>
          
          <category> esp32 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> led </tag>
            
            <tag> hc-sr04 </tag>
            
            <tag> mqtt </tag>
            
            <tag> node-red </tag>
            
            <tag> 超音波模組 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>DC直流馬達測試-micropython</title>
      <link href="/2021/08/31/dc-zhi-liu-ma-da-ce-shi-micropython/"/>
      <url>/2021/08/31/dc-zhi-liu-ma-da-ce-shi-micropython/</url>
      
        <content type="html"><![CDATA[<h1 id="ESP32-DC直流馬達測試"><a href="#ESP32-DC直流馬達測試" class="headerlink" title="ESP32-DC直流馬達測試"></a>ESP32-DC直流馬達測試</h1><h6 id="tags-micropython-dc-moto"><a href="#tags-micropython-dc-moto" class="headerlink" title="tags: micropython dc_moto"></a>tags: <code>micropython</code> <code>dc_moto</code></h6><p><strong>直流馬達是微控板常常在用的元件，最常搭配的是L298N</strong></p><p><strong>驅動裝置，因為如果把馬達直接接上微控板會導致燒掉</strong></p><p>======================================================================</p><h2 id="L298N驅動板"><a href="#L298N驅動板" class="headerlink" title="L298N驅動板"></a>L298N驅動板</h2><p>OUT1：直流電機A+端子<br>OUT2：直流電機 A – 端子<br>OUT3：直流電機B+端子<br>OUT4：直流電機 B – 端子</p><p>這裡要特別注意的地方</p><p>在底部，您有一個帶有 +12V、GND 和 +5V 的三接線端子。 </p><p>一般用18650電池二~三顆供電的話接+12V和GND，如果要</p><p>額外接微控板例如esp32或arduino，在+5V和GND就是往外</p><p>供電給微控板的5V。</p><p>注意：如果供電超過12V，需要去掉跳線，給+5V端供電5V。</p><p>使能(Enble)引腳  </p><p>如果您向使能 A 引腳發送 HIGH 信號，則電機 A 已準備好以最大速度進行控制；<br>如果向使能 A 引腳發送 LOW 信號，則電機 A 關閉；<br>如果發送PWM信號，則可以控制電機的速度。電機速度與占空比成正比。但是，</p><p>請注意，<strong>對於小占空比，電機可能不會旋轉</strong>，並發出持續的嗡嗡聲。</p><p><a href="https://draft.blogger.com/blog/post/edit/6280040346040914276/4739341746141337289?hl=zh-TW#"><img src="https://1.bp.blogspot.com/-P-j3FW8Xbpw/YQdexXM61HI/AAAAAAAAemw/Eg9w-rqfbS8KUP7etV1xL1O6CC0g457VwCNcBGAsYHQ/w541-h475/L298N-label.jpg"></a></p><hr><h2 id="接線"><a href="#接線" class="headerlink" title="接線"></a>接線</h2><p><strong>＊記得L298N的GND要拉一條到ESP32的GND，否則馬達不會動作</strong></p><p><a href="https://draft.blogger.com/blog/post/edit/6280040346040914276/4739341746141337289?hl=zh-TW#"><img src="https://1.bp.blogspot.com/-emtD7l8K7IE/YQdpsc_-zqI/AAAAAAAAem8/bIDZQ1CeGIUjmlgIgJlSfQI3DE1emAINQCNcBGAsYHQ/w534-h701/ESP32_1_DC_Motor_bb.png"></a></p><hr><h2 id="程式"><a href="#程式" class="headerlink" title="程式"></a>程式</h2><pre class="line-numbers language-py" data-language="py"><code class="language-py">from machine import Pin, PWM, freqfrom time import sleep  class L298N():    def __init__(self):        self.in1 &#x3D; Pin(26, Pin.OUT)        self.in2 &#x3D; Pin(27, Pin.OUT)        self.enble &#x3D; PWM(Pin(14), freq &#x3D; 5000)    def forward(self,speed):        self.speed(speed)        self.in1.on()        self.in2.off()        print(&quot;forward&quot;)    def back(self, speed):        self.speed(speed)        self.in1.off()        self.in2.on()        print(&quot;back&quot;)    def stop(self):        self.in1.off()        self.in2.off()        print(&quot;stop&quot;)    def speed(self,speed):        self.enble.duty(speed)if __name__ &#x3D;&#x3D; &quot;__main__&quot;:    l298n &#x3D; L298N()    l298n.forward(800)    sleep(3)    l298n.back(600)    sleep(3)    l298n.stop()<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><hr>]]></content>
      
      
      <categories>
          
          <category> micropython </category>
          
          <category> esp32 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> dc_moto </tag>
            
            <tag> 直流馬達 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>MQTT+Publish+Node-RED+BMP280-micropython</title>
      <link href="/2021/08/31/mqtt-publish-node-red-bmp280-micropython/"/>
      <url>/2021/08/31/mqtt-publish-node-red-bmp280-micropython/</url>
      
        <content type="html"><![CDATA[<h1 id="MQTT-Publish-Node-RED-BMP280"><a href="#MQTT-Publish-Node-RED-BMP280" class="headerlink" title="MQTT Publish + Node-RED + BMP280"></a>MQTT Publish + Node-RED + BMP280</h1><h6 id="tags-micropython-node-red-bmp280-mqtt"><a href="#tags-micropython-node-red-bmp280-mqtt" class="headerlink" title="tags: micropython node-red bmp280 mqtt"></a>tags: <code>micropython</code> <code>node-red</code> <code>bmp280</code> <code>mqtt</code></h6><p>參考文獻-<a href="https://draft.blogger.com/blog/post/edit/6280040346040914276/3007345750551778636#">https://randomnerdtutorials.com/micropython-mqtt-publish-bme280-esp32-esp8266/</a></p><p><a href="https://draft.blogger.com/blog/post/edit/6280040346040914276/3007345750551778636#"><img src="https://lh3.googleusercontent.com/-StQSf00mTdE/YQSTDWUtKTI/AAAAAAAAelU/mlW0TXVWxsYcf_RxakpnuT_LbaXrYk3TACNcBGAsYHQ/w567-h443/image.png"></a></p><p>這次實作是使用MQTT發送BMP280的數據到樹莓派上的Node-RED儀錶版上</p><p>我是參考這篇文章-<a href="https://draft.blogger.com/blog/post/edit/6280040346040914276/3007345750551778636#">https://randomnerdtutorials.com/esp32-mqtt-publish-subscribe-arduino-ide/</a></p><p>所以會使用類似的程式碼手法來完成項目。<br>開始之前先備妥樹莓派上所須的軟硬體</p><hr><h2 id="安裝順序"><a href="#安裝順序" class="headerlink" title="安裝順序"></a>安裝順序</h2><ol><li><p><strong><em>安裝<a href="https://draft.blogger.com/blog/post/edit/6280040346040914276/3007345750551778636#">Mosquitto broker</a>(如果沒玩過樹莓派,請連結<a href="https://draft.blogger.com/blog/post/edit/6280040346040914276/3007345750551778636#">這裡</a>安裝樹莓派系統</em></strong></p></li><li><p> <strong><em><a href="https://draft.blogger.com/blog/post/edit/6280040346040914276/3007345750551778636#">如何使用SSH和VNC鏡像</a></em></strong></p></li><li><p> <strong><em>安裝 <a href="https://draft.blogger.com/blog/post/edit/6280040346040914276/3007345750551778636#">Node-RED installed</a>  和 <a href="https://draft.blogger.com/blog/post/edit/6280040346040914276/3007345750551778636#">Node-RED Dashboard</a>在樹莓派上。</em></strong></p></li><li><p> <strong>_備註:安裝Node-RED時若出現錯誤訊息改用下面所附下載 _****<em>bash &lt;(curl -sL <a href="https://raw.githubusercontent.com/node-red/linux-installers/master/deb/update-nodejs-and-nodered">https://raw.githubusercontent.com/node-red/linux-installers/master/deb/update-nodejs-and-nodered</a>)</em></strong></p></li><li><p><strong><em>接下來先測試BMP280是否可正常測溫度和壓力-請參考之前的紀錄(<a href="https://draft.blogger.com/blog/post/edit/6280040346040914276/3007345750551778636#">點我傳送</a>)。</em></strong></p></li></ol><p>先來看一下整個發送原理比較容易理解自己要學的重點在哪裡</p><p>此次實驗我只寫從ESP32發送數據到樹莓派的Mosquitto代理接收/發送</p><p>然後通過MQTT通信協議去控制ESP32發送數據到Node-RED,其實我覺</p><p>得和ThingSpeak很類似,只是使用Node-RED更能客製化。</p><p>看一下這張圖(此次我所做的實驗是下圖的下方那個ESP32發送的部份)</p><p><a href="https://draft.blogger.com/blog/post/edit/6280040346040914276/3007345750551778636#"><img src="https://lh3.googleusercontent.com/-dbEK49_w9_A/YQP1Mii2utI/AAAAAAAAelI/zvaBPu6JqXIcyeXVPyqIHhOt6CVSYkCrgCNcBGAsYHQ/w642-h341/image.png"></a></p><hr><p>知道原理後就是開始進入寫程式的主軸</p><p>首先要有網路可以連到數莓派和ESP32，然後判斷是否已經連線</p><p>如果連不上就再自動重連，連上後印出IP，連上網路後，就是</p><p>要去和樹莓派的Mosquitto Broker連線，一樣就是判斷是否成功</p><p>連線做出對應的動作。WiFi和Mosquitto Broker都連線之後，就開</p><p>始從ESP32客戶端發送溫度和壓力的數據到Node-RED的介面上。</p><hr><h2 id="umqtttsimple-py上傳到ESP32"><a href="#umqtttsimple-py上傳到ESP32" class="headerlink" title="umqtttsimple.py上傳到ESP32"></a>umqtttsimple.py上傳到ESP32</h2><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">try</span><span class="token punctuation">:</span>    <span class="token keyword">import</span> usocket <span class="token keyword">as</span> socket<span class="token keyword">except</span><span class="token punctuation">:</span>    <span class="token keyword">import</span> socket<span class="token keyword">import</span> ustruct <span class="token keyword">as</span> struct<span class="token keyword">from</span> ubinascii <span class="token keyword">import</span> hexlify<span class="token keyword">class</span> <span class="token class-name">MQTTException</span><span class="token punctuation">(</span>Exception<span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">pass</span><span class="token keyword">class</span> <span class="token class-name">MQTTClient</span><span class="token punctuation">:</span>    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> client_id<span class="token punctuation">,</span> server<span class="token punctuation">,</span> port<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">,</span> user<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">,</span> password<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">,</span> keepalive<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">,</span>                 ssl<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">,</span> ssl_params<span class="token operator">=</span><span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">:</span>        <span class="token keyword">if</span> port <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">:</span>            port <span class="token operator">=</span> <span class="token number">8883</span> <span class="token keyword">if</span> ssl <span class="token keyword">else</span> <span class="token number">1883</span>        self<span class="token punctuation">.</span>client_id <span class="token operator">=</span> client_id        self<span class="token punctuation">.</span>sock <span class="token operator">=</span> <span class="token boolean">None</span>        self<span class="token punctuation">.</span>server <span class="token operator">=</span> server        self<span class="token punctuation">.</span>port <span class="token operator">=</span> port        self<span class="token punctuation">.</span>ssl <span class="token operator">=</span> ssl        self<span class="token punctuation">.</span>ssl_params <span class="token operator">=</span> ssl_params        self<span class="token punctuation">.</span>pid <span class="token operator">=</span> <span class="token number">0</span>        self<span class="token punctuation">.</span>cb <span class="token operator">=</span> <span class="token boolean">None</span>        self<span class="token punctuation">.</span>user <span class="token operator">=</span> user        self<span class="token punctuation">.</span>pswd <span class="token operator">=</span> password        self<span class="token punctuation">.</span>keepalive <span class="token operator">=</span> keepalive        self<span class="token punctuation">.</span>lw_topic <span class="token operator">=</span> <span class="token boolean">None</span>        self<span class="token punctuation">.</span>lw_msg <span class="token operator">=</span> <span class="token boolean">None</span>        self<span class="token punctuation">.</span>lw_qos <span class="token operator">=</span> <span class="token number">0</span>        self<span class="token punctuation">.</span>lw_retain <span class="token operator">=</span> <span class="token boolean">False</span>    <span class="token keyword">def</span> <span class="token function">_send_str</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> s<span class="token punctuation">)</span><span class="token punctuation">:</span>        self<span class="token punctuation">.</span>sock<span class="token punctuation">.</span>write<span class="token punctuation">(</span>struct<span class="token punctuation">.</span>pack<span class="token punctuation">(</span><span class="token string">"!H"</span><span class="token punctuation">,</span> <span class="token builtin">len</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>        self<span class="token punctuation">.</span>sock<span class="token punctuation">.</span>write<span class="token punctuation">(</span>s<span class="token punctuation">)</span>    <span class="token keyword">def</span> <span class="token function">_recv_len</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>        n <span class="token operator">=</span> <span class="token number">0</span>        sh <span class="token operator">=</span> <span class="token number">0</span>        <span class="token keyword">while</span> <span class="token number">1</span><span class="token punctuation">:</span>            b <span class="token operator">=</span> self<span class="token punctuation">.</span>sock<span class="token punctuation">.</span>read<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>            n <span class="token operator">|</span><span class="token operator">=</span> <span class="token punctuation">(</span>b <span class="token operator">&amp;</span> <span class="token number">0x7f</span><span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> sh            <span class="token keyword">if</span> <span class="token keyword">not</span> b <span class="token operator">&amp;</span> <span class="token number">0x80</span><span class="token punctuation">:</span>                <span class="token keyword">return</span> n            sh <span class="token operator">+=</span> <span class="token number">7</span>    <span class="token keyword">def</span> <span class="token function">set_callback</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> f<span class="token punctuation">)</span><span class="token punctuation">:</span>        self<span class="token punctuation">.</span>cb <span class="token operator">=</span> f    <span class="token keyword">def</span> <span class="token function">set_last_will</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> topic<span class="token punctuation">,</span> msg<span class="token punctuation">,</span> retain<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">,</span> qos<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">:</span>        <span class="token keyword">assert</span> <span class="token number">0</span> <span class="token operator">&lt;=</span> qos <span class="token operator">&lt;=</span> <span class="token number">2</span>        <span class="token keyword">assert</span> topic        self<span class="token punctuation">.</span>lw_topic <span class="token operator">=</span> topic        self<span class="token punctuation">.</span>lw_msg <span class="token operator">=</span> msg        self<span class="token punctuation">.</span>lw_qos <span class="token operator">=</span> qos        self<span class="token punctuation">.</span>lw_retain <span class="token operator">=</span> retain    <span class="token keyword">def</span> <span class="token function">connect</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> clean_session<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span><span class="token punctuation">:</span>        self<span class="token punctuation">.</span>sock <span class="token operator">=</span> socket<span class="token punctuation">.</span>socket<span class="token punctuation">(</span><span class="token punctuation">)</span>        addr <span class="token operator">=</span> socket<span class="token punctuation">.</span>getaddrinfo<span class="token punctuation">(</span>self<span class="token punctuation">.</span>server<span class="token punctuation">,</span> self<span class="token punctuation">.</span>port<span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span>        self<span class="token punctuation">.</span>sock<span class="token punctuation">.</span>connect<span class="token punctuation">(</span>addr<span class="token punctuation">)</span>        <span class="token keyword">if</span> self<span class="token punctuation">.</span>ssl<span class="token punctuation">:</span>            <span class="token keyword">import</span> ussl            self<span class="token punctuation">.</span>sock <span class="token operator">=</span> ussl<span class="token punctuation">.</span>wrap_socket<span class="token punctuation">(</span>self<span class="token punctuation">.</span>sock<span class="token punctuation">,</span> <span class="token operator">**</span>self<span class="token punctuation">.</span>ssl_params<span class="token punctuation">)</span>        premsg <span class="token operator">=</span> <span class="token builtin">bytearray</span><span class="token punctuation">(</span><span class="token string">b"\x10\0\0\0\0\0"</span><span class="token punctuation">)</span>        msg <span class="token operator">=</span> <span class="token builtin">bytearray</span><span class="token punctuation">(</span><span class="token string">b"\x04MQTT\x04\x02\0\0"</span><span class="token punctuation">)</span>        sz <span class="token operator">=</span> <span class="token number">10</span> <span class="token operator">+</span> <span class="token number">2</span> <span class="token operator">+</span> <span class="token builtin">len</span><span class="token punctuation">(</span>self<span class="token punctuation">.</span>client_id<span class="token punctuation">)</span>        msg<span class="token punctuation">[</span><span class="token number">6</span><span class="token punctuation">]</span> <span class="token operator">=</span> clean_session <span class="token operator">&lt;&lt;</span> <span class="token number">1</span>        <span class="token keyword">if</span> self<span class="token punctuation">.</span>user <span class="token keyword">is</span> <span class="token keyword">not</span> <span class="token boolean">None</span><span class="token punctuation">:</span>            sz <span class="token operator">+=</span> <span class="token number">2</span> <span class="token operator">+</span> <span class="token builtin">len</span><span class="token punctuation">(</span>self<span class="token punctuation">.</span>user<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">2</span> <span class="token operator">+</span> <span class="token builtin">len</span><span class="token punctuation">(</span>self<span class="token punctuation">.</span>pswd<span class="token punctuation">)</span>            msg<span class="token punctuation">[</span><span class="token number">6</span><span class="token punctuation">]</span> <span class="token operator">|</span><span class="token operator">=</span> <span class="token number">0xC0</span>        <span class="token keyword">if</span> self<span class="token punctuation">.</span>keepalive<span class="token punctuation">:</span>            <span class="token keyword">assert</span> self<span class="token punctuation">.</span>keepalive <span class="token operator">&lt;</span> <span class="token number">65536</span>            msg<span class="token punctuation">[</span><span class="token number">7</span><span class="token punctuation">]</span> <span class="token operator">|</span><span class="token operator">=</span> self<span class="token punctuation">.</span>keepalive <span class="token operator">>></span> <span class="token number">8</span>            msg<span class="token punctuation">[</span><span class="token number">8</span><span class="token punctuation">]</span> <span class="token operator">|</span><span class="token operator">=</span> self<span class="token punctuation">.</span>keepalive <span class="token operator">&amp;</span> <span class="token number">0x00FF</span>        <span class="token keyword">if</span> self<span class="token punctuation">.</span>lw_topic<span class="token punctuation">:</span>            sz <span class="token operator">+=</span> <span class="token number">2</span> <span class="token operator">+</span> <span class="token builtin">len</span><span class="token punctuation">(</span>self<span class="token punctuation">.</span>lw_topic<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">2</span> <span class="token operator">+</span> <span class="token builtin">len</span><span class="token punctuation">(</span>self<span class="token punctuation">.</span>lw_msg<span class="token punctuation">)</span>            msg<span class="token punctuation">[</span><span class="token number">6</span><span class="token punctuation">]</span> <span class="token operator">|</span><span class="token operator">=</span> <span class="token number">0x4</span> <span class="token operator">|</span> <span class="token punctuation">(</span>self<span class="token punctuation">.</span>lw_qos <span class="token operator">&amp;</span> <span class="token number">0x1</span><span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> <span class="token number">3</span> <span class="token operator">|</span> <span class="token punctuation">(</span>self<span class="token punctuation">.</span>lw_qos <span class="token operator">&amp;</span> <span class="token number">0x2</span><span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> <span class="token number">3</span>            msg<span class="token punctuation">[</span><span class="token number">6</span><span class="token punctuation">]</span> <span class="token operator">|</span><span class="token operator">=</span> self<span class="token punctuation">.</span>lw_retain <span class="token operator">&lt;&lt;</span> <span class="token number">5</span>        i <span class="token operator">=</span> <span class="token number">1</span>        <span class="token keyword">while</span> sz <span class="token operator">></span> <span class="token number">0x7f</span><span class="token punctuation">:</span>            premsg<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">(</span>sz <span class="token operator">&amp;</span> <span class="token number">0x7f</span><span class="token punctuation">)</span> <span class="token operator">|</span> <span class="token number">0x80</span>            sz <span class="token operator">>></span><span class="token operator">=</span> <span class="token number">7</span>            i <span class="token operator">+=</span> <span class="token number">1</span>        premsg<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> sz        self<span class="token punctuation">.</span>sock<span class="token punctuation">.</span>write<span class="token punctuation">(</span>premsg<span class="token punctuation">,</span> i <span class="token operator">+</span> <span class="token number">2</span><span class="token punctuation">)</span>        self<span class="token punctuation">.</span>sock<span class="token punctuation">.</span>write<span class="token punctuation">(</span>msg<span class="token punctuation">)</span>        <span class="token comment">#print(hex(len(msg)), hexlify(msg, ":"))</span>        self<span class="token punctuation">.</span>_send_str<span class="token punctuation">(</span>self<span class="token punctuation">.</span>client_id<span class="token punctuation">)</span>        <span class="token keyword">if</span> self<span class="token punctuation">.</span>lw_topic<span class="token punctuation">:</span>            self<span class="token punctuation">.</span>_send_str<span class="token punctuation">(</span>self<span class="token punctuation">.</span>lw_topic<span class="token punctuation">)</span>            self<span class="token punctuation">.</span>_send_str<span class="token punctuation">(</span>self<span class="token punctuation">.</span>lw_msg<span class="token punctuation">)</span>        <span class="token keyword">if</span> self<span class="token punctuation">.</span>user <span class="token keyword">is</span> <span class="token keyword">not</span> <span class="token boolean">None</span><span class="token punctuation">:</span>            self<span class="token punctuation">.</span>_send_str<span class="token punctuation">(</span>self<span class="token punctuation">.</span>user<span class="token punctuation">)</span>            self<span class="token punctuation">.</span>_send_str<span class="token punctuation">(</span>self<span class="token punctuation">.</span>pswd<span class="token punctuation">)</span>        resp <span class="token operator">=</span> self<span class="token punctuation">.</span>sock<span class="token punctuation">.</span>read<span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span>        <span class="token keyword">assert</span> resp<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token number">0x20</span> <span class="token keyword">and</span> resp<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token number">0x02</span>        <span class="token keyword">if</span> resp<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span> <span class="token operator">!=</span> <span class="token number">0</span><span class="token punctuation">:</span>            <span class="token keyword">raise</span> MQTTException<span class="token punctuation">(</span>resp<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">)</span>        <span class="token keyword">return</span> resp<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span> <span class="token operator">&amp;</span> <span class="token number">1</span>    <span class="token keyword">def</span> <span class="token function">disconnect</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>        self<span class="token punctuation">.</span>sock<span class="token punctuation">.</span>write<span class="token punctuation">(</span><span class="token string">b"\xe0\0"</span><span class="token punctuation">)</span>        self<span class="token punctuation">.</span>sock<span class="token punctuation">.</span>close<span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token keyword">def</span> <span class="token function">ping</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>        self<span class="token punctuation">.</span>sock<span class="token punctuation">.</span>write<span class="token punctuation">(</span><span class="token string">b"\xc0\0"</span><span class="token punctuation">)</span>    <span class="token keyword">def</span> <span class="token function">publish</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> topic<span class="token punctuation">,</span> msg<span class="token punctuation">,</span> retain<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">,</span> qos<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">:</span>        pkt <span class="token operator">=</span> <span class="token builtin">bytearray</span><span class="token punctuation">(</span><span class="token string">b"\x30\0\0\0"</span><span class="token punctuation">)</span>        pkt<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">|</span><span class="token operator">=</span> qos <span class="token operator">&lt;&lt;</span> <span class="token number">1</span> <span class="token operator">|</span> retain        sz <span class="token operator">=</span> <span class="token number">2</span> <span class="token operator">+</span> <span class="token builtin">len</span><span class="token punctuation">(</span>topic<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token builtin">len</span><span class="token punctuation">(</span>msg<span class="token punctuation">)</span>        <span class="token keyword">if</span> qos <span class="token operator">></span> <span class="token number">0</span><span class="token punctuation">:</span>            sz <span class="token operator">+=</span> <span class="token number">2</span>        <span class="token keyword">assert</span> sz <span class="token operator">&lt;</span> <span class="token number">2097152</span>        i <span class="token operator">=</span> <span class="token number">1</span>        <span class="token keyword">while</span> sz <span class="token operator">></span> <span class="token number">0x7f</span><span class="token punctuation">:</span>            pkt<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">(</span>sz <span class="token operator">&amp;</span> <span class="token number">0x7f</span><span class="token punctuation">)</span> <span class="token operator">|</span> <span class="token number">0x80</span>            sz <span class="token operator">>></span><span class="token operator">=</span> <span class="token number">7</span>            i <span class="token operator">+=</span> <span class="token number">1</span>        pkt<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> sz        <span class="token comment">#print(hex(len(pkt)), hexlify(pkt, ":"))</span>        self<span class="token punctuation">.</span>sock<span class="token punctuation">.</span>write<span class="token punctuation">(</span>pkt<span class="token punctuation">,</span> i <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span>        self<span class="token punctuation">.</span>_send_str<span class="token punctuation">(</span>topic<span class="token punctuation">)</span>        <span class="token keyword">if</span> qos <span class="token operator">></span> <span class="token number">0</span><span class="token punctuation">:</span>            self<span class="token punctuation">.</span>pid <span class="token operator">+=</span> <span class="token number">1</span>            pid <span class="token operator">=</span> self<span class="token punctuation">.</span>pid            struct<span class="token punctuation">.</span>pack_into<span class="token punctuation">(</span><span class="token string">"!H"</span><span class="token punctuation">,</span> pkt<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> pid<span class="token punctuation">)</span>            self<span class="token punctuation">.</span>sock<span class="token punctuation">.</span>write<span class="token punctuation">(</span>pkt<span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span>        self<span class="token punctuation">.</span>sock<span class="token punctuation">.</span>write<span class="token punctuation">(</span>msg<span class="token punctuation">)</span>        <span class="token keyword">if</span> qos <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">:</span>            <span class="token keyword">while</span> <span class="token number">1</span><span class="token punctuation">:</span>                op <span class="token operator">=</span> self<span class="token punctuation">.</span>wait_msg<span class="token punctuation">(</span><span class="token punctuation">)</span>                <span class="token keyword">if</span> op <span class="token operator">==</span> <span class="token number">0x40</span><span class="token punctuation">:</span>                    sz <span class="token operator">=</span> self<span class="token punctuation">.</span>sock<span class="token punctuation">.</span>read<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>                    <span class="token keyword">assert</span> sz <span class="token operator">==</span> <span class="token string">b"\x02"</span>                    rcv_pid <span class="token operator">=</span> self<span class="token punctuation">.</span>sock<span class="token punctuation">.</span>read<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span>                    rcv_pid <span class="token operator">=</span> rcv_pid<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">&lt;&lt;</span> <span class="token number">8</span> <span class="token operator">|</span> rcv_pid<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span>                    <span class="token keyword">if</span> pid <span class="token operator">==</span> rcv_pid<span class="token punctuation">:</span>                        <span class="token keyword">return</span>        <span class="token keyword">elif</span> qos <span class="token operator">==</span> <span class="token number">2</span><span class="token punctuation">:</span>            <span class="token keyword">assert</span> <span class="token number">0</span>    <span class="token keyword">def</span> <span class="token function">subscribe</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> topic<span class="token punctuation">,</span> qos<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">:</span>        <span class="token keyword">assert</span> self<span class="token punctuation">.</span>cb <span class="token keyword">is</span> <span class="token keyword">not</span> <span class="token boolean">None</span><span class="token punctuation">,</span> <span class="token string">"Subscribe callback is not set"</span>        pkt <span class="token operator">=</span> <span class="token builtin">bytearray</span><span class="token punctuation">(</span><span class="token string">b"\x82\0\0\0"</span><span class="token punctuation">)</span>        self<span class="token punctuation">.</span>pid <span class="token operator">+=</span> <span class="token number">1</span>        struct<span class="token punctuation">.</span>pack_into<span class="token punctuation">(</span><span class="token string">"!BH"</span><span class="token punctuation">,</span> pkt<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span> <span class="token operator">+</span> <span class="token number">2</span> <span class="token operator">+</span> <span class="token builtin">len</span><span class="token punctuation">(</span>topic<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">,</span> self<span class="token punctuation">.</span>pid<span class="token punctuation">)</span>        <span class="token comment">#print(hex(len(pkt)), hexlify(pkt, ":"))</span>        self<span class="token punctuation">.</span>sock<span class="token punctuation">.</span>write<span class="token punctuation">(</span>pkt<span class="token punctuation">)</span>        self<span class="token punctuation">.</span>_send_str<span class="token punctuation">(</span>topic<span class="token punctuation">)</span>        self<span class="token punctuation">.</span>sock<span class="token punctuation">.</span>write<span class="token punctuation">(</span>qos<span class="token punctuation">.</span>to_bytes<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token string">"little"</span><span class="token punctuation">)</span><span class="token punctuation">)</span>        <span class="token keyword">while</span> <span class="token number">1</span><span class="token punctuation">:</span>            op <span class="token operator">=</span> self<span class="token punctuation">.</span>wait_msg<span class="token punctuation">(</span><span class="token punctuation">)</span>            <span class="token keyword">if</span> op <span class="token operator">==</span> <span class="token number">0x90</span><span class="token punctuation">:</span>                resp <span class="token operator">=</span> self<span class="token punctuation">.</span>sock<span class="token punctuation">.</span>read<span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span>                <span class="token comment">#print(resp)</span>                <span class="token keyword">assert</span> resp<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">==</span> pkt<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span> <span class="token keyword">and</span> resp<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span> <span class="token operator">==</span> pkt<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span>                <span class="token keyword">if</span> resp<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token number">0x80</span><span class="token punctuation">:</span>                    <span class="token keyword">raise</span> MQTTException<span class="token punctuation">(</span>resp<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">)</span>                <span class="token keyword">return</span>    <span class="token comment"># Wait for a single incoming MQTT message and process it.</span>    <span class="token comment"># Subscribed messages are delivered to a callback previously</span>    <span class="token comment"># set by .set_callback() method. Other (internal) MQTT</span>    <span class="token comment"># messages processed internally.</span>    <span class="token keyword">def</span> <span class="token function">wait_msg</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>        res <span class="token operator">=</span> self<span class="token punctuation">.</span>sock<span class="token punctuation">.</span>read<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>        self<span class="token punctuation">.</span>sock<span class="token punctuation">.</span>setblocking<span class="token punctuation">(</span><span class="token boolean">True</span><span class="token punctuation">)</span>        <span class="token keyword">if</span> res <span class="token keyword">is</span> <span class="token boolean">None</span><span class="token punctuation">:</span>            <span class="token keyword">return</span> <span class="token boolean">None</span>        <span class="token keyword">if</span> res <span class="token operator">==</span> <span class="token string">b""</span><span class="token punctuation">:</span>            <span class="token keyword">raise</span> OSError<span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span>        <span class="token keyword">if</span> res <span class="token operator">==</span> <span class="token string">b"\xd0"</span><span class="token punctuation">:</span>  <span class="token comment"># PINGRESP</span>            sz <span class="token operator">=</span> self<span class="token punctuation">.</span>sock<span class="token punctuation">.</span>read<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>            <span class="token keyword">assert</span> sz <span class="token operator">==</span> <span class="token number">0</span>            <span class="token keyword">return</span> <span class="token boolean">None</span>        op <span class="token operator">=</span> res<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>        <span class="token keyword">if</span> op <span class="token operator">&amp;</span> <span class="token number">0xf0</span> <span class="token operator">!=</span> <span class="token number">0x30</span><span class="token punctuation">:</span>            <span class="token keyword">return</span> op        sz <span class="token operator">=</span> self<span class="token punctuation">.</span>_recv_len<span class="token punctuation">(</span><span class="token punctuation">)</span>        topic_len <span class="token operator">=</span> self<span class="token punctuation">.</span>sock<span class="token punctuation">.</span>read<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span>        topic_len <span class="token operator">=</span> <span class="token punctuation">(</span>topic_len<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">&lt;&lt;</span> <span class="token number">8</span><span class="token punctuation">)</span> <span class="token operator">|</span> topic_len<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span>        topic <span class="token operator">=</span> self<span class="token punctuation">.</span>sock<span class="token punctuation">.</span>read<span class="token punctuation">(</span>topic_len<span class="token punctuation">)</span>        sz <span class="token operator">-=</span> topic_len <span class="token operator">+</span> <span class="token number">2</span>        <span class="token keyword">if</span> op <span class="token operator">&amp;</span> <span class="token number">6</span><span class="token punctuation">:</span>            pid <span class="token operator">=</span> self<span class="token punctuation">.</span>sock<span class="token punctuation">.</span>read<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span>            pid <span class="token operator">=</span> pid<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">&lt;&lt;</span> <span class="token number">8</span> <span class="token operator">|</span> pid<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span>            sz <span class="token operator">-=</span> <span class="token number">2</span>        msg <span class="token operator">=</span> self<span class="token punctuation">.</span>sock<span class="token punctuation">.</span>read<span class="token punctuation">(</span>sz<span class="token punctuation">)</span>        self<span class="token punctuation">.</span>cb<span class="token punctuation">(</span>topic<span class="token punctuation">,</span> msg<span class="token punctuation">)</span>        <span class="token keyword">if</span> op <span class="token operator">&amp;</span> <span class="token number">6</span> <span class="token operator">==</span> <span class="token number">2</span><span class="token punctuation">:</span>            pkt <span class="token operator">=</span> <span class="token builtin">bytearray</span><span class="token punctuation">(</span><span class="token string">b"\x40\x02\0\0"</span><span class="token punctuation">)</span>            struct<span class="token punctuation">.</span>pack_into<span class="token punctuation">(</span><span class="token string">"!H"</span><span class="token punctuation">,</span> pkt<span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> pid<span class="token punctuation">)</span>            self<span class="token punctuation">.</span>sock<span class="token punctuation">.</span>write<span class="token punctuation">(</span>pkt<span class="token punctuation">)</span>        <span class="token keyword">elif</span> op <span class="token operator">&amp;</span> <span class="token number">6</span> <span class="token operator">==</span> <span class="token number">4</span><span class="token punctuation">:</span>            <span class="token keyword">assert</span> <span class="token number">0</span>    <span class="token comment"># Checks whether a pending message from server is available.</span>    <span class="token comment"># If not, returns immediately with None. Otherwise, does</span>    <span class="token comment"># the same processing as wait_msg.</span>    <span class="token keyword">def</span> <span class="token function">check_msg</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>        self<span class="token punctuation">.</span>sock<span class="token punctuation">.</span>setblocking<span class="token punctuation">(</span><span class="token boolean">False</span><span class="token punctuation">)</span>        <span class="token keyword">return</span> self<span class="token punctuation">.</span>wait_msg<span class="token punctuation">(</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="將BME280-py上傳到ESP32"><a href="#將BME280-py上傳到ESP32" class="headerlink" title="將BME280.py上傳到ESP32"></a>將BME280.py上傳到ESP32</h2><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">from</span> machine <span class="token keyword">import</span> I2C<span class="token keyword">import</span> time<span class="token comment"># BME280 default address.</span>BME280_I2CADDR <span class="token operator">=</span> <span class="token number">0x76</span><span class="token comment"># Operating Modes</span>BME280_OSAMPLE_1 <span class="token operator">=</span> <span class="token number">1</span>BME280_OSAMPLE_2 <span class="token operator">=</span> <span class="token number">2</span>BME280_OSAMPLE_4 <span class="token operator">=</span> <span class="token number">3</span>BME280_OSAMPLE_8 <span class="token operator">=</span> <span class="token number">4</span>BME280_OSAMPLE_16 <span class="token operator">=</span> <span class="token number">5</span><span class="token comment"># BME280 Registers</span>BME280_REGISTER_DIG_T1 <span class="token operator">=</span> <span class="token number">0x88</span>  <span class="token comment"># Trimming parameter registers</span>BME280_REGISTER_DIG_T2 <span class="token operator">=</span> <span class="token number">0x8A</span>BME280_REGISTER_DIG_T3 <span class="token operator">=</span> <span class="token number">0x8C</span>BME280_REGISTER_DIG_P1 <span class="token operator">=</span> <span class="token number">0x8E</span>BME280_REGISTER_DIG_P2 <span class="token operator">=</span> <span class="token number">0x90</span>BME280_REGISTER_DIG_P3 <span class="token operator">=</span> <span class="token number">0x92</span>BME280_REGISTER_DIG_P4 <span class="token operator">=</span> <span class="token number">0x94</span>BME280_REGISTER_DIG_P5 <span class="token operator">=</span> <span class="token number">0x96</span>BME280_REGISTER_DIG_P6 <span class="token operator">=</span> <span class="token number">0x98</span>BME280_REGISTER_DIG_P7 <span class="token operator">=</span> <span class="token number">0x9A</span>BME280_REGISTER_DIG_P8 <span class="token operator">=</span> <span class="token number">0x9C</span>BME280_REGISTER_DIG_P9 <span class="token operator">=</span> <span class="token number">0x9E</span>BME280_REGISTER_DIG_H1 <span class="token operator">=</span> <span class="token number">0xA1</span>BME280_REGISTER_DIG_H2 <span class="token operator">=</span> <span class="token number">0xE1</span>BME280_REGISTER_DIG_H3 <span class="token operator">=</span> <span class="token number">0xE3</span>BME280_REGISTER_DIG_H4 <span class="token operator">=</span> <span class="token number">0xE4</span>BME280_REGISTER_DIG_H5 <span class="token operator">=</span> <span class="token number">0xE5</span>BME280_REGISTER_DIG_H6 <span class="token operator">=</span> <span class="token number">0xE6</span>BME280_REGISTER_DIG_H7 <span class="token operator">=</span> <span class="token number">0xE7</span>BME280_REGISTER_CHIPID <span class="token operator">=</span> <span class="token number">0xD0</span>BME280_REGISTER_VERSION <span class="token operator">=</span> <span class="token number">0xD1</span>BME280_REGISTER_SOFTRESET <span class="token operator">=</span> <span class="token number">0xE0</span>BME280_REGISTER_CONTROL_HUM <span class="token operator">=</span> <span class="token number">0xF2</span>BME280_REGISTER_CONTROL <span class="token operator">=</span> <span class="token number">0xF4</span>BME280_REGISTER_CONFIG <span class="token operator">=</span> <span class="token number">0xF5</span>BME280_REGISTER_PRESSURE_DATA <span class="token operator">=</span> <span class="token number">0xF7</span>BME280_REGISTER_TEMP_DATA <span class="token operator">=</span> <span class="token number">0xFA</span>BME280_REGISTER_HUMIDITY_DATA <span class="token operator">=</span> <span class="token number">0xFD</span><span class="token keyword">class</span> <span class="token class-name">Device</span><span class="token punctuation">:</span>  <span class="token triple-quoted-string string">"""Class for communicating with an I2C device.  Allows reading and writing 8-bit, 16-bit, and byte array values to  registers on the device."""</span>  <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> address<span class="token punctuation">,</span> i2c<span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token triple-quoted-string string">"""Create an instance of the I2C device at the specified address using    the specified I2C interface object."""</span>    self<span class="token punctuation">.</span>_address <span class="token operator">=</span> address    self<span class="token punctuation">.</span>_i2c <span class="token operator">=</span> i2c  <span class="token keyword">def</span> <span class="token function">writeRaw8</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> value<span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token triple-quoted-string string">"""Write an 8-bit value on the bus (without register)."""</span>    value <span class="token operator">=</span> value <span class="token operator">&amp;</span> <span class="token number">0xFF</span>    self<span class="token punctuation">.</span>_i2c<span class="token punctuation">.</span>writeto<span class="token punctuation">(</span>self<span class="token punctuation">.</span>_address<span class="token punctuation">,</span> value<span class="token punctuation">)</span>  <span class="token keyword">def</span> <span class="token function">write8</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> register<span class="token punctuation">,</span> value<span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token triple-quoted-string string">"""Write an 8-bit value to the specified register."""</span>    b<span class="token operator">=</span><span class="token builtin">bytearray</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>    b<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token operator">=</span>value <span class="token operator">&amp;</span> <span class="token number">0xFF</span>    self<span class="token punctuation">.</span>_i2c<span class="token punctuation">.</span>writeto_mem<span class="token punctuation">(</span>self<span class="token punctuation">.</span>_address<span class="token punctuation">,</span> register<span class="token punctuation">,</span> b<span class="token punctuation">)</span>  <span class="token keyword">def</span> <span class="token function">write16</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> register<span class="token punctuation">,</span> value<span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token triple-quoted-string string">"""Write a 16-bit value to the specified register."""</span>    value <span class="token operator">=</span> value <span class="token operator">&amp;</span> <span class="token number">0xFFFF</span>    b<span class="token operator">=</span><span class="token builtin">bytearray</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span>    b<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token operator">=</span> value <span class="token operator">&amp;</span> <span class="token number">0xFF</span>    b<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token operator">=</span> <span class="token punctuation">(</span>value<span class="token operator">>></span><span class="token number">8</span><span class="token punctuation">)</span> <span class="token operator">&amp;</span> <span class="token number">0xFF</span>    self<span class="token punctuation">.</span>i2c<span class="token punctuation">.</span>writeto_mem<span class="token punctuation">(</span>self<span class="token punctuation">.</span>_address<span class="token punctuation">,</span> register<span class="token punctuation">,</span> value<span class="token punctuation">)</span>  <span class="token keyword">def</span> <span class="token function">readRaw8</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token triple-quoted-string string">"""Read an 8-bit value on the bus (without register)."""</span>    <span class="token keyword">return</span> <span class="token builtin">int</span><span class="token punctuation">.</span>from_bytes<span class="token punctuation">(</span>self<span class="token punctuation">.</span>_i2c<span class="token punctuation">.</span>readfrom<span class="token punctuation">(</span>self<span class="token punctuation">.</span>_address<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token string">'little'</span><span class="token punctuation">)</span> <span class="token operator">&amp;</span> <span class="token number">0xFF</span>  <span class="token keyword">def</span> <span class="token function">readU8</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> register<span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token triple-quoted-string string">"""Read an unsigned byte from the specified register."""</span>    <span class="token keyword">return</span> <span class="token builtin">int</span><span class="token punctuation">.</span>from_bytes<span class="token punctuation">(</span>        self<span class="token punctuation">.</span>_i2c<span class="token punctuation">.</span>readfrom_mem<span class="token punctuation">(</span>self<span class="token punctuation">.</span>_address<span class="token punctuation">,</span> register<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token string">'little'</span><span class="token punctuation">)</span> <span class="token operator">&amp;</span> <span class="token number">0xFF</span>  <span class="token keyword">def</span> <span class="token function">readS8</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> register<span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token triple-quoted-string string">"""Read a signed byte from the specified register."""</span>    result <span class="token operator">=</span> self<span class="token punctuation">.</span>readU8<span class="token punctuation">(</span>register<span class="token punctuation">)</span>    <span class="token keyword">if</span> result <span class="token operator">></span> <span class="token number">127</span><span class="token punctuation">:</span>      result <span class="token operator">-=</span> <span class="token number">256</span>    <span class="token keyword">return</span> result  <span class="token keyword">def</span> <span class="token function">readU16</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> register<span class="token punctuation">,</span> little_endian<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token triple-quoted-string string">"""Read an unsigned 16-bit value from the specified register, with the    specified endianness (default little endian, or least significant byte    first)."""</span>    result <span class="token operator">=</span> <span class="token builtin">int</span><span class="token punctuation">.</span>from_bytes<span class="token punctuation">(</span>        self<span class="token punctuation">.</span>_i2c<span class="token punctuation">.</span>readfrom_mem<span class="token punctuation">(</span>self<span class="token punctuation">.</span>_address<span class="token punctuation">,</span> register<span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token string">'little'</span><span class="token punctuation">)</span> <span class="token operator">&amp;</span> <span class="token number">0xFFFF</span>    <span class="token keyword">if</span> <span class="token keyword">not</span> little_endian<span class="token punctuation">:</span>      result <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>result <span class="token operator">&lt;&lt;</span> <span class="token number">8</span><span class="token punctuation">)</span> <span class="token operator">&amp;</span> <span class="token number">0xFF00</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token punctuation">(</span>result <span class="token operator">>></span> <span class="token number">8</span><span class="token punctuation">)</span>    <span class="token keyword">return</span> result  <span class="token keyword">def</span> <span class="token function">readS16</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> register<span class="token punctuation">,</span> little_endian<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token triple-quoted-string string">"""Read a signed 16-bit value from the specified register, with the    specified endianness (default little endian, or least significant byte    first)."""</span>    result <span class="token operator">=</span> self<span class="token punctuation">.</span>readU16<span class="token punctuation">(</span>register<span class="token punctuation">,</span> little_endian<span class="token punctuation">)</span>    <span class="token keyword">if</span> result <span class="token operator">></span> <span class="token number">32767</span><span class="token punctuation">:</span>      result <span class="token operator">-=</span> <span class="token number">65536</span>    <span class="token keyword">return</span> result  <span class="token keyword">def</span> <span class="token function">readU16LE</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> register<span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token triple-quoted-string string">"""Read an unsigned 16-bit value from the specified register, in little    endian byte order."""</span>    <span class="token keyword">return</span> self<span class="token punctuation">.</span>readU16<span class="token punctuation">(</span>register<span class="token punctuation">,</span> little_endian<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>  <span class="token keyword">def</span> <span class="token function">readU16BE</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> register<span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token triple-quoted-string string">"""Read an unsigned 16-bit value from the specified register, in big    endian byte order."""</span>    <span class="token keyword">return</span> self<span class="token punctuation">.</span>readU16<span class="token punctuation">(</span>register<span class="token punctuation">,</span> little_endian<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">)</span>  <span class="token keyword">def</span> <span class="token function">readS16LE</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> register<span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token triple-quoted-string string">"""Read a signed 16-bit value from the specified register, in little    endian byte order."""</span>    <span class="token keyword">return</span> self<span class="token punctuation">.</span>readS16<span class="token punctuation">(</span>register<span class="token punctuation">,</span> little_endian<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>  <span class="token keyword">def</span> <span class="token function">readS16BE</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> register<span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token triple-quoted-string string">"""Read a signed 16-bit value from the specified register, in big    endian byte order."""</span>    <span class="token keyword">return</span> self<span class="token punctuation">.</span>readS16<span class="token punctuation">(</span>register<span class="token punctuation">,</span> little_endian<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">)</span><span class="token keyword">class</span> <span class="token class-name">BME280</span><span class="token punctuation">:</span>  <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> mode<span class="token operator">=</span>BME280_OSAMPLE_1<span class="token punctuation">,</span> address<span class="token operator">=</span>BME280_I2CADDR<span class="token punctuation">,</span> i2c<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">,</span>               <span class="token operator">**</span>kwargs<span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token comment"># Check that mode is valid.</span>    <span class="token keyword">if</span> mode <span class="token keyword">not</span> <span class="token keyword">in</span> <span class="token punctuation">[</span>BME280_OSAMPLE_1<span class="token punctuation">,</span> BME280_OSAMPLE_2<span class="token punctuation">,</span> BME280_OSAMPLE_4<span class="token punctuation">,</span>                    BME280_OSAMPLE_8<span class="token punctuation">,</span> BME280_OSAMPLE_16<span class="token punctuation">]</span><span class="token punctuation">:</span>        <span class="token keyword">raise</span> ValueError<span class="token punctuation">(</span>            <span class="token string">'Unexpected mode value &#123;0&#125;. Set mode to one of '</span>            <span class="token string">'BME280_ULTRALOWPOWER, BME280_STANDARD, BME280_HIGHRES, or '</span>            <span class="token string">'BME280_ULTRAHIGHRES'</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>mode<span class="token punctuation">)</span><span class="token punctuation">)</span>    self<span class="token punctuation">.</span>_mode <span class="token operator">=</span> mode    <span class="token comment"># Create I2C device.</span>    <span class="token keyword">if</span> i2c <span class="token keyword">is</span> <span class="token boolean">None</span><span class="token punctuation">:</span>      <span class="token keyword">raise</span> ValueError<span class="token punctuation">(</span><span class="token string">'An I2C object is required.'</span><span class="token punctuation">)</span>    self<span class="token punctuation">.</span>_device <span class="token operator">=</span> Device<span class="token punctuation">(</span>address<span class="token punctuation">,</span> i2c<span class="token punctuation">)</span>    <span class="token comment"># Load calibration values.</span>    self<span class="token punctuation">.</span>_load_calibration<span class="token punctuation">(</span><span class="token punctuation">)</span>    self<span class="token punctuation">.</span>_device<span class="token punctuation">.</span>write8<span class="token punctuation">(</span>BME280_REGISTER_CONTROL<span class="token punctuation">,</span> <span class="token number">0x3F</span><span class="token punctuation">)</span>    self<span class="token punctuation">.</span>t_fine <span class="token operator">=</span> <span class="token number">0</span>  <span class="token keyword">def</span> <span class="token function">_load_calibration</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>    self<span class="token punctuation">.</span>dig_T1 <span class="token operator">=</span> self<span class="token punctuation">.</span>_device<span class="token punctuation">.</span>readU16LE<span class="token punctuation">(</span>BME280_REGISTER_DIG_T1<span class="token punctuation">)</span>    self<span class="token punctuation">.</span>dig_T2 <span class="token operator">=</span> self<span class="token punctuation">.</span>_device<span class="token punctuation">.</span>readS16LE<span class="token punctuation">(</span>BME280_REGISTER_DIG_T2<span class="token punctuation">)</span>    self<span class="token punctuation">.</span>dig_T3 <span class="token operator">=</span> self<span class="token punctuation">.</span>_device<span class="token punctuation">.</span>readS16LE<span class="token punctuation">(</span>BME280_REGISTER_DIG_T3<span class="token punctuation">)</span>    self<span class="token punctuation">.</span>dig_P1 <span class="token operator">=</span> self<span class="token punctuation">.</span>_device<span class="token punctuation">.</span>readU16LE<span class="token punctuation">(</span>BME280_REGISTER_DIG_P1<span class="token punctuation">)</span>    self<span class="token punctuation">.</span>dig_P2 <span class="token operator">=</span> self<span class="token punctuation">.</span>_device<span class="token punctuation">.</span>readS16LE<span class="token punctuation">(</span>BME280_REGISTER_DIG_P2<span class="token punctuation">)</span>    self<span class="token punctuation">.</span>dig_P3 <span class="token operator">=</span> self<span class="token punctuation">.</span>_device<span class="token punctuation">.</span>readS16LE<span class="token punctuation">(</span>BME280_REGISTER_DIG_P3<span class="token punctuation">)</span>    self<span class="token punctuation">.</span>dig_P4 <span class="token operator">=</span> self<span class="token punctuation">.</span>_device<span class="token punctuation">.</span>readS16LE<span class="token punctuation">(</span>BME280_REGISTER_DIG_P4<span class="token punctuation">)</span>    self<span class="token punctuation">.</span>dig_P5 <span class="token operator">=</span> self<span class="token punctuation">.</span>_device<span class="token punctuation">.</span>readS16LE<span class="token punctuation">(</span>BME280_REGISTER_DIG_P5<span class="token punctuation">)</span>    self<span class="token punctuation">.</span>dig_P6 <span class="token operator">=</span> self<span class="token punctuation">.</span>_device<span class="token punctuation">.</span>readS16LE<span class="token punctuation">(</span>BME280_REGISTER_DIG_P6<span class="token punctuation">)</span>    self<span class="token punctuation">.</span>dig_P7 <span class="token operator">=</span> self<span class="token punctuation">.</span>_device<span class="token punctuation">.</span>readS16LE<span class="token punctuation">(</span>BME280_REGISTER_DIG_P7<span class="token punctuation">)</span>    self<span class="token punctuation">.</span>dig_P8 <span class="token operator">=</span> self<span class="token punctuation">.</span>_device<span class="token punctuation">.</span>readS16LE<span class="token punctuation">(</span>BME280_REGISTER_DIG_P8<span class="token punctuation">)</span>    self<span class="token punctuation">.</span>dig_P9 <span class="token operator">=</span> self<span class="token punctuation">.</span>_device<span class="token punctuation">.</span>readS16LE<span class="token punctuation">(</span>BME280_REGISTER_DIG_P9<span class="token punctuation">)</span>    self<span class="token punctuation">.</span>dig_H1 <span class="token operator">=</span> self<span class="token punctuation">.</span>_device<span class="token punctuation">.</span>readU8<span class="token punctuation">(</span>BME280_REGISTER_DIG_H1<span class="token punctuation">)</span>    self<span class="token punctuation">.</span>dig_H2 <span class="token operator">=</span> self<span class="token punctuation">.</span>_device<span class="token punctuation">.</span>readS16LE<span class="token punctuation">(</span>BME280_REGISTER_DIG_H2<span class="token punctuation">)</span>    self<span class="token punctuation">.</span>dig_H3 <span class="token operator">=</span> self<span class="token punctuation">.</span>_device<span class="token punctuation">.</span>readU8<span class="token punctuation">(</span>BME280_REGISTER_DIG_H3<span class="token punctuation">)</span>    self<span class="token punctuation">.</span>dig_H6 <span class="token operator">=</span> self<span class="token punctuation">.</span>_device<span class="token punctuation">.</span>readS8<span class="token punctuation">(</span>BME280_REGISTER_DIG_H7<span class="token punctuation">)</span>    h4 <span class="token operator">=</span> self<span class="token punctuation">.</span>_device<span class="token punctuation">.</span>readS8<span class="token punctuation">(</span>BME280_REGISTER_DIG_H4<span class="token punctuation">)</span>    h4 <span class="token operator">=</span> <span class="token punctuation">(</span>h4 <span class="token operator">&lt;&lt;</span> <span class="token number">24</span><span class="token punctuation">)</span> <span class="token operator">>></span> <span class="token number">20</span>    self<span class="token punctuation">.</span>dig_H4 <span class="token operator">=</span> h4 <span class="token operator">|</span> <span class="token punctuation">(</span>self<span class="token punctuation">.</span>_device<span class="token punctuation">.</span>readU8<span class="token punctuation">(</span>BME280_REGISTER_DIG_H5<span class="token punctuation">)</span> <span class="token operator">&amp;</span> <span class="token number">0x0F</span><span class="token punctuation">)</span>    h5 <span class="token operator">=</span> self<span class="token punctuation">.</span>_device<span class="token punctuation">.</span>readS8<span class="token punctuation">(</span>BME280_REGISTER_DIG_H6<span class="token punctuation">)</span>    h5 <span class="token operator">=</span> <span class="token punctuation">(</span>h5 <span class="token operator">&lt;&lt;</span> <span class="token number">24</span><span class="token punctuation">)</span> <span class="token operator">>></span> <span class="token number">20</span>    self<span class="token punctuation">.</span>dig_H5 <span class="token operator">=</span> h5 <span class="token operator">|</span> <span class="token punctuation">(</span>        self<span class="token punctuation">.</span>_device<span class="token punctuation">.</span>readU8<span class="token punctuation">(</span>BME280_REGISTER_DIG_H5<span class="token punctuation">)</span> <span class="token operator">>></span> <span class="token number">4</span> <span class="token operator">&amp;</span> <span class="token number">0x0F</span><span class="token punctuation">)</span>  <span class="token keyword">def</span> <span class="token function">read_raw_temp</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token triple-quoted-string string">"""Reads the raw (uncompensated) temperature from the sensor."""</span>    meas <span class="token operator">=</span> self<span class="token punctuation">.</span>_mode    self<span class="token punctuation">.</span>_device<span class="token punctuation">.</span>write8<span class="token punctuation">(</span>BME280_REGISTER_CONTROL_HUM<span class="token punctuation">,</span> meas<span class="token punctuation">)</span>    meas <span class="token operator">=</span> self<span class="token punctuation">.</span>_mode <span class="token operator">&lt;&lt;</span> <span class="token number">5</span> <span class="token operator">|</span> self<span class="token punctuation">.</span>_mode <span class="token operator">&lt;&lt;</span> <span class="token number">2</span> <span class="token operator">|</span> <span class="token number">1</span>    self<span class="token punctuation">.</span>_device<span class="token punctuation">.</span>write8<span class="token punctuation">(</span>BME280_REGISTER_CONTROL<span class="token punctuation">,</span> meas<span class="token punctuation">)</span>    sleep_time <span class="token operator">=</span> <span class="token number">1250</span> <span class="token operator">+</span> <span class="token number">2300</span> <span class="token operator">*</span> <span class="token punctuation">(</span><span class="token number">1</span> <span class="token operator">&lt;&lt;</span> self<span class="token punctuation">.</span>_mode<span class="token punctuation">)</span>    sleep_time <span class="token operator">=</span> sleep_time <span class="token operator">+</span> <span class="token number">2300</span> <span class="token operator">*</span> <span class="token punctuation">(</span><span class="token number">1</span> <span class="token operator">&lt;&lt;</span> self<span class="token punctuation">.</span>_mode<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">575</span>    sleep_time <span class="token operator">=</span> sleep_time <span class="token operator">+</span> <span class="token number">2300</span> <span class="token operator">*</span> <span class="token punctuation">(</span><span class="token number">1</span> <span class="token operator">&lt;&lt;</span> self<span class="token punctuation">.</span>_mode<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">575</span>    time<span class="token punctuation">.</span>sleep_us<span class="token punctuation">(</span>sleep_time<span class="token punctuation">)</span>  <span class="token comment"># Wait the required time</span>    msb <span class="token operator">=</span> self<span class="token punctuation">.</span>_device<span class="token punctuation">.</span>readU8<span class="token punctuation">(</span>BME280_REGISTER_TEMP_DATA<span class="token punctuation">)</span>    lsb <span class="token operator">=</span> self<span class="token punctuation">.</span>_device<span class="token punctuation">.</span>readU8<span class="token punctuation">(</span>BME280_REGISTER_TEMP_DATA <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span>    xlsb <span class="token operator">=</span> self<span class="token punctuation">.</span>_device<span class="token punctuation">.</span>readU8<span class="token punctuation">(</span>BME280_REGISTER_TEMP_DATA <span class="token operator">+</span> <span class="token number">2</span><span class="token punctuation">)</span>    raw <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>msb <span class="token operator">&lt;&lt;</span> <span class="token number">16</span><span class="token punctuation">)</span> <span class="token operator">|</span> <span class="token punctuation">(</span>lsb <span class="token operator">&lt;&lt;</span> <span class="token number">8</span><span class="token punctuation">)</span> <span class="token operator">|</span> xlsb<span class="token punctuation">)</span> <span class="token operator">>></span> <span class="token number">4</span>    <span class="token keyword">return</span> raw  <span class="token keyword">def</span> <span class="token function">read_raw_pressure</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token triple-quoted-string string">"""Reads the raw (uncompensated) pressure level from the sensor."""</span>    <span class="token triple-quoted-string string">"""Assumes that the temperature has already been read """</span>    <span class="token triple-quoted-string string">"""i.e. that enough delay has been provided"""</span>    msb <span class="token operator">=</span> self<span class="token punctuation">.</span>_device<span class="token punctuation">.</span>readU8<span class="token punctuation">(</span>BME280_REGISTER_PRESSURE_DATA<span class="token punctuation">)</span>    lsb <span class="token operator">=</span> self<span class="token punctuation">.</span>_device<span class="token punctuation">.</span>readU8<span class="token punctuation">(</span>BME280_REGISTER_PRESSURE_DATA <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span>    xlsb <span class="token operator">=</span> self<span class="token punctuation">.</span>_device<span class="token punctuation">.</span>readU8<span class="token punctuation">(</span>BME280_REGISTER_PRESSURE_DATA <span class="token operator">+</span> <span class="token number">2</span><span class="token punctuation">)</span>    raw <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>msb <span class="token operator">&lt;&lt;</span> <span class="token number">16</span><span class="token punctuation">)</span> <span class="token operator">|</span> <span class="token punctuation">(</span>lsb <span class="token operator">&lt;&lt;</span> <span class="token number">8</span><span class="token punctuation">)</span> <span class="token operator">|</span> xlsb<span class="token punctuation">)</span> <span class="token operator">>></span> <span class="token number">4</span>    <span class="token keyword">return</span> raw  <span class="token keyword">def</span> <span class="token function">read_raw_humidity</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token triple-quoted-string string">"""Assumes that the temperature has already been read """</span>    <span class="token triple-quoted-string string">"""i.e. that enough delay has been provided"""</span>    msb <span class="token operator">=</span> self<span class="token punctuation">.</span>_device<span class="token punctuation">.</span>readU8<span class="token punctuation">(</span>BME280_REGISTER_HUMIDITY_DATA<span class="token punctuation">)</span>    lsb <span class="token operator">=</span> self<span class="token punctuation">.</span>_device<span class="token punctuation">.</span>readU8<span class="token punctuation">(</span>BME280_REGISTER_HUMIDITY_DATA <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span>    raw <span class="token operator">=</span> <span class="token punctuation">(</span>msb <span class="token operator">&lt;&lt;</span> <span class="token number">8</span><span class="token punctuation">)</span> <span class="token operator">|</span> lsb    <span class="token keyword">return</span> raw  <span class="token keyword">def</span> <span class="token function">read_temperature</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token triple-quoted-string string">"""Get the compensated temperature in 0.01 of a degree celsius."""</span>    adc <span class="token operator">=</span> self<span class="token punctuation">.</span>read_raw_temp<span class="token punctuation">(</span><span class="token punctuation">)</span>    var1 <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>adc <span class="token operator">>></span> <span class="token number">3</span><span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token punctuation">(</span>self<span class="token punctuation">.</span>dig_T1 <span class="token operator">&lt;&lt;</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token punctuation">(</span>self<span class="token punctuation">.</span>dig_T2 <span class="token operator">>></span> <span class="token number">11</span><span class="token punctuation">)</span>    var2 <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>        <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">(</span>adc <span class="token operator">>></span> <span class="token number">4</span><span class="token punctuation">)</span> <span class="token operator">-</span> self<span class="token punctuation">.</span>dig_T1<span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>adc <span class="token operator">>></span> <span class="token number">4</span><span class="token punctuation">)</span> <span class="token operator">-</span> self<span class="token punctuation">.</span>dig_T1<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">>></span> <span class="token number">12</span><span class="token punctuation">)</span> <span class="token operator">*</span>        self<span class="token punctuation">.</span>dig_T3<span class="token punctuation">)</span> <span class="token operator">>></span> <span class="token number">14</span>    self<span class="token punctuation">.</span>t_fine <span class="token operator">=</span> var1 <span class="token operator">+</span> var2    <span class="token keyword">return</span> <span class="token punctuation">(</span>self<span class="token punctuation">.</span>t_fine <span class="token operator">*</span> <span class="token number">5</span> <span class="token operator">+</span> <span class="token number">128</span><span class="token punctuation">)</span> <span class="token operator">>></span> <span class="token number">8</span>  <span class="token keyword">def</span> <span class="token function">read_pressure</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token triple-quoted-string string">"""Gets the compensated pressure in Pascals."""</span>    adc <span class="token operator">=</span> self<span class="token punctuation">.</span>read_raw_pressure<span class="token punctuation">(</span><span class="token punctuation">)</span>    var1 <span class="token operator">=</span> self<span class="token punctuation">.</span>t_fine <span class="token operator">-</span> <span class="token number">128000</span>    var2 <span class="token operator">=</span> var1 <span class="token operator">*</span> var1 <span class="token operator">*</span> self<span class="token punctuation">.</span>dig_P6    var2 <span class="token operator">=</span> var2 <span class="token operator">+</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>var1 <span class="token operator">*</span> self<span class="token punctuation">.</span>dig_P5<span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> <span class="token number">17</span><span class="token punctuation">)</span>    var2 <span class="token operator">=</span> var2 <span class="token operator">+</span> <span class="token punctuation">(</span>self<span class="token punctuation">.</span>dig_P4 <span class="token operator">&lt;&lt;</span> <span class="token number">35</span><span class="token punctuation">)</span>    var1 <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">(</span>var1 <span class="token operator">*</span> var1 <span class="token operator">*</span> self<span class="token punctuation">.</span>dig_P3<span class="token punctuation">)</span> <span class="token operator">>></span> <span class="token number">8</span><span class="token punctuation">)</span> <span class="token operator">+</span>            <span class="token punctuation">(</span><span class="token punctuation">(</span>var1 <span class="token operator">*</span> self<span class="token punctuation">.</span>dig_P2<span class="token punctuation">)</span> <span class="token operator">>></span> <span class="token number">12</span><span class="token punctuation">)</span><span class="token punctuation">)</span>    var1 <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token number">1</span> <span class="token operator">&lt;&lt;</span> <span class="token number">47</span><span class="token punctuation">)</span> <span class="token operator">+</span> var1<span class="token punctuation">)</span> <span class="token operator">*</span> self<span class="token punctuation">.</span>dig_P1<span class="token punctuation">)</span> <span class="token operator">>></span> <span class="token number">33</span>    <span class="token keyword">if</span> var1 <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">:</span>      <span class="token keyword">return</span> <span class="token number">0</span>    p <span class="token operator">=</span> <span class="token number">1048576</span> <span class="token operator">-</span> adc    p <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">(</span>p <span class="token operator">&lt;&lt;</span> <span class="token number">31</span><span class="token punctuation">)</span> <span class="token operator">-</span> var2<span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">3125</span><span class="token punctuation">)</span> <span class="token operator">//</span> var1    var1 <span class="token operator">=</span> <span class="token punctuation">(</span>self<span class="token punctuation">.</span>dig_P9 <span class="token operator">*</span> <span class="token punctuation">(</span>p <span class="token operator">>></span> <span class="token number">13</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token punctuation">(</span>p <span class="token operator">>></span> <span class="token number">13</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">>></span> <span class="token number">25</span>    var2 <span class="token operator">=</span> <span class="token punctuation">(</span>self<span class="token punctuation">.</span>dig_P8 <span class="token operator">*</span> p<span class="token punctuation">)</span> <span class="token operator">>></span> <span class="token number">19</span>    <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>p <span class="token operator">+</span> var1 <span class="token operator">+</span> var2<span class="token punctuation">)</span> <span class="token operator">>></span> <span class="token number">8</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token punctuation">(</span>self<span class="token punctuation">.</span>dig_P7 <span class="token operator">&lt;&lt;</span> <span class="token number">4</span><span class="token punctuation">)</span>  <span class="token keyword">def</span> <span class="token function">read_humidity</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>    adc <span class="token operator">=</span> self<span class="token punctuation">.</span>read_raw_humidity<span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token comment"># print 'Raw humidity = &#123;0:d&#125;'.format (adc)</span>    h <span class="token operator">=</span> self<span class="token punctuation">.</span>t_fine <span class="token operator">-</span> <span class="token number">76800</span>    h <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">(</span>adc <span class="token operator">&lt;&lt;</span> <span class="token number">14</span><span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token punctuation">(</span>self<span class="token punctuation">.</span>dig_H4 <span class="token operator">&lt;&lt;</span> <span class="token number">20</span><span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token punctuation">(</span>self<span class="token punctuation">.</span>dig_H5 <span class="token operator">*</span> h<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">+</span>         <span class="token number">16384</span><span class="token punctuation">)</span> <span class="token operator">>></span> <span class="token number">15</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">(</span>h <span class="token operator">*</span> self<span class="token punctuation">.</span>dig_H6<span class="token punctuation">)</span> <span class="token operator">>></span> <span class="token number">10</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">(</span>h <span class="token operator">*</span>                          self<span class="token punctuation">.</span>dig_H3<span class="token punctuation">)</span> <span class="token operator">>></span> <span class="token number">11</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">32768</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">>></span> <span class="token number">10</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">2097152</span><span class="token punctuation">)</span> <span class="token operator">*</span>                          self<span class="token punctuation">.</span>dig_H2 <span class="token operator">+</span> <span class="token number">8192</span><span class="token punctuation">)</span> <span class="token operator">>></span> <span class="token number">14</span><span class="token punctuation">)</span><span class="token punctuation">)</span>    h <span class="token operator">=</span> h <span class="token operator">-</span> <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">(</span>h <span class="token operator">>></span> <span class="token number">15</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token punctuation">(</span>h <span class="token operator">>></span> <span class="token number">15</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">>></span> <span class="token number">7</span><span class="token punctuation">)</span> <span class="token operator">*</span> self<span class="token punctuation">.</span>dig_H1<span class="token punctuation">)</span> <span class="token operator">>></span> <span class="token number">4</span><span class="token punctuation">)</span>    h <span class="token operator">=</span> <span class="token number">0</span> <span class="token keyword">if</span> h <span class="token operator">&lt;</span> <span class="token number">0</span> <span class="token keyword">else</span> h    h <span class="token operator">=</span> <span class="token number">419430400</span> <span class="token keyword">if</span> h <span class="token operator">></span> <span class="token number">419430400</span> <span class="token keyword">else</span> h    <span class="token keyword">return</span> h <span class="token operator">>></span> <span class="token number">12</span>  <span class="token decorator annotation punctuation">@property</span>  <span class="token keyword">def</span> <span class="token function">temperature</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token string">"Return the temperature in degrees."</span>    t <span class="token operator">=</span> self<span class="token punctuation">.</span>read_temperature<span class="token punctuation">(</span><span class="token punctuation">)</span>    ti <span class="token operator">=</span> t <span class="token operator">//</span> <span class="token number">100</span>    td <span class="token operator">=</span> t <span class="token operator">-</span> ti <span class="token operator">*</span> <span class="token number">100</span>    <span class="token keyword">return</span> <span class="token string">"&#123;&#125;.&#123;:02d&#125;C"</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>ti<span class="token punctuation">,</span> td<span class="token punctuation">)</span>  <span class="token decorator annotation punctuation">@property</span>  <span class="token keyword">def</span> <span class="token function">pressure</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token string">"Return the temperature in hPa."</span>    p <span class="token operator">=</span> self<span class="token punctuation">.</span>read_pressure<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">//</span> <span class="token number">256</span>    pi <span class="token operator">=</span> p <span class="token operator">//</span> <span class="token number">100</span>    pd <span class="token operator">=</span> p <span class="token operator">-</span> pi <span class="token operator">*</span> <span class="token number">100</span>    <span class="token keyword">return</span> <span class="token string">"&#123;&#125;.&#123;:02d&#125;hPa"</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>pi<span class="token punctuation">,</span> pd<span class="token punctuation">)</span>  <span class="token decorator annotation punctuation">@property</span>  <span class="token keyword">def</span> <span class="token function">humidity</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token string">"Return the humidity in percent."</span>    h <span class="token operator">=</span> self<span class="token punctuation">.</span>read_humidity<span class="token punctuation">(</span><span class="token punctuation">)</span>    hi <span class="token operator">=</span> h <span class="token operator">//</span> <span class="token number">1024</span>    hd <span class="token operator">=</span> h <span class="token operator">*</span> <span class="token number">100</span> <span class="token operator">//</span> <span class="token number">1024</span> <span class="token operator">-</span> hi <span class="token operator">*</span> <span class="token number">100</span>    <span class="token keyword">return</span> <span class="token string">"&#123;&#125;.&#123;:02d&#125;%"</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>hi<span class="token punctuation">,</span> hd<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><hr><h2 id="試驗BMP280"><a href="#試驗BMP280" class="headerlink" title="試驗BMP280"></a>試驗BMP280</h2><h3 id="先試驗BMP280是否正常運作-如果OK就可加入WiFi和MQTT協定"><a href="#先試驗BMP280是否正常運作-如果OK就可加入WiFi和MQTT協定" class="headerlink" title="先試驗BMP280是否正常運作,如果OK就可加入WiFi和MQTT協定"></a>先試驗BMP280是否正常運作,如果OK就可加入WiFi和MQTT協定</h3><p>如果要測試bmp280</p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">from</span> machine <span class="token keyword">import</span> Pin<span class="token punctuation">,</span> SoftI2C<span class="token punctuation">,</span> reset<span class="token keyword">from</span> bmp280 <span class="token keyword">import</span> BMP280<span class="token keyword">from</span> time <span class="token keyword">import</span> sleep<span class="token keyword">from</span> umqttsimple <span class="token keyword">import</span> MQTTClient<span class="token keyword">import</span> ubinascii<span class="token punctuation">,</span> micropython<span class="token punctuation">,</span> network<span class="token punctuation">,</span> time<span class="token keyword">import</span> machine<span class="token punctuation">,</span> socketi2c <span class="token operator">=</span> SoftI2C<span class="token punctuation">(</span>sda <span class="token operator">=</span> Pin<span class="token punctuation">(</span><span class="token number">21</span><span class="token punctuation">)</span><span class="token punctuation">,</span> scl <span class="token operator">=</span> Pin<span class="token punctuation">(</span><span class="token number">22</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">def</span> read_bmp280<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    bmp <span class="token operator">=</span> BMP280<span class="token punctuation">(</span>i2c<span class="token punctuation">)</span>    temp <span class="token operator">=</span> bmp<span class="token punctuation">.</span>temperature    humi <span class="token operator">=</span> <span class="token number">1.8</span> <span class="token operator">*</span> temp <span class="token operator">+</span> <span class="token number">32</span>    pressure <span class="token operator">=</span> bmp<span class="token punctuation">.</span>pressure    <span class="token keyword">return</span> temp<span class="token punctuation">,</span> humi<span class="token punctuation">,</span> pressure<span class="token keyword">print</span><span class="token punctuation">(</span>read_bmp280<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><hr><h2 id="布署Node-RED"><a href="#布署Node-RED" class="headerlink" title="布署Node-RED"></a>布署Node-RED</h2><div class="video-container"><iframe src="https://www.youtube.com/embed/IHebAHN_E50" frameborder="0" loading="lazy" allowfullscreen></iframe></div><h2 id="完整程式碼"><a href="#完整程式碼" class="headerlink" title="完整程式碼"></a>完整程式碼</h2><pre class="line-numbers language-py" data-language="py"><code class="language-py"><span class="token keyword">from</span> machine <span class="token keyword">import</span> Pin<span class="token punctuation">,</span> SoftI2C<span class="token punctuation">,</span> reset<span class="token keyword">from</span> bmp280 <span class="token keyword">import</span> BMP280<span class="token keyword">from</span> time <span class="token keyword">import</span> sleep<span class="token keyword">from</span> umqttsimple <span class="token keyword">import</span> MQTTClient<span class="token keyword">import</span> ubinascii<span class="token punctuation">,</span> micropython<span class="token punctuation">,</span> network<span class="token punctuation">,</span> time<span class="token keyword">import</span> machine<span class="token punctuation">,</span> socket  ssid <span class="token operator">=</span> <span class="token string">"---"</span>password <span class="token operator">=</span> <span class="token string">"---"</span>mqtt_server <span class="token operator">=</span> <span class="token string">"---.---.--.--"</span><span class="token comment">#轉成獨熱碼</span>clinet_id <span class="token operator">=</span> ubinascii<span class="token punctuation">.</span>hexlify<span class="token punctuation">(</span>machine<span class="token punctuation">.</span>unique_id<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>client_temp <span class="token operator">=</span> <span class="token string">b'esp32/temp'</span>clinet_humi <span class="token operator">=</span> <span class="token string">b'esp32/humi'</span>clinet_pressure <span class="token operator">=</span> <span class="token string">b'esp32/pressure'</span>lastTime <span class="token operator">=</span> <span class="token number">0</span>currentTime <span class="token operator">=</span> time<span class="token punctuation">.</span>time<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token keyword">def</span> connectWifi<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    wifi <span class="token operator">=</span> network<span class="token punctuation">.</span>WLAN<span class="token punctuation">(</span>network<span class="token punctuation">.</span>STA_IF<span class="token punctuation">)</span>    wifi<span class="token punctuation">.</span>active<span class="token punctuation">(</span><span class="token boolean">True</span><span class="token punctuation">)</span>    wifi<span class="token punctuation">.</span>connect<span class="token punctuation">(</span>ssid<span class="token punctuation">,</span> password<span class="token punctuation">)</span>    <span class="token keyword">while</span> wifi<span class="token punctuation">.</span>isconnected<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token boolean">False</span><span class="token punctuation">:</span>            <span class="token keyword">pass</span>    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"connected successful"</span><span class="token punctuation">)</span>    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"IP: &#123;&#125;"</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>wifi<span class="token punctuation">.</span>ifconfig<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token keyword">def</span> conn_mqtt<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">global</span> mqtt_server<span class="token punctuation">,</span> clinet_id    <span class="token keyword">try</span><span class="token punctuation">:</span>        client <span class="token operator">=</span> MQTTClient<span class="token punctuation">(</span>clinet_id<span class="token punctuation">,</span> mqtt_server<span class="token punctuation">,</span> <span class="token number">1883</span><span class="token punctuation">)</span>        client<span class="token punctuation">.</span>connect<span class="token punctuation">(</span><span class="token punctuation">)</span>        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"connected to %s"</span><span class="token operator">%</span>mqtt_server<span class="token punctuation">)</span>        <span class="token keyword">return</span> client    <span class="token keyword">except</span> OSError <span class="token keyword">as</span> e<span class="token punctuation">:</span>        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"fialed connected MQTT!"</span><span class="token punctuation">)</span>        machine<span class="token punctuation">.</span>reset<span class="token punctuation">(</span><span class="token punctuation">)</span>i2c <span class="token operator">=</span> SoftI2C<span class="token punctuation">(</span>sda <span class="token operator">=</span> Pin<span class="token punctuation">(</span><span class="token number">21</span><span class="token punctuation">)</span><span class="token punctuation">,</span> scl <span class="token operator">=</span> Pin<span class="token punctuation">(</span><span class="token number">22</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">def</span> read_bmp280<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    bmp <span class="token operator">=</span> BMP280<span class="token punctuation">(</span>i2c<span class="token punctuation">)</span>    temp <span class="token operator">=</span> bmp<span class="token punctuation">.</span>temperature    humi <span class="token operator">=</span> <span class="token number">1.8</span> <span class="token operator">*</span> temp <span class="token operator">+</span> <span class="token number">32</span>    pressure <span class="token operator">=</span> bmp<span class="token punctuation">.</span>pressure    <span class="token keyword">return</span> temp<span class="token punctuation">,</span> humi<span class="token punctuation">,</span> pressure  connectWifi<span class="token punctuation">(</span><span class="token punctuation">)</span>client <span class="token operator">=</span> conn_mqtt<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token keyword">while</span> <span class="token boolean">True</span><span class="token punctuation">:</span>    temp<span class="token punctuation">,</span> humi<span class="token punctuation">,</span> pressure <span class="token operator">=</span> read_bmp280<span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token keyword">print</span><span class="token punctuation">(</span>temp<span class="token punctuation">,</span> humi<span class="token punctuation">,</span> pressure<span class="token punctuation">)</span>    client<span class="token punctuation">.</span>publish<span class="token punctuation">(</span>client_temp<span class="token punctuation">,</span> <span class="token builtin">str</span><span class="token punctuation">(</span>temp<span class="token punctuation">)</span><span class="token punctuation">)</span>    client<span class="token punctuation">.</span>publish<span class="token punctuation">(</span>clinet_humi<span class="token punctuation">,</span> <span class="token builtin">str</span><span class="token punctuation">(</span>humi<span class="token punctuation">)</span><span class="token punctuation">)</span>    client<span class="token punctuation">.</span>publish<span class="token punctuation">(</span>clinet_pressure<span class="token punctuation">,</span> <span class="token builtin">str</span><span class="token punctuation">(</span>pressure<span class="token punctuation">)</span><span class="token punctuation">)</span>    sleep<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><hr><h2 id="解析"><a href="#解析" class="headerlink" title="解析"></a>解析</h2><p>匯入所須的程式庫</p><pre class="line-numbers language-py" data-language="py"><code class="language-py"><span class="token keyword">from</span> machine <span class="token keyword">import</span> Pin<span class="token punctuation">,</span> SoftI2C<span class="token punctuation">,</span> reset<span class="token keyword">from</span> bmp280 <span class="token keyword">import</span> BMP280<span class="token keyword">from</span> time <span class="token keyword">import</span> sleep<span class="token keyword">from</span> umqttsimple <span class="token keyword">import</span> MQTTClient<span class="token keyword">import</span> ubinascii<span class="token punctuation">,</span> micropython<span class="token punctuation">,</span> network<span class="token punctuation">,</span> time<span class="token keyword">import</span> machine<span class="token punctuation">,</span> socket<span class="token comment">#設定基地台名稱和密碼</span><span class="token comment">#mqtt_server的ip(也就是樹苺派的ip)</span>ssid <span class="token operator">=</span> <span class="token string">"---"</span>password <span class="token operator">=</span> <span class="token string">"---"</span>mqtt_server <span class="token operator">=</span> <span class="token string">"192.168.--.--"</span><span class="token comment">#轉成獨熱碼</span>clinet_id <span class="token operator">=</span> ubinascii<span class="token punctuation">.</span>hexlify<span class="token punctuation">(</span>machine<span class="token punctuation">.</span>unique_id<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">#和Nord-RED上的標簽名稱一致</span>client_temp <span class="token operator">=</span> <span class="token string">b'esp32/temp'</span>clinet_humi <span class="token operator">=</span> <span class="token string">b'esp32/humi'</span>clinet_pressure <span class="token operator">=</span> <span class="token string">b'esp32/pressure'</span><span class="token comment">#WIFI連結</span><span class="token keyword">def</span> connectWifi<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    wifi <span class="token operator">=</span> network<span class="token punctuation">.</span>WLAN<span class="token punctuation">(</span>network<span class="token punctuation">.</span>STA_IF<span class="token punctuation">)</span>    wifi<span class="token punctuation">.</span>active<span class="token punctuation">(</span><span class="token boolean">True</span><span class="token punctuation">)</span>    wifi<span class="token punctuation">.</span>connect<span class="token punctuation">(</span>ssid<span class="token punctuation">,</span> password<span class="token punctuation">)</span>    <span class="token keyword">while</span> wifi<span class="token punctuation">.</span>isconnected<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token boolean">False</span><span class="token punctuation">:</span>            <span class="token keyword">pass</span>    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"connected successful"</span><span class="token punctuation">)</span>    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"IP: &#123;&#125;"</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>wifi<span class="token punctuation">.</span>ifconfig<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token comment">#MQTT伺服器連結</span><span class="token keyword">def</span> conn_mqtt<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">global</span> mqtt_server<span class="token punctuation">,</span> clinet_id    <span class="token keyword">try</span><span class="token punctuation">:</span>        client <span class="token operator">=</span> MQTTClient<span class="token punctuation">(</span>clinet_id<span class="token punctuation">,</span> mqtt_server<span class="token punctuation">,</span> <span class="token number">1883</span><span class="token punctuation">)</span>        client<span class="token punctuation">.</span>connect<span class="token punctuation">(</span><span class="token punctuation">)</span>        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"connected to %s"</span><span class="token operator">%</span>mqtt_server<span class="token punctuation">)</span>        <span class="token keyword">return</span> client    <span class="token keyword">except</span> OSError <span class="token keyword">as</span> e<span class="token punctuation">:</span>        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"fialed connected MQTT!"</span><span class="token punctuation">)</span>        machine<span class="token punctuation">.</span>reset<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token comment">#BMP280偵測       </span>i2c <span class="token operator">=</span> SoftI2C<span class="token punctuation">(</span>sda <span class="token operator">=</span> Pin<span class="token punctuation">(</span><span class="token number">21</span><span class="token punctuation">)</span><span class="token punctuation">,</span> scl <span class="token operator">=</span> Pin<span class="token punctuation">(</span><span class="token number">22</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">def</span> read_bmp280<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    bmp <span class="token operator">=</span> BMP280<span class="token punctuation">(</span>i2c<span class="token punctuation">)</span>    temp <span class="token operator">=</span> bmp<span class="token punctuation">.</span>temperature    humi <span class="token operator">=</span> <span class="token number">1.8</span> <span class="token operator">*</span> temp <span class="token operator">+</span> <span class="token number">32</span>    pressure <span class="token operator">=</span> bmp<span class="token punctuation">.</span>pressure    <span class="token keyword">return</span> temp<span class="token punctuation">,</span> humi<span class="token punctuation">,</span> pressureconnectWifi<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">#WIFI連結函式</span>client <span class="token operator">=</span> conn_mqtt<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token comment">#偵測到的數據透過MQTT發送到Nord-RED</span><span class="token keyword">while</span> <span class="token boolean">True</span><span class="token punctuation">:</span>    temp<span class="token punctuation">,</span> humi<span class="token punctuation">,</span> pressure <span class="token operator">=</span> read_bmp280<span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token keyword">print</span><span class="token punctuation">(</span>temp<span class="token punctuation">,</span> humi<span class="token punctuation">,</span> pressure<span class="token punctuation">)</span>    client<span class="token punctuation">.</span>publish<span class="token punctuation">(</span>client_temp<span class="token punctuation">,</span> <span class="token builtin">str</span><span class="token punctuation">(</span>temp<span class="token punctuation">)</span><span class="token punctuation">)</span>    client<span class="token punctuation">.</span>publish<span class="token punctuation">(</span>clinet_humi<span class="token punctuation">,</span> <span class="token builtin">str</span><span class="token punctuation">(</span>humi<span class="token punctuation">)</span><span class="token punctuation">)</span>    client<span class="token punctuation">.</span>publish<span class="token punctuation">(</span>clinet_pressure<span class="token punctuation">,</span> <span class="token builtin">str</span><span class="token punctuation">(</span>pressure<span class="token punctuation">)</span><span class="token punctuation">)</span>    sleep<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><img src="https://i.imgur.com/neAbxPw.png"></p>]]></content>
      
      
      <categories>
          
          <category> micropython </category>
          
          <category> esp32 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> bmp280 </tag>
            
            <tag> mqtt </tag>
            
            <tag> node-red </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>webserver控制伺服馬達-ESP32</title>
      <link href="/2021/08/30/webserver-kong-zhi-si-fu-ma-da-esp32/"/>
      <url>/2021/08/30/webserver-kong-zhi-si-fu-ma-da-esp32/</url>
      
        <content type="html"><![CDATA[<h1 id="webserver控制伺服馬達-ESP32"><a href="#webserver控制伺服馬達-ESP32" class="headerlink" title="webserver控制伺服馬達-ESP32"></a>webserver控制伺服馬達-ESP32</h1><p><em>伺服馬達對於微控板玩家一定是再熟悉不過，也是入門必學的元件之一，只是特別要注意如果要控制２個以上的伺服馬達，一定要使用外接電源或者PCA9685。</em></p><p><em>伺服馬達有很多款，小型常用的就屬SG-90，它是塑膠齒輪，還有一種是金屬齒輪</em></p><h2 id="伺服馬達規格"><a href="#伺服馬達規格" class="headerlink" title="伺服馬達規格"></a>伺服馬達規格</h2><h3 id="SG-90規格"><a href="#SG-90規格" class="headerlink" title="SG-90規格"></a>SG-90規格</h3><p><a href="https://draft.blogger.com/blog/post/edit/3809681606094011522/3986922455798592262?hl=zh-TW#"><img src="https://1.bp.blogspot.com/-nxgapjbWx68/YSXYndzzCVI/AAAAAAAAe2s/qsMvSksBD3YRlIHAnQ1wzBKyuROmzx90wCNcBGAsYHQ/w233-h233/dc05cb93dcb58dbc3887b14f60cced9f.jpg"></a></p><ul><li>  工作電壓：4.8V.</li><li>  轉矩：1.8kg-cm</li><li>  運轉速度：0.1秒∕ 60度</li><li>  轉動角度：最大90°</li><li>脈衝寬度範圍：500~2400µs.</li></ul><h3 id="MG90S規格"><a href="#MG90S規格" class="headerlink" title="MG90S規格"></a>MG90S規格</h3><p><a href="https://draft.blogger.com/blog/post/edit/3809681606094011522/3986922455798592262?hl=zh-TW#"><img src="https://1.bp.blogspot.com/-ClUAItIjGJ4/YSXY8XrU1pI/AAAAAAAAe20/pIH_GpNA5Cgnlsx45QZJ1nlS6Uu6_xsdACNcBGAsYHQ/w273-h273/180303000000b-800x800.jpg"></a></p><ul><li>  金屬銅齒、空心杯電機、雙滾珠軸承</li><li>  產品型號：<strong>MG90s</strong>.</li><li>  扭力：2.0kg(4.8v)</li><li>  運轉速度：0.11s(4.8v)</li><li>  轉動角度：最大90°/180°</li><li>舵機類型：數字舵機</li></ul><hr><ol><li> <em>此次實驗以MG-90為主</em></li><li> <em>要控制伺服馬達有兩種方式，一種是利用PWM，另一種是使用現有的庫包來控制，本次實驗以庫包為主</em></li></ol><h2 id="首先安裝"><a href="#首先安裝" class="headerlink" title="首先安裝"></a>首先安裝</h2><p> <a href="https://draft.blogger.com/blog/post/edit/3809681606094011522/3986922455798592262?hl=zh-TW#">ESP32 Arduino Servo Library</a></p><h2 id="接線方式"><a href="#接線方式" class="headerlink" title="接線方式"></a>接線方式</h2><ul><li><p>  GND -&gt; ESP32 GND pin;</p></li><li><p>  Power -&gt; ESP32 VIN pin;</p></li><li><p>Signal -&gt; GPIO 13 (or any PWM pin).</p><p>  <a href="https://draft.blogger.com/blog/post/edit/3809681606094011522/3986922455798592262?hl=zh-TW#"><img src="https://i1.wp.com/randomnerdtutorials.com/wp-content/uploads/2018/05/servo-esp32-schematic.png?w=750&quality=100&strip=all&ssl=1"></a></p></li></ul><h2 id="進行實驗"><a href="#進行實驗" class="headerlink" title="進行實驗"></a>進行實驗</h2><pre class="line-numbers language-cpp" data-language="cpp"><code class="language-cpp"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;ESP32Servo.h></span></span> Servo myservo<span class="token punctuation">;</span> <span class="token keyword">int</span> pos <span class="token operator">=</span> <span class="token number">20</span><span class="token punctuation">;</span><span class="token keyword">const</span> <span class="token keyword">int</span> pin <span class="token operator">=</span> <span class="token number">12</span><span class="token punctuation">;</span> <span class="token keyword">void</span> <span class="token function">setup</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>  Serial<span class="token punctuation">.</span><span class="token function">begin</span><span class="token punctuation">(</span><span class="token number">115200</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  myservo<span class="token punctuation">.</span><span class="token function">attach</span><span class="token punctuation">(</span>pin<span class="token punctuation">,</span> <span class="token number">500</span><span class="token punctuation">,</span> <span class="token number">2400</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span> <span class="token keyword">void</span> <span class="token function">loop</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>  <span class="token keyword">for</span> <span class="token punctuation">(</span>pos<span class="token operator">=</span><span class="token number">20</span><span class="token punctuation">;</span> pos<span class="token operator">&lt;=</span><span class="token number">160</span><span class="token punctuation">;</span> pos<span class="token operator">+=</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    myservo<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span>pos<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token function">delay</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token punctuation">&#125;</span>  <span class="token keyword">for</span> <span class="token punctuation">(</span>pos<span class="token operator">=</span><span class="token number">160</span><span class="token punctuation">;</span> pos<span class="token operator">>=</span><span class="token number">20</span><span class="token punctuation">;</span> pos<span class="token operator">-=</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    myservo<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span>pos<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token function">delay</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><hr><h2 id="ESP32網頁伺服器"><a href="#ESP32網頁伺服器" class="headerlink" title="ESP32網頁伺服器"></a>ESP32網頁伺服器</h2><p><em>上面伺服馬達簡單的測試完成後，就可以納入網頁伺服器來控制伺服馬達，這裡我覺得有點難度的是網頁的編寫，因為寫HTML+CSS我沒學過，所以參考網路上教學文的網頁範例。</em></p><p><em>這是我參考教學網站上的網頁範例</em></p><pre class="line-numbers language-html" data-language="html"><code class="language-html"><span class="token doctype"><span class="token punctuation">&lt;!</span><span class="token doctype-tag">DOCTYPE</span> <span class="token name">html</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>viewport<span class="token punctuation">"</span></span> <span class="token attr-name">content</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>width=device-width, initial-scale=1<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>link</span> <span class="token attr-name">rel</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>icon<span class="token punctuation">"</span></span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>data:,<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>style</span><span class="token punctuation">></span></span><span class="token style"><span class="token language-css">    <span class="token selector">body</span> <span class="token punctuation">&#123;</span>        <span class="token property">text-align</span><span class="token punctuation">:</span> center<span class="token punctuation">;</span>        <span class="token property">font-family</span><span class="token punctuation">:</span> <span class="token string">"Trebuchet MS"</span><span class="token punctuation">,</span> Arial<span class="token punctuation">;</span>        <span class="token property">margin-left</span><span class="token punctuation">:</span>auto<span class="token punctuation">;</span>        <span class="token property">margin-right</span><span class="token punctuation">:</span>auto<span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token selector">.slider</span> <span class="token punctuation">&#123;</span>        <span class="token property">width</span><span class="token punctuation">:</span> 300px<span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    </span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>style</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token script"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>head</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h1</span><span class="token punctuation">></span></span>ESP32 with Servo<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h1</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">></span></span>Position: <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>span</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>servoPos<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>span</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>range<span class="token punctuation">"</span></span> <span class="token attr-name">min</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>0<span class="token punctuation">"</span></span> <span class="token attr-name">max</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>180<span class="token punctuation">"</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>slider<span class="token punctuation">"</span></span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>servoSlider<span class="token punctuation">"</span></span> <span class="token special-attr"><span class="token attr-name">onchange</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span><span class="token value javascript language-javascript"><span class="token function">servo</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>value<span class="token punctuation">)</span></span><span class="token punctuation">"</span></span></span><span class="token punctuation">/></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">></span></span><span class="token script"><span class="token language-javascript">    <span class="token keyword">var</span> slider <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">"servoSlider"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">var</span> servoP <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">"servoPos"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    servoP<span class="token punctuation">.</span>innerHTML <span class="token operator">=</span> slider<span class="token punctuation">.</span>value<span class="token punctuation">;</span>    slider<span class="token punctuation">.</span><span class="token function-variable function">oninput</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        slider<span class="token punctuation">.</span>value <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>value<span class="token punctuation">;</span>        servoP<span class="token punctuation">.</span>innerHTML <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>value<span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    $<span class="token punctuation">.</span><span class="token function">ajaxSetup</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span>timeout<span class="token operator">:</span><span class="token number">1000</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">function</span> <span class="token function">servo</span><span class="token punctuation">(</span><span class="token parameter">pos</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        $<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">"/?value="</span> <span class="token operator">+</span> pos <span class="token operator">+</span> <span class="token string">"&amp;"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#123;</span>Connection<span class="token operator">:</span> close<span class="token punctuation">&#125;</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    </span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><hr><p><em>使用 script 和 /script 標籤將一些 JavaScript 代碼添加到您的 HTML 文件中。此代碼片段使用當前滑塊位置更新網頁</em></p><pre class="line-numbers language-cpp" data-language="cpp"><code class="language-cpp">var slider <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">"servoSlider"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>var servoP <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">"servoPos"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>servoP<span class="token punctuation">.</span>innerHTML <span class="token operator">=</span> slider<span class="token punctuation">.</span>value<span class="token punctuation">;</span>slider<span class="token punctuation">.</span>oninput <span class="token operator">=</span> <span class="token function">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    slider<span class="token punctuation">.</span>value <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>value<span class="token punctuation">;</span>    servoP<span class="token punctuation">.</span>innerHTML <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>value<span class="token punctuation">;</span><span class="token punctuation">&#125;</span>  <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>接下來的幾行在此特定 URL 路徑 /?value\u003d[SLIDER_POSITION]&amp; 中的 ESP IP 地址上發出 HTTP GET 請求。</p><pre class="line-numbers language-cpp" data-language="cpp"><code class="language-cpp">$<span class="token punctuation">.</span><span class="token function">ajaxSetup</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span>timeout<span class="token operator">:</span><span class="token number">1000</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>function <span class="token function">servo</span><span class="token punctuation">(</span>pos<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    $<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">"/?value="</span> <span class="token operator">+</span> pos <span class="token operator">+</span> <span class="token string">"&amp;"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#123;</span>Connection<span class="token operator">:</span> close<span class="token punctuation">&#125;</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>例如，當滑塊位於 0 時，您在以下 URL 上發出 HTTP GET 請求：</p><pre class="line-numbers language-none"><code class="language-none">http:&#x2F;&#x2F;192.168.1.135&#x2F;?value&#x3D;0&amp;<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><hr><h2 id="完整程式碼"><a href="#完整程式碼" class="headerlink" title="完整程式碼"></a>完整程式碼</h2><pre class="line-numbers language-cpp" data-language="cpp"><code class="language-cpp"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;ESP32Servo.h></span></span><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;WiFi.h></span></span> <span class="token comment">//定義伺服馬達</span>Servo myservo<span class="token punctuation">;</span> <span class="token comment">//伺服馬達的起始值和腳位</span><span class="token keyword">int</span> pos <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span><span class="token keyword">const</span> <span class="token keyword">int</span> servoPin <span class="token operator">=</span> <span class="token number">12</span><span class="token punctuation">;</span> <span class="token comment">//WIFI</span><span class="token keyword">const</span> <span class="token keyword">char</span> <span class="token operator">*</span>ssid <span class="token operator">=</span> <span class="token string">"---"</span><span class="token punctuation">;</span><span class="token keyword">const</span> <span class="token keyword">char</span> <span class="token operator">*</span>password <span class="token operator">=</span> <span class="token string">"-----"</span><span class="token punctuation">;</span><span class="token comment">//將 Web 服務器端口號設置為 80</span>WiFiServer <span class="token function">server</span><span class="token punctuation">(</span><span class="token number">80</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//用於存儲 HTTP 請求的變量</span>String header<span class="token punctuation">;</span> <span class="token comment">//解碼 HTTP GET 值</span>String valueString <span class="token operator">=</span> <span class="token function">String</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">int</span> pos1 <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span><span class="token keyword">int</span> pos2 <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> <span class="token comment">// 當下的時間</span><span class="token keyword">unsigned</span> <span class="token keyword">long</span> currentTime <span class="token operator">=</span> <span class="token function">millis</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// 之前的時間</span><span class="token keyword">unsigned</span> <span class="token keyword">long</span> previousTime <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> <span class="token comment">// 超時</span><span class="token keyword">const</span> <span class="token keyword">long</span> timeoutTime <span class="token operator">=</span> <span class="token number">2000</span><span class="token punctuation">;</span> <span class="token keyword">void</span> <span class="token function">setup</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>  Serial<span class="token punctuation">.</span><span class="token function">begin</span><span class="token punctuation">(</span><span class="token number">115200</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">//指定伺服器上的pin</span>  myservo<span class="token punctuation">.</span><span class="token function">attach</span><span class="token punctuation">(</span>servoPin<span class="token punctuation">,</span> <span class="token number">500</span><span class="token punctuation">,</span> <span class="token number">2400</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">//連接wifi</span>  WiFi<span class="token punctuation">.</span><span class="token function">begin</span><span class="token punctuation">(</span>ssid<span class="token punctuation">,</span> password<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token keyword">while</span> <span class="token punctuation">(</span>WiFi<span class="token punctuation">.</span><span class="token function">isConnected</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    Serial<span class="token punctuation">.</span><span class="token function">print</span><span class="token punctuation">(</span><span class="token string">"."</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token function">delay</span><span class="token punctuation">(</span><span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token punctuation">&#125;</span>  Serial<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"Connected successful!"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  Serial<span class="token punctuation">.</span><span class="token function">print</span><span class="token punctuation">(</span><span class="token string">"IP: "</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  Serial<span class="token punctuation">.</span><span class="token function">print</span><span class="token punctuation">(</span>WiFi<span class="token punctuation">.</span><span class="token function">localIP</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">//連接伺服器</span>  server<span class="token punctuation">.</span><span class="token function">begin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span> <span class="token keyword">void</span> <span class="token function">loop</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>  <span class="token comment">//監聽客戶端傳入的資料</span>  WiFiClient client <span class="token operator">=</span> server<span class="token punctuation">.</span><span class="token function">available</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">//如果有新客戶端連接進來,</span>  <span class="token keyword">if</span> <span class="token punctuation">(</span>client<span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    currentTime <span class="token operator">=</span> <span class="token function">millis</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    previousTime <span class="token operator">=</span> currentTime<span class="token punctuation">;</span>    Serial<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"New Client."</span><span class="token punctuation">)</span><span class="token punctuation">;</span>         <span class="token comment">//製作一個字符串來保存來自客戶端的傳入數據</span>    String currentLine <span class="token operator">=</span> <span class="token string">""</span><span class="token punctuation">;</span>    <span class="token keyword">while</span> <span class="token punctuation">(</span>client<span class="token punctuation">.</span><span class="token function">connected</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token punctuation">(</span>currentTime <span class="token operator">-</span> previousTime <span class="token operator">&lt;=</span> <span class="token number">2000</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>      currentTime <span class="token operator">=</span> <span class="token function">millis</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token keyword">if</span> <span class="token punctuation">(</span>client<span class="token punctuation">.</span><span class="token function">available</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span> <span class="token comment">//如果有字節要從客戶端讀取，</span>        <span class="token keyword">char</span> c <span class="token operator">=</span> client<span class="token punctuation">.</span><span class="token function">read</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//讀取字節</span>        Serial<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span>c<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//印到序列監測窗口</span>        header <span class="token operator">+=</span> c<span class="token punctuation">;</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span>c <span class="token operator">==</span> <span class="token string">'\n'</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span> <span class="token comment">//如果字節是換行符 //如果當前行為空，則表示一行中有兩個換行符。</span>          <span class="token comment">//這是客戶端 HTTP 請求的結束，因此發送響應：</span>          <span class="token keyword">if</span> <span class="token punctuation">(</span>currentLine<span class="token punctuation">.</span><span class="token function">length</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>            client<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"HTTP/1.1 200 OK"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            client<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"Content-type:text/html; charset=utf-8"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            client<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"Connection: close"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            client<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token comment">//接下來就是顯示網頁</span>            client<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"&lt;!DOCTYPE html>&lt;html>"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            client<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"&lt;head>&lt;meta name=\"viewport\" content=\"width=device-width, initial-scale=1\">"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            client<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"&lt;link rel=\"icon\" href=\"data:,\">"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            client<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"&lt;style>body &#123; text-align: center; font-family: \"Trebuchet MS\", Arial; margin-left:auto; margin-right:auto;&#125;"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            client<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">".slider &#123; width: 300px; &#125;&lt;/style>"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            client<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"&lt;script src=\"https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js\">&lt;/script>"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                                 <span class="token comment">// Web Page</span>            client<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"&lt;/head>&lt;body>&lt;h1>ESP32 控制伺服馬達練習&lt;/h1>"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            client<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"&lt;p>Position: &lt;span id=\"servoPos\">&lt;/span>&lt;/p>"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                      client<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"&lt;input type=\"range\" min=\"0\" max=\"180\" class=\"slider\" id=\"servoSlider\" onchange=\"servo(this.value)\" value=\""</span><span class="token operator">+</span>valueString<span class="token operator">+</span><span class="token string">"\"/>"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                        client<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"&lt;script>var slider = document.getElementById(\"servoSlider\");"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            client<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"var servoP = document.getElementById(\"servoPos\"); servoP.innerHTML = slider.value;"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            client<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"slider.oninput = function() &#123; slider.value = this.value; servoP.innerHTML = this.value; &#125;"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            client<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"$.ajaxSetup(&#123;timeout:1000&#125;); function servo(pos) &#123; "</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            client<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"$.get(\"/?value=\" \+ pos + \"&amp;\"); &#123;Connection: close&#125;;&#125;&lt;/script>"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                       client<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"&lt;/body>&lt;/html>"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token comment">//GET /?value=180&amp; HTTP/1.1</span>            <span class="token keyword">if</span><span class="token punctuation">(</span>header<span class="token punctuation">.</span><span class="token function">indexOf</span><span class="token punctuation">(</span><span class="token string">"GET /?value="</span><span class="token punctuation">)</span><span class="token operator">>=</span><span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>              pos1 <span class="token operator">=</span> header<span class="token punctuation">.</span><span class="token function">indexOf</span><span class="token punctuation">(</span><span class="token string">'='</span><span class="token punctuation">)</span><span class="token punctuation">;</span>              pos2 <span class="token operator">=</span> header<span class="token punctuation">.</span><span class="token function">indexOf</span><span class="token punctuation">(</span><span class="token string">'&amp;'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>              <span class="token comment">//取得=和&amp;之中的字節</span>              valueString <span class="token operator">=</span> header<span class="token punctuation">.</span><span class="token function">substring</span><span class="token punctuation">(</span>pos1<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">,</span> pos2<span class="token punctuation">)</span><span class="token punctuation">;</span>                            <span class="token comment">//轉換成整數後傳入伺服馬達令其動作</span>              myservo<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span>valueString<span class="token punctuation">.</span><span class="token function">toInt</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>              <span class="token function">delay</span><span class="token punctuation">(</span><span class="token number">15</span><span class="token punctuation">)</span><span class="token punctuation">;</span>              Serial<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>valueString<span class="token punctuation">)</span><span class="token punctuation">;</span>             <span class="token punctuation">&#125;</span>                     <span class="token comment">// The HTTP response ends with another blank line</span>            client<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token keyword">break</span><span class="token punctuation">;</span>          <span class="token punctuation">&#125;</span><span class="token keyword">else</span> <span class="token punctuation">&#123;</span> <span class="token comment">//如果有一個換行符，就清除 currentLine</span>            currentLine <span class="token operator">=</span> <span class="token string">""</span><span class="token punctuation">;</span>          <span class="token punctuation">&#125;</span>        <span class="token punctuation">&#125;</span><span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>c <span class="token operator">!=</span> <span class="token string">'\r'</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span> <span class="token comment">//否則如果除了enter以外還有別的字串,把它加入currentLine末端</span>          currentLine <span class="token operator">+=</span> c<span class="token punctuation">;</span>         <span class="token punctuation">&#125;</span>      <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span>    <span class="token comment">// 將header清空</span>    header <span class="token operator">=</span> <span class="token string">""</span><span class="token punctuation">;</span>    <span class="token comment">// 關閉連結</span>    client<span class="token punctuation">.</span><span class="token function">stop</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    Serial<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"Client disconnected."</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    Serial<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">""</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><div class="video-container"><iframe src="https://www.youtube.com/embed/noDl7zL7hIM" frameborder="0" loading="lazy" allowfullscreen></iframe></div>]]></content>
      
      
      <categories>
          
          <category> esp32 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> webserver </tag>
            
            <tag> servo </tag>
            
            <tag> 伺服馬達 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>webServer控制neopixel燈條-ESP32</title>
      <link href="/2021/08/30/webserver-kong-zhi-neopixel-deng-tiao-esp32/"/>
      <url>/2021/08/30/webserver-kong-zhi-neopixel-deng-tiao-esp32/</url>
      
        <content type="html"><![CDATA[<h1 id="webServer控制RGB-LED-ESP32"><a href="#webServer控制RGB-LED-ESP32" class="headerlink" title="webServer控制RGB_LED-ESP32"></a>webServer控制RGB_LED-ESP32</h1><h6 id="tags-esp32-rbg-webserver"><a href="#tags-esp32-rbg-webserver" class="headerlink" title="tags: esp32 rbg webserver"></a>tags: <code>esp32</code> <code>rbg</code> <code>webserver</code></h6><p><strong>這個項目還有點模糊,但就我的理解還是先紀錄下來</strong></p><p>**</p><p><a href="https://draft.blogger.com/blog/post/edit/3809681606094011522/7721744657667049248?hl=zh-TW#"><img src="https://lh3.googleusercontent.com/-EGRdbV6myKU/YSMGxtZ4WBI/AAAAAAAAe2I/kzc_LU3nZIQf1s_6QrPwHXVFcsKIayS5wCNcBGAsYHQ/s1600/1629685406049224-0.png"></a></p><p>**</p><p><strong>參考-<a href="https://draft.blogger.com/blog/post/edit/3809681606094011522/7721744657667049248?hl=zh-TW#">https://randomnerdtutorials.com/esp32-esp8266-rgb-led-strip-web-server/</a></strong></p><h2 id="控制流程"><a href="#控制流程" class="headerlink" title="控制流程"></a>控制流程</h2><p><a href="https://draft.blogger.com/blog/post/edit/3809681606094011522/7721744657667049248?hl=zh-TW#"><img src="https://i1.wp.com/randomnerdtutorials.com/wp-content/uploads/2019/03/color-picker-overview.png?w=750&quality=100&strip=all&ssl=1"></a></p><p><em><strong>ESP32網絡服務器顯示一個顏色選擇器。<br>選擇顏色後，瀏覽器會向包含所選顏色的 R、G 和 B 參數的 URL 發出請求。<br>ESP32接收請求並拆分每個顏色參數的值。<br>然後，它向控制條帶的 GPIO 發送具有相應值的 PWM 信號。</strong></em></p><p> <strong>如果燈條是使用8顆LED以上,要另外加5V電源獨立供電</strong></p><p>**</p><p><a href="https://draft.blogger.com/blog/post/edit/3809681606094011522/7721744657667049248?hl=zh-TW#"><img src="https://i0.wp.com/randomnerdtutorials.com/wp-content/uploads/2019/03/ESP32-LED-strip-schematic_f.png?w=445&quality=100&strip=all&ssl=1"></a></p><hr><h2 id="程式碼"><a href="#程式碼" class="headerlink" title="程式碼"></a>程式碼</h2><pre class="line-numbers language-cpp" data-language="cpp"><code class="language-cpp"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;WiFi.h></span></span><span class="token comment">//設定wifi帳密</span><span class="token keyword">const</span> <span class="token keyword">char</span><span class="token operator">*</span> ssid <span class="token operator">=</span> <span class="token string">"---"</span><span class="token punctuation">;</span><span class="token keyword">const</span> <span class="token keyword">char</span><span class="token operator">*</span> password <span class="token operator">=</span> <span class="token string">"----------"</span><span class="token punctuation">;</span><span class="token comment">//設定網路伺服器的port</span>WiFiServer <span class="token function">server</span><span class="token punctuation">(</span><span class="token number">80</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//rgb的對應到網路的初始值</span>String redString <span class="token operator">=</span> <span class="token string">"0"</span><span class="token punctuation">;</span>String greenString <span class="token operator">=</span> <span class="token string">"0"</span><span class="token punctuation">;</span>String blueString <span class="token operator">=</span> <span class="token string">"0"</span><span class="token punctuation">;</span><span class="token keyword">int</span> pos1 <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span><span class="token keyword">int</span> pos2 <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span><span class="token keyword">int</span> pos3 <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span><span class="token keyword">int</span> pos4 <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span><span class="token comment">//儲存http請求的變量</span>String header<span class="token punctuation">;</span>  <span class="token comment">//RGB的PIN</span><span class="token keyword">const</span> <span class="token keyword">int</span> Rpin <span class="token operator">=</span> <span class="token number">13</span><span class="token punctuation">;</span><span class="token keyword">const</span> <span class="token keyword">int</span> Gpin <span class="token operator">=</span> <span class="token number">12</span><span class="token punctuation">;</span><span class="token keyword">const</span> <span class="token keyword">int</span> Bpin <span class="token operator">=</span> <span class="token number">14</span><span class="token punctuation">;</span><span class="token comment">//設定時間</span><span class="token keyword">unsigned</span> <span class="token keyword">long</span> previousTime <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span><span class="token keyword">unsigned</span> <span class="token keyword">long</span> currenTime <span class="token operator">=</span> <span class="token function">millis</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">void</span> <span class="token function">setup</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    Serial<span class="token punctuation">.</span><span class="token function">begin</span><span class="token punctuation">(</span><span class="token number">115200</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment">//配置 LED PWM 功能</span>    <span class="token function">ledcSetup</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">5000</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token function">ledcSetup</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">5000</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token function">ledcSetup</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">5000</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token function">ledcAttachPin</span><span class="token punctuation">(</span>Rpin<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token function">ledcAttachPin</span><span class="token punctuation">(</span>Gpin<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token function">ledcAttachPin</span><span class="token punctuation">(</span>Bpin<span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment">//帶入網路連線</span>    WiFi<span class="token punctuation">.</span><span class="token function">begin</span><span class="token punctuation">(</span>ssid<span class="token punctuation">,</span> password<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">while</span> <span class="token punctuation">(</span>WiFi<span class="token punctuation">.</span><span class="token function">status</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">!=</span> WL_CONNECTED<span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        Serial<span class="token punctuation">.</span><span class="token function">print</span><span class="token punctuation">(</span><span class="token string">"."</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token function">delay</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    Serial<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"WiFi connceted success"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    Serial<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>WiFi<span class="token punctuation">.</span><span class="token function">localIP</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    server<span class="token punctuation">.</span><span class="token function">begin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span>  <span class="token keyword">void</span> <span class="token function">loop</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    WiFiClient client <span class="token operator">=</span> server<span class="token punctuation">.</span><span class="token function">available</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span>client<span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        currenTime <span class="token operator">=</span> <span class="token function">millis</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        previousTime <span class="token operator">=</span> currenTime<span class="token punctuation">;</span>        String currentLine <span class="token operator">=</span> <span class="token string">""</span><span class="token punctuation">;</span>         <span class="token keyword">while</span> <span class="token punctuation">(</span>client<span class="token punctuation">.</span><span class="token function">connected</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> currenTime <span class="token operator">-</span> previousTime <span class="token operator">&lt;=</span> <span class="token number">2000</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>            currenTime <span class="token operator">=</span> <span class="token function">millis</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token keyword">if</span> <span class="token punctuation">(</span>client<span class="token punctuation">.</span><span class="token function">available</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>                <span class="token keyword">char</span> c <span class="token operator">=</span> client<span class="token punctuation">.</span><span class="token function">read</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                Serial<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span>c<span class="token punctuation">)</span><span class="token punctuation">;</span>                header <span class="token operator">+=</span> c<span class="token punctuation">;</span>                <span class="token keyword">if</span> <span class="token punctuation">(</span>c <span class="token operator">==</span> <span class="token string">'\\n'</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>                    <span class="token comment">//如果字串等於0表示接收完成</span>                    <span class="token keyword">if</span> <span class="token punctuation">(</span>currentLine<span class="token punctuation">.</span><span class="token function">length</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>                        client<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"HTTP/1.1 200 OK"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                        client<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"Content-type:text/html"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                        client<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"Connection: close"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                        client<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                        <span class="token comment">// 以下網頁的部份目前對我來說難度有點高,尤其調色部份,暫借用學習對象的範例</span>                        <span class="token comment">// Display the HTML web page</span>                        client<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"&lt;!DOCTYPE html>&lt;html>"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                        client<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"&lt;head>&lt;meta name=\"viewport\" content=\"width=device-width, initial-scale=1\">"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                        client<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"&lt;link rel=\"icon\" href=\"data:,\">"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                        client<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"&lt;link rel=\"stylesheet\" href=\"https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css\">"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                        client<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"&lt;script src=\"https://cdnjs.cloudflare.com/ajax/libs/jscolor/2.0.4/jscolor.min.js\">&lt;/script>"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                        client<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"&lt;/head>&lt;body>&lt;div class=\"container\">&lt;div class=\"row\">&lt;h1>ESP Color Picker&lt;/h1>&lt;/div>"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                        client<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"&lt;a class=\"btn btn-primary btn-lg\" href=\"#\" id=\"change_color\" role=\"button\">Change Color&lt;/a> "</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                        client<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"&lt;input class=\"jscolor &#123;onFineChange:'update(this)'&#125;\" id=\"rgb\">&lt;/div>"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                        client<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"&lt;script>function update(picker) &#123;document.getElementById('rgb').innerHTML = Math.round(picker.rgb[0]) + ', ' +  Math.round(picker.rgb[1]) + ', ' + Math.round(picker.rgb[2]);"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                        client<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"document.getElementById(\\"</span>change_color\\<span class="token string">").href=\\"</span><span class="token operator">?</span>r\\<span class="token string">" + Math.round(picker.rgb[0]) + \"g\" +  Math.round(picker.rgb[1]) + \"b\" + Math.round(picker.rgb[2]) + \"&amp;\";&#125;&lt;/script>&lt;/body>&lt;/html>"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                        <span class="token comment">// The HTTP response ends with another blank line</span>                        client<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                        <span class="token comment">// Request sample: /?r201g32b255&amp;</span>                        <span class="token comment">// Red = 201 | Green = 32 | Blue = 255</span>                        <span class="token comment">//搜尋字串裡的關鍵字,如果有的話就將它串接在一起</span>                        <span class="token keyword">if</span> <span class="token punctuation">(</span>header<span class="token punctuation">.</span><span class="token function">indexOf</span><span class="token punctuation">(</span><span class="token string">"GET /?r"</span><span class="token punctuation">)</span> <span class="token operator">>=</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>                            pos1 <span class="token operator">=</span> header<span class="token punctuation">.</span><span class="token function">indexOf</span><span class="token punctuation">(</span><span class="token string">'r'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                            pos2 <span class="token operator">=</span> header<span class="token punctuation">.</span><span class="token function">indexOf</span><span class="token punctuation">(</span><span class="token string">'g'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                            pos3 <span class="token operator">=</span> header<span class="token punctuation">.</span><span class="token function">indexOf</span><span class="token punctuation">(</span><span class="token string">'b'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                            pos4 <span class="token operator">=</span> header<span class="token punctuation">.</span><span class="token function">indexOf</span><span class="token punctuation">(</span><span class="token string">'&amp;'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                            redString <span class="token operator">=</span> header<span class="token punctuation">.</span><span class="token function">substring</span><span class="token punctuation">(</span>pos1<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">,</span> pos2<span class="token punctuation">)</span><span class="token punctuation">;</span>                            greenString <span class="token operator">=</span> header<span class="token punctuation">.</span><span class="token function">substring</span><span class="token punctuation">(</span>pos2<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">,</span> pos3<span class="token punctuation">)</span><span class="token punctuation">;</span>                            blueString <span class="token operator">=</span> header<span class="token punctuation">.</span><span class="token function">substring</span><span class="token punctuation">(</span>pos3<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">,</span> pos4<span class="token punctuation">)</span><span class="token punctuation">;</span>                            <span class="token function">ledcWrite</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> redString<span class="token punctuation">.</span><span class="token function">toInt</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                            <span class="token function">ledcWrite</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> greenString<span class="token punctuation">.</span><span class="token function">toInt</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                            <span class="token function">ledcWrite</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> blueString<span class="token punctuation">.</span><span class="token function">toInt</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                        <span class="token punctuation">&#125;</span>                        <span class="token keyword">break</span><span class="token punctuation">;</span>                    <span class="token punctuation">&#125;</span><span class="token keyword">else</span><span class="token punctuation">&#123;</span>                        <span class="token comment">//否則當前的行為空</span>                        currentLine <span class="token operator">=</span> <span class="token string">""</span><span class="token punctuation">;</span>                    <span class="token punctuation">&#125;</span>                <span class="token comment">//如果c為空行,則c加入當前行</span>                <span class="token punctuation">&#125;</span><span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>c <span class="token operator">!=</span> <span class="token string">'\\r'</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>                    currentLine <span class="token operator">+=</span> c<span class="token punctuation">;</span>                <span class="token punctuation">&#125;</span>            <span class="token punctuation">&#125;</span>        <span class="token punctuation">&#125;</span>        header <span class="token operator">=</span> <span class="token string">""</span><span class="token punctuation">;</span>        client<span class="token punctuation">.</span><span class="token function">stop</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        Serial<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"Client disconnected."</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        Serial<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">""</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>**</p><div class="video-container"><iframe src="https://www.youtube.com/embed/MwvuwqJcddI" frameborder="0" loading="lazy" allowfullscreen></iframe></div>]]></content>
      
      
      <categories>
          
          <category> esp32 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> neopixel </tag>
            
            <tag> webServer </tag>
            
            <tag> rgb </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>低功耗藍芽-BLE-ESP32</title>
      <link href="/2021/08/30/di-gong-hao-lan-ya-ble-esp32/"/>
      <url>/2021/08/30/di-gong-hao-lan-ya-ble-esp32/</url>
      
        <content type="html"><![CDATA[<h1 id="低功耗藍芽-BLE-ESP32"><a href="#低功耗藍芽-BLE-ESP32" class="headerlink" title="低功耗藍芽-BLE-ESP32"></a>低功耗藍芽-BLE-ESP32</h1><h6 id="tags-esp32-BLE"><a href="#tags-esp32-BLE" class="headerlink" title="tags: esp32 BLE"></a>tags: <code>esp32</code> <code>BLE</code></h6><h2 id="什麼是低功耗藍牙？"><a href="#什麼是低功耗藍牙？" class="headerlink" title="什麼是低功耗藍牙？"></a>什麼是低功耗藍牙？</h2><p>低功耗藍牙，簡稱 BLE，是藍牙的一種節能變體。 BLE 的主要應用是短距離傳輸少量數據（低帶寬）。與始終開啟的藍牙不同，BLE 始終處於睡眠模式，除非發起連接。  </p><p>這使得它消耗非常低的功率。 BLE 的功耗比藍牙低約 100 倍（取決於用例）。</p><p>由於其特性，BLE 適用於需要交換在鈕扣電池上定期運行的少量數據的應用程序。例如，BLE 在醫療保健、健身、跟踪、信標、安全和家庭自動化行業中非常有用。  </p><p><a href="https://draft.blogger.com/blog/post/edit/3809681606094011522/2973515378701882623?hl=zh-TW#"><img src="https://lh3.googleusercontent.com/-FOhL0dvy_Mg/YRNcMNCTl7I/AAAAAAAAexI/5l6KJtkQbNg7C3UMQyF4Y6WHJaVhg0KSwCNcBGAsYHQ/w478-h145/image.png"></a></p><h2 id="BLE-Server和Client"><a href="#BLE-Server和Client" class="headerlink" title="BLE-Server和Client"></a>BLE-Server和Client</h2><p>使用低功耗藍牙，有兩種類型的設備：服務器和客戶端。 ESP32 既可以作為客戶端，也可以作為服務器。  </p><p>服務器通告它的存在，因此它可以被其他設備發現，並且包含客戶端可以讀取的數據。客戶端掃描附近的設備，當它找到它正在尋找的服務器時，它會建立一個連接並監聽傳入的數據。這稱為點對點通信。</p><p>如前所述，BLE 還支持廣播模式和網狀網絡：  </p><p>廣播模式：服務器向多個連接的客戶端傳輸數據；<br>網狀網絡：所有設備都連接起來，這是一個多對多的連接。<br>儘管可以實現廣播和網狀網絡設置，但它們是最近開發的，因此目前為 ESP32 實現的示例並不多。</p><h2 id="GATT"><a href="#GATT" class="headerlink" title="GATT"></a>GATT</h2><p>GATT 代表通用屬性，它定義了暴露給連接的 BLE 設備的分層數據結構。這意味著 GATT 定義了兩個 BLE 設備發送和接收標準消息的方式。了解此層次結構很重要，因為這樣可以更輕鬆地了解如何使用 BLE 和編寫應用程序。</p><p><a href="https://draft.blogger.com/blog/post/edit/3809681606094011522/2973515378701882623?hl=zh-TW#"><img src="https://lh3.googleusercontent.com/-9tSApqWf14Y/YRNdWbNFB9I/AAAAAAAAexQ/ZkpScOpDK1kfVzgbtLfvPqT0-hwTleFvACNcBGAsYHQ/w565-h318/image.png"></a></p><hr><p>這些屬性描述瞭如何與特徵值交互。基本上，它包含可以與特徵一起使用的操作和過程：</p><p>播送<br>讀<br>寫無響應<br>寫<br>通知<br>表明<br>經過身份驗證的簽名寫入<br>擴展屬性</p><hr><h2 id="使用範例檔的”寫入”"><a href="#使用範例檔的”寫入”" class="headerlink" title="使用範例檔的”寫入”"></a>使用範例檔的”寫入”</h2><p><a href="https://draft.blogger.com/blog/post/edit/3809681606094011522/2973515378701882623?hl=zh-TW#"><img src="https://1.bp.blogspot.com/-Oy14eF3dwdY/YRSQAYKtDBI/AAAAAAAAexc/22G5NNCu4kAgtGlxMQOpAHJWCf6zPcaBwCNcBGAsYHQ/w895-h504/1.jpg"></a></p><pre class="line-numbers language-cpp" data-language="cpp"><code class="language-cpp"><span class="token comment">/*    Based on Neil Kolban example for IDF: https://github.com/nkolban/esp32-snippets/blob/master/cpp_utils/tests/BLE%20Tests/SampleWrite.cpp    Ported to Arduino ESP32 by Evandro Copercini*/</span>  <span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;BLEDevice.h></span></span><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;BLEUtils.h></span></span><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;BLEServer.h></span></span>  <span class="token comment">// See the following for generating UUIDs:</span><span class="token comment">// https://www.uuidgenerator.net/</span>  <span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">SERVICE_UUID</span> <span class="token string">"4fafc201-1fb5-459e-8fcc-c5c9c331914b"</span></span><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">CHARACTERISTIC_UUID</span> <span class="token string">"beb5483e-36e1-4688-b7f5-ea07361b26a8"</span></span><span class="token keyword">class</span> <span class="token class-name">MyCallbacks</span><span class="token operator">:</span> <span class="token base-clause"><span class="token keyword">public</span> <span class="token class-name">BLECharacteristicCallbacks</span></span> <span class="token punctuation">&#123;</span>    <span class="token keyword">void</span> <span class="token function">onWrite</span><span class="token punctuation">(</span>BLECharacteristic <span class="token operator">*</span>pCharacteristic<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>      std<span class="token double-colon punctuation">::</span>string value <span class="token operator">=</span> pCharacteristic<span class="token operator">-></span><span class="token function">getValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token keyword">if</span> <span class="token punctuation">(</span>value<span class="token punctuation">.</span><span class="token function">length</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">></span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        Serial<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"*********"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        Serial<span class="token punctuation">.</span><span class="token function">print</span><span class="token punctuation">(</span><span class="token string">"New value: "</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> value<span class="token punctuation">.</span><span class="token function">length</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span>          Serial<span class="token punctuation">.</span><span class="token function">print</span><span class="token punctuation">(</span>value\<span class="token punctuation">[</span>i\<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        Serial<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        Serial<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"*********"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token punctuation">;</span><span class="token keyword">void</span> <span class="token function">setup</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  Serial<span class="token punctuation">.</span><span class="token function">begin</span><span class="token punctuation">(</span><span class="token number">115200</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  Serial<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"1- Download and install an BLE scanner app in your phone"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  Serial<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"2- Scan for BLE devices in the app"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  Serial<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"3- Connect to MyESP32"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  Serial<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"4- Go to CUSTOM CHARACTERISTIC in CUSTOM SERVICE and write something"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  Serial<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"5- See the magic =)"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token class-name">BLEDevice</span><span class="token double-colon punctuation">::</span><span class="token function">init</span><span class="token punctuation">(</span><span class="token string">"MyESP32"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  BLEServer <span class="token operator">*</span>pServer <span class="token operator">=</span> <span class="token class-name">BLEDevice</span><span class="token double-colon punctuation">::</span><span class="token function">createServer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  BLEService <span class="token operator">*</span>pService <span class="token operator">=</span> pServer<span class="token operator">-></span><span class="token function">createService</span><span class="token punctuation">(</span>SERVICE_UUID<span class="token punctuation">)</span><span class="token punctuation">;</span>  BLECharacteristic <span class="token operator">*</span>pCharacteristic <span class="token operator">=</span> pService<span class="token operator">-></span><span class="token function">createCharacteristic</span><span class="token punctuation">(</span>                                         CHARACTERISTIC_UUID<span class="token punctuation">,</span>                                         BLECharacteristic<span class="token double-colon punctuation">::</span>PROPERTY_READ <span class="token operator">|</span>                                         BLECharacteristic<span class="token double-colon punctuation">::</span>PROPERTY_WRITE                                       <span class="token punctuation">)</span><span class="token punctuation">;</span>  pCharacteristic<span class="token operator">-></span><span class="token function">setCallbacks</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token function">MyCallbacks</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  pCharacteristic<span class="token operator">-></span><span class="token function">setValue</span><span class="token punctuation">(</span><span class="token string">"Hello World"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  pService<span class="token operator">-></span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  BLEAdvertising <span class="token operator">*</span>pAdvertising <span class="token operator">=</span> pServer<span class="token operator">-></span><span class="token function">getAdvertising</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  pAdvertising<span class="token operator">-></span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">void</span> <span class="token function">loop</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  <span class="token comment">// put your main code here, to run repeatedly:</span>  <span class="token function">delay</span><span class="token punctuation">(</span><span class="token number">2000</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><hr><h2 id="解析"><a href="#解析" class="headerlink" title="解析"></a>解析</h2><p><strong>首先導入 BLE 功能所需的庫</strong></p><pre class="line-numbers language-cpp" data-language="cpp"><code class="language-cpp"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;BLEDevice.h></span></span><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;BLEUtils.h></span></span><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;BLEServer.h></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><strong>然後，您需要為 Service 和 Characteristic 定義一個 UUID,也可以流用內訂的UUID</strong></p><p><strong>或要自己創建自己的UUID可以到這個網站<a href="https://draft.blogger.com/blog/post/edit/3809681606094011522/2973515378701882623?hl=zh-TW#">https://www.uuidgenerator.net/</a></strong></p><pre class="line-numbers language-cpp" data-language="cpp"><code class="language-cpp"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">SERVICE_UUID</span> <span class="token string">"4fafc201-1fb5-459e-8fcc-c5c9c331914b"</span></span><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">CHARACTERISTIC_UUID</span> <span class="token string">"beb5483e-36e1-4688-b7f5-ea07361b26a8"</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p><strong>接收字串的類</strong></p><pre class="line-numbers language-cpp" data-language="cpp"><code class="language-cpp"><span class="token keyword">class</span> <span class="token class-name">MyCallbacks</span><span class="token operator">:</span> <span class="token base-clause"><span class="token keyword">public</span> <span class="token class-name">BLECharacteristicCallbacks</span></span> <span class="token punctuation">&#123;</span>    <span class="token keyword">void</span> <span class="token function">onWrite</span><span class="token punctuation">(</span>BLECharacteristic <span class="token operator">*</span>pCharacteristic<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>      std<span class="token double-colon punctuation">::</span>string value <span class="token operator">=</span> pCharacteristic<span class="token operator">-></span><span class="token function">getValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token keyword">if</span> <span class="token punctuation">(</span>value<span class="token punctuation">.</span><span class="token function">length</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">></span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        Serial<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"*********"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        Serial<span class="token punctuation">.</span><span class="token function">print</span><span class="token punctuation">(</span><span class="token string">"New value: "</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> value<span class="token punctuation">.</span><span class="token function">length</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span>          Serial<span class="token punctuation">.</span><span class="token function">print</span><span class="token punctuation">(</span>value\<span class="token punctuation">[</span>i\<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        Serial<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        Serial<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"*********"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token punctuation">;</span><span class="token operator">*</span><span class="token operator">*</span>在 <span class="token function">setup</span><span class="token punctuation">(</span><span class="token punctuation">)</span> 中，它以 <span class="token number">115200</span> 的波特率啟動串行通信<span class="token operator">*</span><span class="token operator">*</span>```cpp Serial<span class="token punctuation">.</span><span class="token function">begin</span><span class="token punctuation">(</span><span class="token number">115200</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><strong>創建一個名為“MyESP32”的 BLE 設備。您可以將此名稱更改為您喜歡的任何名稱。</strong></p><pre class="line-numbers language-cpp" data-language="cpp"><code class="language-cpp"><span class="token class-name">BLEDevice</span><span class="token double-colon punctuation">::</span><span class="token function">init</span><span class="token punctuation">(</span><span class="token string">"MyESP32"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p><strong>在以下行中，您將 BLE 設備設置為服務器。</strong></p><pre class="line-numbers language-cpp" data-language="cpp"><code class="language-cpp">BLEServer <span class="token operator">*</span>pServer <span class="token operator">=</span> <span class="token class-name">BLEDevice</span><span class="token double-colon punctuation">::</span><span class="token function">createServer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p><strong>在這之後，你的BLE服務器創建的UUID前面定義的服務。</strong></p><pre class="line-numbers language-cpp" data-language="cpp"><code class="language-cpp">BLEService <span class="token operator">*</span>pService <span class="token operator">=</span> pServer<span class="token operator">-></span><span class="token function">createService</span><span class="token punctuation">(</span>SERVICE_UUID<span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p><strong>設置該服務的特徵。如您所見，您還使用了之前定義的 UUID，您需要將特徵的屬性作為參數傳遞。在這種情況下，它是：讀和寫。</strong></p><pre class="line-numbers language-cpp" data-language="cpp"><code class="language-cpp">BLECharacteristic <span class="token operator">*</span>pCharacteristic <span class="token operator">=</span> pService<span class="token operator">-></span><span class="token function">createCharacteristic</span><span class="token punctuation">(</span>                                         CHARACTERISTIC_UUID<span class="token punctuation">,</span>                                         BLECharacteristic<span class="token double-colon punctuation">::</span>PROPERTY_READ <span class="token operator">|</span>                                         BLECharacteristic<span class="token double-colon punctuation">::</span>PROPERTY_WRITE                                       <span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><strong>創建setCallbacks() 方法接收傳來的值或字串</strong></p><pre class="line-numbers language-cpp" data-language="cpp"><code class="language-cpp">pCharacteristic<span class="token operator">-></span><span class="token function">setCallbacks</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token function">MyCallbacks</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p><strong>創建特徵後，您可以使用 setValue() 方法設置其值。</strong></p><p><strong>我們將值設置為文本“Hello World 說 Neil”。您可以將此文本更改為您喜歡的任何內容。例如，在未來的項目中，該文本可以是傳感器讀數或燈的狀態。</strong></p><pre class="line-numbers language-cpp" data-language="cpp"><code class="language-cpp">pCharacteristic<span class="token operator">-></span><span class="token function">setValue</span><span class="token punctuation">(</span><span class="token string">"Hello World"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>``<span class="token operator">*</span><span class="token operator">*</span>最後，您可以啟動服務，並進行廣告，以便其他 BLE 設備可以掃描並找到此 BLE 設備<span class="token operator">*</span><span class="token operator">*</span>  ```cppBLEAdvertising <span class="token operator">*</span>pAdvertising <span class="token operator">=</span> pServer<span class="token operator">-></span><span class="token function">getAdvertising</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  pAdvertising<span class="token operator">-></span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><hr><p><strong>上傳完成之後,打開監測窗口,按一下ESP32的RESET,會出現以下畫面</strong></p><p><a href="https://draft.blogger.com/blog/post/edit/3809681606094011522/2973515378701882623?hl=zh-TW#"><img src="https://1.bp.blogspot.com/-5jO95-XvQu0/YRSSPJ9F-AI/AAAAAAAAexw/nz3F5DWsJ9oNFZmLf8xf-z7AsQZglJ_-wCNcBGAsYHQ/w767-h432/2.jpg"></a></p><p><strong>下載手機APP <a href="https://draft.blogger.com/blog/post/edit/3809681606094011522/2973515378701882623?hl=zh-TW#">nRF Connect</a> 並開啓APP</strong></p><p><a href="https://draft.blogger.com/blog/post/edit/3809681606094011522/2973515378701882623?hl=zh-TW#"><img src="https://lh3.googleusercontent.com/-qlUi7497sg4/YRSTXZb1f-I/AAAAAAAAeyE/LbzEQbE2hvs3MFDjERCYdpcVf4fDohQsACNcBGAsYHQ/s1600/1628738390279946-0.png"></a></p><p><a href="https://draft.blogger.com/blog/post/edit/3809681606094011522/2973515378701882623?hl=zh-TW#"><img src="https://lh3.googleusercontent.com/-Nf9DHYKj3AM/YRSTVOlwm6I/AAAAAAAAeyA/pKUuFBbdjZo_8FGJdX2MmLcHL1c1hPLhwCNcBGAsYHQ/s1600/1628738380362595-1.png"></a></p><p><a href="https://draft.blogger.com/blog/post/edit/3809681606094011522/2973515378701882623?hl=zh-TW#"><img src="https://lh3.googleusercontent.com/-1JkgS9GGNVs/YRSTS3iQbwI/AAAAAAAAex8/RXyTRNwbU58Qrr1PPOv3KNTTaf5Dj68JQCNcBGAsYHQ/s1600/1628738377493328-2.png"></a></p><p><a href="https://draft.blogger.com/blog/post/edit/3809681606094011522/2973515378701882623?hl=zh-TW#"><img src="https://lh3.googleusercontent.com/-9WgHaxVf2FI/YRSTSLnMzvI/AAAAAAAAex4/Gye9ZeTj3eMmdO9UEjNMTS95IOFWJOblgCNcBGAsYHQ/s1600/1628738372129606-3.png"></a></p><p><strong>按下SEND後</strong></p><p><a href="https://draft.blogger.com/blog/post/edit/3809681606094011522/2973515378701882623?hl=zh-TW#"><img src="https://1.bp.blogspot.com/-qFsywMyHNCE/YRSToPLpGQI/AAAAAAAAeyU/WeOP7MtlzeMjBweA6cIOJIYuwvZE93XowCNcBGAsYHQ/w879-h495/3.jpg"></a></p><p>參考-<a href="https://draft.blogger.com/blog/post/edit/3809681606094011522/2973515378701882623?hl=zh-TW#">https://randomnerdtutorials.com/esp32-bluetooth-low-energy-ble-arduino-ide/</a></p>]]></content>
      
      
      <categories>
          
          <category> esp32 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> BLE </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>MQTT-Nord-RED顯示超音波測距數據+控制LED</title>
      <link href="/2021/08/30/mqtt-nord-red-xian-shi-chao-yin-bo-ce-ju-shu-ju-kong-zhi-led/"/>
      <url>/2021/08/30/mqtt-nord-red-xian-shi-chao-yin-bo-ce-ju-shu-ju-kong-zhi-led/</url>
      
        <content type="html"><![CDATA[<h2 id="MQTT-Nord-RED顯示超音波測距數據-控制LED"><a href="#MQTT-Nord-RED顯示超音波測距數據-控制LED" class="headerlink" title="MQTT-Nord-RED顯示超音波測距數據+控制LED"></a>MQTT-Nord-RED顯示超音波測距數據+控制LED</h2><h2 id="超音波模組-HC-SC04-測試回顧-點我回顧"><a href="#超音波模組-HC-SC04-測試回顧-點我回顧" class="headerlink" title="超音波模組(HC-SC04)測試回顧-點我回顧"></a>超音波模組(HC-SC04)測試回顧-<a href="https://draft.blogger.com/blog/post/edit/3809681606094011522/3385819142688987744?hl=zh-TW#">點我回顧</a></h2><h2 id="MQTT相關布暑-點我回顧"><a href="#MQTT相關布暑-點我回顧" class="headerlink" title="MQTT相關布暑-點我回顧"></a>MQTT相關布暑-<a href="https://draft.blogger.com/blog/post/edit/3809681606094011522/3385819142688987744?hl=zh-TW#">點我回顧</a></h2><h2 id="程式碼"><a href="#程式碼" class="headerlink" title="程式碼"></a>程式碼</h2><pre class="line-numbers language-c#" data-language="c#"><code class="language-c#">#include &lt;Ultrasonic.h&gt;#include &lt;WiFi.h&gt;#include &lt;PubSubClient.h&gt;Ultrasonic ultrasonic(32, 33);const char* ssid &#x3D; &quot;---&quot;;const char* password &#x3D; &quot;-----&quot;;const char* mqttServer &#x3D; &quot;192.168.67.22&quot;;&#x2F;&#x2F;wifi客戶端及MQTT客戶端代數WiFiClient espClient;PubSubClient client(espClient);&#x2F;&#x2F;設定wifivoid wifiConn()&#123;  WiFi.begin(ssid, password);  while (WiFi.status() !&#x3D; WL_CONNECTED)&#123;    Serial.print(&quot;.&quot;);    delay(50);  &#125;  Serial.println(&quot;Connected successful!&quot;);  Serial.println(WiFi.localIP());&#125;  &#x2F;&#x2F;檢查訂閱的字串是否含有on和off,如果比對下來是&#x2F;&#x2F;nord-red裡的標頭一樣,而且包含on就開燈,off就關燈void callback(char *topic, byte *message, unsigned int length)&#123;  String messageDist;  Serial.print(&quot;Message arrived on topic: &quot;);  Serial.print(topic);  Serial.print(&quot;. Message: &quot;);  for (int i &#x3D; 0; i &lt; length; i++)  &#123;    Serial.print(char(message\[i\]));    messageDist +&#x3D; char(message\[i\]);  &#125;  Serial.println();  if (String(topic) &#x3D;&#x3D; &quot;esp32&#x2F;output&quot;)&#123;    if (messageDist &#x3D;&#x3D; &quot;on&quot;)&#123;      Serial.print(&quot;on&quot;);      digitalWrite(LED_BUILTIN, HIGH);    &#125;else if (messageDist &#x3D;&#x3D; &quot;off&quot;)&#123;      Serial.print(&quot;off&quot;);      digitalWrite(LED_BUILTIN, LOW);    &#125;  &#125;&#125;&#x2F;&#x2F;萬一連不上mqtt就重新連線void reconnect()&#123;  while (! client.connected())&#123;    Serial.print(&quot;Attempting MQTT connection...&quot;);    if (client.connect(&quot;esp32Client&quot;))&#123;      Serial.println(&quot;connected&quot;);      client.subscribe(&quot;esp32&#x2F;output&quot;);    &#125;else &#123;      Serial.print(&quot;failed connected is : &quot;);      Serial.println(client.state());      delay(2000);    &#125;  &#125;&#125;void setup() &#123;  Serial.begin(115200);  wifiConn();  client.setServer(mqttServer, 1883);  client.setCallback(callback);  pinMode(LED_BUILTIN, OUTPUT);&#125;void loop() &#123;    if (! client.connected())&#123;      reconnect();    &#125;    client.loop();    long lastTime &#x3D; 0;    long currentTime &#x3D; millis();    float distance &#x3D; 0;    if (currentTime - lastTime &gt; 3000)&#123;      lastTime &#x3D; currentTime;      distance &#x3D; ultrasonic.read(CM);      Serial.println(distance);      char distStr[8] &#x3D; &quot;&quot;;      dtostrf(distance, 1, 2, distStr);      Serial.print(&quot;Distance: &quot;);      Serial.print(distance);      Serial.println(&quot;CM&quot;);      client.publish(&quot;esp32&#x2F;distanceRead&quot;, distStr);      delay(500);    &#125;&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><a href="https://draft.blogger.com/blog/post/edit/3809681606094011522/3385819142688987744?hl=zh-TW#"><img src="https://lh3.googleusercontent.com/-rw-XPPQUrZQ/YQylpvMqgMI/AAAAAAAAeq4/AOgDSHZxzNgssqLlrKNTHm1Vxks8qHaMwCNcBGAsYHQ/w505-h1005/1628218778514172-0.png"></a></p>]]></content>
      
      
      <categories>
          
          <category> esp32 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> hc-sr04 </tag>
            
            <tag> mqtt </tag>
            
            <tag> nord-red </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ESP32-DC直流馬達測試</title>
      <link href="/2021/08/29/esp32-dc-zhi-liu-ma-da-ce-shi/"/>
      <url>/2021/08/29/esp32-dc-zhi-liu-ma-da-ce-shi/</url>
      
        <content type="html"><![CDATA[<h1 id="ESP32-DC直流馬達測試"><a href="#ESP32-DC直流馬達測試" class="headerlink" title="ESP32-DC直流馬達測試"></a>ESP32-DC直流馬達測試</h1><h6 id="tags-esp32-dc-moto-l298n"><a href="#tags-esp32-dc-moto-l298n" class="headerlink" title="tags: esp32 dc moto l298n"></a>tags: <code>esp32</code> <code>dc moto</code> <code>l298n</code></h6><p><strong>直流馬達是微控板常常在用的元件，最常搭配的是L298N</strong></p><p><strong>驅動裝置，因為如果把馬達直接接上微控板會導致燒掉</strong></p><h2 id="L298N驅動板"><a href="#L298N驅動板" class="headerlink" title="L298N驅動板"></a>L298N驅動板</h2><p>OUT1：直流電機A+端子<br>OUT2：直流電機 A – 端子<br>OUT3：直流電機B+端子<br>OUT4：直流電機 B – 端子</p><p>這裡要特別注意的地方</p><p>在底部，您有一個帶有 +12V、GND 和 +5V 的三接線端子。 </p><p>一般用18650電池二~三顆供電的話接+12V和GND，如果要</p><p>額外接微控板例如esp32或arduino，在+5V和GND就是往外</p><p>供電給微控板的5V。</p><p>注意：如果供電超過12V，需要去掉跳線，給+5V端供電5V。</p><p>使能(Enble)引腳  </p><p>如果您向使能 A 引腳發送 HIGH 信號，則電機 A 已準備好以最大速度進行控制；<br>如果向使能 A 引腳發送 LOW 信號，則電機 A 關閉；<br>如果發送PWM信號，則可以控制電機的速度。電機速度與占空比成正比。但是，</p><p>請注意，<strong>對於小占空比，電機可能不會旋轉</strong>，並發出持續的嗡嗡聲。</p><p><a href="https://draft.blogger.com/blog/post/edit/3809681606094011522/7079589207275388404?hl=zh-TW#"><img src="https://1.bp.blogspot.com/-P-j3FW8Xbpw/YQdexXM61HI/AAAAAAAAemw/Eg9w-rqfbS8KUP7etV1xL1O6CC0g457VwCNcBGAsYHQ/w541-h475/L298N-label.jpg"></a></p><hr><h2 id="接線"><a href="#接線" class="headerlink" title="接線"></a>接線</h2><p><strong>＊記得L298N的GND要拉一條到ESP32的GND，否則馬達不會動作</strong></p><p><a href="https://draft.blogger.com/blog/post/edit/3809681606094011522/7079589207275388404?hl=zh-TW#"><img src="https://1.bp.blogspot.com/-emtD7l8K7IE/YQdpsc_-zqI/AAAAAAAAem8/bIDZQ1CeGIUjmlgIgJlSfQI3DE1emAINQCNcBGAsYHQ/w534-h701/ESP32_1_DC_Motor_bb.png"></a></p><hr><h2 id="程式"><a href="#程式" class="headerlink" title="程式"></a>程式</h2><pre class="line-numbers language-c#" data-language="c#"><code class="language-c#">int M1 &#x3D; 27;int M2 &#x3D; 26;int enb &#x3D; 14;int duty &#x3D; 150;void setup() &#123;  Serial.begin(115200);  pinMode(M1, OUTPUT);  pinMode(M2, OUTPUT);  pinMode(enb, OUTPUT);    ledcSetup(0, 3000, 8);  ledcAttachPin(enb, 0);&#125;  void loop() &#123;  &#x2F;&#x2F;forward  Serial.println(&quot;forward&quot;);  digitalWrite(M1, LOW);  digitalWrite(M2, HIGH);  delay(2000);  &#x2F;&#x2F;stop  Serial.println(&quot;stop&quot;);  digitalWrite(M1, LOW);  digitalWrite(M2, LOW);  delay(2000);  &#x2F;&#x2F;back  Serial.println(&quot;back&quot;);  digitalWrite(M1, HIGH);  digitalWrite(M2, LOW);  delay(2000);  &#x2F;&#x2F;stop  Serial.println(&quot;stop&quot;);  digitalWrite(M1, LOW);  digitalWrite(M2, LOW);  delay(2000);  &#x2F;&#x2F;pwm forward  Serial.println(&quot;forward&quot;);  digitalWrite(M1, LOW);  digitalWrite(M2, HIGH);  delay(2000);  while (duty &lt;&#x3D; 255)&#123;    Serial.println(duty);    ledcWrite(0, duty);    duty +&#x3D; 5;    delay(500);  &#125;  delay(2000);  duty &#x3D; 150;&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><hr><h2 id="解析"><a href="#解析" class="headerlink" title="解析"></a>解析</h2><pre class="line-numbers language-c#" data-language="c#"><code class="language-c#">&#x2F;&#x2F;馬達1的正反轉腳位int M1_IN1 &#x3D; 27;int M1_IN2 &#x3D; 26;int enb &#x3D; 14; &#x2F;&#x2F;使能控制腳位int duty &#x3D; 150; &#x2F;&#x2F;PWM的dutyclcyle預設150,不能太小,值太小馬達不會轉  void setup() &#123;  Serial.begin(115200);  pinMode(M1_IN1, OUTPUT);  pinMode(M1_IN2, OUTPUT);  pinMode(enb, OUTPUT);  &#x2F;&#x2F;頻道0, 頻率3000, 解析度8  ledcSetup(0, 3000, 8);   &#x2F;&#x2F;enblePin, 通道  ledcAttachPin(enb, 0);&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><strong>loop裡面最後有while(),因為duty最大值到255,所以要讓它從150漸增到255</strong></p><p><strong>來觀察pwm的動作</strong></p><pre class="line-numbers language-c#" data-language="c#"><code class="language-c#">void loop() &#123;  &#x2F;&#x2F;forward  Serial.println(&quot;forward&quot;);  digitalWrite(M1_IN1, LOW);  digitalWrite(M1_IN2, HIGH);  delay(2000);  &#x2F;&#x2F;stop  Serial.println(&quot;stop&quot;);  digitalWrite(M1_IN1, LOW);  digitalWrite(M1_IN2, LOW);  delay(2000);  &#x2F;&#x2F;back  Serial.println(&quot;back&quot;);  digitalWrite(M1, HIGH);  digitalWrite(M2, LOW);  delay(2000);  &#x2F;&#x2F;stop  Serial.println(&quot;stop&quot;);  digitalWrite(M1_IN1, LOW);  digitalWrite(M1_IN2, LOW);  delay(2000);  &#x2F;&#x2F;pwm forward  Serial.println(&quot;forward&quot;);  digitalWrite(M1_IN1, LOW);  digitalWrite(M1_IN2, HIGH);  delay(2000);  while (duty &lt;&#x3D; 255)&#123;    Serial.println(duty);    ledcWrite(0, duty);    duty +&#x3D; 5;    delay(500);  &#125;  delay(2000);  duty &#x3D; 150;&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><hr><div class="video-container"><iframe src="https://www.youtube.com/embed/J5Chbzcz3jY" frameborder="0" loading="lazy" allowfullscreen></iframe></div>]]></content>
      
      
      <categories>
          
          <category> esp32 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> dc moto </tag>
            
            <tag> L298N </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>MQTT-Publish-Node-RED-BMP280</title>
      <link href="/2021/08/29/esp32-mqtt-publish-node-red-bmp280/"/>
      <url>/2021/08/29/esp32-mqtt-publish-node-red-bmp280/</url>
      
        <content type="html"><![CDATA[<h1 id="MQTT-Publish-Node-RED-BMP280"><a href="#MQTT-Publish-Node-RED-BMP280" class="headerlink" title="MQTT-Publish-Node-RED-BMP280"></a>MQTT-Publish-Node-RED-BMP280</h1><p><strong>參考文獻-<a href="https://draft.blogger.com/blog/post/edit/3809681606094011522/5842507104876900238?hl=zh-TW#">https://randomnerdtutorials.com/esp32-mqtt-publish-subscribe-arduino-ide/</a></strong></p><p><strong>這次實作是使用MQTT發送BMP280的數據到樹莓派上的Node-RED儀錶版上</strong></p><p><strong>我是參考這篇文章-<a href="https://draft.blogger.com/blog/post/edit/3809681606094011522/5842507104876900238?hl=zh-TW#">https://randomnerdtutorials.com/esp32-mqtt-publish-subscribe-arduino-ide/</a></strong></p><p><strong>所以會使用類似的程式碼手法來完成項目。</strong></p><p><strong>開始之前先備妥樹莓派上所須的軟硬體</strong></p><ol><li> <strong><em>安裝<a href="https://draft.blogger.com/blog/post/edit/3809681606094011522/5842507104876900238?hl=zh-TW#">Mosquitto broker</a>(如果沒玩過樹莓派,請連結<a href="https://draft.blogger.com/blog/post/edit/3809681606094011522/5842507104876900238?hl=zh-TW#">這裡</a>安裝樹莓派系統和<a href="https://draft.blogger.com/blog/post/edit/3809681606094011522/5842507104876900238?hl=zh-TW#">如</a></em></strong></li><li> <strong><em><a href="https://draft.blogger.com/blog/post/edit/3809681606094011522/5842507104876900238?hl=zh-TW#">何使用SSH和VNC鏡像</a>)</em></strong></li><li> <strong><em>安裝 <a href="https://draft.blogger.com/blog/post/edit/3809681606094011522/5842507104876900238?hl=zh-TW#">Node-RED installed</a>  和 <a href="https://draft.blogger.com/blog/post/edit/3809681606094011522/5842507104876900238?hl=zh-TW#">Node-RED Dashboard</a>在樹莓派上。</em></strong></li><li> <strong>_備註:安裝Node-RED時若出現錯誤訊息改用下面所附下載 _****<em>bash &lt;(curl -sL <a href="https://raw.githubusercontent.com/node-red/linux-installers/master/deb/update-nodejs-and-nodered">https://raw.githubusercontent.com/node-red/linux-installers/master/deb/update-nodejs-and-nodered</a>)</em></strong></li><li><strong><em>接下來先測試BMP280是否可正常測溫度和壓力-請參考之前的紀錄(<a href="https://draft.blogger.com/blog/post/edit/3809681606094011522/5842507104876900238?hl=zh-TW#">點我傳送</a>)。</em></strong></li></ol><p><em><strong>先來看一下整個發送原理比較容易理解自己要學的重點在哪裡</strong></em></p><p><em><strong>此次實驗我只寫從ESP32發送數據到樹莓派的Mosquitto代理接收/發送</strong></em></p><p><em><strong>然後通過MQTT通信協議去控制ESP32發送數據到Node-RED,其實我覺</strong></em></p><p><em><strong>得和ThingSpeak很類似,只是使用Node-RED更能客製化。</strong></em></p><p><em><strong>看一下這張圖</strong></em></p><p><a href="https://draft.blogger.com/blog/post/edit/3809681606094011522/5842507104876900238?hl=zh-TW#"><strong><img src="https://lh3.googleusercontent.com/-dbEK49_w9_A/YQP1Mii2utI/AAAAAAAAelI/zvaBPu6JqXIcyeXVPyqIHhOt6CVSYkCrgCNcBGAsYHQ/w642-h341/image.png"></strong></a></p><hr><p><strong><em>知道原理後就是開始進入寫程式的主軸</em></strong></p><p><strong><em>首先要有網路可以連到數莓派和ESP32，然後判斷是否已經連線</em></strong></p><p><strong><em>如果連不上就再自動重連，連上後印出IP，連上網路後，就是</em></strong></p><p><strong><em>要去和樹莓派的Mosquitto Broker連線，一樣就是判斷是否成功</em></strong></p><p><strong><em>連線做出對應的動作。WiFi和Mosquitto Broker都連線之後，就開</em></strong></p><p><strong><em>始從ESP32客戶端發送溫度和壓力的數據到Node-RED的介面上。</em></strong></p><hr><h2 id="布署Node-RED"><a href="#布署Node-RED" class="headerlink" title="布署Node-RED"></a>布署Node-RED</h2><div class="video-container"><iframe src="https://www.youtube.com/embed/IHebAHN_E50" frameborder="0" loading="lazy" allowfullscreen></iframe></div><h2 id="程式碼"><a href="#程式碼" class="headerlink" title="程式碼"></a>程式碼</h2><pre class="line-numbers language-c#" data-language="c#"><code class="language-c#">#include &lt;WiFi.h&gt;#include &lt;PubSubClient.h&gt;#include &lt;Adafruit_BMP280.h&gt;#include &lt;Adafruit_Sensor.h&gt;#include &lt;Wire.h&gt;Adafruit_BMP280 bmp; &#x2F;&#x2F; I2C  WiFiClient espClient;PubSubClient client(espClient);&#x2F;&#x2F;wifi帳密const char* ssid &#x3D; &quot;---&quot;;const char* password &#x3D; &quot;------&quot;;&#x2F;&#x2F;mqttServerconst char* mqttServer &#x3D; &quot;---.---.---.--&quot;;  &#x2F;&#x2F;設定wifivoid setupWifi()&#123;  WiFi.begin(ssid, password);  while (WiFi.status() !&#x3D; WL_CONNECTED)&#123;    delay(50);    Serial.print(&quot;.&quot;);  &#125;  Serial.println(&quot;connected successful&quot;);  Serial.println(WiFi.localIP());  &#125;    void reconnect()&#123;  while (! client.connected())&#123;    Serial.print(&quot;Attempting MQTT connection...&quot;);    if (client.connect(&quot;esp32Client&quot;))&#123;      Serial.println(&quot;connected&quot;);    &#125;else &#123;      Serial.print(&quot;failed connected is : &quot;);      Serial.println(client.state());      delay(2000);    &#125;  &#125;&#125;  void setup() &#123;  Serial.begin(115200);  Serial.println(F(&quot;BMP280 test&quot;));  setupWifi();  client.setServer(mqttServer, 1883);  if (!bmp.begin()) &#123;    Serial.println(F(&quot;Could not find a valid BMP280 sensor, check wiring or &quot;                      &quot;try a different address!&quot;));    while (1) delay(10);  &#125;&#125;void loop() &#123;    if (! client.connected())&#123;      reconnect();    &#125;    client.loop();    long lastTime &#x3D; 0;    long currentTime &#x3D; millis();    float temp &#x3D; 0;    float pressure &#x3D; 0;    float humi &#x3D; 0;    if (currentTime - lastTime &gt; 5000)&#123;      lastTime &#x3D; currentTime;      temp &#x3D; bmp.readTemperature();      humi &#x3D; 1.8 * temp + 32;      pressure &#x3D; bmp.readPressure();      char tempStr\[8\] &#x3D; &quot;&quot;;      char pressStr\[24\] &#x3D; &quot;&quot;;      char humiStr\[8\] &#x3D; &quot;&quot;;      dtostrf(temp, 1, 2, tempStr);      dtostrf(pressure, 1, 2, pressStr);      dtostrf(humi, 1, 2, humiStr);      Serial.print(&quot;Temp: &quot;);      Serial.println(tempStr);      Serial.print(&quot;humi: &quot;);      Serial.println(humiStr);      Serial.print(&quot;Pressure: &quot;);      Serial.println(pressStr);      client.publish(&quot;esp32&#x2F;temp&quot;, tempStr);      client.publish(&quot;esp32&#x2F;pressure&quot;, pressStr);      client.publish(&quot;esp32&#x2F;humi&quot;, humiStr);      delay(1000);    &#125;&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="解析"><a href="#解析" class="headerlink" title="解析"></a>解析</h2><p><strong>匯入所須的程式庫</strong></p><pre class="line-numbers language-c#" data-language="c#"><code class="language-c#">#include &lt;WiFi.h&gt;#include &lt;PubSubClient.h&gt;#include &lt;Adafruit_BMP280.h&gt;#include &lt;Adafruit_Sensor.h&gt;#include &lt;Wire.h&gt;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><strong>建立bmp280，wifi客戶端及MQTT客戶端代數</strong></p><pre class="line-numbers language-c#" data-language="c#"><code class="language-c#">Adafruit_BMP280 bmp; &#x2F;&#x2F; I2CWiFiClient espClient;PubSubClient client(espClient);  <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><strong>MQTTserver的IP即是樹莓派的IP</strong></p><pre class="line-numbers language-c#" data-language="c#"><code class="language-c#">&#x2F;&#x2F;wifi帳密const char* ssid &#x3D; &quot;---&quot;;const char* password &#x3D; &quot;------&quot;;&#x2F;&#x2F;mqttServerconst char* mqttServer &#x3D; &quot;---.---.---.---&quot;;  &#x2F;&#x2F;設定wifivoid setupWifi()&#123;  WiFi.begin(ssid, password);  while (WiFi.status() !&#x3D; WL_CONNECTED)&#123;    delay(50);    Serial.print(&quot;.&quot;);  &#125;  Serial.println(&quot;connected successful&quot;);  Serial.println(WiFi.localIP());  &#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><strong>連線至MQTT伺服器成功與無法連線的對應動作</strong></p><pre class="line-numbers language-c#" data-language="c#"><code class="language-c#">void reconnect()&#123;  while (! client.connected())&#123;    Serial.print(&quot;Attempting MQTT connection...&quot;);    if (client.connect(&quot;esp32Client&quot;))&#123;      Serial.println(&quot;connected&quot;);    &#125;else &#123;      Serial.print(&quot;failed connected is : &quot;);      Serial.println(client.state());      delay(2000);    &#125;  &#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><strong>void setup(){}裡面的一些必要初始化</strong></p><pre class="line-numbers language-c#" data-language="c#"><code class="language-c#">void setup() &#123;  Serial.begin(115200);  Serial.println(F(&quot;BMP280 test&quot;));  setupWifi();  client.setServer(mqttServer, 1883);  if (!bmp.begin()) &#123;    Serial.println(F(&quot;Could not find a valid BMP280 sensor, check wiring or &quot;                      &quot;try a different address!&quot;));    while (1) delay(10);  &#125;&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><strong>void loop(){}裡</strong></p><p><strong>無法連線就重複連線</strong></p><pre class="line-numbers language-c#" data-language="c#"><code class="language-c#">if (! client.connected())&#123;      reconnect();    &#125;    client.loop();<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><strong><em>關於數值轉字元的函式</em></strong></p><pre class="line-numbers language-c#" data-language="c#"><code class="language-c#">char* dtostrf(double _val,signed char _width, unsigned char prec, char* _s)  <span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>引數說明：<br>_val:要轉換的float或者double值。</p><p>_width:轉換後整數部分長度。</p><p>_prec：轉換後小數部分長度。</p><p>_s:儲存到該char陣列中。</p><p><strong><em>其中這個是轉成對應的字元</em></strong></p><pre class="line-numbers language-c#" data-language="c#"><code class="language-c#">char tempStr[8] &#x3D; &quot;&quot;;char pressStr[24] &#x3D; &quot;&quot;;char humiStr[8] &#x3D; &quot;&quot;;dtostrf(temp, 1, 2, tempStr);dtostrf(pressure, 1, 2, pressStr);dtostrf(humi, 1, 2, humiStr);<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><strong>取得溫度/壓力數值後每5秒發送到MQTT的Node-RED</strong></p><pre class="line-numbers language-c#" data-language="c#"><code class="language-c#">if (currentTime - lastTime &gt; 5000)&#123;      lastTime &#x3D; currentTime;      temp &#x3D; bmp.readTemperature();      humi &#x3D; 1.8 * temp + 32;      pressure &#x3D; bmp.readPressure();      char tempStr[8] &#x3D; &quot;&quot;;      char pressStr[24] &#x3D; &quot;&quot;;      char humiStr[8] &#x3D; &quot;&quot;;      dtostrf(temp, 1, 2, tempStr);      dtostrf(pressure, 1, 2, pressStr);      dtostrf(humi, 1, 2, humiStr);      Serial.print(&quot;Temp: &quot;);      Serial.println(tempStr);      Serial.print(&quot;humi: &quot;);      Serial.println(humiStr);      Serial.print(&quot;Pressure: &quot;);      Serial.println(pressStr);      client.publish(&quot;esp32&#x2F;temp&quot;, tempStr);      client.publish(&quot;esp32&#x2F;pressure&quot;, pressStr);      client.publish(&quot;esp32&#x2F;humi&quot;, humiStr);      delay(1000);    &#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p> <a href="https://draft.blogger.com/blog/post/edit/3809681606094011522/5842507104876900238?hl=zh-TW#"><img src="https://lh3.googleusercontent.com/-ysEI3JQaSG4/YQYUjIdUS-I/AAAAAAAAemY/eaOvIOCh2Zkcz5SrWboitrz4Ji02B7hegCNcBGAsYHQ/s1600/1627788424761991-0.png"></a> </p><hr>]]></content>
      
      
      <categories>
          
          <category> esp32 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> bmp280 </tag>
            
            <tag> mqtt </tag>
            
            <tag> node-red </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>DHT11/12網路監測溫濕度計-micropython</title>
      <link href="/2021/08/29/dht11-12-wang-lu-jian-ce-wen-shi-du-ji-micropython-1/"/>
      <url>/2021/08/29/dht11-12-wang-lu-jian-ce-wen-shi-du-ji-micropython-1/</url>
      
        <content type="html"><![CDATA[<h1 id="DHT11-12網路監測溫濕度計-micropython"><a href="#DHT11-12網路監測溫濕度計-micropython" class="headerlink" title="DHT11/12網路監測溫濕度計-micropython"></a>DHT11/12網路監測溫濕度計-micropython</h1><h6 id="tags-micropython-dht11-12-webserver"><a href="#tags-micropython-dht11-12-webserver" class="headerlink" title="tags: micropython dht11/12 webserver"></a>tags: <code>micropython</code> <code>dht11/12 webserver</code></h6><hr><p><strong><em>DHT11/12單純測試參考頁面-</em></strong></p><p><a href="https://draft.blogger.com/blog/post/edit/6280040346040914276/5661741645243406963?hl=zh-TW#">https://blairan-esp32-micropython.blogspot.com/2021/07/dht11dht12-micropython.html</a></p><p><em><strong>WiFi聯網參考-</strong></em><a href="https://draft.blogger.com/blog/post/edit/6280040346040914276/5661741645243406963?hl=zh-TW#">https://blairan-esp32-micropython.blogspot.com/2021/07/wifi.html</a></p><hr><h2 id="完整程式碼"><a href="#完整程式碼" class="headerlink" title="完整程式碼"></a>完整程式碼</h2><pre class="line-numbers language-py" data-language="py"><code class="language-py">import dhtimport network, socketfrom machine import Pinfrom time import sleep  ssid&#x3D;&quot;---&quot;password&#x3D;&quot;------&quot;STA&#x3D;network.WLAN(network.STA_IF)STA.active(True)STA.connect(ssid, password)while STA.isconnected()&#x3D;&#x3D;False:    passprint(&quot;The connected successful!&quot;)print(&quot;IP:  &#123;&#125;&quot;.format(STA.ifconfig()))def readTempAndHumi():    global temp, humi    try:        sensor&#x3D;dht.DHT11(Pin(4))        sensor.measure()        temp&#x3D;sensor.temperature()        humi&#x3D;sensor.humidity()        if (isinstance(temp, float) and isinstance(humi, float)) or (isinstance(temp, int) and isinstance(humi, int)):          measureResult&#x3D;&quot;&#123;&#125;,&#123;&#125;&quot;.format(temp, humi)          return measureResult        else:          return (&quot;--&quot;)    except OSError as o:        print(&quot;--&quot;)def Htmlpage():  html&#x3D; &quot;&quot;&quot;        &lt;html&gt;    &lt;head&gt;      &lt;meta charset&#x3D;&quot;utf-8&quot; &#x2F;&gt;      &lt;meta name&#x3D;&quot;viewport&quot; content&#x3D;&quot;width&#x3D;device-width, initial-scale&#x3D;1.0&quot; &#x2F;&gt;      &lt;style&gt;        h1  &#123;text-align: center; background-color: orange; margin-right:5px;&#125;        dl &#123; width: 320px; margin: 12px auto; &#125;        dt &#123;           font-size: 20pt; color: #444; background-color: #ddd;          margin: 6pt 0; padding: 6pt 12pt;        &#125;        dd &#123;          text-align: right; padding-right: 6pt;        &#125;        .num &#123; font-size: 36pt; color: dodgerblue; &#125;      &lt;&#x2F;style&gt;      &lt;&#x2F;head&gt;    &lt;body&gt;      &lt;p&gt;&lt;h1&gt;ESP32 DHT11&#x2F;12&lt;&#x2F;h1&gt;&lt;&#x2F;p&gt;      &lt;dl&gt;        &lt;dt&gt;Temp&lt;&#x2F;dt&gt;        &lt;dd class&#x3D;num&gt;&quot;&quot;&quot;+str(temp)+&quot;&quot;&quot;°C&lt;&#x2F;dd&gt;        &lt;dt&gt;Humi&lt;&#x2F;dt&gt;        &lt;dd class&#x3D;num&gt;&quot;&quot;&quot;+str(humi)+&quot;&quot;&quot; %&lt;&#x2F;dd&gt;      &lt;&#x2F;dl&gt;    &lt;&#x2F;body&gt;    &lt;&#x2F;html&gt;    &quot;&quot;&quot;  return html  s&#x3D;socket.socket(socket.AF_INET, socket.SOCK_STREAM)s.bind((&#39;&#39;, 80))s.listen(5)  while True:    conn, addr &#x3D; s.accept()    print(&#39;Got a connection from %s&#39; % str(addr))    req &#x3D; conn.recv(1024)    print(&#39;Content &#x3D; %s&#39; % str(req))    sensor_reading &#x3D; readTempAndHumi()    print(sensor_reading)    respone &#x3D; Htmlpage()    conn.send(&quot;http&#x2F;1.1 200 OK\n&quot;)    conn.send(&quot;Content-Type: text&#x2F;html; charset&#x3D;&#39;utf-8&#39;\n&quot;)    conn.send(&quot;Connection: close\n\n&quot;)    conn.sendall(respone)    conn.close()<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="解析"><a href="#解析" class="headerlink" title="解析"></a>解析</h2><pre class="line-numbers language-py" data-language="py"><code class="language-py">**_載入dht,wifi,端口,pin和時間模組_**import dhtimport network, socketfrom machine import Pinfrom time import sleep<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><strong><em>這個部份是設制WiFi的流程</em></strong></p><pre class="line-numbers language-py" data-language="py"><code class="language-py">ssid&#x3D;&quot;基地台名稱&quot;password&#x3D;&quot;基地台密碼&quot;  STA&#x3D;network.WLAN(network.STA_IF)STA.active(True)STA.connect(ssid, password)  while STA.isconnected()&#x3D;&#x3D;False:    passprint(&quot;The connected successful!&quot;)print(&quot;IP:  &#123;&#125;&quot;.format(STA.ifconfig()))<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><strong><em>讀取溫溼度的函式</em></strong></p><pre class="line-numbers language-py" data-language="py"><code class="language-py">def readTempAndHumi():    global temp, humi    try:        sensor&#x3D;dht.DHT11(Pin(4))        sensor.measure()        temp&#x3D;sensor.temperature()        humi&#x3D;sensor.humidity()        if (isinstance(temp, float) and isinstance(humi, float)) or (isinstance(temp, int) and isinstance(humi, int)):          measureResult&#x3D;&quot;&#123;&#125;,&#123;&#125;&quot;.format(temp, humi)          return measureResult        else:          return (&quot;--&quot;)    except OSError as o:        print(&quot;--&quot;)<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><strong>網頁前端的布置,記得要讓其讀取時可返回(return)</strong></p><p><strong>其中須注意的是讓溫溼度的值可以正顯示要使用</strong>“””+str(溫/溼度變數)+”””</p><pre class="line-numbers language-html" data-language="html"><code class="language-html">def Htmlpage():  html= """        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span><span class="token punctuation">></span></span>      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">charset</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>utf-8<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span>      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>viewport<span class="token punctuation">"</span></span> <span class="token attr-name">content</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>width=device-width, initial-scale=1.0<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span>      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>style</span><span class="token punctuation">></span></span><span class="token style"><span class="token language-css">        <span class="token selector">h1</span>  <span class="token punctuation">&#123;</span><span class="token property">text-align</span><span class="token punctuation">:</span> center<span class="token punctuation">;</span> background-color<span class="token punctuation">:</span> orange<span class="token punctuation">;</span> margin-right<span class="token punctuation">:</span>5px<span class="token punctuation">;</span><span class="token punctuation">&#125;</span>        <span class="token selector">dl</span> <span class="token punctuation">&#123;</span> width<span class="token punctuation">:</span> 320px<span class="token punctuation">;</span> margin<span class="token punctuation">:</span> 12px auto<span class="token punctuation">;</span> <span class="token punctuation">&#125;</span>        <span class="token selector">dt</span> <span class="token punctuation">&#123;</span>           font-size<span class="token punctuation">:</span> 20pt<span class="token punctuation">;</span> color<span class="token punctuation">:</span> #444<span class="token punctuation">;</span> background-color<span class="token punctuation">:</span> #ddd<span class="token punctuation">;</span>          margin<span class="token punctuation">:</span> 6pt 0<span class="token punctuation">;</span> padding<span class="token punctuation">:</span> 6pt 12pt<span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>        <span class="token selector">dd</span> <span class="token punctuation">&#123;</span>          text-align<span class="token punctuation">:</span> right<span class="token punctuation">;</span> padding-right<span class="token punctuation">:</span> 6pt<span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>        <span class="token selector">.num</span> <span class="token punctuation">&#123;</span> font-size<span class="token punctuation">:</span> 36pt<span class="token punctuation">;</span> color<span class="token punctuation">:</span> dodgerblue<span class="token punctuation">;</span> <span class="token punctuation">&#125;</span>      </span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>style</span><span class="token punctuation">></span></span>      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>head</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">></span></span>      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h1</span><span class="token punctuation">></span></span>ESP32 DHT11/12<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h1</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">></span></span>      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dl</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dt</span><span class="token punctuation">></span></span>Temp<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dt</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dd</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span>num</span><span class="token punctuation">></span></span>"""+str(temp)+"""°C<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dd</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dt</span><span class="token punctuation">></span></span>Humi<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dt</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dd</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span>num</span><span class="token punctuation">></span></span>"""+str(humi)+""" %<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dd</span><span class="token punctuation">></span></span>      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dl</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">></span></span>    """  return html<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><strong><em>設制監聽套接端口</em></strong></p><p><strong><em>函式參考-</em></strong><a href="https://draft.blogger.com/blog/post/edit/6280040346040914276/5661741645243406963?hl=zh-TW#">我的micropython函式筆記</a></p><pre class="line-numbers language-py" data-language="py"><code class="language-py">s&#x3D;socket.socket(socket.AF_INET, socket.SOCK_STREAM)s.bind((&#39;&#39;, 80))s.listen(5)while True:    conn, addr &#x3D; s.accept()    print(&#39;Got a connection from %s&#39; % str(addr))    req &#x3D; conn.recv(1024)    print(&#39;Content &#x3D; %s&#39; % str(req))    sensor_reading &#x3D; readTempAndHumi()    print(sensor_reading)    respone &#x3D; Htmlpage()    conn.send(&quot;http&#x2F;1.1 200 OK\n&quot;)    conn.send(&quot;Content-Type: text&#x2F;html; charset&#x3D;&#39;utf-8&#39;\n&quot;)    conn.send(&quot;Connection: close\n\n&quot;)    conn.sendall(respone)    conn.close()<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><a href="https://draft.blogger.com/blog/post/edit/6280040346040914276/5661741645243406963?hl=zh-TW#"><img src="https://lh3.googleusercontent.com/-stu-h6hdsgc/YOaaTDfLfOI/AAAAAAAAeaQ/NiNjk1xHXl0YOU_J8btvb9Qd3isHo6ZvwCNcBGAsYHQ/s1600/1625725506698515-0.png"></a></p>]]></content>
      
      
      <categories>
          
          <category> micropython </category>
          
          <category> esp32 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> dht11/dht12 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>DS1306實時時鐘模組-micropython</title>
      <link href="/2021/08/29/ds1306-shi-shi-shi-zhong-mo-zu-micropython/"/>
      <url>/2021/08/29/ds1306-shi-shi-shi-zhong-mo-zu-micropython/</url>
      
        <content type="html"><![CDATA[<h1 id="DS1306實時時鐘模組-micropython"><a href="#DS1306實時時鐘模組-micropython" class="headerlink" title="DS1306實時時鐘模組-micropython"></a>DS1306實時時鐘模組-micropython</h1><h6 id="tags-micropython-ds1302"><a href="#tags-micropython-ds1302" class="headerlink" title="tags: micropython ds1302"></a>tags: <code>micropython</code> <code>ds1302</code></h6><p>這是廣華電子上的介紹<br>◎ 時鐘具有能計算2100 年之前的秒、分、時、日、星期、月、年的能力，還有閏年調整的能力<br>◎ 31 8 位暫存數據存儲RAM<br>◎ 串行 I/O 口方式使得管腳數量最少<br>◎ 寬範圍工作電壓2.0 5.5V<br>◎ 工作電流 2.0V 時,小於300nA<br>◎ 讀 / 寫時鐘或RAM 數據時有兩種傳送方式單字節傳送和多字節傳送字符組方式<br>◎ 8 腳DIP 封裝或可選的8 腳SOIC 封裝根據表面裝配<br>◎ 簡單 3 線接口<br>◎ 與 TTL 相容Vcc=5V<br>◎ 雙電源管用於主電源和備份電源供應<br>◎ 電池：CR2032 電壓3V，電流260mAh<br>◎ 晶振32.768KHz，匹配電容為6pF<br>◎ DS1302為8腳直插大晶片，晶片下面有IC座，方便更換及插拔片<br>6.模塊工作電壓兼容3.3V/5V，可與5V及3.3V單片機連接<br>◎帶4個定位孔，直徑3.1mm<br>◎工作溫度：0°～70°</p><p>◎ 安裝注意!<br>1.VCC與GND千萬不要接反，以免燒壞晶片<br>2.51系列單晶片P0接腳需要連接上拉電阻，如果單晶片沒有連接上拉電阻，可以將數據線接到其他接腳</p><h2 id="步驟1"><a href="#步驟1" class="headerlink" title="步驟1:"></a>步驟1:</h2><p>下載sd1306.py並上傳到微控板上<br><a href="https://github.com/omarbenhamid/micropython-ds1302-rtc">https://github.com/omarbenhamid/micropython-ds1302-rtc</a></p><pre class="line-numbers language-py" data-language="py"><code class="language-py"><span class="token keyword">from</span> machine <span class="token keyword">import</span> PinDS1302_REG_SECOND <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token number">0x80</span><span class="token punctuation">)</span>DS1302_REG_MINUTE <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token number">0x82</span><span class="token punctuation">)</span>DS1302_REG_HOUR   <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token number">0x84</span><span class="token punctuation">)</span>DS1302_REG_DAY    <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token number">0x86</span><span class="token punctuation">)</span>DS1302_REG_MONTH  <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token number">0x88</span><span class="token punctuation">)</span>DS1302_REG_WEEKDAY<span class="token operator">=</span> <span class="token punctuation">(</span><span class="token number">0x8A</span><span class="token punctuation">)</span>DS1302_REG_YEAR   <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token number">0x8C</span><span class="token punctuation">)</span>DS1302_REG_WP     <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token number">0x8E</span><span class="token punctuation">)</span>DS1302_REG_CTRL   <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token number">0x90</span><span class="token punctuation">)</span>DS1302_REG_RAM    <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token number">0xC0</span><span class="token punctuation">)</span><span class="token keyword">class</span> <span class="token class-name">DS1302</span><span class="token punctuation">:</span>    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> clk<span class="token punctuation">,</span> dio<span class="token punctuation">,</span> cs<span class="token punctuation">)</span><span class="token punctuation">:</span>        self<span class="token punctuation">.</span>clk <span class="token operator">=</span> clk        self<span class="token punctuation">.</span>dio <span class="token operator">=</span> dio        self<span class="token punctuation">.</span>cs <span class="token operator">=</span> cs        self<span class="token punctuation">.</span>clk<span class="token punctuation">.</span>init<span class="token punctuation">(</span>Pin<span class="token punctuation">.</span>OUT<span class="token punctuation">)</span>        self<span class="token punctuation">.</span>cs<span class="token punctuation">.</span>init<span class="token punctuation">(</span>Pin<span class="token punctuation">.</span>OUT<span class="token punctuation">)</span>    <span class="token keyword">def</span> <span class="token function">_dec2hex</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> dat<span class="token punctuation">)</span><span class="token punctuation">:</span>        <span class="token keyword">return</span> <span class="token punctuation">(</span>dat<span class="token operator">//</span><span class="token number">10</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">16</span> <span class="token operator">+</span> <span class="token punctuation">(</span>dat <span class="token operator">%</span> <span class="token number">10</span><span class="token punctuation">)</span>    <span class="token keyword">def</span> <span class="token function">_hex2dec</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> dat<span class="token punctuation">)</span><span class="token punctuation">:</span>        <span class="token keyword">return</span> <span class="token punctuation">(</span>dat<span class="token operator">//</span><span class="token number">16</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">10</span> <span class="token operator">+</span> <span class="token punctuation">(</span>dat <span class="token operator">%</span> <span class="token number">16</span><span class="token punctuation">)</span>    <span class="token keyword">def</span> <span class="token function">_write_byte</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> dat<span class="token punctuation">)</span><span class="token punctuation">:</span>        self<span class="token punctuation">.</span>dio<span class="token punctuation">.</span>init<span class="token punctuation">(</span>Pin<span class="token punctuation">.</span>OUT<span class="token punctuation">)</span>        <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">8</span><span class="token punctuation">)</span><span class="token punctuation">:</span>            self<span class="token punctuation">.</span>dio<span class="token punctuation">.</span>value<span class="token punctuation">(</span><span class="token punctuation">(</span>dat <span class="token operator">>></span> i<span class="token punctuation">)</span> <span class="token operator">&amp;</span> <span class="token number">1</span><span class="token punctuation">)</span>            self<span class="token punctuation">.</span>clk<span class="token punctuation">.</span>value<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>            self<span class="token punctuation">.</span>clk<span class="token punctuation">.</span>value<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>    <span class="token keyword">def</span> <span class="token function">_read_byte</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>        d <span class="token operator">=</span> <span class="token number">0</span>        self<span class="token punctuation">.</span>dio<span class="token punctuation">.</span>init<span class="token punctuation">(</span>Pin<span class="token punctuation">.</span>IN<span class="token punctuation">)</span>        <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">8</span><span class="token punctuation">)</span><span class="token punctuation">:</span>            d <span class="token operator">=</span> d <span class="token operator">|</span> <span class="token punctuation">(</span>self<span class="token punctuation">.</span>dio<span class="token punctuation">.</span>value<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> i<span class="token punctuation">)</span>            self<span class="token punctuation">.</span>clk<span class="token punctuation">.</span>value<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>            self<span class="token punctuation">.</span>clk<span class="token punctuation">.</span>value<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>        <span class="token keyword">return</span> d    <span class="token keyword">def</span> <span class="token function">_get_reg</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> reg<span class="token punctuation">)</span><span class="token punctuation">:</span>        self<span class="token punctuation">.</span>cs<span class="token punctuation">.</span>value<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>        self<span class="token punctuation">.</span>_write_byte<span class="token punctuation">(</span>reg<span class="token punctuation">)</span>        t <span class="token operator">=</span> self<span class="token punctuation">.</span>_read_byte<span class="token punctuation">(</span><span class="token punctuation">)</span>        self<span class="token punctuation">.</span>cs<span class="token punctuation">.</span>value<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>        <span class="token keyword">return</span> t    <span class="token keyword">def</span> <span class="token function">_set_reg</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> reg<span class="token punctuation">,</span> dat<span class="token punctuation">)</span><span class="token punctuation">:</span>        self<span class="token punctuation">.</span>cs<span class="token punctuation">.</span>value<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>        self<span class="token punctuation">.</span>_write_byte<span class="token punctuation">(</span>reg<span class="token punctuation">)</span>        self<span class="token punctuation">.</span>_write_byte<span class="token punctuation">(</span>dat<span class="token punctuation">)</span>        self<span class="token punctuation">.</span>cs<span class="token punctuation">.</span>value<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>    <span class="token keyword">def</span> <span class="token function">_wr</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> reg<span class="token punctuation">,</span> dat<span class="token punctuation">)</span><span class="token punctuation">:</span>        self<span class="token punctuation">.</span>_set_reg<span class="token punctuation">(</span>DS1302_REG_WP<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span>        self<span class="token punctuation">.</span>_set_reg<span class="token punctuation">(</span>reg<span class="token punctuation">,</span> dat<span class="token punctuation">)</span>        self<span class="token punctuation">.</span>_set_reg<span class="token punctuation">(</span>DS1302_REG_WP<span class="token punctuation">,</span> <span class="token number">0x80</span><span class="token punctuation">)</span>    <span class="token keyword">def</span> <span class="token function">start</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>        t <span class="token operator">=</span> self<span class="token punctuation">.</span>_get_reg<span class="token punctuation">(</span>DS1302_REG_SECOND <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span>        self<span class="token punctuation">.</span>_wr<span class="token punctuation">(</span>DS1302_REG_SECOND<span class="token punctuation">,</span> t <span class="token operator">&amp;</span> <span class="token number">0x7f</span><span class="token punctuation">)</span>    <span class="token keyword">def</span> <span class="token function">stop</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>        t <span class="token operator">=</span> self<span class="token punctuation">.</span>_get_reg<span class="token punctuation">(</span>DS1302_REG_SECOND <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span>        self<span class="token punctuation">.</span>_wr<span class="token punctuation">(</span>DS1302_REG_SECOND<span class="token punctuation">,</span> t <span class="token operator">|</span> <span class="token number">0x80</span><span class="token punctuation">)</span>    <span class="token keyword">def</span> <span class="token function">second</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> second<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">)</span><span class="token punctuation">:</span>        <span class="token keyword">if</span> second <span class="token operator">==</span> <span class="token boolean">None</span><span class="token punctuation">:</span>            <span class="token keyword">return</span> self<span class="token punctuation">.</span>_hex2dec<span class="token punctuation">(</span>self<span class="token punctuation">.</span>_get_reg<span class="token punctuation">(</span>DS1302_REG_SECOND<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">%</span> <span class="token number">60</span>        <span class="token keyword">else</span><span class="token punctuation">:</span>            self<span class="token punctuation">.</span>_wr<span class="token punctuation">(</span>DS1302_REG_SECOND<span class="token punctuation">,</span> self<span class="token punctuation">.</span>_dec2hex<span class="token punctuation">(</span>second <span class="token operator">%</span> <span class="token number">60</span><span class="token punctuation">)</span><span class="token punctuation">)</span>    <span class="token keyword">def</span> <span class="token function">minute</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> minute<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">)</span><span class="token punctuation">:</span>        <span class="token keyword">if</span> minute <span class="token operator">==</span> <span class="token boolean">None</span><span class="token punctuation">:</span>            <span class="token keyword">return</span> self<span class="token punctuation">.</span>_hex2dec<span class="token punctuation">(</span>self<span class="token punctuation">.</span>_get_reg<span class="token punctuation">(</span>DS1302_REG_MINUTE<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span>        <span class="token keyword">else</span><span class="token punctuation">:</span>            self<span class="token punctuation">.</span>_wr<span class="token punctuation">(</span>DS1302_REG_MINUTE<span class="token punctuation">,</span> self<span class="token punctuation">.</span>_dec2hex<span class="token punctuation">(</span>minute <span class="token operator">%</span> <span class="token number">60</span><span class="token punctuation">)</span><span class="token punctuation">)</span>    <span class="token keyword">def</span> <span class="token function">hour</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> hour<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">)</span><span class="token punctuation">:</span>        <span class="token keyword">if</span> hour <span class="token operator">==</span> <span class="token boolean">None</span><span class="token punctuation">:</span>            <span class="token keyword">return</span> self<span class="token punctuation">.</span>_hex2dec<span class="token punctuation">(</span>self<span class="token punctuation">.</span>_get_reg<span class="token punctuation">(</span>DS1302_REG_HOUR<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span>        <span class="token keyword">else</span><span class="token punctuation">:</span>            self<span class="token punctuation">.</span>_wr<span class="token punctuation">(</span>DS1302_REG_HOUR<span class="token punctuation">,</span> self<span class="token punctuation">.</span>_dec2hex<span class="token punctuation">(</span>hour <span class="token operator">%</span> <span class="token number">24</span><span class="token punctuation">)</span><span class="token punctuation">)</span>    <span class="token keyword">def</span> <span class="token function">weekday</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> weekday<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">)</span><span class="token punctuation">:</span>        <span class="token keyword">if</span> weekday <span class="token operator">==</span> <span class="token boolean">None</span><span class="token punctuation">:</span>            <span class="token keyword">return</span> self<span class="token punctuation">.</span>_hex2dec<span class="token punctuation">(</span>self<span class="token punctuation">.</span>_get_reg<span class="token punctuation">(</span>DS1302_REG_WEEKDAY<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span>        <span class="token keyword">else</span><span class="token punctuation">:</span>            self<span class="token punctuation">.</span>_wr<span class="token punctuation">(</span>DS1302_REG_WEEKDAY<span class="token punctuation">,</span> self<span class="token punctuation">.</span>_dec2hex<span class="token punctuation">(</span>weekday <span class="token operator">%</span> <span class="token number">8</span><span class="token punctuation">)</span><span class="token punctuation">)</span>    <span class="token keyword">def</span> <span class="token function">day</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> day<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">)</span><span class="token punctuation">:</span>        <span class="token keyword">if</span> day <span class="token operator">==</span> <span class="token boolean">None</span><span class="token punctuation">:</span>            <span class="token keyword">return</span> self<span class="token punctuation">.</span>_hex2dec<span class="token punctuation">(</span>self<span class="token punctuation">.</span>_get_reg<span class="token punctuation">(</span>DS1302_REG_DAY<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span>        <span class="token keyword">else</span><span class="token punctuation">:</span>            self<span class="token punctuation">.</span>_wr<span class="token punctuation">(</span>DS1302_REG_DAY<span class="token punctuation">,</span> self<span class="token punctuation">.</span>_dec2hex<span class="token punctuation">(</span>day <span class="token operator">%</span> <span class="token number">32</span><span class="token punctuation">)</span><span class="token punctuation">)</span>    <span class="token keyword">def</span> <span class="token function">month</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> month<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">)</span><span class="token punctuation">:</span>        <span class="token keyword">if</span> month <span class="token operator">==</span> <span class="token boolean">None</span><span class="token punctuation">:</span>            <span class="token keyword">return</span> self<span class="token punctuation">.</span>_hex2dec<span class="token punctuation">(</span>self<span class="token punctuation">.</span>_get_reg<span class="token punctuation">(</span>DS1302_REG_MONTH<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span>        <span class="token keyword">else</span><span class="token punctuation">:</span>            self<span class="token punctuation">.</span>_wr<span class="token punctuation">(</span>DS1302_REG_MONTH<span class="token punctuation">,</span> self<span class="token punctuation">.</span>_dec2hex<span class="token punctuation">(</span>month <span class="token operator">%</span> <span class="token number">13</span><span class="token punctuation">)</span><span class="token punctuation">)</span>    <span class="token keyword">def</span> <span class="token function">year</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> year<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">)</span><span class="token punctuation">:</span>        <span class="token keyword">if</span> year <span class="token operator">==</span> <span class="token boolean">None</span><span class="token punctuation">:</span>            <span class="token keyword">return</span> self<span class="token punctuation">.</span>_hex2dec<span class="token punctuation">(</span>self<span class="token punctuation">.</span>_get_reg<span class="token punctuation">(</span>DS1302_REG_YEAR<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">2000</span>        <span class="token keyword">else</span><span class="token punctuation">:</span>            self<span class="token punctuation">.</span>_wr<span class="token punctuation">(</span>DS1302_REG_YEAR<span class="token punctuation">,</span> self<span class="token punctuation">.</span>_dec2hex<span class="token punctuation">(</span>year <span class="token operator">%</span> <span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">)</span>    <span class="token keyword">def</span> <span class="token function">date_time</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> dat<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">)</span><span class="token punctuation">:</span>        <span class="token keyword">if</span> dat <span class="token operator">==</span> <span class="token boolean">None</span><span class="token punctuation">:</span>            <span class="token keyword">return</span> <span class="token punctuation">[</span>self<span class="token punctuation">.</span>year<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> self<span class="token punctuation">.</span>month<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> self<span class="token punctuation">.</span>day<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> self<span class="token punctuation">.</span>weekday<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> self<span class="token punctuation">.</span>hour<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> self<span class="token punctuation">.</span>minute<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> self<span class="token punctuation">.</span>second<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">]</span>        <span class="token keyword">else</span><span class="token punctuation">:</span>            self<span class="token punctuation">.</span>year<span class="token punctuation">(</span>dat<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span>            self<span class="token punctuation">.</span>month<span class="token punctuation">(</span>dat<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span>            self<span class="token punctuation">.</span>day<span class="token punctuation">(</span>dat<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">)</span>            self<span class="token punctuation">.</span>weekday<span class="token punctuation">(</span>dat<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">)</span>            self<span class="token punctuation">.</span>hour<span class="token punctuation">(</span>dat<span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">]</span><span class="token punctuation">)</span>            self<span class="token punctuation">.</span>minute<span class="token punctuation">(</span>dat<span class="token punctuation">[</span><span class="token number">5</span><span class="token punctuation">]</span><span class="token punctuation">)</span>            self<span class="token punctuation">.</span>second<span class="token punctuation">(</span>dat<span class="token punctuation">[</span><span class="token number">6</span><span class="token punctuation">]</span><span class="token punctuation">)</span>    <span class="token keyword">def</span> <span class="token function">ram</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> reg<span class="token punctuation">,</span> dat<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">)</span><span class="token punctuation">:</span>        <span class="token keyword">if</span> dat <span class="token operator">==</span> <span class="token boolean">None</span><span class="token punctuation">:</span>            <span class="token keyword">return</span> self<span class="token punctuation">.</span>_get_reg<span class="token punctuation">(</span>DS1302_REG_RAM <span class="token operator">+</span> <span class="token number">1</span> <span class="token operator">+</span> <span class="token punctuation">(</span>reg <span class="token operator">%</span> <span class="token number">31</span><span class="token punctuation">)</span><span class="token operator">*</span><span class="token number">2</span><span class="token punctuation">)</span>        <span class="token keyword">else</span><span class="token punctuation">:</span>            self<span class="token punctuation">.</span>_wr<span class="token punctuation">(</span>DS1302_REG_RAM <span class="token operator">+</span> <span class="token punctuation">(</span>reg <span class="token operator">%</span> <span class="token number">31</span><span class="token punctuation">)</span><span class="token operator">*</span><span class="token number">2</span><span class="token punctuation">,</span> dat<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="步驟2"><a href="#步驟2" class="headerlink" title="步驟2:"></a>步驟2:</h2><pre class="line-numbers language-none"><code class="language-none">&#x2F;&#x2F; DS1302 CLK&#x2F;SCLK --&gt;  5&#x2F;&#x2F; DS1302 DAT&#x2F;IO --&gt;  4&#x2F;&#x2F; DS1302 RST&#x2F;CE --&gt;  2&#x2F;&#x2F; DS1302 VCC --&gt;  3.3v - 5v&#x2F;&#x2F; DS1302 GND --&gt;  GND<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="步驟3"><a href="#步驟3" class="headerlink" title="步驟3:"></a>步驟3:</h2><p>上傳程式碼</p><pre class="line-numbers language-py" data-language="py"><code class="language-py"><span class="token keyword">import</span> ds1302<span class="token keyword">from</span> machine <span class="token keyword">import</span> PIN_WAKE<span class="token punctuation">,</span> Pin<span class="token keyword">import</span> timeds <span class="token operator">=</span> ds1302<span class="token punctuation">.</span>DS1302<span class="token punctuation">(</span>Pin<span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">,</span> Pin<span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">,</span> Pin<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token keyword">while</span> <span class="token boolean">True</span><span class="token punctuation">:</span>    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"Today is &#123;&#125;/&#123;&#125;/&#123;&#125;"</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>ds<span class="token punctuation">.</span>year<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> ds<span class="token punctuation">.</span>month<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> ds<span class="token punctuation">.</span>day<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"Time: &#123;&#125;:&#123;&#125;:&#123;&#125;"</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>ds<span class="token punctuation">.</span>hour<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> ds<span class="token punctuation">.</span>minute<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> ds<span class="token punctuation">.</span>second<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"="</span><span class="token operator">*</span><span class="token number">10</span><span class="token punctuation">)</span>    time<span class="token punctuation">.</span>sleep<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-none"><code class="language-none">Today is 2021&#x2F;7&#x2F;28Time: 12:19:18&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;Today is 2021&#x2F;7&#x2F;28Time: 12:19:19&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;Today is 2021&#x2F;7&#x2F;28Time: 12:19:20&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;Today is 2021&#x2F;7&#x2F;28Time: 12:19:21&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="步驟4"><a href="#步驟4" class="headerlink" title="步驟4:"></a>步驟4:</h2><p>再將ssd1306.py下載後並上傳到微控板</p><h2 id="步驟5"><a href="#步驟5" class="headerlink" title="步驟5:"></a>步驟5:</h2><p>oled接線</p><h2 id="步驟6"><a href="#步驟6" class="headerlink" title="步驟6:"></a>步驟6:</h2><pre class="line-numbers language-py" data-language="py"><code class="language-py"><span class="token keyword">import</span> ds1302<span class="token punctuation">,</span> ssd1306<span class="token keyword">from</span> machine <span class="token keyword">import</span> PIN_WAKE<span class="token punctuation">,</span> Pin<span class="token keyword">from</span> machine <span class="token keyword">import</span> SoftI2C<span class="token keyword">import</span> timewidth <span class="token operator">=</span> <span class="token number">128</span>height <span class="token operator">=</span> <span class="token number">64</span>i2c <span class="token operator">=</span> SoftI2C<span class="token punctuation">(</span>scl<span class="token operator">=</span>Pin<span class="token punctuation">(</span><span class="token number">22</span><span class="token punctuation">)</span><span class="token punctuation">,</span> sda<span class="token operator">=</span>Pin<span class="token punctuation">(</span><span class="token number">21</span><span class="token punctuation">)</span><span class="token punctuation">)</span>oled <span class="token operator">=</span> ssd1306<span class="token punctuation">.</span>SSD1306_I2C<span class="token punctuation">(</span>width<span class="token punctuation">,</span> height<span class="token punctuation">,</span> i2c<span class="token punctuation">)</span>ds <span class="token operator">=</span> ds1302<span class="token punctuation">.</span>DS1302<span class="token punctuation">(</span>Pin<span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">,</span> Pin<span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">,</span> Pin<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token keyword">while</span> <span class="token boolean">True</span><span class="token punctuation">:</span>    oled<span class="token punctuation">.</span>text<span class="token punctuation">(</span><span class="token builtin">str</span><span class="token punctuation">(</span>ds<span class="token punctuation">.</span>year<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span>    oled<span class="token punctuation">.</span>text<span class="token punctuation">(</span><span class="token string">"/"</span><span class="token punctuation">,</span> <span class="token number">30</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span>    oled<span class="token punctuation">.</span>text<span class="token punctuation">(</span><span class="token builtin">str</span><span class="token punctuation">(</span>ds<span class="token punctuation">.</span>month<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">40</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span>    oled<span class="token punctuation">.</span>text<span class="token punctuation">(</span><span class="token string">"/"</span><span class="token punctuation">,</span> <span class="token number">50</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span>    oled<span class="token punctuation">.</span>text<span class="token punctuation">(</span><span class="token builtin">str</span><span class="token punctuation">(</span>ds<span class="token punctuation">.</span>day<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">60</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span>        oled<span class="token punctuation">.</span>text<span class="token punctuation">(</span><span class="token builtin">str</span><span class="token punctuation">(</span>ds<span class="token punctuation">.</span>hour<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">30</span><span class="token punctuation">,</span> <span class="token number">30</span><span class="token punctuation">)</span>    oled<span class="token punctuation">.</span>text<span class="token punctuation">(</span><span class="token string">":"</span><span class="token punctuation">,</span> <span class="token number">50</span><span class="token punctuation">,</span> <span class="token number">30</span><span class="token punctuation">)</span>    oled<span class="token punctuation">.</span>text<span class="token punctuation">(</span><span class="token builtin">str</span><span class="token punctuation">(</span>ds<span class="token punctuation">.</span>minute<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">60</span><span class="token punctuation">,</span> <span class="token number">30</span><span class="token punctuation">)</span>    oled<span class="token punctuation">.</span>text<span class="token punctuation">(</span><span class="token string">":"</span><span class="token punctuation">,</span> <span class="token number">80</span><span class="token punctuation">,</span> <span class="token number">30</span><span class="token punctuation">)</span>    oled<span class="token punctuation">.</span>text<span class="token punctuation">(</span><span class="token builtin">str</span><span class="token punctuation">(</span>ds<span class="token punctuation">.</span>second<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">90</span><span class="token punctuation">,</span> <span class="token number">30</span><span class="token punctuation">)</span>    oled<span class="token punctuation">.</span>show<span class="token punctuation">(</span><span class="token punctuation">)</span>    time<span class="token punctuation">.</span>sleep<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><div class="video-container"><iframe src="https://www.youtube.com/embed/HnIFDhD1DxY" frameborder="0" loading="lazy" allowfullscreen></iframe></div>]]></content>
      
      
      <categories>
          
          <category> micropython </category>
          
          <category> esp32 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> ds1306 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>DS18B20溫度感應模組+顯示網頁-micropython</title>
      <link href="/2021/08/29/ds18b20-wen-du-gan-ying-mo-zu-xian-shi-wang-ye-micropython/"/>
      <url>/2021/08/29/ds18b20-wen-du-gan-ying-mo-zu-xian-shi-wang-ye-micropython/</url>
      
        <content type="html"><![CDATA[<h1 id="DS18B20溫度感應模組-顯示網頁-micropython"><a href="#DS18B20溫度感應模組-顯示網頁-micropython" class="headerlink" title="DS18B20溫度感應模組+顯示網頁-micropython"></a>DS18B20溫度感應模組+顯示網頁-micropython</h1><h6 id="tags-micropython-ds18b20"><a href="#tags-micropython-ds18b20" class="headerlink" title="tags: micropython ds18b20"></a>tags: <code>micropython</code> ds18b20</h6><hr><p>DS18B20 溫度傳感器是一種單線數字溫度傳感器。這意味著它只需要一根數據線（和 GND）即可與您的 ESP32 或 ESP8266 通信。 </p><p>它可以由外部電源供電，也可以從數據線獲取電源（稱為“寄生模式”），從而無需外部電源。</p><p>以下是 DS18B20 溫度傳感器最相關規格的摘要： </p><p>通過單線總線通信<br>電源範圍：3.0V 至 5.5V<br>工作溫度範圍：-55ºC 至 +125ºC<br>精度 +/-0.5 ºC（介於 -10ºC 至 85ºC 之間）**</p><p><a href="https://draft.blogger.com/blog/post/edit/6280040346040914276/5051662257603737866?hl=zh-TW#"><img src="https://lh3.googleusercontent.com/-M5Mg46TDQM0/YPjn5-wneYI/AAAAAAAAegI/oEFR5CjjUgAsSSWao7HOggVsgpzjWt-QQCNcBGAsYHQ/w407-h266/image.png"></a></p><p><a href="https://draft.blogger.com/blog/post/edit/6280040346040914276/5051662257603737866?hl=zh-TW#"><img src="https://lh3.googleusercontent.com/-vLA_oPaKP3s/YPjoBdCR_iI/AAAAAAAAegM/JtHMyZzu1Fs78AdoOhlIBrBnbn_PR0geACNcBGAsYHQ/w457-h257/image.png"></a></p><hr><h2 id="接線"><a href="#接線" class="headerlink" title="接線"></a>接線</h2><p><a href="https://draft.blogger.com/blog/post/edit/6280040346040914276/5051662257603737866?hl=zh-TW#"><img src="https://lh3.googleusercontent.com/-PalBcnYvW7s/YPjoVWAna1I/AAAAAAAAegY/K9YqBp7hLB8BoFo-disKoJwNDmm65hd6gCNcBGAsYHQ/w457-h496/image.png"></a></p><h2 id="程式碼"><a href="#程式碼" class="headerlink" title="程式碼"></a>程式碼</h2><pre class="line-numbers language-py" data-language="py"><code class="language-py"><span class="token keyword">from</span> machine <span class="token keyword">import</span> Pin<span class="token keyword">from</span> time <span class="token keyword">import</span> sleep<span class="token keyword">import</span> time<span class="token keyword">import</span> onewire<span class="token punctuation">,</span> ds18x20  dsSensor<span class="token operator">=</span>ds18x20<span class="token punctuation">.</span>DS18X20<span class="token punctuation">(</span>onewire<span class="token punctuation">.</span>OneWire<span class="token punctuation">(</span>Pin<span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>scan<span class="token operator">=</span>dsSensor<span class="token punctuation">.</span>scan<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"Devices: "</span><span class="token punctuation">,</span>scan<span class="token punctuation">)</span><span class="token keyword">while</span> <span class="token boolean">True</span><span class="token punctuation">:</span>    rows<span class="token operator">=</span>ds_sensor<span class="token punctuation">.</span>scan<span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"The devices: "</span><span class="token punctuation">,</span> rows<span class="token punctuation">)</span>    sleep<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>    <span class="token keyword">for</span> row <span class="token keyword">in</span> rows<span class="token punctuation">:</span>      ds_sensor<span class="token punctuation">.</span>convert_temp<span class="token punctuation">(</span><span class="token punctuation">)</span>      <span class="token keyword">print</span><span class="token punctuation">(</span>row<span class="token punctuation">)</span>      temp<span class="token operator">=</span>ds_sensor<span class="token punctuation">.</span>read_temp<span class="token punctuation">(</span>row<span class="token punctuation">)</span> <span class="token keyword">print</span><span class="token punctuation">(</span>temp<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><strong>解析</strong></p><p><strong>匯入Pin,sleep,單總線,溫度模組</strong></p><pre class="line-numbers language-py" data-language="py"><code class="language-py"><span class="token keyword">from</span> machine <span class="token keyword">import</span> Pin<span class="token keyword">from</span> time <span class="token keyword">import</span> sleep<span class="token keyword">import</span> time<span class="token keyword">import</span> onewire<span class="token punctuation">,</span> ds18x20<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><strong><em>構造函數</em></strong></p><p><strong><em>ow=onewire.OneWire(machine.Pin(id))</em></strong></p><p><strong><em>構建單總線對象。 id:引腳編號；</em></strong></p><p><strong><em>使用方法</em></strong></p><p><strong><em>ow.scan()</em></strong></p><p><strong><em>構造函數</em></strong></p><p><strong><em>ds=ds18x20.DS18X20(ow)</em></strong></p><p><strong><em>構建 DS18B20 傳感器對象。 ow:定義好的單總線對象；</em></strong></p><p><strong><em>使用方法</em></strong></p><p><strong><em>ds.scan()</em></strong></p><p><strong><em>掃描總線上的設備。返回設備地址，支持多設備同時掛載。</em></strong></p><p><strong><em>ds.convert_temp()</em></strong></p><p><strong><em>溫度轉換。</em></strong></p><p><strong><em>ds.read_temp(rom)</em></strong></p><p><strong><em>獲取溫度值。 rom：表示對應的設備號。</em></strong></p><pre class="line-numbers language-py" data-language="py"><code class="language-py">dsSensor<span class="token operator">=</span>ds18x20<span class="token punctuation">.</span>DS18X20<span class="token punctuation">(</span>onewire<span class="token punctuation">.</span>OneWire<span class="token punctuation">(</span>Pin<span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>scan<span class="token operator">=</span>dsSensor<span class="token punctuation">.</span>scan<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"Devices: "</span><span class="token punctuation">,</span>scan<span class="token punctuation">)</span><span class="token keyword">while</span> <span class="token boolean">True</span><span class="token punctuation">:</span>    rows<span class="token operator">=</span>ds_sensor<span class="token punctuation">.</span>scan<span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"The devices: "</span><span class="token punctuation">,</span> rows<span class="token punctuation">)</span>    sleep<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>    <span class="token keyword">for</span> row <span class="token keyword">in</span> rows<span class="token punctuation">:</span>      ds_sensor<span class="token punctuation">.</span>convert_temp<span class="token punctuation">(</span><span class="token punctuation">)</span>      <span class="token keyword">print</span><span class="token punctuation">(</span>row<span class="token punctuation">)</span>      temp<span class="token operator">=</span>ds_sensor<span class="token punctuation">.</span>read_temp<span class="token punctuation">(</span>row<span class="token punctuation">)</span> <span class="token keyword">print</span><span class="token punctuation">(</span>temp<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><strong>顯示結果</strong></p><pre class="line-numbers language-none"><code class="language-none">Devices:  \[bytearray(b&#39;(t~\\x19\\r\\x00\\x00.&#39;)\]bytearray(b&#39;(t~\\x19\\r\\x00\\x00.&#39;)26.4375bytearray(b&#39;(t~\\x19\\r\\x00\\x00.&#39;)26.375bytearray(b&#39;(t~\\x19\\r\\x00\\x00.&#39;)26.375bytearray(b&#39;(t~\\x19\\r\\x00\\x00.&#39;)26.5625    <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><hr><h2 id="加上網頁顯示數據"><a href="#加上網頁顯示數據" class="headerlink" title="加上網頁顯示數據"></a>加上網頁顯示數據</h2><p><strong>首先動手寫一個html,並把它封包起來方便呼叫</strong></p><pre class="line-numbers language-py" data-language="py"><code class="language-py"><span class="token keyword">def</span> web_html<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>  html<span class="token operator">=</span><span class="token triple-quoted-string string">"""&lt;!DOCTYPE html>      &lt;html>      &lt;head>        &lt;meta charset="utf-8" />        &lt;meta http-equiv="refresh" content="1" />        &lt;meta name="viewport" content="width=device-width, initial-scale=1.0" />        &lt;title>ESP32 TO DS18B20&lt;/title>        &lt;style type="text/css">          body &#123;            color: rgb(9, 39, 95);            background-color: rgb(214, 205, 231);            font-family: 'Lucida Sans', 'Lucida Sans Regular', 'Lucida Grande', 'Lucida Sans Unicode', Geneva, Verdana, sans-serif;          &#125;          h1 &#123;text-align: center;&#125;          h2 &#123;text-align: center; color: rgb(60, 12, 114);&#125;          h3 &#123;text-align: center; color: deeppink;&#125;          dd &#123;text-align: center;&#125;        &lt;/style>      &lt;/head>      &lt;body>        &lt;h1>ESP32 TO DS18D20&lt;/h1>        &lt;p Align=center>&lt;img src="https://media.istockphoto.com/photos/fahrenheit-and-celsius-scale-meteorology-thermometer-for-measuring-picture-id1138308244" height="150" width="100" >&lt;/p>        &lt;dl>          &lt;dt>&lt;h2>Temperature&lt;/h2>&lt;/dt>          &lt;h3>&lt;dd class="val">"""</span><span class="token operator">+</span><span class="token builtin">str</span><span class="token punctuation">(</span><span class="token builtin">round</span><span class="token punctuation">(</span>temp<span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token triple-quoted-string string">""" *C&lt;/dd>&lt;h3>        &lt;/dl>        &lt;br>&lt;/br>        &lt;dl>          &lt;p>&lt;i class="fas fa-temperature-high">&lt;/i>&lt;/p>          &lt;dt>&lt;h2>Temperature&lt;/h2>&lt;/dt>          &lt;h3>&lt;dd class="val">"""</span><span class="token operator">+</span><span class="token builtin">str</span><span class="token punctuation">(</span><span class="token builtin">round</span><span class="token punctuation">(</span>temp <span class="token operator">*</span> <span class="token punctuation">(</span><span class="token number">9</span><span class="token operator">/</span><span class="token number">5</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">32.0</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token triple-quoted-string string">""" *F&lt;/dd>&lt;/h3>        &lt;/dl>      &lt;/body>      &lt;/html>"""</span>  <span class="token keyword">return</span> html<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><hr><p><strong>之後加入wifi和socket套接客戶端的相關的接收和請求</strong></p><p><strong>整個程式碼如下:</strong></p><pre class="line-numbers language-py" data-language="py"><code class="language-py"><span class="token keyword">import</span> socket<span class="token keyword">from</span> time <span class="token keyword">import</span> sleep<span class="token keyword">import</span> time<span class="token keyword">from</span> machine <span class="token keyword">import</span> Pin<span class="token keyword">import</span> onewire<span class="token punctuation">,</span> ds18x20<span class="token keyword">import</span> network  ssid<span class="token operator">=</span><span class="token string">"基地台名稱"</span>password<span class="token operator">=</span><span class="token string">"基地台密碼"</span><span class="token keyword">def</span> connected_wifi<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>  <span class="token keyword">global</span> ssid<span class="token punctuation">,</span> password  wifi<span class="token operator">=</span>network<span class="token punctuation">.</span>WLAN<span class="token punctuation">(</span>network<span class="token punctuation">.</span>STA_IF<span class="token punctuation">)</span>  wifi<span class="token punctuation">.</span>active<span class="token punctuation">(</span><span class="token boolean">True</span><span class="token punctuation">)</span>  wifi<span class="token punctuation">.</span>connect<span class="token punctuation">(</span>ssid<span class="token punctuation">,</span> password<span class="token punctuation">)</span>  <span class="token keyword">while</span> wifi<span class="token punctuation">.</span>isconnected<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">==</span><span class="token boolean">False</span><span class="token punctuation">:</span>    <span class="token keyword">pass</span>  <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"connected successful!"</span><span class="token punctuation">)</span>  <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"IP: &#123;&#125;"</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>wifi<span class="token punctuation">.</span>ifconfig<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token keyword">def</span> read_sensor<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>  <span class="token keyword">global</span> temp  ds_sensor<span class="token operator">=</span>ds18x20<span class="token punctuation">.</span>DS18X20<span class="token punctuation">(</span>onewire<span class="token punctuation">.</span>OneWire<span class="token punctuation">(</span>Pin<span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token keyword">while</span> <span class="token boolean">True</span><span class="token punctuation">:</span>    rows<span class="token operator">=</span>ds_sensor<span class="token punctuation">.</span>scan<span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"The devices: "</span><span class="token punctuation">,</span> rows<span class="token punctuation">)</span>    sleep<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>    <span class="token keyword">for</span> row <span class="token keyword">in</span> rows<span class="token punctuation">:</span>      ds_sensor<span class="token punctuation">.</span>convert_temp<span class="token punctuation">(</span><span class="token punctuation">)</span>      <span class="token keyword">print</span><span class="token punctuation">(</span>row<span class="token punctuation">)</span>      temp<span class="token operator">=</span>ds_sensor<span class="token punctuation">.</span>read_temp<span class="token punctuation">(</span>row<span class="token punctuation">)</span>      <span class="token keyword">return</span> temp<span class="token keyword">def</span> web_html<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>  html<span class="token operator">=</span><span class="token triple-quoted-string string">"""&lt;!DOCTYPE html>      &lt;html>      &lt;head>        &lt;meta charset="utf-8" />        &lt;meta http-equiv="refresh" content="1" />        &lt;meta name="viewport" content="width=device-width, initial-scale=1.0" />        &lt;title>ESP32 TO DS18B20&lt;/title>        &lt;style type="text/css">          body &#123;            color: rgb(9, 39, 95);            background-color: rgb(214, 205, 231);            font-family: 'Lucida Sans', 'Lucida Sans Regular', 'Lucida Grande', 'Lucida Sans Unicode', Geneva, Verdana, sans-serif;          &#125;          h1 &#123;text-align: center;&#125;          h2 &#123;text-align: center; color: rgb(60, 12, 114);&#125;          h3 &#123;text-align: center; color: deeppink;&#125;          dd &#123;text-align: center;&#125;        &lt;/style>      &lt;/head>      &lt;body>        &lt;h1>ESP32 TO DS18D20&lt;/h1>        &lt;p Align=center>&lt;img src="https://media.istockphoto.com/photos/fahrenheit-and-celsius-scale-meteorology-thermometer-for-measuring-picture-id1138308244" height="150" width="100" >&lt;/p>        &lt;dl>          &lt;dt>&lt;h2>Temperature&lt;/h2>&lt;/dt>          &lt;h3>&lt;dd class="val">"""</span><span class="token operator">+</span><span class="token builtin">str</span><span class="token punctuation">(</span><span class="token builtin">round</span><span class="token punctuation">(</span>temp<span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token triple-quoted-string string">""" *C&lt;/dd>&lt;h3>        &lt;/dl>        &lt;br>&lt;/br>        &lt;dl>          &lt;p>&lt;i class="fas fa-temperature-high">&lt;/i>&lt;/p>          &lt;dt>&lt;h2>Temperature&lt;/h2>&lt;/dt>          &lt;h3>&lt;dd class="val">"""</span><span class="token operator">+</span><span class="token builtin">str</span><span class="token punctuation">(</span><span class="token builtin">round</span><span class="token punctuation">(</span>temp <span class="token operator">*</span> <span class="token punctuation">(</span><span class="token number">9</span><span class="token operator">/</span><span class="token number">5</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">32.0</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token triple-quoted-string string">""" *F&lt;/dd>&lt;/h3>        &lt;/dl>      &lt;/body>      &lt;/html>"""</span>  <span class="token keyword">return</span> html  connected_wifi<span class="token punctuation">(</span><span class="token punctuation">)</span>s<span class="token operator">=</span>socket<span class="token punctuation">.</span>socket<span class="token punctuation">(</span>socket<span class="token punctuation">.</span>AF_INET<span class="token punctuation">,</span> socket<span class="token punctuation">.</span>SOCK_STREAM<span class="token punctuation">)</span>s<span class="token punctuation">.</span>bind<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token string">''</span><span class="token punctuation">,</span> <span class="token number">80</span><span class="token punctuation">)</span><span class="token punctuation">)</span>s<span class="token punctuation">.</span>listen<span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span>  <span class="token keyword">while</span> <span class="token boolean">True</span><span class="token punctuation">:</span>  conn<span class="token punctuation">,</span> addr <span class="token operator">=</span> s<span class="token punctuation">.</span>accept<span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'Got a connection from %s'</span><span class="token operator">%</span><span class="token builtin">str</span><span class="token punctuation">(</span>addr<span class="token punctuation">)</span><span class="token punctuation">)</span>  request <span class="token operator">=</span> conn<span class="token punctuation">.</span>recv<span class="token punctuation">(</span><span class="token number">1024</span><span class="token punctuation">)</span>  <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"content: %s"</span><span class="token operator">%</span><span class="token builtin">str</span><span class="token punctuation">(</span>request<span class="token punctuation">)</span><span class="token punctuation">)</span>  read_temp<span class="token operator">=</span>read_sensor<span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token keyword">print</span><span class="token punctuation">(</span>read_temp<span class="token punctuation">)</span>  res<span class="token operator">=</span>web_html<span class="token punctuation">(</span><span class="token punctuation">)</span>  conn<span class="token punctuation">.</span>send<span class="token punctuation">(</span><span class="token string">"http/1.1 200 OK\n"</span><span class="token punctuation">)</span>  conn<span class="token punctuation">.</span>send<span class="token punctuation">(</span><span class="token string">"Content-Type: text/html\n"</span><span class="token punctuation">)</span>  conn<span class="token punctuation">.</span>send<span class="token punctuation">(</span><span class="token string">"Connection: close\n\n"</span><span class="token punctuation">)</span>  conn<span class="token punctuation">.</span>sendall<span class="token punctuation">(</span>res<span class="token punctuation">)</span>  conn<span class="token punctuation">.</span>close<span class="token punctuation">(</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="解析"><a href="#解析" class="headerlink" title="解析"></a>解析</h2><p><strong>匯入machine, sockt, network, HC_SR04模組</strong></p><pre class="line-numbers language-py" data-language="py"><code class="language-py"><span class="token keyword">from</span> machine <span class="token keyword">import</span> Pin <span class="token keyword">from</span> HC_SR04 <span class="token keyword">import</span> HCSR04<span class="token keyword">import</span> socket<span class="token punctuation">,</span> network<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><strong>設定wifi連線</strong></p><pre class="line-numbers language-py" data-language="py"><code class="language-py"><span class="token keyword">def</span> connected_wifi<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>  <span class="token keyword">global</span> ssid<span class="token punctuation">,</span> password  wifi<span class="token operator">=</span>network<span class="token punctuation">.</span>WLAN<span class="token punctuation">(</span>network<span class="token punctuation">.</span>STA_IF<span class="token punctuation">)</span>  wifi<span class="token punctuation">.</span>active<span class="token punctuation">(</span><span class="token boolean">True</span><span class="token punctuation">)</span>  wifi<span class="token punctuation">.</span>connect<span class="token punctuation">(</span>ssid<span class="token punctuation">,</span> password<span class="token punctuation">)</span>  <span class="token keyword">while</span> wifi<span class="token punctuation">.</span>isconnected<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">==</span><span class="token boolean">False</span><span class="token punctuation">:</span>    <span class="token keyword">pass</span>  <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"connected successful!"</span><span class="token punctuation">)</span> <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"IP: &#123;&#125;"</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>wifi<span class="token punctuation">.</span>ifconfig<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><strong>讀取DS18B20數據</strong></p><pre class="line-numbers language-py" data-language="py"><code class="language-py"><span class="token keyword">def</span> read_sensor<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>  <span class="token keyword">global</span> temp  ds_sensor<span class="token operator">=</span>ds18x20<span class="token punctuation">.</span>DS18X20<span class="token punctuation">(</span>onewire<span class="token punctuation">.</span>OneWire<span class="token punctuation">(</span>Pin<span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token keyword">while</span> <span class="token boolean">True</span><span class="token punctuation">:</span>    rows<span class="token operator">=</span>ds_sensor<span class="token punctuation">.</span>scan<span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"The devices: "</span><span class="token punctuation">,</span> rows<span class="token punctuation">)</span>    sleep<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>    <span class="token keyword">for</span> row <span class="token keyword">in</span> rows<span class="token punctuation">:</span>      ds_sensor<span class="token punctuation">.</span>convert_temp<span class="token punctuation">(</span><span class="token punctuation">)</span>      <span class="token keyword">print</span><span class="token punctuation">(</span>row<span class="token punctuation">)</span>      temp<span class="token operator">=</span>ds_sensor<span class="token punctuation">.</span>read_temp<span class="token punctuation">(</span>row<span class="token punctuation">)</span>      <span class="token keyword">return</span> temp<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><strong>socket套接</strong></p><pre class="line-numbers language-py" data-language="py"><code class="language-py">s<span class="token operator">=</span>socket<span class="token punctuation">.</span>socket<span class="token punctuation">(</span>socket<span class="token punctuation">.</span>AF_INET<span class="token punctuation">,</span> socket<span class="token punctuation">.</span>SOCK_STREAM<span class="token punctuation">)</span>s<span class="token punctuation">.</span>bind<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token string">''</span><span class="token punctuation">,</span> <span class="token number">80</span><span class="token punctuation">)</span><span class="token punctuation">)</span>s<span class="token punctuation">.</span>listen<span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token keyword">while</span> <span class="token boolean">True</span><span class="token punctuation">:</span>  conn<span class="token punctuation">,</span> addr <span class="token operator">=</span> s<span class="token punctuation">.</span>accept<span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'Got a connection from %s'</span><span class="token operator">%</span><span class="token builtin">str</span><span class="token punctuation">(</span>addr<span class="token punctuation">)</span><span class="token punctuation">)</span>  request <span class="token operator">=</span> conn<span class="token punctuation">.</span>recv<span class="token punctuation">(</span><span class="token number">1024</span><span class="token punctuation">)</span>  <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"content: %s"</span><span class="token operator">%</span><span class="token builtin">str</span><span class="token punctuation">(</span>request<span class="token punctuation">)</span><span class="token punctuation">)</span>  read_temp<span class="token operator">=</span>read_sensor<span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token keyword">print</span><span class="token punctuation">(</span>read_temp<span class="token punctuation">)</span>  res<span class="token operator">=</span>web_html<span class="token punctuation">(</span><span class="token punctuation">)</span>  conn<span class="token punctuation">.</span>send<span class="token punctuation">(</span><span class="token string">"http/1.1 200 OK\\n"</span><span class="token punctuation">)</span>  conn<span class="token punctuation">.</span>send<span class="token punctuation">(</span><span class="token string">"Content-Type: text/html\n"</span><span class="token punctuation">)</span>  conn<span class="token punctuation">.</span>send<span class="token punctuation">(</span><span class="token string">"Connection: close\n\n"</span><span class="token punctuation">)</span>  conn<span class="token punctuation">.</span>sendall<span class="token punctuation">(</span>res<span class="token punctuation">)</span>  conn<span class="token punctuation">.</span>close<span class="token punctuation">(</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><hr><p><a href="https://draft.blogger.com/blog/post/edit/6280040346040914276/5051662257603737866?hl=zh-TW#"><img src="https://1.bp.blogspot.com/-2BVcuDPUyWo/YPpATv8mUUI/AAAAAAAAegs/M-2s_MNuCJ88coTfrj8QqGimPFFIcZ7RQCNcBGAsYHQ/w644-h324/2.jpg"></a></p>]]></content>
      
      
      <categories>
          
          <category> micropython </category>
          
          <category> esp32 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> DS18B20 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>溫濕度傳感器(DHT11/12)+ThingSpeak</title>
      <link href="/2021/08/29/wen-shi-du-chuan-gan-qi-dht11-12-thingspeak/"/>
      <url>/2021/08/29/wen-shi-du-chuan-gan-qi-dht11-12-thingspeak/</url>
      
        <content type="html"><![CDATA[<h1 id="溫濕度傳感器-DHT11-12-ThingSpeak"><a href="#溫濕度傳感器-DHT11-12-ThingSpeak" class="headerlink" title="溫濕度傳感器(DHT11/12)+ThingSpeak"></a>溫濕度傳感器(DHT11/12)+ThingSpeak</h1><h6 id="tags-micropython-thingspeak-dht11-dht12"><a href="#tags-micropython-thingspeak-dht11-dht12" class="headerlink" title="tags: micropython thingspeak dht11/dht12"></a>tags: <code>micropython</code> <code>thingspeak</code> <code>dht11/dht12</code></h6><p><a href="https://1.bp.blogspot.com/-wKr7F1FYVIg/YPjC09ruT-I/AAAAAAAAegA/lJ2_JcIB1eUkbiPNuHqpejBJzidrbNYEwCNcBGAsYHQ/s1920/1.jpg"><img src="https://1.bp.blogspot.com/-wKr7F1FYVIg/YPjC09ruT-I/AAAAAAAAegA/lJ2_JcIB1eUkbiPNuHqpejBJzidrbNYEwCNcBGAsYHQ/w633-h269/1.jpg"></a></p><hr><p><strong>回顧DHT11/12實作紀錄</strong></p><p><strong>基本介紹和實驗參考-</strong><a href="https://draft.blogger.com/blog/post/edit/6280040346040914276/2584628173386400659?hl=zh-TW#">https://esp32-blairan.blogspot.com/2021/07/dht11dht12-esp32.html</a></p><hr><p><a href="https://draft.blogger.com/blog/post/edit/6280040346040914276/2584628173386400659?hl=zh-TW#"><img src="http://2.bp.blogspot.com/-3syBdItbhrI/Vb6X8sJx7tI/AAAAAAAAEO8/cMmlSOV142M/s320/dht11.jpg"></a></p><pre class="line-numbers language-py" data-language="py"><code class="language-py"><span class="token keyword">import</span> dht<span class="token keyword">from</span> machine <span class="token keyword">import</span> Pin<span class="token keyword">from</span> time <span class="token keyword">import</span> sleep<span class="token keyword">def</span> measureTemp<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    sensor<span class="token operator">=</span>dht<span class="token punctuation">.</span>DHT11<span class="token punctuation">(</span>Pin<span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">)</span>    <span class="token keyword">while</span> <span class="token boolean">True</span><span class="token punctuation">:</span>        <span class="token keyword">try</span><span class="token punctuation">:</span>            sleep<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span>            sensor<span class="token punctuation">.</span>measure<span class="token punctuation">(</span><span class="token punctuation">)</span>            t<span class="token operator">=</span>sensor<span class="token punctuation">.</span>temperature<span class="token punctuation">(</span><span class="token punctuation">)</span>            t_f<span class="token operator">=</span>t<span class="token operator">*</span><span class="token punctuation">(</span><span class="token number">9</span><span class="token operator">/</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token number">32</span>            h<span class="token operator">=</span>sensor<span class="token punctuation">.</span>humidity<span class="token punctuation">(</span><span class="token punctuation">)</span>            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"Temp: &#123;:.1f&#125;.C"</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>t<span class="token punctuation">)</span><span class="token punctuation">)</span>            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"Temp: &#123;:.1f&#125;.F"</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>t_f<span class="token punctuation">)</span><span class="token punctuation">)</span>            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"Humidity: &#123;:.1f&#125;"</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>h<span class="token punctuation">)</span><span class="token punctuation">)</span>        <span class="token keyword">except</span> OSError <span class="token keyword">as</span> o<span class="token punctuation">:</span>            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"Failed to read sensor."</span><span class="token punctuation">)</span><span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">'__main__'</span><span class="token punctuation">:</span>    measureTemp<span class="token punctuation">(</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><strong>載入dht庫(內建)</strong></p><pre class="line-numbers language-py" data-language="py"><code class="language-py"><span class="token keyword">import</span> dht<span class="token keyword">from</span> machine <span class="token keyword">import</span> Pin<span class="token keyword">from</span> time <span class="token keyword">import</span> sleep<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><strong>指定DHT11腳位給sensor變數</strong></p><pre class="line-numbers language-py" data-language="py"><code class="language-py">sensor<span class="token operator">=</span>dht<span class="token punctuation">.</span>DHT11<span class="token punctuation">(</span>Pin<span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p><strong>給予while()每2秒不斷偵測</strong></p><pre class="line-numbers language-py" data-language="py"><code class="language-py">sleep<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span>sensor<span class="token punctuation">.</span>measure<span class="token punctuation">(</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p><strong>攝氏溫度(t)/華氏溫度(t_f)/濕度</strong></p><p><strong>其中攝氏轉換華氏的公式:攝氏x(9/5)+32</strong></p><pre class="line-numbers language-py" data-language="py"><code class="language-py">t<span class="token operator">=</span>sensor<span class="token punctuation">.</span>temperature<span class="token punctuation">(</span><span class="token punctuation">)</span>t_f<span class="token operator">=</span>t<span class="token operator">*</span><span class="token punctuation">(</span><span class="token number">9</span><span class="token operator">/</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token number">32</span>h<span class="token operator">=</span>sensor<span class="token punctuation">.</span>humidity<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"Temp: &#123;:.1f&#125;.C"</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>t<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"Temp: &#123;:.1f&#125;.F"</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>t_f<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"Humidity: &#123;:.1f&#125;"</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>h<span class="token punctuation">)</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="結果"><a href="#結果" class="headerlink" title="結果"></a>結果</h2><pre class="line-numbers language-none"><code class="language-none">&gt;&gt;&gt; Temp: 26.0.CTemp: 78.8.FHumidity: 27.0Temp: 26.0.CTemp: 78.8.FHumidity: 27.0Temp: 26.0.CTemp: 78.8.FHumidity: 27.0<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><hr><h2 id="如何上傳數據到ThingSpeak"><a href="#如何上傳數據到ThingSpeak" class="headerlink" title="如何上傳數據到ThingSpeak"></a>如何上傳數據到ThingSpeak</h2><p><strong>先到此<a href="https://draft.blogger.com/blog/post/edit/6280040346040914276/2584628173386400659?hl=zh-TW#">ThingSpeak</a>網站註冊一帳號</strong></p><p><a href="https://draft.blogger.com/blog/post/edit/6280040346040914276/2584628173386400659?hl=zh-TW#"><img src="https://1.bp.blogspot.com/-4RxhjYmlh_w/YPi8P5fsN8I/AAAAAAAAeeM/yzV1oiE05VgEVVeNwhVCtsFwQ1cfASN-gCNcBGAsYHQ/w934-h353/4.jpg"></a></p><p><a href="https://draft.blogger.com/blog/post/edit/6280040346040914276/2584628173386400659?hl=zh-TW#"><img src="https://1.bp.blogspot.com/-M_V8HTIXrOE/YPi8nmVCETI/AAAAAAAAee0/1F322PD3xF8K2cShI60AYjD5SWHSU1H8gCNcBGAsYHQ/w862-h326/3.jpg"></a></p><p><a href="https://draft.blogger.com/blog/post/edit/6280040346040914276/2584628173386400659?hl=zh-TW#"><img src="https://1.bp.blogspot.com/-g2Npin1ea78/YPi9X5a3scI/AAAAAAAAefY/NIGB1rmS9EktBe1uC1izXbW9rrMA0VrEgCNcBGAsYHQ/w659-h286/5.jpg"></a></p><p><a href="https://draft.blogger.com/blog/post/edit/6280040346040914276/2584628173386400659?hl=zh-TW#"><img src="https://1.bp.blogspot.com/-mDsWT2vL9uI/YPi9gFDE3tI/AAAAAAAAefc/TtXCW9i2P949XybIa09n606lHwmW-PnwACNcBGAsYHQ/w654-h284/6.jpg"></a></p><p><a href="https://draft.blogger.com/blog/post/edit/6280040346040914276/2584628173386400659?hl=zh-TW#"><img src="https://1.bp.blogspot.com/-mrzm6S71djU/YPi9lqFmdLI/AAAAAAAAefg/Xr5UMJs2m9wzKy6hHJvW-_NDyP5wFljYwCNcBGAsYHQ/w651-h283/7.jpg"></a></p><p><a href="https://draft.blogger.com/blog/post/edit/6280040346040914276/2584628173386400659?hl=zh-TW#"><img src="https://1.bp.blogspot.com/-Dk5fmn8xP0Q/YPi9ro_CJvI/AAAAAAAAefk/8bRay8G7aVYqN5E4szIINBNhkAm0aAYcwCNcBGAsYHQ/w692-h368/8.jpg"></a></p><hr><p><a href="https://draft.blogger.com/blog/post/edit/6280040346040914276/2584628173386400659?hl=zh-TW#"><img src="https://1.bp.blogspot.com/-FcMZGCGvGjI/YPi-kOFx8II/AAAAAAAAefw/8lNcoOipruwT3wRTrRYwn36ZL8Eldl8QQCNcBGAsYHQ/w758-h329/%25E6%2593%25B7%25E5%258F%2596_2021_07_22_08_13_19_130.jpg"></a></p><hr><h2 id="程式碼"><a href="#程式碼" class="headerlink" title="程式碼"></a>程式碼</h2><pre class="line-numbers language-py" data-language="py"><code class="language-py"><span class="token keyword">import</span> network<span class="token punctuation">,</span> urequests<span class="token keyword">from</span> machine <span class="token keyword">import</span> Pin<span class="token keyword">import</span> dht<span class="token keyword">from</span> time <span class="token keyword">import</span> sleep  ssid<span class="token operator">=</span><span class="token string">"基地台名稱"</span>password<span class="token operator">=</span><span class="token string">"基地台密碼"</span>api_key<span class="token operator">=</span><span class="token string">"VCJQHQFVSMB-----"</span>dht11<span class="token operator">=</span>dht<span class="token punctuation">.</span>DHT11<span class="token punctuation">(</span>Pin<span class="token punctuation">(</span><span class="token number">27</span><span class="token punctuation">)</span><span class="token punctuation">)</span>sleep<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token keyword">def</span> wifiContent<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">global</span> ssid<span class="token punctuation">,</span> password    wifi<span class="token operator">=</span>network<span class="token punctuation">.</span>WLAN<span class="token punctuation">(</span>network<span class="token punctuation">.</span>STA_IF<span class="token punctuation">)</span>    wifi<span class="token punctuation">.</span>active<span class="token punctuation">(</span><span class="token boolean">True</span><span class="token punctuation">)</span>    wifi<span class="token punctuation">.</span>connect<span class="token punctuation">(</span>ssid<span class="token punctuation">,</span> password<span class="token punctuation">)</span>    <span class="token keyword">while</span> wifi<span class="token punctuation">.</span>isconnected<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token boolean">False</span><span class="token punctuation">:</span>        <span class="token keyword">pass</span>    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"connected successful!"</span><span class="token punctuation">)</span>    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"IP: &#123;&#125;"</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>wifi<span class="token punctuation">.</span>ifconfig<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token keyword">def</span> getDHT<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">:</span>        dht11<span class="token punctuation">.</span>measure<span class="token punctuation">(</span><span class="token punctuation">)</span>        d<span class="token operator">=</span>dht11<span class="token punctuation">.</span>temperature<span class="token punctuation">(</span><span class="token punctuation">)</span>        rh<span class="token operator">=</span>dht11<span class="token punctuation">.</span>humidity<span class="token punctuation">(</span><span class="token punctuation">)</span>        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"Temp: &#123;:.1f&#125;*C,  Humi: &#123;:.1f&#125;%RH"</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>d<span class="token punctuation">,</span> rh<span class="token punctuation">)</span><span class="token punctuation">)</span>        uloadUrl<span class="token operator">=</span><span class="token string">"https://api.thingspeak.com/update?api_key=&#123;&#125;&amp;field1=&#123;&#125;&amp;field2=&#123;&#125;"</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>api<span class="token punctuation">,</span> d<span class="token punctuation">,</span> rh<span class="token punctuation">)</span>        <span class="token keyword">try</span><span class="token punctuation">:</span>            res<span class="token operator">=</span>urequests<span class="token punctuation">.</span>get<span class="token punctuation">(</span>uloadUrl<span class="token punctuation">)</span>            <span class="token keyword">print</span><span class="token punctuation">(</span>res<span class="token punctuation">.</span>text<span class="token punctuation">)</span>        <span class="token keyword">except</span> OSError <span class="token keyword">as</span> e<span class="token punctuation">:</span>            <span class="token keyword">print</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span>        sleep<span class="token punctuation">(</span><span class="token number">16</span><span class="token punctuation">)</span><span class="token keyword">if</span> __name__<span class="token operator">==</span><span class="token string">"__main__"</span><span class="token punctuation">:</span>    wifiContent<span class="token punctuation">(</span><span class="token punctuation">)</span>    getDHT<span class="token punctuation">(</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="解析"><a href="#解析" class="headerlink" title="解析"></a>解析</h2><p><strong><em>匯入對應的模組,其urequest是小型爬蟲,可用於抓取和上傳</em></strong></p><pre class="line-numbers language-py" data-language="py"><code class="language-py"><span class="token keyword">import</span> network<span class="token punctuation">,</span> urequests<span class="token keyword">from</span> machine <span class="token keyword">import</span> Pin<span class="token keyword">import</span> dht<span class="token keyword">from</span> time <span class="token keyword">import</span> sleep<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><strong><em>基地台名稱和密碼先給予變數,還有剛在ThingSpeak給的api_key</em></strong></p><p><strong><em>dht腳位設定,停止一秒使其初始化完全</em></strong></p><pre class="line-numbers language-py" data-language="py"><code class="language-py">ssid<span class="token operator">=</span><span class="token string">"基地台名稱"</span>password<span class="token operator">=</span><span class="token string">"基地台密碼"</span>api<span class="token operator">=</span><span class="token string">"VCJQHQFVSMB-----"</span>dht11<span class="token operator">=</span>dht<span class="token punctuation">.</span>DHT11<span class="token punctuation">(</span>Pin<span class="token punctuation">(</span><span class="token number">27</span><span class="token punctuation">)</span><span class="token punctuation">)</span>sleep<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><em><strong>這個封包裡是連接wifi的流程</strong></em></p><pre class="line-numbers language-py" data-language="py"><code class="language-py"><span class="token keyword">def</span> wifiContent<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">global</span> ssid<span class="token punctuation">,</span> password    wifi<span class="token operator">=</span>network<span class="token punctuation">.</span>WLAN<span class="token punctuation">(</span>network<span class="token punctuation">.</span>STA_IF<span class="token punctuation">)</span>    wifi<span class="token punctuation">.</span>active<span class="token punctuation">(</span><span class="token boolean">True</span><span class="token punctuation">)</span>    wifi<span class="token punctuation">.</span>connect<span class="token punctuation">(</span>ssid<span class="token punctuation">,</span> password<span class="token punctuation">)</span>    <span class="token keyword">while</span> wifi<span class="token punctuation">.</span>isconnected<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token boolean">False</span><span class="token punctuation">:</span>        <span class="token keyword">pass</span>    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"connected successful!"</span><span class="token punctuation">)</span>    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"IP: &#123;&#125;"</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>wifi<span class="token punctuation">.</span>ifconfig<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><strong><em>這個封包裡是讀取dht11/12數據,和上傳到ThingSpeak同步</em></strong></p><p>*<strong>如果有一個以上的數據,除了ThingSpeak網站上要設定一個以上的對應欄位,再來就是程式的網址格式,例如:</strong></p><p><strong>api_key</strong></p><pre class="line-numbers language-py" data-language="py"><code class="language-py">api_key<span class="token operator">=</span><span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p><strong>2個數據上傳到網站的2個欄位,field1代表第一個欄位,field2代表第二個欄位</strong></p><pre class="line-numbers language-py" data-language="py"><code class="language-py"><span class="token operator">&amp;</span>field1<span class="token operator">=</span><span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token operator">&amp;</span>field2<span class="token operator">=</span><span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><pre class="line-numbers language-py" data-language="py"><code class="language-py"><span class="token keyword">def</span> getDHT<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">:</span>        dht11<span class="token punctuation">.</span>measure<span class="token punctuation">(</span><span class="token punctuation">)</span>        d<span class="token operator">=</span>dht11<span class="token punctuation">.</span>temperature<span class="token punctuation">(</span><span class="token punctuation">)</span>        rh<span class="token operator">=</span>dht11<span class="token punctuation">.</span>humidity<span class="token punctuation">(</span><span class="token punctuation">)</span>        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"Temp: &#123;:.1f&#125;*C,  Humi: &#123;:.1f&#125;%RH"</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>d<span class="token punctuation">,</span> rh<span class="token punctuation">)</span><span class="token punctuation">)</span>        uloadUrl<span class="token operator">=</span><span class="token string">"https://api.thingspeak.com/update?api_key=&#123;&#125;&amp;field1=&#123;&#125;&amp;field2=&#123;&#125;"</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>api<span class="token punctuation">,</span> d<span class="token punctuation">,</span> rh<span class="token punctuation">)</span>        <span class="token keyword">try</span><span class="token punctuation">:</span>            res<span class="token operator">=</span>urequests<span class="token punctuation">.</span>get<span class="token punctuation">(</span>uloadUrl<span class="token punctuation">)</span>            <span class="token keyword">print</span><span class="token punctuation">(</span>res<span class="token punctuation">.</span>text<span class="token punctuation">)</span>        <span class="token keyword">except</span> OSError <span class="token keyword">as</span> e<span class="token punctuation">:</span>            <span class="token keyword">print</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span>        sleep<span class="token punctuation">(</span><span class="token number">16</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><hr><p><a href="https://draft.blogger.com/blog/post/edit/6280040346040914276/2584628173386400659?hl=zh-TW#"><img src="https://1.bp.blogspot.com/-lggjIDGj9VA/YPjA-2exaYI/AAAAAAAAef4/QN52OngWLS4MVqiFHVu2lF5D_EC-BE89wCNcBGAsYHQ/w730-h410/2.jpg"></a></p>]]></content>
      
      
      <categories>
          
          <category> micropython </category>
          
          <category> esp32 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> dht11/dht12 </tag>
            
            <tag> thingSpeak </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>BMP280氣壓,溫度模組-micropython</title>
      <link href="/2021/08/29/bmp280-qi-ya-wen-du-mo-zu-micropython/"/>
      <url>/2021/08/29/bmp280-qi-ya-wen-du-mo-zu-micropython/</url>
      
        <content type="html"><![CDATA[<h1 id="BMP280氣壓-溫度模組-micropython"><a href="#BMP280氣壓-溫度模組-micropython" class="headerlink" title="BMP280氣壓,溫度模組-micropython"></a>BMP280氣壓,溫度模組-micropython</h1><h6 id="tags-micropython-bmp280"><a href="#tags-micropython-bmp280" class="headerlink" title="tags: micropython bmp280"></a>tags: <code>micropython</code> <code>bmp280</code></h6><p><a href="https://draft.blogger.com/blog/post/edit/6280040346040914276/2288121610458811026?hl=zh-TW#"><img src="https://1.bp.blogspot.com/-4LdM2J8lnOY/YPV1dYnda-I/AAAAAAAAecQ/OXHYgyYLfkgCzpZzyPV9wC_xhR4CiLv2ACNcBGAsYHQ/s320/21805656779815_796.jpg"></a></p><p>**_BMP280,該傳感器可以非常準確地測量氣壓和溫度。  </p><p>您可以使用 I2C 或 SPI 連接協議將其與您的 Arduino 板連接。它有一個 3.3V 穩壓器和電平轉換，因此您可以毫無問題地將它與 3V 或 5V 邏輯微控制器一起使用。_**</p><hr><h2 id="接線"><a href="#接線" class="headerlink" title="接線"></a>接線</h2><p>| BME280 | ESP32 |<br>| Vin | 3.3V |<br>| GND | GND |<br>| SCL | GPIO 22 |<br>| SDA | GPIO 21 |</p><p><a href="https://draft.blogger.com/blog/post/edit/6280040346040914276/2288121610458811026?hl=zh-TW#"><img src="https://i0.wp.com/randomnerdtutorials.com/wp-content/uploads/2018/08/ESP32-bme280_bb_f-768x669.png?resize=768,669&quality=100&strip=all&ssl=1"></a></p><hr><p><strong>將<a href="https://draft.blogger.com/blog/post/edit/6280040346040914276/2288121610458811026?hl=zh-TW#">bmp280.py</a>上傳到板子裡,以便可載入函式庫</strong></p><p>**</p><p><a href="https://draft.blogger.com/blog/post/edit/6280040346040914276/2288121610458811026?hl=zh-TW#"><img src="https://1.bp.blogspot.com/-1m3Ca316Awg/YPYqYTi4jhI/AAAAAAAAeco/IfQy-3mEXxslGaYpVXR_pTnkesOTuea5wCNcBGAsYHQ/w711-h400/b.jpg"></a></p><p>**</p><hr><h2 id="程式碼"><a href="#程式碼" class="headerlink" title="程式碼"></a>程式碼</h2><pre class="line-numbers language-py" data-language="py"><code class="language-py">from machine import SoftI2C, Pin, sleepfrom bmp280 import BMP280while True:    i2c&#x3D;SoftI2C(sda&#x3D;Pin(21), scl&#x3D;Pin(22))    bmp&#x3D;BMP280(i2c)    temp&#x3D;bmp.temperature    pressure&#x3D;bmp.pressure    print(&quot;Tempture &#x3D; &#123;&#125; *C&quot;.format(temp))    print(&quot;Pressure &#x3D; &#123;&#125; hPa&quot;.format(pressure))    print(&quot;&#x3D;&quot;*20)    sleep(1000)<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><hr><pre class="line-numbers language-none"><code class="language-none">&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;   Tempture &#x3D; 24.67 *C    Pressure &#x3D; 77892.58 hPa&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>]]></content>
      
      
      <categories>
          
          <category> micropython </category>
          
          <category> esp32 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> bmp280 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>網頁控制LED-micropython</title>
      <link href="/2021/08/29/wang-ye-kong-zhi-led-micropython/"/>
      <url>/2021/08/29/wang-ye-kong-zhi-led-micropython/</url>
      
        <content type="html"><![CDATA[<h1 id="網頁控制LED-micropython"><a href="#網頁控制LED-micropython" class="headerlink" title="網頁控制LED-micropython"></a>網頁控制LED-micropython</h1><p><strong>因為是用內建的LED所以不用接任何杜邦線</strong></p><h2 id="程式碼"><a href="#程式碼" class="headerlink" title="程式碼"></a>程式碼</h2><pre class="line-numbers language-py" data-language="py"><code class="language-py"><span class="token keyword">from</span> machine <span class="token keyword">import</span> Pin<span class="token keyword">import</span> network<span class="token punctuation">,</span> socket  ssid<span class="token operator">=</span><span class="token string">"---"</span>password<span class="token operator">=</span><span class="token string">"------"</span>led<span class="token operator">=</span>Pin<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> Pin<span class="token punctuation">.</span>OUT<span class="token punctuation">)</span>ledState<span class="token operator">=</span><span class="token string">"OFF"</span><span class="token keyword">def</span> sw_page<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">if</span> led<span class="token punctuation">.</span>value<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">:</span>        ledState<span class="token operator">=</span><span class="token string">"ON"</span>    <span class="token keyword">else</span><span class="token punctuation">:</span>        ledState<span class="token operator">=</span><span class="token string">"OFF"</span>    html<span class="token operator">=</span><span class="token triple-quoted-string string">"""            &lt;html>        &lt;head>            &lt;title>ESP32 網頁伺服器控制練習&lt;/title>            &lt;meta name="viewport" content="width=device-width, initial            scale=1">            &lt;link rel="icon" href="data:,">            &lt;style>                html &#123;                    text-align: center;                    font-family: Arial;                    display: inline-block;                    margin: auto;&#125;                .button &#123;                    background-color: #e0e252; /* Green */                    border: none;                    color: white;                    padding: 15px 35px;                    text-align: center;                    text-decoration: none;                    display: inline-block;                    font-size: 16px;                &#125;                .button2 &#123;                    background-color: #b0b1a2; /* Green */                    padding: 15px 32px;                &#125;            &lt;/style>        &lt;/head>          &lt;body>            &lt;h1>ESP32 網頁伺服器控制練習&lt;/h1>            &lt;p>GPIO-2 狀態: &lt;strong>"""</span> <span class="token operator">+</span> ledState <span class="token operator">+</span> <span class="token triple-quoted-string string">"""&lt;/strong>&lt;/p>            &lt;p>&lt;a href="/on">&lt;button class="button">ON&lt;/button>&lt;/a>&lt;/p>            &lt;p>&lt;a href="/off">&lt;button class="button button2">OFF&lt;/button>&lt;/a>&lt;/p>        &lt;/body>        &lt;/html>    """</span>    <span class="token keyword">return</span> htmlwifi<span class="token operator">=</span>network<span class="token punctuation">.</span>WLAN<span class="token punctuation">(</span>network<span class="token punctuation">.</span>STA_IF<span class="token punctuation">)</span>wifi<span class="token punctuation">.</span>active<span class="token punctuation">(</span><span class="token boolean">True</span><span class="token punctuation">)</span>wifi<span class="token punctuation">.</span>connect<span class="token punctuation">(</span>ssid<span class="token punctuation">,</span> password<span class="token punctuation">)</span><span class="token keyword">while</span> wifi<span class="token punctuation">.</span>isconnected<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">==</span><span class="token boolean">False</span><span class="token punctuation">:</span>    <span class="token keyword">pass</span><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"connected sccessful!"</span><span class="token punctuation">)</span><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"IP: &#123;&#125;"</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>wifi<span class="token punctuation">.</span>ifconfig<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>  s<span class="token operator">=</span>socket<span class="token punctuation">.</span>socket<span class="token punctuation">(</span>socket<span class="token punctuation">.</span>AF_INET<span class="token punctuation">,</span> socket<span class="token punctuation">.</span>SOCK_STREAM<span class="token punctuation">)</span>s<span class="token punctuation">.</span>bind<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token string">''</span><span class="token punctuation">,</span> <span class="token number">80</span><span class="token punctuation">)</span><span class="token punctuation">)</span>s<span class="token punctuation">.</span>listen<span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span>  <span class="token keyword">while</span> <span class="token boolean">True</span><span class="token punctuation">:</span>    conn<span class="token punctuation">,</span> addr <span class="token operator">=</span> s<span class="token punctuation">.</span>accept<span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"got a connect from %s"</span><span class="token operator">%</span><span class="token builtin">str</span><span class="token punctuation">(</span>addr<span class="token punctuation">)</span><span class="token punctuation">)</span>    request <span class="token operator">=</span> conn<span class="token punctuation">.</span>recv<span class="token punctuation">(</span><span class="token number">1024</span><span class="token punctuation">)</span>    request <span class="token operator">=</span> <span class="token builtin">str</span><span class="token punctuation">(</span>request<span class="token punctuation">)</span>    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"context = %s"</span><span class="token operator">%</span>request<span class="token punctuation">)</span>    led_on <span class="token operator">=</span> request<span class="token punctuation">.</span>find<span class="token punctuation">(</span><span class="token string">"/on"</span><span class="token punctuation">)</span>    led_off <span class="token operator">=</span> request<span class="token punctuation">.</span>find<span class="token punctuation">(</span><span class="token string">"/off"</span><span class="token punctuation">)</span>    <span class="token keyword">if</span> led_on <span class="token operator">==</span> <span class="token number">6</span><span class="token punctuation">:</span>        led<span class="token punctuation">.</span>value<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"ON"</span><span class="token punctuation">)</span>    <span class="token keyword">if</span> led_off <span class="token operator">==</span> <span class="token number">6</span><span class="token punctuation">:</span>        led<span class="token punctuation">.</span>value<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"OFF"</span><span class="token punctuation">)</span>    respones <span class="token operator">=</span> sw_page<span class="token punctuation">(</span><span class="token punctuation">)</span>    conn<span class="token punctuation">.</span>send<span class="token punctuation">(</span><span class="token string">"HTTP/1.1 200 OK\n"</span><span class="token punctuation">)</span>    conn<span class="token punctuation">.</span>send<span class="token punctuation">(</span><span class="token string">"Context-Type: text/html\n"</span><span class="token punctuation">)</span>    conn<span class="token punctuation">.</span>send<span class="token punctuation">(</span><span class="token string">"Connection: close\n\n"</span><span class="token punctuation">)</span>    conn<span class="token punctuation">.</span>sendall<span class="token punctuation">(</span>respones<span class="token punctuation">)</span>    conn<span class="token punctuation">.</span>close<span class="token punctuation">(</span><span class="token punctuation">)</span>  <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><hr><h2 id="解析"><a href="#解析" class="headerlink" title="解析"></a>解析</h2><p><strong>匯入腳位和wifi和套接的模組</strong></p><pre class="line-numbers language-py" data-language="py"><code class="language-py"><span class="token keyword">from</span> machine <span class="token keyword">import</span> Pin<span class="token keyword">import</span> network<span class="token punctuation">,</span> socket<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p><strong>wifi連線設定</strong></p><pre class="line-numbers language-py" data-language="py"><code class="language-py">ssid<span class="token operator">=</span><span class="token string">"基地台名稱"</span>password<span class="token operator">=</span><span class="token string">"基地台密碼"</span>wifi<span class="token operator">=</span>network<span class="token punctuation">.</span>WLAN<span class="token punctuation">(</span>network<span class="token punctuation">.</span>STA_IF<span class="token punctuation">)</span>wifi<span class="token punctuation">.</span>active<span class="token punctuation">(</span><span class="token boolean">True</span><span class="token punctuation">)</span>wifi<span class="token punctuation">.</span>connect<span class="token punctuation">(</span>ssid<span class="token punctuation">,</span> password<span class="token punctuation">)</span><span class="token keyword">while</span> wifi<span class="token punctuation">.</span>isconnected<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">==</span><span class="token boolean">False</span><span class="token punctuation">:</span>    <span class="token keyword">pass</span><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"connected sccessful!"</span><span class="token punctuation">)</span><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"IP: &#123;&#125;"</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>wifi<span class="token punctuation">.</span>ifconfig<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><strong>主要這裡是前端網頁,if和else是在控制網頁的開啓就顯示ON,否則顯示OFF</strong></p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">def</span> sw_page<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span> ifled<span class="token punctuation">.</span>value<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">==</span><span class="token number">1</span><span class="token punctuation">:</span>ledState<span class="token operator">=</span><span class="token string">"ON"</span><span class="token keyword">else</span><span class="token punctuation">:</span>        ledState<span class="token operator">=</span><span class="token string">"OFF"</span>    html<span class="token operator">=</span><span class="token triple-quoted-string string">"""            &lt;html>        &lt;head>            &lt;title>ESP32 網頁伺服器控制練習&lt;/title>            &lt;meta name="viewport" content="width=device-width, initial            scale=1">            &lt;link rel="icon" href="data:,">            &lt;style>                html &#123;                    text-align: center;                    font-family: Arial;                    display: inline-block;                    margin: auto;&#125;                .button &#123;                    background-color: #e0e252; /* Green */                    border: none;                    color: white;                    padding: 15px 35px;                    text-align: center;                    text-decoration: none;                    display: inline-block;                    font-size: 16px;                &#125;                .button2 &#123;                    background-color: #b0b1a2; /* Green */                    padding: 15px 32px;                &#125;            &lt;/style>        &lt;/head>          &lt;body>            &lt;h1>ESP32 網頁伺服器控制練習&lt;/h1>            &lt;p>GPIO-2 狀態: &lt;strong>"""</span> <span class="token operator">+</span> ledState <span class="token operator">+</span> <span class="token triple-quoted-string string">"""&lt;/strong>&lt;/p>            &lt;p>&lt;a href="/on">&lt;button class="button">ON&lt;/button>&lt;/a>&lt;/p>            &lt;p>&lt;a href="/off">&lt;button class="button button2">OFF&lt;/button>&lt;/a>&lt;/p>        &lt;/body>        &lt;/html>    """</span>    <span class="token keyword">return</span> html<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><hr><p><strong>以下是套接</strong></p><pre class="line-numbers language-py" data-language="py"><code class="language-py">s<span class="token operator">=</span>socket<span class="token punctuation">.</span>socket<span class="token punctuation">(</span>socket<span class="token punctuation">.</span>AF_INET<span class="token punctuation">,</span> socket<span class="token punctuation">.</span>SOCK_STREAM<span class="token punctuation">)</span>s<span class="token punctuation">.</span>bind<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token string">''</span><span class="token punctuation">,</span> <span class="token number">80</span><span class="token punctuation">)</span><span class="token punctuation">)</span>s<span class="token punctuation">.</span>listen<span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span>  <span class="token keyword">while</span> <span class="token boolean">True</span><span class="token punctuation">:</span>    conn<span class="token punctuation">,</span> addr <span class="token operator">=</span> s<span class="token punctuation">.</span>accept<span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"got a connect from %s"</span><span class="token operator">%</span><span class="token builtin">str</span><span class="token punctuation">(</span>addr<span class="token punctuation">)</span><span class="token punctuation">)</span>    request <span class="token operator">=</span> conn<span class="token punctuation">.</span>recv<span class="token punctuation">(</span><span class="token number">1024</span><span class="token punctuation">)</span>    request <span class="token operator">=</span> <span class="token builtin">str</span><span class="token punctuation">(</span>request<span class="token punctuation">)</span>    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"context = %s"</span><span class="token operator">%</span>request<span class="token punctuation">)</span>    led_on <span class="token operator">=</span> request<span class="token punctuation">.</span>find<span class="token punctuation">(</span><span class="token string">"/on"</span><span class="token punctuation">)</span>    led_off <span class="token operator">=</span> request<span class="token punctuation">.</span>find<span class="token punctuation">(</span><span class="token string">"/off"</span><span class="token punctuation">)</span>    <span class="token keyword">if</span> led_on <span class="token operator">==</span> <span class="token number">6</span><span class="token punctuation">:</span>        led<span class="token punctuation">.</span>value<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"ON"</span><span class="token punctuation">)</span>    <span class="token keyword">if</span> led_off <span class="token operator">==</span> <span class="token number">6</span><span class="token punctuation">:</span>        led<span class="token punctuation">.</span>value<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"OFF"</span><span class="token punctuation">)</span>    respones <span class="token operator">=</span> sw_page<span class="token punctuation">(</span><span class="token punctuation">)</span>    conn<span class="token punctuation">.</span>send<span class="token punctuation">(</span><span class="token string">"HTTP/1.1 200 OK\n"</span><span class="token punctuation">)</span>    conn<span class="token punctuation">.</span>send<span class="token punctuation">(</span><span class="token string">"Context-Type: text/html\n"</span><span class="token punctuation">)</span>    conn<span class="token punctuation">.</span>send<span class="token punctuation">(</span><span class="token string">"Connection: close\n\n"</span><span class="token punctuation">)</span>    conn<span class="token punctuation">.</span>sendall<span class="token punctuation">(</span>respones<span class="token punctuation">)</span>    conn<span class="token punctuation">.</span>close<span class="token punctuation">(</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><div class="video-container"><iframe src="https://www.youtube.com/embed/OmbY4UQ8Kcc" frameborder="0" loading="lazy" allowfullscreen></iframe></div>]]></content>
      
      
      <categories>
          
          <category> micropython </category>
          
          <category> esp32 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> web server </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>HC-SR04超音波模組&amp;網頁顯示</title>
      <link href="/2021/08/29/hc-sr04-chao-yin-bo-mo-zu-wang-ye-xian-shi/"/>
      <url>/2021/08/29/hc-sr04-chao-yin-bo-mo-zu-wang-ye-xian-shi/</url>
      
        <content type="html"><![CDATA[<h1 id="HC-SR04超音波模組-amp-網頁顯示"><a href="#HC-SR04超音波模組-amp-網頁顯示" class="headerlink" title="HC-SR04超音波模組&amp;網頁顯示"></a>HC-SR04超音波模組&amp;網頁顯示</h1><h6 id="tags-micropython-‘hc-sr04’"><a href="#tags-micropython-‘hc-sr04’" class="headerlink" title="tags: micropython, ‘hc-sr04’"></a>tags: <code>micropython</code>, ‘hc-sr04’</h6><p><strong>超音波模組測試參考-</strong><a href="https://draft.blogger.com/blog/post/edit/6280040346040914276/956822760667011320#">https://blairan-esp32-micropython.blogspot.com/2021/07/blog-post.html</a></p><p><strong><em>基於以上的基本測試,加入WiFi網頁伺服器即可顯示於網頁</em></strong></p><h2 id="接線"><a href="#接線" class="headerlink" title="接線"></a>接線</h2><p>————————–    </p><p>//  * | HC-SC04 | ESP32  |    </p><p>//  * ———————    </p><p>//  * |   Vcc   |   3.3V  |    </p><p>//  * |   Trig  |   32    |  </p><p>//  * |   Echo  |   33    |     </p><p>//  * |   Gnd   |   GND   |  </p><p>//  * ———————</p><p><a href="https://draft.blogger.com/blog/post/edit/6280040346040914276/956822760667011320#"><img src="https://lemariva.com/storage/temp/public/295/644/a2e/esp32_bb__750.png"></a></p><hr><h2 id="上傳HC-SR04-py檔至板上"><a href="#上傳HC-SR04-py檔至板上" class="headerlink" title="上傳HC-SR04.py檔至板上"></a>上傳HC-SR04.py檔至板上</h2><h2 id="HC-SR04-py"><a href="#HC-SR04-py" class="headerlink" title="HC_SR04.py"></a>HC_SR04.py</h2><pre class="line-numbers language-py" data-language="py"><code class="language-py"><span class="token keyword">import</span> machine<span class="token punctuation">,</span> time<span class="token keyword">from</span> machine <span class="token keyword">import</span> Pin <span class="token keyword">class</span> <span class="token class-name">HCSR04</span><span class="token punctuation">:</span>    <span class="token triple-quoted-string string">"""    Driver to use the untrasonic sensor HC-SR04.    The sensor range is between 2cm and 4m.    The timeouts received listening to echo pin are converted to OSError('Out of range')    """</span>    <span class="token comment"># echo_timeout_us is based in chip range limit (400cm)</span>    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> trigger_pin<span class="token punctuation">,</span> echo_pin<span class="token punctuation">,</span> echo_timeout_us<span class="token operator">=</span><span class="token number">500</span><span class="token operator">*</span><span class="token number">2</span><span class="token operator">*</span><span class="token number">30</span><span class="token punctuation">)</span><span class="token punctuation">:</span>        <span class="token triple-quoted-string string">"""        trigger_pin: Output pin to send pulses        echo_pin: Readonly pin to measure the distance. The pin should be protected with 1k resistor        echo_timeout_us: Timeout in microseconds to listen to echo pin.         By default is based in sensor limit range (4m)        """</span>        self<span class="token punctuation">.</span>echo_timeout_us <span class="token operator">=</span> echo_timeout_us        <span class="token comment"># Init trigger pin (out)</span>        self<span class="token punctuation">.</span>trigger <span class="token operator">=</span> Pin<span class="token punctuation">(</span>trigger_pin<span class="token punctuation">,</span> mode<span class="token operator">=</span>Pin<span class="token punctuation">.</span>OUT<span class="token punctuation">,</span> pull<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">)</span>        self<span class="token punctuation">.</span>trigger<span class="token punctuation">.</span>value<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>         <span class="token comment"># Init echo pin (in)</span>        self<span class="token punctuation">.</span>echo <span class="token operator">=</span> Pin<span class="token punctuation">(</span>echo_pin<span class="token punctuation">,</span> mode<span class="token operator">=</span>Pin<span class="token punctuation">.</span>IN<span class="token punctuation">,</span> pull<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">)</span>     <span class="token keyword">def</span> <span class="token function">_send_pulse_and_wait</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>        <span class="token triple-quoted-string string">"""        Send the pulse to trigger and listen on echo pin.        We use the method `machine.time_pulse_us()` to get the microseconds until the echo is received.        """</span>        self<span class="token punctuation">.</span>trigger<span class="token punctuation">.</span>value<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span> <span class="token comment"># Stabilize the sensor</span>        time<span class="token punctuation">.</span>sleep_us<span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span>        self<span class="token punctuation">.</span>trigger<span class="token punctuation">.</span>value<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>        <span class="token comment"># Send a 10us pulse.</span>        time<span class="token punctuation">.</span>sleep_us<span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span>        self<span class="token punctuation">.</span>trigger<span class="token punctuation">.</span>value<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>        <span class="token keyword">try</span><span class="token punctuation">:</span>            pulse_time <span class="token operator">=</span> machine<span class="token punctuation">.</span>time_pulse_us<span class="token punctuation">(</span>self<span class="token punctuation">.</span>echo<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> self<span class="token punctuation">.</span>echo_timeout_us<span class="token punctuation">)</span>            <span class="token keyword">return</span> pulse_time        <span class="token keyword">except</span> OSError <span class="token keyword">as</span> ex<span class="token punctuation">:</span>            <span class="token keyword">if</span> ex<span class="token punctuation">.</span>args<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token number">110</span><span class="token punctuation">:</span> <span class="token comment"># 110 = ETIMEDOUT</span>                <span class="token keyword">raise</span> OSError<span class="token punctuation">(</span><span class="token string">'Out of range'</span><span class="token punctuation">)</span>            <span class="token keyword">raise</span> ex     <span class="token keyword">def</span> <span class="token function">distance_mm</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>        <span class="token triple-quoted-string string">"""        Get the distance in milimeters without floating point operations.        """</span>        pulse_time <span class="token operator">=</span> self<span class="token punctuation">.</span>_send_pulse_and_wait<span class="token punctuation">(</span><span class="token punctuation">)</span>         <span class="token comment"># To calculate the distance we get the pulse_time and divide it by 2 </span>        <span class="token comment"># (the pulse walk the distance twice) and by 29.1 becasue</span>        <span class="token comment"># the sound speed on air (343.2 m/s), that It's equivalent to</span>        <span class="token comment"># 0.34320 mm/us that is 1mm each 2.91us</span>        <span class="token comment"># pulse_time // 2 // 2.91 -> pulse_time // 5.82 -> pulse_time * 100 // 582 </span>        mm <span class="token operator">=</span> pulse_time <span class="token operator">*</span> <span class="token number">100</span> <span class="token operator">//</span> <span class="token number">582</span>        <span class="token keyword">return</span> mm     <span class="token keyword">def</span> <span class="token function">distance_cm</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>        <span class="token triple-quoted-string string">"""        Get the distance in centimeters with floating point operations.        It returns a float        """</span>        pulse_time <span class="token operator">=</span> self<span class="token punctuation">.</span>_send_pulse_and_wait<span class="token punctuation">(</span><span class="token punctuation">)</span>         <span class="token comment"># To calculate the distance we get the pulse_time and divide it by 2 </span>        <span class="token comment"># (the pulse walk the distance twice) and by 29.1 becasue</span>        <span class="token comment"># the sound speed on air (343.2 m/s), that It's equivalent to</span>        <span class="token comment"># 0.034320 cm/us that is 1cm each 29.1us</span>        cms <span class="token operator">=</span> <span class="token punctuation">(</span>pulse_time <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token number">29.1</span>        <span class="token keyword">return</span> cms<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="主程式碼"><a href="#主程式碼" class="headerlink" title="主程式碼"></a>主程式碼</h2><pre class="line-numbers language-py" data-language="py"><code class="language-py"><span class="token operator">**</span>main<span class="token punctuation">.</span>py<span class="token operator">**</span><span class="token keyword">from</span> machine <span class="token keyword">import</span> Pin <span class="token comment">#匯入i2c相關模組和腳位模組</span><span class="token keyword">from</span> HC_SR04 <span class="token keyword">import</span> HCSR04<span class="token keyword">import</span> socket<span class="token punctuation">,</span> network  ssid<span class="token operator">=</span><span class="token string">"基地台名稱"</span>password<span class="token operator">=</span><span class="token string">"基地台密碼"</span>wifi <span class="token operator">=</span> network<span class="token punctuation">.</span>WLAN<span class="token punctuation">(</span>network<span class="token punctuation">.</span>STA_IF<span class="token punctuation">)</span>wifi<span class="token punctuation">.</span>active<span class="token punctuation">(</span><span class="token boolean">True</span><span class="token punctuation">)</span>wifi<span class="token punctuation">.</span>connect<span class="token punctuation">(</span>ssid<span class="token punctuation">,</span> password<span class="token punctuation">)</span>  sensor<span class="token operator">=</span>HCSR04<span class="token punctuation">(</span>trigger_pin<span class="token operator">=</span><span class="token number">32</span><span class="token punctuation">,</span> echo_pin<span class="token operator">=</span><span class="token number">33</span><span class="token punctuation">,</span> echo\_timeout\_us<span class="token operator">=</span><span class="token number">100000</span><span class="token punctuation">)</span>  <span class="token keyword">while</span> wifi<span class="token punctuation">.</span>isconnected<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">==</span><span class="token boolean">False</span><span class="token punctuation">:</span>    <span class="token keyword">pass</span><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"Connected Successful!"</span><span class="token punctuation">)</span><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"IP: &#123;&#125;"</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>wifi<span class="token punctuation">.</span>ifconfig<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token keyword">def</span> readDist<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">global</span> dist    dist<span class="token operator">=</span><span class="token builtin">round</span><span class="token punctuation">(</span>sensor<span class="token punctuation">.</span>distance_cm<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span>    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"The distance is &#123;:.1f&#125; cm"</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>dist<span class="token punctuation">)</span><span class="token punctuation">)</span>    <span class="token keyword">return</span> dist  <span class="token keyword">def</span> htmlPage<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    html<span class="token operator">=</span><span class="token triple-quoted-string string">"""        &lt;html>    &lt;head>      &lt;meta charset="utf-8" />      &lt;meta http-equiv="refresh" content="1" />      &lt;meta name="viewport" content="width=device-width, initial-scale=1.0" />      &lt;style>        h1  &#123;text-align: center; background-color: orange; margin-right:5px;&#125;        dl &#123; width: 320px; margin: 12px auto; &#125;        dt &#123;           font-size: 20pt; color: #444; background-color: #ddd;          margin: 6pt 0; padding: 6pt 12pt;        &#125;        dd &#123;          text-align: right; padding-right: 6pt;        &#125;        .num &#123; font-size: 36pt; color: dodgerblue; &#125;      &lt;/style>      &lt;/head>    &lt;body>      &lt;p>&lt;h1>ESP32 HC-SR04 Distance Test&lt;/h1>&lt;/p>      &lt;dl>        &lt;dt>Distance:&lt;/dt>        &lt;dd class=num>"""</span><span class="token operator">+</span><span class="token builtin">str</span><span class="token punctuation">(</span>dist<span class="token punctuation">)</span><span class="token operator">+</span><span class="token triple-quoted-string string">"""cm&lt;/dd>      &lt;/dl>    &lt;/body>    &lt;/html>    """</span>    <span class="token keyword">return</span> htmls<span class="token operator">=</span>socket<span class="token punctuation">.</span>socket<span class="token punctuation">(</span>socket<span class="token punctuation">.</span>AF_INET<span class="token punctuation">,</span> socket<span class="token punctuation">.</span>SOCK_STREAM<span class="token punctuation">)</span>s<span class="token punctuation">.</span>bind<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token string">''</span><span class="token punctuation">,</span> <span class="token number">80</span><span class="token punctuation">)</span><span class="token punctuation">)</span>s<span class="token punctuation">.</span>listen<span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span>  <span class="token keyword">while</span> <span class="token boolean">True</span><span class="token punctuation">:</span>    conn<span class="token punctuation">,</span> addr <span class="token operator">=</span> s<span class="token punctuation">.</span>accept<span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'Got a connection from %s'</span> <span class="token operator">%</span> <span class="token builtin">str</span><span class="token punctuation">(</span>addr<span class="token punctuation">)</span><span class="token punctuation">)</span>    req <span class="token operator">=</span> conn<span class="token punctuation">.</span>recv<span class="token punctuation">(</span><span class="token number">1024</span><span class="token punctuation">)</span>    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'Content = %s'</span> <span class="token operator">%</span> <span class="token builtin">str</span><span class="token punctuation">(</span>req<span class="token punctuation">)</span><span class="token punctuation">)</span>    DRead <span class="token operator">=</span> readDist<span class="token punctuation">(</span><span class="token punctuation">)</span>    response <span class="token operator">=</span> htmlPage<span class="token punctuation">(</span><span class="token punctuation">)</span>    conn<span class="token punctuation">.</span>send<span class="token punctuation">(</span><span class="token string">"http/1.1 200 OK\\n"</span><span class="token punctuation">)</span>    conn<span class="token punctuation">.</span>send<span class="token punctuation">(</span><span class="token string">"Content-Type: text/html\\n"</span><span class="token punctuation">)</span>    conn<span class="token punctuation">.</span>send<span class="token punctuation">(</span><span class="token string">"Connection: close\\n\\n"</span><span class="token punctuation">)</span>    conn<span class="token punctuation">.</span>sendall<span class="token punctuation">(</span>response<span class="token punctuation">)</span>    conn<span class="token punctuation">.</span>close<span class="token punctuation">(</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="解析"><a href="#解析" class="headerlink" title="解析"></a>解析</h2><p><strong>匯入machine, sockt, network, HC_SR04模組</strong></p><pre class="line-numbers language-py" data-language="py"><code class="language-py"><span class="token keyword">from</span> machine <span class="token keyword">import</span> Pin <span class="token keyword">from</span> HC_SR04 <span class="token keyword">import</span> HCSR04<span class="token keyword">import</span> socket<span class="token punctuation">,</span> network<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><strong>設定wifi連線</strong></p><pre class="line-numbers language-py" data-language="py"><code class="language-py">ssid<span class="token operator">=</span><span class="token string">"基地台名稱"</span>password<span class="token operator">=</span><span class="token string">"基地台密碼"</span>wifi <span class="token operator">=</span> network<span class="token punctuation">.</span>WLAN<span class="token punctuation">(</span>network<span class="token punctuation">.</span>STA_IF<span class="token punctuation">)</span>wifi<span class="token punctuation">.</span>active<span class="token punctuation">(</span><span class="token boolean">True</span><span class="token punctuation">)</span>wifi<span class="token punctuation">.</span>connect<span class="token punctuation">(</span>ssid<span class="token punctuation">,</span> password<span class="token punctuation">)</span><span class="token keyword">while</span> wifi<span class="token punctuation">.</span>isconnected<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">==</span><span class="token boolean">False</span><span class="token punctuation">:</span>    <span class="token keyword">pass</span><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"Connected Successful!"</span><span class="token punctuation">)</span><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"IP: &#123;&#125;"</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>wifi<span class="token punctuation">.</span>ifconfig<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><strong>超音波測距</strong></p><pre class="line-numbers language-py" data-language="py"><code class="language-py">sensor<span class="token operator">=</span>HCSR04<span class="token punctuation">(</span>trigger_pin<span class="token operator">=</span><span class="token number">32</span><span class="token punctuation">,</span> echo_pin<span class="token operator">=</span><span class="token number">33</span><span class="token punctuation">,</span>echo_timeout_us<span class="token operator">=</span><span class="token number">100000</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p><strong>讀取距離的函式</strong></p><pre class="line-numbers language-py" data-language="py"><code class="language-py"><span class="token keyword">def</span> readDist<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">global</span> dist    dist<span class="token operator">=</span><span class="token builtin">round</span><span class="token punctuation">(</span>sensor<span class="token punctuation">.</span>distance_cm<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span>    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"The distance is &#123;:.1f&#125; cm"</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>dist<span class="token punctuation">)</span><span class="token punctuation">)</span>    <span class="token keyword">return</span> dist<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><strong>前端網頁</strong></p><pre class="line-numbers language-html" data-language="html"><code class="language-html">def htmlPage():    html="""        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span><span class="token punctuation">></span></span>      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">charset</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>utf-8<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span>      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">http-equiv</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>refresh<span class="token punctuation">"</span></span> <span class="token attr-name">content</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>1<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span>      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>viewport<span class="token punctuation">"</span></span> <span class="token attr-name">content</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>width=device-width, initial-scale=1.0<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span>      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>style</span><span class="token punctuation">></span></span><span class="token style"><span class="token language-css">        <span class="token selector">h1</span>  <span class="token punctuation">&#123;</span><span class="token property">text-align</span><span class="token punctuation">:</span> center<span class="token punctuation">;</span> background-color<span class="token punctuation">:</span> orange<span class="token punctuation">;</span> margin-right<span class="token punctuation">:</span>5px<span class="token punctuation">;</span><span class="token punctuation">&#125;</span>        <span class="token selector">dl</span> <span class="token punctuation">&#123;</span> width<span class="token punctuation">:</span> 320px<span class="token punctuation">;</span> margin<span class="token punctuation">:</span> 12px auto<span class="token punctuation">;</span> <span class="token punctuation">&#125;</span>        <span class="token selector">dt</span> <span class="token punctuation">&#123;</span>           font-size<span class="token punctuation">:</span> 20pt<span class="token punctuation">;</span> color<span class="token punctuation">:</span> #444<span class="token punctuation">;</span> background-color<span class="token punctuation">:</span> #ddd<span class="token punctuation">;</span>          margin<span class="token punctuation">:</span> 6pt 0<span class="token punctuation">;</span> padding<span class="token punctuation">:</span> 6pt 12pt<span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>        <span class="token selector">dd</span> <span class="token punctuation">&#123;</span>          text-align<span class="token punctuation">:</span> right<span class="token punctuation">;</span> padding-right<span class="token punctuation">:</span> 6pt<span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>        <span class="token selector">.num</span> <span class="token punctuation">&#123;</span> font-size<span class="token punctuation">:</span> 36pt<span class="token punctuation">;</span> color<span class="token punctuation">:</span> dodgerblue<span class="token punctuation">;</span> <span class="token punctuation">&#125;</span>      </span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>style</span><span class="token punctuation">></span></span>      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>head</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">></span></span>      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h1</span><span class="token punctuation">></span></span>ESP32 HC-SR04 Distance Test<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h1</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">></span></span>      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dl</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dt</span><span class="token punctuation">></span></span>Distance:<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dt</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dd</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span>num</span><span class="token punctuation">></span></span>"""+str(dist)+"""cm<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dd</span><span class="token punctuation">></span></span>      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dl</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">></span></span>    """    return html  <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><strong>socket套接</strong></p><pre class="line-numbers language-py" data-language="py"><code class="language-py">s<span class="token operator">=</span>socket<span class="token punctuation">.</span>socket<span class="token punctuation">(</span>socket<span class="token punctuation">.</span>AF_INET<span class="token punctuation">,</span> socket<span class="token punctuation">.</span>SOCK_STREAM<span class="token punctuation">)</span>s<span class="token punctuation">.</span>bind<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token string">''</span><span class="token punctuation">,</span> <span class="token number">80</span><span class="token punctuation">)</span><span class="token punctuation">)</span>s<span class="token punctuation">.</span>listen<span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span>  <span class="token keyword">while</span> <span class="token boolean">True</span><span class="token punctuation">:</span>    conn<span class="token punctuation">,</span> addr <span class="token operator">=</span> s<span class="token punctuation">.</span>accept<span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'Got a connection from %s'</span> <span class="token operator">%</span> <span class="token builtin">str</span><span class="token punctuation">(</span>addr<span class="token punctuation">)</span><span class="token punctuation">)</span>    req <span class="token operator">=</span> conn<span class="token punctuation">.</span>recv<span class="token punctuation">(</span><span class="token number">1024</span><span class="token punctuation">)</span>    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'Content = %s'</span> <span class="token operator">%</span> <span class="token builtin">str</span><span class="token punctuation">(</span>req<span class="token punctuation">)</span><span class="token punctuation">)</span>    DRead <span class="token operator">=</span> readDist<span class="token punctuation">(</span><span class="token punctuation">)</span>    response <span class="token operator">=</span> htmlPage<span class="token punctuation">(</span><span class="token punctuation">)</span>    conn<span class="token punctuation">.</span>send<span class="token punctuation">(</span><span class="token string">"http/1.1 200 OK\n"</span><span class="token punctuation">)</span>    conn<span class="token punctuation">.</span>send<span class="token punctuation">(</span><span class="token string">"Content-Type: text/html\n"</span><span class="token punctuation">)</span>    conn<span class="token punctuation">.</span>send<span class="token punctuation">(</span><span class="token string">"Connection: close\n\n"</span><span class="token punctuation">)</span>    conn<span class="token punctuation">.</span>sendall<span class="token punctuation">(</span>response<span class="token punctuation">)</span>    conn<span class="token punctuation">.</span>close<span class="token punctuation">(</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><div class="video-container"><iframe src="https://www.youtube.com/embed/10foDr8unxo" frameborder="0" loading="lazy" allowfullscreen></iframe></div>]]></content>
      
      
      <categories>
          
          <category> micropython </category>
          
          <category> esp32 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> hc-sr04 </tag>
            
            <tag> web server </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>超音波模組&amp;0.96OLED-micropython</title>
      <link href="/2021/08/29/chao-yin-bo-mo-zu-0-96oled-micropython/"/>
      <url>/2021/08/29/chao-yin-bo-mo-zu-0-96oled-micropython/</url>
      
        <content type="html"><![CDATA[<h1 id="超音波模組-amp-0-96OLED-micropython"><a href="#超音波模組-amp-0-96OLED-micropython" class="headerlink" title="超音波模組&amp;0.96OLED-micropython"></a>超音波模組&amp;0.96OLED-micropython</h1><h6 id="tags-micropython-hcsr04-amp-0-96oled-esp32"><a href="#tags-micropython-hcsr04-amp-0-96oled-esp32" class="headerlink" title="tags: micropython hcsr04&amp;0.96oled esp32"></a>tags: <code>micropython</code> <code>hcsr04&amp;0.96oled</code> <code>esp32</code></h6><h2 id="接線"><a href="#接線" class="headerlink" title="接線"></a>接線</h2><p><a href="https://draft.blogger.com/blog/post/edit/6280040346040914276/3844235121108768211#"><img src="https://1.bp.blogspot.com/-vUSt95-nd5I/YOqB-78G3uI/AAAAAAAAebY/SOiwses8e8QZD-XSYQsYuJA3B0DTTVAMQCNcBGAsYHQ/w703-h340/MicroPython-Ultrasonic-Sensor-ESP32.jpg"></a></p><p>————————–      ———————     </p><p>//  * | HC-SC04 | ESP32  |     |  OLED | ESP32 |</p><p>//  * ———————     ———————     </p><p>//  * |   Vcc   |   3.3V  |     | Vcc | 3.3V |</p><p>//  * |   Trig  |   32    |     | Gnd | GND |</p><p>//  * |   Echo  |   33    |     | SCL | 21 |</p><p>//  * |   Gnd   |   GND   |     | SDA | 22 |</p><p>//  * --------------------- ———————-</p><hr><h2 id="將ssd1306-py-HC-SR04-py上傳至板子裡"><a href="#將ssd1306-py-HC-SR04-py上傳至板子裡" class="headerlink" title="將ssd1306.py HC_SR04.py上傳至板子裡"></a>將ssd1306.py HC_SR04.py上傳至板子裡</h2><p>**考鋇以下二檔並存成py檔 **</p><p><strong>ssd1306.py</strong></p><pre class="line-numbers language-py" data-language="py"><code class="language-py"><span class="token comment"># MicroPython SSD1306 OLED driver, I2C and SPI interfaces</span><span class="token keyword">from</span> micropython <span class="token keyword">import</span> const<span class="token keyword">import</span> time<span class="token keyword">import</span> framebuf<span class="token keyword">import</span> sys currentBoard<span class="token operator">=</span><span class="token string">""</span><span class="token keyword">if</span><span class="token punctuation">(</span>sys<span class="token punctuation">.</span>platform<span class="token operator">==</span><span class="token string">"esp8266"</span><span class="token punctuation">)</span><span class="token punctuation">:</span>  currentBoard<span class="token operator">=</span><span class="token string">"esp8266"</span><span class="token keyword">elif</span><span class="token punctuation">(</span>sys<span class="token punctuation">.</span>platform<span class="token operator">==</span><span class="token string">"esp32"</span><span class="token punctuation">)</span><span class="token punctuation">:</span>  currentBoard<span class="token operator">=</span><span class="token string">"esp32"</span><span class="token keyword">elif</span><span class="token punctuation">(</span>sys<span class="token punctuation">.</span>platform<span class="token operator">==</span><span class="token string">"pyboard"</span><span class="token punctuation">)</span><span class="token punctuation">:</span>  currentBoard<span class="token operator">=</span><span class="token string">"pyboard"</span>  <span class="token keyword">import</span> pyb<span class="token comment"># register definitions</span>SET_CONTRAST        <span class="token operator">=</span> const<span class="token punctuation">(</span><span class="token number">0x81</span><span class="token punctuation">)</span>SET_ENTIRE_ON       <span class="token operator">=</span> const<span class="token punctuation">(</span><span class="token number">0xa4</span><span class="token punctuation">)</span>SET_NORM_INV        <span class="token operator">=</span> const<span class="token punctuation">(</span><span class="token number">0xa6</span><span class="token punctuation">)</span>SET_DISP            <span class="token operator">=</span> const<span class="token punctuation">(</span><span class="token number">0xae</span><span class="token punctuation">)</span>SET_MEM_ADDR        <span class="token operator">=</span> const<span class="token punctuation">(</span><span class="token number">0x20</span><span class="token punctuation">)</span>SET_COL_ADDR        <span class="token operator">=</span> const<span class="token punctuation">(</span><span class="token number">0x21</span><span class="token punctuation">)</span>SET_PAGE_ADDR       <span class="token operator">=</span> const<span class="token punctuation">(</span><span class="token number">0x22</span><span class="token punctuation">)</span>SET_DISP_START_LINE <span class="token operator">=</span> const<span class="token punctuation">(</span><span class="token number">0x40</span><span class="token punctuation">)</span>SET_SEG_REMAP       <span class="token operator">=</span> const<span class="token punctuation">(</span><span class="token number">0xa0</span><span class="token punctuation">)</span>SET_MUX_RATIO       <span class="token operator">=</span> const<span class="token punctuation">(</span><span class="token number">0xa8</span><span class="token punctuation">)</span>SET_COM_OUT_DIR     <span class="token operator">=</span> const<span class="token punctuation">(</span><span class="token number">0xc0</span><span class="token punctuation">)</span>SET_DISP_OFFSET     <span class="token operator">=</span> const<span class="token punctuation">(</span><span class="token number">0xd3</span><span class="token punctuation">)</span>SET_COM_PIN_CFG     <span class="token operator">=</span> const<span class="token punctuation">(</span><span class="token number">0xda</span><span class="token punctuation">)</span>SET_DISP_CLK_DIV    <span class="token operator">=</span> const<span class="token punctuation">(</span><span class="token number">0xd5</span><span class="token punctuation">)</span>SET_PRECHARGE       <span class="token operator">=</span> const<span class="token punctuation">(</span><span class="token number">0xd9</span><span class="token punctuation">)</span>SET_VCOM_DESEL      <span class="token operator">=</span> const<span class="token punctuation">(</span><span class="token number">0xdb</span><span class="token punctuation">)</span>SET_CHARGE_PUMP     <span class="token operator">=</span> const<span class="token punctuation">(</span><span class="token number">0x8d</span><span class="token punctuation">)</span><span class="token keyword">class</span> <span class="token class-name">SSD1306</span><span class="token punctuation">:</span>  <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> width<span class="token punctuation">,</span> height<span class="token punctuation">,</span> external_vcc<span class="token punctuation">)</span><span class="token punctuation">:</span>    self<span class="token punctuation">.</span>width <span class="token operator">=</span> width    self<span class="token punctuation">.</span>height <span class="token operator">=</span> height    self<span class="token punctuation">.</span>external_vcc <span class="token operator">=</span> external_vcc    self<span class="token punctuation">.</span>pages <span class="token operator">=</span> self<span class="token punctuation">.</span>height <span class="token operator">//</span> <span class="token number">8</span>    self<span class="token punctuation">.</span><span class="token builtin">buffer</span> <span class="token operator">=</span> <span class="token builtin">bytearray</span><span class="token punctuation">(</span>self<span class="token punctuation">.</span>pages <span class="token operator">*</span> self<span class="token punctuation">.</span>width<span class="token punctuation">)</span>    self<span class="token punctuation">.</span>framebuf <span class="token operator">=</span> framebuf<span class="token punctuation">.</span>FrameBuffer<span class="token punctuation">(</span>self<span class="token punctuation">.</span><span class="token builtin">buffer</span><span class="token punctuation">,</span> self<span class="token punctuation">.</span>width<span class="token punctuation">,</span> self<span class="token punctuation">.</span>height<span class="token punctuation">,</span> framebuf<span class="token punctuation">.</span>MVLSB<span class="token punctuation">)</span>    self<span class="token punctuation">.</span>poweron<span class="token punctuation">(</span><span class="token punctuation">)</span>    self<span class="token punctuation">.</span>init_display<span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token keyword">def</span> <span class="token function">init_display</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">for</span> cmd <span class="token keyword">in</span> <span class="token punctuation">(</span>      SET_DISP <span class="token operator">|</span> <span class="token number">0x00</span><span class="token punctuation">,</span> <span class="token comment"># off</span>      <span class="token comment"># address setting</span>      SET_MEM_ADDR<span class="token punctuation">,</span> <span class="token number">0x00</span><span class="token punctuation">,</span> <span class="token comment"># horizontal</span>      <span class="token comment"># resolution and layout</span>      SET_DISP_START_LINE <span class="token operator">|</span> <span class="token number">0x00</span><span class="token punctuation">,</span>      SET_SEG_REMAP <span class="token operator">|</span> <span class="token number">0x01</span><span class="token punctuation">,</span> <span class="token comment"># column addr 127 mapped to SEG0</span>      SET_MUX_RATIO<span class="token punctuation">,</span> self<span class="token punctuation">.</span>height <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">,</span>      SET_COM_OUT_DIR <span class="token operator">|</span> <span class="token number">0x08</span><span class="token punctuation">,</span> <span class="token comment"># scan from COM[N] to COM0</span>      SET_DISP_OFFSET<span class="token punctuation">,</span> <span class="token number">0x00</span><span class="token punctuation">,</span>      SET_COM_PIN_CFG<span class="token punctuation">,</span> <span class="token number">0x02</span> <span class="token keyword">if</span> self<span class="token punctuation">.</span>height <span class="token operator">==</span> <span class="token number">32</span> <span class="token keyword">else</span> <span class="token number">0x12</span><span class="token punctuation">,</span>      <span class="token comment"># timing and driving scheme</span>      SET_DISP_CLK_DIV<span class="token punctuation">,</span> <span class="token number">0x80</span><span class="token punctuation">,</span>      SET_PRECHARGE<span class="token punctuation">,</span> <span class="token number">0x22</span> <span class="token keyword">if</span> self<span class="token punctuation">.</span>external_vcc <span class="token keyword">else</span> <span class="token number">0xf1</span><span class="token punctuation">,</span>      SET_VCOM_DESEL<span class="token punctuation">,</span> <span class="token number">0x30</span><span class="token punctuation">,</span> <span class="token comment"># 0.83*Vcc</span>      <span class="token comment"># display</span>      SET_CONTRAST<span class="token punctuation">,</span> <span class="token number">0xff</span><span class="token punctuation">,</span> <span class="token comment"># maximum</span>      SET_ENTIRE_ON<span class="token punctuation">,</span> <span class="token comment"># output follows RAM contents</span>      SET_NORM_INV<span class="token punctuation">,</span> <span class="token comment"># not inverted</span>      <span class="token comment"># charge pump</span>      SET_CHARGE_PUMP<span class="token punctuation">,</span> <span class="token number">0x10</span> <span class="token keyword">if</span> self<span class="token punctuation">.</span>external_vcc <span class="token keyword">else</span> <span class="token number">0x14</span><span class="token punctuation">,</span>      SET_DISP <span class="token operator">|</span> <span class="token number">0x01</span><span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token comment"># on</span>      self<span class="token punctuation">.</span>write_cmd<span class="token punctuation">(</span>cmd<span class="token punctuation">)</span>    self<span class="token punctuation">.</span>fill<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>    self<span class="token punctuation">.</span>show<span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token keyword">def</span> <span class="token function">poweroff</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>    self<span class="token punctuation">.</span>write_cmd<span class="token punctuation">(</span>SET_DISP <span class="token operator">|</span> <span class="token number">0x00</span><span class="token punctuation">)</span>  <span class="token keyword">def</span> <span class="token function">contrast</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> contrast<span class="token punctuation">)</span><span class="token punctuation">:</span>    self<span class="token punctuation">.</span>write_cmd<span class="token punctuation">(</span>SET_CONTRAST<span class="token punctuation">)</span>    self<span class="token punctuation">.</span>write_cmd<span class="token punctuation">(</span>contrast<span class="token punctuation">)</span>  <span class="token keyword">def</span> <span class="token function">invert</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> invert<span class="token punctuation">)</span><span class="token punctuation">:</span>    self<span class="token punctuation">.</span>write_cmd<span class="token punctuation">(</span>SET_NORM_INV <span class="token operator">|</span> <span class="token punctuation">(</span>invert <span class="token operator">&amp;</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token keyword">def</span> <span class="token function">show</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>    x0 <span class="token operator">=</span> <span class="token number">0</span>    x1 <span class="token operator">=</span> self<span class="token punctuation">.</span>width <span class="token operator">-</span> <span class="token number">1</span>    <span class="token keyword">if</span> self<span class="token punctuation">.</span>width <span class="token operator">==</span> <span class="token number">64</span><span class="token punctuation">:</span>      <span class="token comment"># displays with width of 64 pixels are shifted by 32</span>      x0 <span class="token operator">+=</span> <span class="token number">32</span>      x1 <span class="token operator">+=</span> <span class="token number">32</span>    self<span class="token punctuation">.</span>write_cmd<span class="token punctuation">(</span>SET_COL_ADDR<span class="token punctuation">)</span>    self<span class="token punctuation">.</span>write_cmd<span class="token punctuation">(</span>x0<span class="token punctuation">)</span>    self<span class="token punctuation">.</span>write_cmd<span class="token punctuation">(</span>x1<span class="token punctuation">)</span>    self<span class="token punctuation">.</span>write_cmd<span class="token punctuation">(</span>SET_PAGE_ADDR<span class="token punctuation">)</span>    self<span class="token punctuation">.</span>write_cmd<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>    self<span class="token punctuation">.</span>write_cmd<span class="token punctuation">(</span>self<span class="token punctuation">.</span>pages <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span>    self<span class="token punctuation">.</span>write_data<span class="token punctuation">(</span>self<span class="token punctuation">.</span><span class="token builtin">buffer</span><span class="token punctuation">)</span>  <span class="token keyword">def</span> <span class="token function">fill</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> col<span class="token punctuation">)</span><span class="token punctuation">:</span>    self<span class="token punctuation">.</span>framebuf<span class="token punctuation">.</span>fill<span class="token punctuation">(</span>col<span class="token punctuation">)</span>  <span class="token keyword">def</span> <span class="token function">pixel</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> x<span class="token punctuation">,</span> y<span class="token punctuation">,</span> col<span class="token punctuation">)</span><span class="token punctuation">:</span>    self<span class="token punctuation">.</span>framebuf<span class="token punctuation">.</span>pixel<span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">,</span> col<span class="token punctuation">)</span>  <span class="token keyword">def</span> <span class="token function">scroll</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> dx<span class="token punctuation">,</span> dy<span class="token punctuation">)</span><span class="token punctuation">:</span>    self<span class="token punctuation">.</span>framebuf<span class="token punctuation">.</span>scroll<span class="token punctuation">(</span>dx<span class="token punctuation">,</span> dy<span class="token punctuation">)</span>  <span class="token keyword">def</span> <span class="token function">text</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> string<span class="token punctuation">,</span> x<span class="token punctuation">,</span> y<span class="token punctuation">,</span> col<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    self<span class="token punctuation">.</span>framebuf<span class="token punctuation">.</span>text<span class="token punctuation">(</span>string<span class="token punctuation">,</span> x<span class="token punctuation">,</span> y<span class="token punctuation">,</span> col<span class="token punctuation">)</span>  <span class="token keyword">def</span> <span class="token function">hline</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> x<span class="token punctuation">,</span> y<span class="token punctuation">,</span> w<span class="token punctuation">,</span> col<span class="token punctuation">)</span><span class="token punctuation">:</span>    self<span class="token punctuation">.</span>framebuf<span class="token punctuation">.</span>hline<span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">,</span> w<span class="token punctuation">,</span> col<span class="token punctuation">)</span>  <span class="token keyword">def</span> <span class="token function">vline</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> x<span class="token punctuation">,</span> y<span class="token punctuation">,</span> h<span class="token punctuation">,</span> col<span class="token punctuation">)</span><span class="token punctuation">:</span>    self<span class="token punctuation">.</span>framebuf<span class="token punctuation">.</span>vline<span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">,</span> h<span class="token punctuation">,</span> col<span class="token punctuation">)</span>  <span class="token keyword">def</span> <span class="token function">line</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> x1<span class="token punctuation">,</span> y1<span class="token punctuation">,</span> x2<span class="token punctuation">,</span> y2<span class="token punctuation">,</span> col<span class="token punctuation">)</span><span class="token punctuation">:</span>    self<span class="token punctuation">.</span>framebuf<span class="token punctuation">.</span>line<span class="token punctuation">(</span>x1<span class="token punctuation">,</span> y1<span class="token punctuation">,</span> x2<span class="token punctuation">,</span> y2<span class="token punctuation">,</span> col<span class="token punctuation">)</span>  <span class="token keyword">def</span> <span class="token function">rect</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> x<span class="token punctuation">,</span> y<span class="token punctuation">,</span> w<span class="token punctuation">,</span> h<span class="token punctuation">,</span> col<span class="token punctuation">)</span><span class="token punctuation">:</span>    self<span class="token punctuation">.</span>framebuf<span class="token punctuation">.</span>rect<span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">,</span> w<span class="token punctuation">,</span> h<span class="token punctuation">,</span> col<span class="token punctuation">)</span>  <span class="token keyword">def</span> <span class="token function">fill_rect</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> x<span class="token punctuation">,</span> y<span class="token punctuation">,</span> w<span class="token punctuation">,</span> h<span class="token punctuation">,</span> col<span class="token punctuation">)</span><span class="token punctuation">:</span>    self<span class="token punctuation">.</span>framebuf<span class="token punctuation">.</span>fill_rect<span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">,</span> w<span class="token punctuation">,</span> h<span class="token punctuation">,</span> col<span class="token punctuation">)</span>  <span class="token keyword">def</span> <span class="token function">blit</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> fbuf<span class="token punctuation">,</span> x<span class="token punctuation">,</span> y<span class="token punctuation">)</span><span class="token punctuation">:</span>    self<span class="token punctuation">.</span>framebuf<span class="token punctuation">.</span>blit<span class="token punctuation">(</span>fbuf<span class="token punctuation">,</span> x<span class="token punctuation">,</span> y<span class="token punctuation">)</span> <span class="token keyword">class</span> <span class="token class-name">SSD1306_I2C</span><span class="token punctuation">(</span>SSD1306<span class="token punctuation">)</span><span class="token punctuation">:</span>  <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> width<span class="token punctuation">,</span> height<span class="token punctuation">,</span> i2c<span class="token punctuation">,</span> addr<span class="token operator">=</span><span class="token number">0x3c</span><span class="token punctuation">,</span> external_vcc<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    self<span class="token punctuation">.</span>i2c <span class="token operator">=</span> i2c    self<span class="token punctuation">.</span>addr <span class="token operator">=</span> addr    self<span class="token punctuation">.</span>temp <span class="token operator">=</span> <span class="token builtin">bytearray</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span>    <span class="token builtin">super</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>__init__<span class="token punctuation">(</span>width<span class="token punctuation">,</span> height<span class="token punctuation">,</span> external_vcc<span class="token punctuation">)</span>  <span class="token keyword">def</span> <span class="token function">write_cmd</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> cmd<span class="token punctuation">)</span><span class="token punctuation">:</span>    self<span class="token punctuation">.</span>temp<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">0x80</span> <span class="token comment"># Co=1, D/C#=0</span>    self<span class="token punctuation">.</span>temp<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">=</span> cmd    <span class="token comment">#IF SYS  :</span>    <span class="token keyword">global</span> currentBoard    <span class="token keyword">if</span> currentBoard<span class="token operator">==</span><span class="token string">"esp8266"</span> <span class="token keyword">or</span> currentBoard<span class="token operator">==</span><span class="token string">"esp32"</span><span class="token punctuation">:</span>      self<span class="token punctuation">.</span>i2c<span class="token punctuation">.</span>writeto<span class="token punctuation">(</span>self<span class="token punctuation">.</span>addr<span class="token punctuation">,</span> self<span class="token punctuation">.</span>temp<span class="token punctuation">)</span>    <span class="token keyword">elif</span> currentBoard<span class="token operator">==</span><span class="token string">"pyboard"</span><span class="token punctuation">:</span>      self<span class="token punctuation">.</span>i2c<span class="token punctuation">.</span>send<span class="token punctuation">(</span>self<span class="token punctuation">.</span>temp<span class="token punctuation">,</span>self<span class="token punctuation">.</span>addr<span class="token punctuation">)</span>    <span class="token comment">#ELSE:</span>            <span class="token keyword">def</span> <span class="token function">write_data</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> buf<span class="token punctuation">)</span><span class="token punctuation">:</span>    self<span class="token punctuation">.</span>temp<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">=</span> self<span class="token punctuation">.</span>addr <span class="token operator">&lt;&lt;</span> <span class="token number">1</span>    self<span class="token punctuation">.</span>temp<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">0x40</span> <span class="token comment"># Co=0, D/C#=1</span>    <span class="token keyword">global</span> currentBoard    <span class="token keyword">if</span> currentBoard<span class="token operator">==</span><span class="token string">"esp8266"</span> <span class="token keyword">or</span> currentBoard<span class="token operator">==</span><span class="token string">"esp32"</span><span class="token punctuation">:</span>      self<span class="token punctuation">.</span>i2c<span class="token punctuation">.</span>start<span class="token punctuation">(</span><span class="token punctuation">)</span>      self<span class="token punctuation">.</span>i2c<span class="token punctuation">.</span>write<span class="token punctuation">(</span>self<span class="token punctuation">.</span>temp<span class="token punctuation">)</span>      self<span class="token punctuation">.</span>i2c<span class="token punctuation">.</span>write<span class="token punctuation">(</span>buf<span class="token punctuation">)</span>      self<span class="token punctuation">.</span>i2c<span class="token punctuation">.</span>stop<span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token keyword">elif</span> currentBoard<span class="token operator">==</span><span class="token string">"pyboard"</span><span class="token punctuation">:</span>      <span class="token comment">#self.i2c.send(self.temp,self.addr)</span>      <span class="token comment">#self.i2c.send(buf,self.addr)</span>      self<span class="token punctuation">.</span>i2c<span class="token punctuation">.</span>mem_write<span class="token punctuation">(</span>buf<span class="token punctuation">,</span>self<span class="token punctuation">.</span>addr<span class="token punctuation">,</span><span class="token number">0x40</span><span class="token punctuation">)</span>  <span class="token keyword">def</span> <span class="token function">poweron</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">pass</span> <span class="token keyword">class</span> <span class="token class-name">SSD1306_SPI</span><span class="token punctuation">(</span>SSD1306<span class="token punctuation">)</span><span class="token punctuation">:</span>  <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> width<span class="token punctuation">,</span> height<span class="token punctuation">,</span> spi<span class="token punctuation">,</span> dc<span class="token punctuation">,</span> res<span class="token punctuation">,</span> cs<span class="token punctuation">,</span> external_vcc<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    self<span class="token punctuation">.</span>rate <span class="token operator">=</span> <span class="token number">10</span> <span class="token operator">*</span> <span class="token number">1024</span> <span class="token operator">*</span> <span class="token number">1024</span>    dc<span class="token punctuation">.</span>init<span class="token punctuation">(</span>dc<span class="token punctuation">.</span>OUT<span class="token punctuation">,</span> value<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">)</span>    res<span class="token punctuation">.</span>init<span class="token punctuation">(</span>res<span class="token punctuation">.</span>OUT<span class="token punctuation">,</span> value<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">)</span>    cs<span class="token punctuation">.</span>init<span class="token punctuation">(</span>cs<span class="token punctuation">.</span>OUT<span class="token punctuation">,</span> value<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span>    self<span class="token punctuation">.</span>spi <span class="token operator">=</span> spi    self<span class="token punctuation">.</span>dc <span class="token operator">=</span> dc    self<span class="token punctuation">.</span>res <span class="token operator">=</span> res    self<span class="token punctuation">.</span>cs <span class="token operator">=</span> cs    <span class="token builtin">super</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>__init__<span class="token punctuation">(</span>width<span class="token punctuation">,</span> height<span class="token punctuation">,</span> external_vcc<span class="token punctuation">)</span>  <span class="token keyword">def</span> <span class="token function">write_cmd</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> cmd<span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">global</span> currentBoard    <span class="token keyword">if</span> currentBoard<span class="token operator">==</span><span class="token string">"esp8266"</span> <span class="token keyword">or</span> currentBoard<span class="token operator">==</span><span class="token string">"esp32"</span><span class="token punctuation">:</span>      self<span class="token punctuation">.</span>spi<span class="token punctuation">.</span>init<span class="token punctuation">(</span>baudrate<span class="token operator">=</span>self<span class="token punctuation">.</span>rate<span class="token punctuation">,</span> polarity<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">,</span> phase<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">)</span>    <span class="token keyword">elif</span> currentBoard<span class="token operator">==</span><span class="token string">"pyboard"</span><span class="token punctuation">:</span>      self<span class="token punctuation">.</span>spi<span class="token punctuation">.</span>init<span class="token punctuation">(</span>mode <span class="token operator">=</span> pyb<span class="token punctuation">.</span>SPI<span class="token punctuation">.</span>MASTER<span class="token punctuation">,</span>baudrate<span class="token operator">=</span>self<span class="token punctuation">.</span>rate<span class="token punctuation">,</span> polarity<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">,</span> phase<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">)</span>    self<span class="token punctuation">.</span>cs<span class="token punctuation">.</span>high<span class="token punctuation">(</span><span class="token punctuation">)</span>    self<span class="token punctuation">.</span>dc<span class="token punctuation">.</span>low<span class="token punctuation">(</span><span class="token punctuation">)</span>    self<span class="token punctuation">.</span>cs<span class="token punctuation">.</span>low<span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token keyword">global</span> currentBoard    <span class="token keyword">if</span> currentBoard<span class="token operator">==</span><span class="token string">"esp8266"</span> <span class="token keyword">or</span> currentBoard<span class="token operator">==</span><span class="token string">"esp32"</span><span class="token punctuation">:</span>      self<span class="token punctuation">.</span>spi<span class="token punctuation">.</span>write<span class="token punctuation">(</span><span class="token builtin">bytearray</span><span class="token punctuation">(</span><span class="token punctuation">[</span>cmd<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span>    <span class="token keyword">elif</span> currentBoard<span class="token operator">==</span><span class="token string">"pyboard"</span><span class="token punctuation">:</span>      self<span class="token punctuation">.</span>spi<span class="token punctuation">.</span>send<span class="token punctuation">(</span><span class="token builtin">bytearray</span><span class="token punctuation">(</span><span class="token punctuation">[</span>cmd<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span>    self<span class="token punctuation">.</span>cs<span class="token punctuation">.</span>high<span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token keyword">def</span> <span class="token function">write_data</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> buf<span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">global</span> currentBoard    <span class="token keyword">if</span> currentBoard<span class="token operator">==</span><span class="token string">"esp8266"</span> <span class="token keyword">or</span> currentBoard<span class="token operator">==</span><span class="token string">"esp32"</span><span class="token punctuation">:</span>      self<span class="token punctuation">.</span>spi<span class="token punctuation">.</span>init<span class="token punctuation">(</span>baudrate<span class="token operator">=</span>self<span class="token punctuation">.</span>rate<span class="token punctuation">,</span> polarity<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">,</span> phase<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">)</span>    <span class="token keyword">elif</span> currentBoard<span class="token operator">==</span><span class="token string">"pyboard"</span><span class="token punctuation">:</span>      self<span class="token punctuation">.</span>spi<span class="token punctuation">.</span>init<span class="token punctuation">(</span>mode <span class="token operator">=</span> pyb<span class="token punctuation">.</span>SPI<span class="token punctuation">.</span>MASTER<span class="token punctuation">,</span>baudrate<span class="token operator">=</span>self<span class="token punctuation">.</span>rate<span class="token punctuation">,</span> polarity<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">,</span> phase<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">)</span>    self<span class="token punctuation">.</span>cs<span class="token punctuation">.</span>high<span class="token punctuation">(</span><span class="token punctuation">)</span>    self<span class="token punctuation">.</span>dc<span class="token punctuation">.</span>high<span class="token punctuation">(</span><span class="token punctuation">)</span>    self<span class="token punctuation">.</span>cs<span class="token punctuation">.</span>low<span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token keyword">global</span> currentBoard    <span class="token keyword">if</span> currentBoard<span class="token operator">==</span><span class="token string">"esp8266"</span> <span class="token keyword">or</span> currentBoard<span class="token operator">==</span><span class="token string">"esp32"</span><span class="token punctuation">:</span>      self<span class="token punctuation">.</span>spi<span class="token punctuation">.</span>write<span class="token punctuation">(</span>buf<span class="token punctuation">)</span>    <span class="token keyword">elif</span> currentBoard<span class="token operator">==</span><span class="token string">"pyboard"</span><span class="token punctuation">:</span>      self<span class="token punctuation">.</span>spi<span class="token punctuation">.</span>send<span class="token punctuation">(</span>buf<span class="token punctuation">)</span>    self<span class="token punctuation">.</span>cs<span class="token punctuation">.</span>high<span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token keyword">def</span> <span class="token function">poweron</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>    self<span class="token punctuation">.</span>res<span class="token punctuation">.</span>high<span class="token punctuation">(</span><span class="token punctuation">)</span>    time<span class="token punctuation">.</span>sleep_ms<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>    self<span class="token punctuation">.</span>res<span class="token punctuation">.</span>low<span class="token punctuation">(</span><span class="token punctuation">)</span>    time<span class="token punctuation">.</span>sleep_ms<span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span>    self<span class="token punctuation">.</span>res<span class="token punctuation">.</span>high<span class="token punctuation">(</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="HC-SR04-py"><a href="#HC-SR04-py" class="headerlink" title="HC_SR04.py"></a>HC_SR04.py</h2><pre class="line-numbers language-py" data-language="py"><code class="language-py"><span class="token keyword">import</span> machine<span class="token punctuation">,</span> time<span class="token keyword">from</span> machine <span class="token keyword">import</span> Pin <span class="token keyword">class</span> <span class="token class-name">HCSR04</span><span class="token punctuation">:</span>    <span class="token triple-quoted-string string">"""    Driver to use the untrasonic sensor HC-SR04.    The sensor range is between 2cm and 4m.    The timeouts received listening to echo pin are converted to OSError('Out of range')    """</span>    <span class="token comment"># echo_timeout_us is based in chip range limit (400cm)</span>    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> trigger_pin<span class="token punctuation">,</span> echo_pin<span class="token punctuation">,</span> echo_timeout_us<span class="token operator">=</span><span class="token number">500</span><span class="token operator">*</span><span class="token number">2</span><span class="token operator">*</span><span class="token number">30</span><span class="token punctuation">)</span><span class="token punctuation">:</span>        <span class="token triple-quoted-string string">"""        trigger_pin: Output pin to send pulses        echo_pin: Readonly pin to measure the distance. The pin should be protected with 1k resistor        echo_timeout_us: Timeout in microseconds to listen to echo pin.         By default is based in sensor limit range (4m)        """</span>        self<span class="token punctuation">.</span>echo_timeout_us <span class="token operator">=</span> echo_timeout_us        <span class="token comment"># Init trigger pin (out)</span>        self<span class="token punctuation">.</span>trigger <span class="token operator">=</span> Pin<span class="token punctuation">(</span>trigger_pin<span class="token punctuation">,</span> mode<span class="token operator">=</span>Pin<span class="token punctuation">.</span>OUT<span class="token punctuation">,</span> pull<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">)</span>        self<span class="token punctuation">.</span>trigger<span class="token punctuation">.</span>value<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>         <span class="token comment"># Init echo pin (in)</span>        self<span class="token punctuation">.</span>echo <span class="token operator">=</span> Pin<span class="token punctuation">(</span>echo_pin<span class="token punctuation">,</span> mode<span class="token operator">=</span>Pin<span class="token punctuation">.</span>IN<span class="token punctuation">,</span> pull<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">)</span>     <span class="token keyword">def</span> <span class="token function">_send_pulse_and_wait</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>        <span class="token triple-quoted-string string">"""        Send the pulse to trigger and listen on echo pin.        We use the method `machine.time_pulse_us()` to get the microseconds until the echo is received.        """</span>        self<span class="token punctuation">.</span>trigger<span class="token punctuation">.</span>value<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span> <span class="token comment"># Stabilize the sensor</span>        time<span class="token punctuation">.</span>sleep_us<span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span>        self<span class="token punctuation">.</span>trigger<span class="token punctuation">.</span>value<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>        <span class="token comment"># Send a 10us pulse.</span>        time<span class="token punctuation">.</span>sleep_us<span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span>        self<span class="token punctuation">.</span>trigger<span class="token punctuation">.</span>value<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>        <span class="token keyword">try</span><span class="token punctuation">:</span>            pulse_time <span class="token operator">=</span> machine<span class="token punctuation">.</span>time_pulse_us<span class="token punctuation">(</span>self<span class="token punctuation">.</span>echo<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> self<span class="token punctuation">.</span>echo_timeout_us<span class="token punctuation">)</span>            <span class="token keyword">return</span> pulse_time        <span class="token keyword">except</span> OSError <span class="token keyword">as</span> ex<span class="token punctuation">:</span>            <span class="token keyword">if</span> ex<span class="token punctuation">.</span>args<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token number">110</span><span class="token punctuation">:</span> <span class="token comment"># 110 = ETIMEDOUT</span>                <span class="token keyword">raise</span> OSError<span class="token punctuation">(</span><span class="token string">'Out of range'</span><span class="token punctuation">)</span>            <span class="token keyword">raise</span> ex     <span class="token keyword">def</span> <span class="token function">distance_mm</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>        <span class="token triple-quoted-string string">"""        Get the distance in milimeters without floating point operations.        """</span>        pulse_time <span class="token operator">=</span> self<span class="token punctuation">.</span>_send_pulse_and_wait<span class="token punctuation">(</span><span class="token punctuation">)</span>         <span class="token comment"># To calculate the distance we get the pulse_time and divide it by 2 </span>        <span class="token comment"># (the pulse walk the distance twice) and by 29.1 becasue</span>        <span class="token comment"># the sound speed on air (343.2 m/s), that It's equivalent to</span>        <span class="token comment"># 0.34320 mm/us that is 1mm each 2.91us</span>        <span class="token comment"># pulse_time // 2 // 2.91 -> pulse_time // 5.82 -> pulse_time * 100 // 582 </span>        mm <span class="token operator">=</span> pulse_time <span class="token operator">*</span> <span class="token number">100</span> <span class="token operator">//</span> <span class="token number">582</span>        <span class="token keyword">return</span> mm     <span class="token keyword">def</span> <span class="token function">distance_cm</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>        <span class="token triple-quoted-string string">"""        Get the distance in centimeters with floating point operations.        It returns a float        """</span>        pulse_time <span class="token operator">=</span> self<span class="token punctuation">.</span>_send_pulse_and_wait<span class="token punctuation">(</span><span class="token punctuation">)</span>         <span class="token comment"># To calculate the distance we get the pulse_time and divide it by 2 </span>        <span class="token comment"># (the pulse walk the distance twice) and by 29.1 becasue</span>        <span class="token comment"># the sound speed on air (343.2 m/s), that It's equivalent to</span>        <span class="token comment"># 0.034320 cm/us that is 1cm each 29.1us</span>        cms <span class="token operator">=</span> <span class="token punctuation">(</span>pulse_time <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token number">29.1</span>        <span class="token keyword">return</span> cms<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="程式碼"><a href="#程式碼" class="headerlink" title="程式碼"></a>程式碼</h2><p><strong>main.py</strong></p><pre class="line-numbers language-py" data-language="py"><code class="language-py"><span class="token keyword">import</span> ssd1306 <span class="token comment">#匯入oled模組</span><span class="token keyword">from</span> machine <span class="token keyword">import</span> I2C<span class="token punctuation">,</span> Pin <span class="token comment">#匯入i2c相關模組和腳位模組</span><span class="token keyword">from</span> HC_SR04 <span class="token keyword">import</span> HCSR04i2c<span class="token operator">=</span>I2C<span class="token punctuation">(</span>scl<span class="token operator">=</span>Pin<span class="token punctuation">(</span><span class="token number">22</span><span class="token punctuation">)</span><span class="token punctuation">,</span> sda<span class="token operator">=</span>Pin<span class="token punctuation">(</span><span class="token number">21</span><span class="token punctuation">)</span><span class="token punctuation">,</span> freq<span class="token operator">=</span><span class="token number">5000</span><span class="token punctuation">)</span>oled<span class="token operator">=</span>ssd1306<span class="token punctuation">.</span>SSD1306_I2C<span class="token punctuation">(</span><span class="token number">128</span><span class="token punctuation">,</span> <span class="token number">64</span><span class="token punctuation">,</span> i2c<span class="token punctuation">)</span>sensor<span class="token operator">=</span>HCSR04<span class="token punctuation">(</span>trigger_pin<span class="token operator">=</span><span class="token number">32</span><span class="token punctuation">,</span> echo_pin<span class="token operator">=</span><span class="token number">33</span><span class="token punctuation">,</span>echo_timeout_us<span class="token operator">=</span><span class="token number">100000</span><span class="token punctuation">)</span>  <span class="token keyword">while</span> <span class="token boolean">True</span><span class="token punctuation">:</span>    dist<span class="token operator">=</span>sensor<span class="token punctuation">.</span>distance_cm<span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"The distance is &#123;:.1f&#125; cm"</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>dist<span class="token punctuation">)</span><span class="token punctuation">)</span>    oled<span class="token punctuation">.</span>fill<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>    oled<span class="token punctuation">.</span>text<span class="token punctuation">(</span><span class="token string">"Distance: "</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span>    oled<span class="token punctuation">.</span>text<span class="token punctuation">(</span><span class="token builtin">str</span><span class="token punctuation">(</span><span class="token builtin">round</span><span class="token punctuation">(</span>dist<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">30</span><span class="token punctuation">,</span> <span class="token number">30</span><span class="token punctuation">)</span>    oled<span class="token punctuation">.</span>text<span class="token punctuation">(</span><span class="token string">"cm"</span><span class="token punctuation">,</span> <span class="token number">80</span><span class="token punctuation">,</span> <span class="token number">30</span><span class="token punctuation">)</span>    oled<span class="token punctuation">.</span>show<span class="token punctuation">(</span><span class="token punctuation">)</span>  <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="解析"><a href="#解析" class="headerlink" title="解析"></a>解析</h2><p><strong>匯入OLED, I2C, HC_SR04模組</strong></p><pre class="line-numbers language-py" data-language="py"><code class="language-py"><span class="token keyword">import</span> ssd1306 <span class="token comment">#匯入oled模組</span><span class="token keyword">from</span> machine <span class="token keyword">import</span> I2C<span class="token punctuation">,</span> Pin <span class="token comment">#匯入i2c相關模組和腳位模組</span><span class="token keyword">from</span> HC_SR04 <span class="token keyword">import</span> HCSR04<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><strong>i2c通設定</strong></p><pre class="line-numbers language-py" data-language="py"><code class="language-py">i2c<span class="token operator">=</span>I2C<span class="token punctuation">(</span>scl<span class="token operator">=</span>Pin<span class="token punctuation">(</span><span class="token number">22</span><span class="token punctuation">)</span><span class="token punctuation">,</span> sda<span class="token operator">=</span>Pin<span class="token punctuation">(</span><span class="token number">21</span><span class="token punctuation">)</span><span class="token punctuation">,</span> freq<span class="token operator">=</span><span class="token number">5000</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p><strong>OLED顯示</strong></p><pre class="line-numbers language-py" data-language="py"><code class="language-py">oled<span class="token operator">=</span>ssd1306<span class="token punctuation">.</span>SSD1306_I2C<span class="token punctuation">(</span><span class="token number">128</span><span class="token punctuation">,</span> <span class="token number">64</span><span class="token punctuation">,</span> i2c<span class="token punctuation">)</span>oled<span class="token punctuation">.</span>fill<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>oled<span class="token punctuation">.</span>text<span class="token punctuation">(</span><span class="token string">"Distance: "</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span>oled<span class="token punctuation">.</span>text<span class="token punctuation">(</span><span class="token builtin">str</span><span class="token punctuation">(</span><span class="token builtin">round</span><span class="token punctuation">(</span>dist<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">30</span><span class="token punctuation">,</span> <span class="token number">30</span><span class="token punctuation">)</span>oled<span class="token punctuation">.</span>text<span class="token punctuation">(</span><span class="token string">"cm"</span><span class="token punctuation">,</span> <span class="token number">80</span><span class="token punctuation">,</span> <span class="token number">30</span><span class="token punctuation">)</span>oled<span class="token punctuation">.</span>show<span class="token punctuation">(</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><strong>超音波測距</strong></p><p><strong>使用while True: 形成迴圈</strong></p><pre class="line-numbers language-py" data-language="py"><code class="language-py">sensor<span class="token operator">=</span>HCSR04<span class="token punctuation">(</span>trigger_pin<span class="token operator">=</span><span class="token number">32</span><span class="token punctuation">,</span> echo_pin<span class="token operator">=</span><span class="token number">33</span><span class="token punctuation">,</span>echo_timeout_us<span class="token operator">=</span><span class="token number">100000</span><span class="token punctuation">)</span>dist<span class="token operator">=</span>sensor<span class="token punctuation">.</span>distance_cm<span class="token punctuation">(</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><hr><div class="video-container"><iframe src="https://www.youtube.com/embed/IkzFiOHADV0" frameborder="0" loading="lazy" allowfullscreen></iframe></div>]]></content>
      
      
      <categories>
          
          <category> micropython </category>
          
          <category> esp32 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> hc-sr04 </tag>
            
            <tag> 超音波模組 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>超音波測距(HC-SR04)&amp;網頁顯示(wifi_server)</title>
      <link href="/2021/08/29/chao-yin-bo-ce-ju-hc-sr04-wang-ye-xian-shi-wifi-server/"/>
      <url>/2021/08/29/chao-yin-bo-ce-ju-hc-sr04-wang-ye-xian-shi-wifi-server/</url>
      
        <content type="html"><![CDATA[<h1 id="超音波測距-HC-SR04-amp-網頁顯示-wifi-server"><a href="#超音波測距-HC-SR04-amp-網頁顯示-wifi-server" class="headerlink" title="超音波測距(HC-SR04)&amp;網頁顯示(wifi_server)"></a>超音波測距(HC-SR04)&amp;網頁顯示(wifi_server)</h1><h6 id="tags-micropython-HC-SR04-amp-wifi"><a href="#tags-micropython-HC-SR04-amp-wifi" class="headerlink" title="tags: micropython HC-SR04&amp;wifi"></a>tags: <code>micropython</code> <code>HC-SR04&amp;wifi</code></h6><p> <strong>超音波測距參考-</strong><a href="https://draft.blogger.com/blog/post/edit/3809681606094011522/7733761810113940833?hl=zh-TW#">https://esp32-blairan.blogspot.com/2021/07/blog-post.html</a></p><h2 id="接線"><a href="#接線" class="headerlink" title="接線"></a>接線</h2><p><a href="https://draft.blogger.com/blog/post/edit/3809681606094011522/7733761810113940833?hl=zh-TW#"><img src="https://lemariva.com/storage/temp/public/295/644/a2e/esp32_bb__750.png"></a></p><h2 id="程式碼"><a href="#程式碼" class="headerlink" title="程式碼"></a>程式碼</h2><pre class="line-numbers language-c#" data-language="c#"><code class="language-c#">#include &lt;Arduino.h&gt;#include &lt;WiFi.h&gt;#include &lt;ESPAsyncWebServer.h&gt;#include &lt;Ultrasonic.h&gt;  &#x2F;&#x2F; ---------------------     ---------------------     -------------------&#x2F;&#x2F;  * | HC-SC04 | Arduino |     | PING))) | Arduino |     | Seeed | Arduino |&#x2F;&#x2F;  * ---------------------     ---------------------     -------------------&#x2F;&#x2F;  * |   Vcc   |   5V    |     |   Vcc   |   5V    |     |  Vcc  |   5V    |&#x2F;&#x2F;  * |   Trig  |   12    | AND |   SIG   |   10    | AND |  SIG  |    8    |&#x2F;&#x2F;  * |   Echo  |   13    |     |   Gnd   |   GND   |     |  Gnd  |   GND   |&#x2F;&#x2F;  * |   Gnd   |   GND   |     ---------------------     -------------------&#x2F;&#x2F;  * ---------------------  const char* ssid&#x3D;&quot;基地台名稱&quot;;const char* password&#x3D;&quot;基地台密碼&quot;;AsyncWebServer server(80);Ultrasonic ultrasonic1(32, 33); &#x2F;&#x2F;ultrasonic(trig, echo)  const char indexHtml\[\] PROGMEM &#x3D; R&quot;&#x3D;&#x3D;&#x3D;(    &lt;html&gt;&lt;head&gt;    &lt;meta charset&#x3D;&quot;utf-8&quot; &#x2F;&gt;    &lt;meta http-equiv&#x3D;&quot;refresh&quot; content&#x3D;&quot;0.5&quot; &#x2F;&gt;    &lt;meta name&#x3D;&quot;viewport&quot; content&#x3D;&quot;width&#x3D;device-width, initial-scale&#x3D;1.0&quot; &#x2F;&gt;    &lt;style&gt;        h1 &#123;text-align: center; background-color: rgb(226, 155, 23); color: rgb(47, 49, 42); margin-right: 5px;&#125;        dl &#123;width: 320px; margin: auto;&#125;        dt &#123;font-size: 20pt; color: rgb(36, 45, 168); background-color: rgb(197, 194, 11);            margin: 6pt 0; padding: 6pt 12pt;&#125;        dd &#123;text-align: left; padding-right: 6pt;&#125;        .val &#123; font-size: 30pt; color: rgb(255, 120, 30); &#125;    &lt;&#x2F;style&gt;&lt;&#x2F;head&gt;&lt;body&gt;    &lt;p&gt;&lt;h1&gt;HC-SR04超音波測距實驗&lt;&#x2F;h1&gt;&lt;&#x2F;p&gt;    &lt;dl&gt;        &lt;dt&gt;偵測物體距離&lt;&#x2F;dt&gt;        &lt;dd class&#x3D;val&gt;%distance% 公分&lt;&#x2F;dd&gt;    &lt;&#x2F;dl&gt;&lt;&#x2F;body&gt;&lt;&#x2F;html&gt;)&#x3D;&#x3D;&#x3D;&quot;;  String readDist()&#123;    unsigned int distance&#x3D;ultrasonic1.read(CM);    Serial.print(distance); Serial.println(&quot; CM&quot;);    return String(distance);&#125;String hcsr04Processors(String(value))&#123;    if (value&#x3D;&#x3D;&quot;distance&quot;)&#123;        return readDist();    &#125;&#125;  void setup()&#123;    Serial.begin(115200);    WiFi.begin(ssid, password);    while (WiFi.status() !&#x3D; WL_CONNECTED)&#123;        Serial.print(&quot;.&quot;);        delay(500);    &#125;    Serial.println(&quot;Connected successful!&quot;);    Serial.print(&quot;IP: &quot;); Serial.println(WiFi.localIP());    server.on(&quot;&#x2F;&quot;, HTTP_GET, \[\](AsyncWebServerRequest *request)&#123;        request-&gt;send_P(200, &quot;text&#x2F;html&quot;, indexHtml, hcsr04Processors);    &#125;);    server.on(&quot;&#x2F;distance&quot;, HTTP_GET, \[\](AsyncWebServerRequest *request)&#123;        request-&gt;send_P(200, &quot;text&#x2F;plain&quot;, readDist().c_str());    &#125;);    server.begin();&#125;  void loop()&#123;&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="解說"><a href="#解說" class="headerlink" title="解說"></a>解說</h2><p><em><strong>匯入WiFi和超音波及網路伺服器模組</strong></em></p><pre class="line-numbers language-none"><code class="language-none">#include &lt;WiFi.h&gt;#include &lt;ESPAsyncWebServer.h&gt;#include &lt;Ultrasonic.h&gt;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><strong><em>定義基地台名稱和密碼,並指定端口號80埠</em></strong></p><pre class="line-numbers language-c#" data-language="c#"><code class="language-c#">const char* ssid &#x3D; &quot;基地台名稱&quot;;const char* password &#x3D; &quot;基地台密碼&quot;;AsyncWebServer server(80);<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><strong><em>這個模組是呼吸超音波用的</em></strong></p><pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;Ultrasonic.h></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p><strong><em>設制超音波腳位</em></strong></p><pre class="line-numbers language-c#" data-language="c#"><code class="language-c#">Ultrasonic ultrasonic1(32, 33); &#x2F;&#x2F;ultrasonic(trig, echo)<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p><strong><em>前端網頁</em></strong></p><p>這一行是每隔0.5秒自動更新一次網頁 <meta http-equiv="refresh" content="0.5" /></p><pre class="line-numbers language-c#" data-language="c#"><code class="language-c#">const char indexHtml[] PROGMEM &#x3D; R&quot;&#x3D;&#x3D;&#x3D;(    &lt;html&gt;&lt;head&gt;    &lt;meta charset&#x3D;&quot;utf-8&quot; &#x2F;&gt;    &lt;meta http-equiv&#x3D;&quot;refresh&quot; content&#x3D;&quot;0.5&quot; &#x2F;&gt;    &lt;meta name&#x3D;&quot;viewport&quot; content&#x3D;&quot;width&#x3D;device-width, initial-scale&#x3D;1.0&quot; &#x2F;&gt;    &lt;style&gt;        h1 &#123;text-align: center; background-color: rgb(226, 155, 23); color: rgb(47, 49, 42); margin-right: 5px;&#125;        dl &#123;width: 320px; margin: auto;&#125;        dt &#123;font-size: 20pt; color: rgb(36, 45, 168); background-color: rgb(197, 194, 11);            margin: 6pt 0; padding: 6pt 12pt;&#125;        dd &#123;text-align: left; padding-right: 6pt;&#125;        .val &#123; font-size: 30pt; color: rgb(255, 120, 30); &#125;    &lt;&#x2F;style&gt;&lt;&#x2F;head&gt;&lt;body&gt;    &lt;p&gt;&lt;h1&gt;HC-SR04超音波測距實驗&lt;&#x2F;h1&gt;&lt;&#x2F;p&gt;    &lt;dl&gt;        &lt;dt&gt;偵測物體距離&lt;&#x2F;dt&gt;        &lt;dd class&#x3D;val&gt;%distance% 公分&lt;&#x2F;dd&gt;    &lt;&#x2F;dl&gt;&lt;&#x2F;body&gt;&lt;&#x2F;html&gt;)&#x3D;&#x3D;&#x3D;&quot;;  _**讀取數值和前端同步數值的函式**_String readDist()&#123; unsigned int distance&#x3D;ultrasonic1.read(CM); Serial.print(distance); Serial.println(&quot; CM&quot;); return String(distance);&#125;String hcsr04Processors(String(value))&#123; if (value&#x3D;&#x3D;&quot;distance&quot;)&#123; return readDist();    &#125;&#125;  <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><strong><em>網路連線</em></strong></p><pre class="line-numbers language-c#" data-language="c#"><code class="language-c#">void setup()&#123;    Serial.begin(115200);    WiFi.begin(ssid, password);    while (WiFi.status() !&#x3D; WL_CONNECTED)&#123;        Serial.print(&quot;.&quot;);        delay(500);    &#125;    Serial.println(&quot;Connected successful!&quot;);    Serial.print(&quot;IP: &quot;); Serial.println(WiFi.localIP());<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>網路伺服器的請求和回應</p><pre class="line-numbers language-c#" data-language="c#"><code class="language-c#"> server.on(&quot;&#x2F;&quot;, HTTP_GET, [](AsyncWebServerRequest *request)&#123;        request-&gt;send_P(200, &quot;text&#x2F;html&quot;, indexHtml, hcsr04Processors);    &#125;);    server.on(&quot;&#x2F;distance&quot;, HTTP_GET, [](AsyncWebServerRequest *request)&#123;        request-&gt;send_P(200, &quot;text&#x2F;plain&quot;, readDist().c_str());    &#125;);    server.begin();&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><div class="video-container"><iframe src="https://www.youtube.com/embed/ammBs4Z-DTs" frameborder="0" loading="lazy" allowfullscreen></iframe></div>]]></content>
      
      
      <categories>
          
          <category> esp32 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> hc-sr04 </tag>
            
            <tag> web server </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>0.96OLED實作-micropython</title>
      <link href="/2021/08/29/0-96oled-shi-zuo-micropython/"/>
      <url>/2021/08/29/0-96oled-shi-zuo-micropython/</url>
      
        <content type="html"><![CDATA[<h1 id="0-96OLED實作-micropython"><a href="#0-96OLED實作-micropython" class="headerlink" title="0.96OLED實作-micropython"></a>0.96OLED實作-micropython</h1><h6 id="tags-micropython-0-96oled"><a href="#tags-micropython-0-96oled" class="headerlink" title="tags: micropython 0.96oled"></a>tags: <code>micropython</code> <code>0.96oled</code></h6><h2 id="ssd1306模組"><a href="#ssd1306模組" class="headerlink" title="ssd1306模組"></a>ssd1306模組</h2><p><strong>先將<a href="https://draft.blogger.com/blog/post/edit/6280040346040914276/2255135354625309493?hl=zh-TW#">ssd1306.py</a>檔和main.py放在一起才能呼叫到ssd1306模組</strong></p><h2 id="接線"><a href="#接線" class="headerlink" title="接線"></a>接線</h2><p><strong>21  SCL</strong></p><p><strong>22  SDA</strong></p><p><a href="https://draft.blogger.com/blog/post/edit/6280040346040914276/2255135354625309493?hl=zh-TW#"><img src="https://i2.wp.com/randomnerdtutorials.com/wp-content/uploads/2019/05/ESP32_OLED.png?w=873&quality=100&strip=all&ssl=1"></a></p><h2 id="程式碼"><a href="#程式碼" class="headerlink" title="程式碼"></a>程式碼</h2><pre class="line-numbers language-py" data-language="py"><code class="language-py">import ssd1306 #匯入oled模組from machine import Pin, SoftI2C #匯入i2c相關模組和腳位模組  i2c&#x3D;SoftI2C(scl&#x3D;Pin(22), sda&#x3D;Pin(21)) #設定i2c腳位width&#x3D;128 #oled高height&#x3D;64 #oled寛oled&#x3D;ssd1306.SSD1306_I2C(width, height, i2c) #賦予變數給設制好的ssd1306模組,並給予所須參數  #oled.text(&quot;文字&quot;, x, y, col&#x3D;0&#x2F;1)#x是縱軸位置#y是橫軸位置#col&#x3D;是顏色,0-BLACK,1-WHITEoled.text(&quot;Hello world!&quot;, 0, 0, col&#x3D;1)oled.text(&quot;ESP32 NICE!&quot;, 0, 10, col&#x3D;1)oled.text(&quot;i am CTK&quot;, 0, 30, col&#x3D;1)#oled.invert(True) #背景全顯oled.show() #顯示於oled上<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><a href="https://draft.blogger.com/blog/post/edit/6280040346040914276/2255135354625309493?hl=zh-TW#"><img src="https://lh3.googleusercontent.com/-k9n260VQuDA/YOexfePzh5I/AAAAAAAAeag/Fu7ZGxbHb9s63zR5_q-D06nDEPyzIWOHgCNcBGAsYHQ/s1600/1625796956591112-0.png"></a></p>]]></content>
      
      
      <categories>
          
          <category> micropython </category>
          
          <category> esp32 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> oled </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>DHT11/DHT12溫溼度傳感器實驗-micropython</title>
      <link href="/2021/08/29/dht11-dht12-wen-shi-du-chuan-gan-qi-shi-yan-micropython/"/>
      <url>/2021/08/29/dht11-dht12-wen-shi-du-chuan-gan-qi-shi-yan-micropython/</url>
      
        <content type="html"><![CDATA[<h1 id="DHT11-DHT12溫溼度傳感器實驗-micropython"><a href="#DHT11-DHT12溫溼度傳感器實驗-micropython" class="headerlink" title="DHT11/DHT12溫溼度傳感器實驗-micropython"></a>DHT11/DHT12溫溼度傳感器實驗-micropython</h1><h6 id="tags-micropython-dht11-dht12"><a href="#tags-micropython-dht11-dht12" class="headerlink" title="tags: micropython dht11/dht12"></a>tags: <code>micropython</code> <code>dht11/dht12</code></h6><p><strong>基本介紹和實驗參考-</strong><a href="https://draft.blogger.com/blog/post/edit/6280040346040914276/2565290853340818706?hl=zh-TW#">https://esp32-blairan.blogspot.com/2021/07/dht11dht12-esp32.html</a></p><hr><p><a href="https://draft.blogger.com/blog/post/edit/6280040346040914276/2565290853340818706?hl=zh-TW#"><img src="http://2.bp.blogspot.com/-3syBdItbhrI/Vb6X8sJx7tI/AAAAAAAAEO8/cMmlSOV142M/s320/dht11.jpg"></a></p><pre class="line-numbers language-py" data-language="py"><code class="language-py"><span class="token keyword">import</span> dht<span class="token keyword">from</span> machine <span class="token keyword">import</span> Pin<span class="token keyword">from</span> time <span class="token keyword">import</span> sleep<span class="token keyword">def</span> measureTemp<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    sensor<span class="token operator">=</span>dht<span class="token punctuation">.</span>DHT11<span class="token punctuation">(</span>Pin<span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">)</span>    <span class="token keyword">while</span> <span class="token boolean">True</span><span class="token punctuation">:</span>        <span class="token keyword">try</span><span class="token punctuation">:</span>            sleep<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span>            sensor<span class="token punctuation">.</span>measure<span class="token punctuation">(</span><span class="token punctuation">)</span>            t<span class="token operator">=</span>sensor<span class="token punctuation">.</span>temperature<span class="token punctuation">(</span><span class="token punctuation">)</span>            t_f<span class="token operator">=</span>t<span class="token operator">*</span><span class="token punctuation">(</span><span class="token number">9</span><span class="token operator">/</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token number">32</span>            h<span class="token operator">=</span>sensor<span class="token punctuation">.</span>humidity<span class="token punctuation">(</span><span class="token punctuation">)</span>            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"Temp: &#123;:.1f&#125;.C"</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>t<span class="token punctuation">)</span><span class="token punctuation">)</span>            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"Temp: &#123;:.1f&#125;.F"</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>t_f<span class="token punctuation">)</span><span class="token punctuation">)</span>            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"Humidity: &#123;:.1f&#125;"</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>h<span class="token punctuation">)</span><span class="token punctuation">)</span>        <span class="token keyword">except</span> OSError <span class="token keyword">as</span> o<span class="token punctuation">:</span>            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"Failed to read sensor."</span><span class="token punctuation">)</span><span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">'__main__'</span><span class="token punctuation">:</span>    measureTemp<span class="token punctuation">(</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><strong>載入dht庫(內建)</strong></p><pre class="line-numbers language-py" data-language="py"><code class="language-py"><span class="token keyword">import</span> dht<span class="token keyword">from</span> machine <span class="token keyword">import</span> Pin<span class="token keyword">from</span> time <span class="token keyword">import</span> sleep<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><strong>指定DHT11腳位給sensor變數</strong></p><pre class="line-numbers language-py" data-language="py"><code class="language-py">sensor<span class="token operator">=</span>dht<span class="token punctuation">.</span>DHT11<span class="token punctuation">(</span>Pin<span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p><strong>給予while()每2秒不斷偵測</strong></p><pre class="line-numbers language-py" data-language="py"><code class="language-py">sleep<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span>sensor<span class="token punctuation">.</span>measure<span class="token punctuation">(</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p><strong>攝氏溫度(t)/華氏溫度(t_f)/濕度</strong></p><p><strong>其中攝氏轉換華氏的公式:攝氏x(9/5)+32</strong></p><pre class="line-numbers language-py" data-language="py"><code class="language-py">t<span class="token operator">=</span>sensor<span class="token punctuation">.</span>temperature<span class="token punctuation">(</span><span class="token punctuation">)</span>t_f<span class="token operator">=</span>t<span class="token operator">*</span><span class="token punctuation">(</span><span class="token number">9</span><span class="token operator">/</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token number">32</span>h<span class="token operator">=</span>sensor<span class="token punctuation">.</span>humidity<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"Temp: &#123;:.1f&#125;.C"</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>t<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"Temp: &#123;:.1f&#125;.F"</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>t_f<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"Humidity: &#123;:.1f&#125;"</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>h<span class="token punctuation">)</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="結果"><a href="#結果" class="headerlink" title="結果"></a>結果</h2><pre class="line-numbers language-none"><code class="language-none">&#x3D;&#x3D;&#x3D; Temp: 26.0.CTemp: 78.8.FHumidity: 27.0Temp: 26.0.CTemp: 78.8.FHumidity: 27.0Temp: 26.0.CTemp: 78.8.FHumidity: 27.0<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>]]></content>
      
      
      <categories>
          
          <category> micropython </category>
          
          <category> esp32 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> dht11/dht12 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>PWM-呼吸燈-mpython</title>
      <link href="/2021/08/29/pwm-hu-xi-deng-mpython/"/>
      <url>/2021/08/29/pwm-hu-xi-deng-mpython/</url>
      
        <content type="html"><![CDATA[<h1 id="PWM-呼吸燈-mpython"><a href="#PWM-呼吸燈-mpython" class="headerlink" title="PWM-呼吸燈-mpython"></a>PWM-呼吸燈-mpython</h1><h6 id="tags-micropython"><a href="#tags-micropython" class="headerlink" title="tags: micropython"></a>tags: <code>micropython</code></h6><h2 id="所需零件"><a href="#所需零件" class="headerlink" title="所需零件"></a>所需零件</h2><ul><li>  ESP32</li><li>  5mm LED</li><li>  330 歐姆電阻</li><li>  麵包板</li><li>  跳線</li></ul><p><a href="https://draft.blogger.com/blog/post/edit/6280040346040914276/7086602446312056740?hl=zh-TW#"><img src="https://i1.wp.com/randomnerdtutorials.com/wp-content/uploads/2019/04/PWM_esp32_bb.png?w=1065&quality=100&strip=all&ssl=1"></a></p><h2 id="程式碼"><a href="#程式碼" class="headerlink" title="程式碼"></a>程式碼</h2><p><strong><em>參照–我的</em></strong><a href="https://draft.blogger.com/blog/post/edit/6280040346040914276/7086602446312056740?hl=zh-TW#">micropython函式筆記本</a></p><pre class="line-numbers language-py" data-language="py"><code class="language-py"><span class="token keyword">from</span> machine <span class="token keyword">import</span> Pin<span class="token punctuation">,</span> PWM<span class="token keyword">from</span> time <span class="token keyword">import</span> sleepled <span class="token operator">=</span> PWM<span class="token punctuation">(</span>Pin<span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">,</span> freq<span class="token operator">=</span><span class="token number">5000</span><span class="token punctuation">)</span><span class="token keyword">while</span> <span class="token boolean">True</span><span class="token punctuation">:</span>    <span class="token keyword">for</span> duty_cycle1 <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">:</span>        led<span class="token punctuation">.</span>duty<span class="token punctuation">(</span>duty_cycle1<span class="token punctuation">)</span>        sleep<span class="token punctuation">(</span><span class="token number">0.05</span><span class="token punctuation">)</span>    <span class="token keyword">for</span> duty_cycle2 <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">1000</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">:</span>        led<span class="token punctuation">.</span>duty<span class="token punctuation">(</span>duty_cycle2<span class="token punctuation">)</span>        sleep<span class="token punctuation">(</span><span class="token number">0.05</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><div class="video-container"><iframe src="https://www.youtube.com/embed/Hw_L3j1hgvQ" frameborder="0" loading="lazy" allowfullscreen></iframe></div>]]></content>
      
      
      <categories>
          
          <category> micropython </category>
          
          <category> esp32 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 呼吸燈 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ESP32-Cam視訊小車</title>
      <link href="/2021/08/29/esp32-cam-shi-xun-xiao-che/"/>
      <url>/2021/08/29/esp32-cam-shi-xun-xiao-che/</url>
      
        <content type="html"><![CDATA[<h1 id="ESP32-Cam視訊小車"><a href="#ESP32-Cam視訊小車" class="headerlink" title="ESP32-Cam視訊小車"></a>ESP32-Cam視訊小車</h1><h6 id="tags-esp32-cam"><a href="#tags-esp32-cam" class="headerlink" title="tags: esp32-cam"></a>tags: <code>esp32-cam</code></h6><p><strong>想不到現在有了ESP32-Cam真是方便，組裝車身上整個植入</strong></p><p><strong>範例程式，大概１小時不等就全部完成。</strong></p><p><strong>我是參照一位國外的大大的製作</strong>-<a href="https://draft.blogger.com/blog/post/edit/3809681606094011522/8416915322345407552#">https://youtu.be/Wfpvj9KlEMs</a></p><hr><h2 id="材料"><a href="#材料" class="headerlink" title="材料"></a>材料</h2><ol><li> <strong>馬達x1</strong></li><li> <strong>L298N x1</strong></li><li> <strong>底盤或車身 x1</strong></li><li> <strong>ESP32-Cam x1</strong></li><li> <strong>18650串接電池盒 x1</strong></li><li> <strong>18650電池 x2</strong></li><li> <strong>杜邦線</strong></li></ol><h2 id="程式碼"><a href="#程式碼" class="headerlink" title="程式碼"></a>程式碼</h2><ul><li>  先到此頁面最底下，下載小車範例-<a href="https://draft.blogger.com/blog/post/edit/3809681606094011522/8416915322345407552#">https://www.viralsciencecreativity.com/post/esp32-cam-surveillance-spy-camera-car</a></li><li>  下載完後解壓縮，將整個資料夾放入Arduino裡的library資料夾裡.，然後從範例裡找到小車範例。</li><li>  更改自己的WIFI名稱和密碼，選取上傳(如果不會上傳ESP32CAM可以看一下這一篇-[<a href="https://esp32-blairan.blogspot.com/2021/04/esp32-cam.htm]">https://esp32-blairan.blogspot.com/2021/04/esp32-cam.htm]</a></li></ul><p><a href="https://draft.blogger.com/blog/post/edit/3809681606094011522/8416915322345407552?hl=zh-TW#"><img src="https://lh3.googleusercontent.com/-Di2phCbK_C4/YMK_QwaxbuI/AAAAAAAAeRU/c0k5do3OCBckqzA0ZeNfxX8095dSnHITQCNcBGAsYHQ/s1600/1623375629694103-0.png"></a></p><p><a href="https://draft.blogger.com/blog/post/edit/3809681606094011522/8416915322345407552?hl=zh-TW#"><img src="https://lh3.googleusercontent.com/-FB_Pb4_d9rg/YMK-fcW9RSI/AAAAAAAAeRA/C2psKg3sXnQ1MDd-YGw7C00cUNlfVb-FgCNcBGAsYHQ/s1600/1623375426928438-1.png"></a></p><p><a href="https://draft.blogger.com/blog/post/edit/3809681606094011522/8416915322345407552?hl=zh-TW#"><img src="https://lh3.googleusercontent.com/-A5IFpKhPTDA/YMK-QOJbRzI/AAAAAAAAeQ8/fXRsejo6DY4AItogU3cn1qZknIe-zw5KACNcBGAsYHQ/s1600/1623375369965993-2.png"></a></p><h2 id="接線"><a href="#接線" class="headerlink" title="接線"></a>接線</h2><ul><li>  接著就可以開始組裝車身並把腳位對應L298N插上。</li></ul><p><img src="https://static.wixstatic.com/media/c901e7_50da7f5d492a4096b8d8ec78a96e5978~mv2.png/v1/fill/w_740,h_581,al_c,q_90/c901e7_50da7f5d492a4096b8d8ec78a96e5978~mv2.webp"></p><hr><div class="video-container"><iframe src="https://www.youtube.com/embed/QT0z2qLUymk" frameborder="0" loading="lazy" allowfullscreen></iframe></div>]]></content>
      
      
      <categories>
          
          <category> esp32 cam </category>
          
      </categories>
      
      
        <tags>
            
            <tag> esp32 cam訊視小車 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ESP32-cam實作</title>
      <link href="/2021/08/29/esp32-cam-shi-zuo/"/>
      <url>/2021/08/29/esp32-cam-shi-zuo/</url>
      
        <content type="html"><![CDATA[<h1 id="ESP32-cam實作"><a href="#ESP32-cam實作" class="headerlink" title="ESP32-cam實作"></a>ESP32-cam實作</h1><h6 id="tags-esp32-cam"><a href="#tags-esp32-cam" class="headerlink" title="tags: esp32-cam"></a>tags: <code>esp32-cam</code></h6><hr><p>-<strong>在臉書社團很多大大分享ESP32系列的板子，感覺小而美小而省</strong></p><p><strong>能做的事也很多，所以就集體採構了２片esp32和esp32-cam，因為</strong></p><p><strong>早先我有入手配製好的esp32的集成板，但和通用的不一樣，好像</strong></p><p><strong>是那家公司基於esp32再創研的，但我個人是不太喜歡用市面上不</strong></p><p><strong>相同規格的板子，所以才又買了esp32通用板。</strong></p><p><strong>那先從esp32-cam試起，聽說前輩們踩坑，所以利用貨還沒到先爬文</strong></p><p><strong>，好不容易過了十五天終於到貨，正式開始實作了。</strong></p><hr><p><a href="https://draft.blogger.com/blog/post/edit/3809681606094011522/2908832685289288450#"><img src="https://1.bp.blogspot.com/-IG2vOkjYr_g/YGmJWUMFS4I/AAAAAAAAeAg/CsYgGDLlUlYE242dPXOWPTAYuJFNwRJ0QCNcBGAsYHQ/w306-h350/20210404_155013.jpg"></a><br><img src="https://i.imgur.com/I8NXL4y.png"></p><hr><h2 id="接線方式"><a href="#接線方式" class="headerlink" title="接線方式"></a>接線方式</h2><hr><h4 id="燒錄須要有USB-TTL的轉接頭"><a href="#燒錄須要有USB-TTL的轉接頭" class="headerlink" title="燒錄須要有USB TTL的轉接頭"></a>燒錄須要有USB TTL的轉接頭</h4><p><img src="https://i.imgur.com/j32bpm3.png"><br><strong>但因為我手上之前有買過類似的轉接線，所以就沒有再買轉接頭</strong></p><p><strong>唯一的缺點就是我手上這條USB-TTL轉接驅動程式已經絕版，但</strong></p><p><strong>在網上找還是可找的到，一開始插入USB是無法辨識。</strong></p><p><a href="https://draft.blogger.com/blog/post/edit/3809681606094011522/2908832685289288450#"><img src="https://1.bp.blogspot.com/-0CIJEIGrJIA/YGmOKrk2qpI/AAAAAAAAeA8/kDpzDpUbCSIo4wFcW6-gDzHLofZfBtWvQCNcBGAsYHQ/w273-h273/images.jpg"></a></p><p><a href="https://draft.blogger.com/blog/post/edit/3809681606094011522/2908832685289288450#"><img src="https://1.bp.blogspot.com/-ORlRmW1ZHXc/YGmOebWesvI/AAAAAAAAeBE/wqp-XeSUeewGT8uGeW_6mdVms0DHmuqawCNcBGAsYHQ/w447-h344/1562393756-3686635058.png"></a></p><hr><p><strong>按照上圖接線後，到＂裝置管理員＂，如果是第一次安裝ＵＳＢ驅動</strong></p><p><strong>會如下顯示＂USB-serial control＂有個三角驚嘆號!</strong></p><p><a href="https://draft.blogger.com/blog/post/edit/3809681606094011522/2908832685289288450#"><img src="https://1.bp.blogspot.com/-MRS_-cK3nYg/YGmP7oNK2nI/AAAAAAAAeBM/-DDNKU9Gt8M0fB-r7YZMoOoNqZxKGF1BQCNcBGAsYHQ/w443-h249/1.jpg"></a></p><p><strong>下載<a href="https://draft.blogger.com/blog/post/edit/3809681606094011522/2908832685289288450#">PL2303_64bit_Installer</a>，進入網址後點選下圖紅框處下載驅動</strong></p><p><a href="https://draft.blogger.com/blog/post/edit/3809681606094011522/2908832685289288450#"><img src="https://1.bp.blogspot.com/-7GnCQo9ZUJg/YGmRF_ueoxI/AAAAAAAAeBU/y292EXqa5MIevfUHVO8T-3FWYCmKyjdewCNcBGAsYHQ/w427-h240/1.jpg"></a></p><p><strong>解壓後安裝軟體</strong></p><p><a href="https://draft.blogger.com/blog/post/edit/3809681606094011522/2908832685289288450#"><img src="https://1.bp.blogspot.com/-8Gl2Tfo2FcQ/YGmRdkQoW0I/AAAAAAAAeBc/y99qiFEWepsza-tYxkol_aVOHBHeSPjxACNcBGAsYHQ/w490-h276/1.jpg"></a></p><p><a href="https://draft.blogger.com/blog/post/edit/3809681606094011522/2908832685289288450#"><img src="https://1.bp.blogspot.com/-T2G-LewhLQ0/YGmRrAQjMDI/AAAAAAAAeBg/gp1kamt2GWMdi8tB9gCOaGUypwRHZVWhQCNcBGAsYHQ/w426-h240/1.jpg"></a></p><p><strong>按下”finsh＂會自動重啓電腦</strong></p><p><a href="https://draft.blogger.com/blog/post/edit/3809681606094011522/2908832685289288450#"><img src="https://1.bp.blogspot.com/-Sf28JI3q4uc/YGmR92n-UDI/AAAAAAAAeBs/p99mswf_9i8ymjplFYWtHTf03L677Yl4QCNcBGAsYHQ/w424-h239/1.jpg"></a></p><p><strong>重開機後，再到”裝置管理員＂， 以我的筆電是com7就出現了</strong></p><p><a href="https://draft.blogger.com/blog/post/edit/3809681606094011522/2908832685289288450#"><img src="https://1.bp.blogspot.com/-4zSMNpvu-jI/YGmUTdUf1rI/AAAAAAAAeB0/wzwo-lTSoI87nEsncW0dmdL0nqUNxa46ACNcBGAsYHQ/w452-h254/1.jpg"></a></p><hr><h2 id="接下來到Arduino-IDE"><a href="#接下來到Arduino-IDE" class="headerlink" title="接下來到Arduino IDE"></a>接下來到Arduino IDE</h2><p><strong>因為IDE裡沒有ESP32的庫 ，所以要先擴增</strong></p><p><strong>到＂檔案-&gt;偏好設定＂裡，＂額外的開發板管理員網址＂貼上以下網址</strong></p><p><strong><a href="https://dl.espressif.com/dl/package/_esp32/_index.json%EF%BC%8C%E4%B8%A6%E6%8C%89%E7%A2%BA%E5%AE%9A">https://dl.espressif.com/dl/package\_esp32\_index.json，並按確定</a></strong></p><p><a href="https://draft.blogger.com/blog/post/edit/3809681606094011522/2908832685289288450#"><img src="https://1.bp.blogspot.com/-Z0BIUuFp-Sk/YGmVoELnJyI/AAAAAAAAeB8/ni-B6jxLZbAG3r4OvSIiqWTiLrWoF3TngCNcBGAsYHQ/w460-h259/1.jpg"></a></p><p><strong>然後到＂工具＂—＞＂開發板管理員＂搜尋”esp32＂，會出現對應的</strong></p><p><strong>庫，選擇＂安裝＂。</strong></p><p><a href="https://draft.blogger.com/blog/post/edit/3809681606094011522/2908832685289288450#"><img src="https://1.bp.blogspot.com/-F0WNedLy2Uk/YGmZZ7xPzfI/AAAAAAAAeCE/FqUlSPxlqVkcoAA6Gx6epLibKKJsT1XbQCNcBGAsYHQ/w434-h244/2.jpg"></a></p><p><strong>安裝好後一樣在＂工具＂底下，選擇＂ESP32 Arduino＂-&gt;”ESP32 Wrrover Module”</strong></p><p><strong>並選擇對應的序列埠(com)</strong></p><p><a href="https://draft.blogger.com/blog/post/edit/3809681606094011522/2908832685289288450#"><img src="https://1.bp.blogspot.com/-rWDqD0dz2qc/YGmakbrRnGI/AAAAAAAAeCM/s3df9UK3zRIrxBhr6C5lY1v3XzpmSGkLQCNcBGAsYHQ/w479-h270/1.jpg"></a></p><p><strong>因為wifi即時的流量要比較大，且耗能，所以再另把以下這個選擇改一下</strong></p><p><a href="https://draft.blogger.com/blog/post/edit/3809681606094011522/2908832685289288450#"><img src="https://1.bp.blogspot.com/-gf7kO8q5y38/YGmbLCcvtEI/AAAAAAAAeCU/z0jC6RtDGbMVCJRXdTumt6URuxFQzT08ACNcBGAsYHQ/w421-h237/2.jpg"></a></p><p><strong>再到”範例＂底下匯入範例</strong></p><p><a href="https://draft.blogger.com/blog/post/edit/3809681606094011522/2908832685289288450#"><img src="https://1.bp.blogspot.com/-cnsDAyIqb_c/YGmcJ4-UPuI/AAAAAAAAeCc/rWqVlsd-ke4YfrkN13yliiMV2x21gPFywCNcBGAsYHQ/w478-h269/2.jpg"></a></p><p><strong>這裡有幾個地方要更改一下設置</strong></p><p><a href="https://draft.blogger.com/blog/post/edit/3809681606094011522/2908832685289288450#"><img src="https://1.bp.blogspot.com/-kaulw1wcg1w/YGmdFDhEwBI/AAAAAAAAeCk/70Ycqy_IG_0-HAHfFxRiJ4W9V3-9oN2zwCNcBGAsYHQ/w514-h289/2.jpg"></a></p><hr><p><strong>都設置好了之後，先把板子上的ＩＯ０和ＧＮＤ短接起來。</strong></p><p><a href="https://draft.blogger.com/blog/post/edit/3809681606094011522/2908832685289288450#"><img src="https://1.bp.blogspot.com/-3knPVurgzB0/YGmgfPGKXfI/AAAAAAAAeCs/c9U4ihOIFXwLNHRMvAdXPbOwRdFj7jvkgCNcBGAsYHQ/w436-h413/20210404_191546.jpg"></a></p><p><strong>接下來按下”上傳＂</strong></p><p><strong>……………………時間約6分鐘，可以喝口水</strong></p><p><strong>寫入程式後最後出現下圖，這時把短接拔掉並REST</strong></p><p><a href="https://draft.blogger.com/blog/post/edit/3809681606094011522/2908832685289288450#"><img src="https://1.bp.blogspot.com/-b_dwGskTofY/YGmiH2rDZwI/AAAAAAAAeC0/RIFbmrKvELkQLfHSEy3EZBcxpQeuwgsLgCNcBGAsYHQ/w418-h235/2.jpg"></a></p><hr><p><strong>然後開啓”監控螢幕”，它會給一組ＩＰ，用瀏覽器登入</strong></p><p><a href="https://draft.blogger.com/blog/post/edit/3809681606094011522/2908832685289288450#"><img src="https://1.bp.blogspot.com/-aIu_JpV1Vb0/YGmiv6GgpvI/AAAAAAAAeC8/qagkETKhQ0kUiqzfZLsE6TMPUO8cSiSIACNcBGAsYHQ/w441-h248/2.jpg"></a></p><p><strong>然後成功了就會進入以下畫面</strong></p><p><a href="https://draft.blogger.com/blog/post/edit/3809681606094011522/2908832685289288450#"><img src="https://1.bp.blogspot.com/-3iwr7LwXbN8/YGmkZ7oslaI/AAAAAAAAeDE/iFIaXkzSu8Yc6r-PH-_qAtYcKleMXOM3wCNcBGAsYHQ/w463-h253/2.jpg"></a></p><p><strong>畫面左下方”start stream”按下，監控頻就會出現</strong></p><p><a href="https://draft.blogger.com/blog/post/edit/3809681606094011522/2908832685289288450#"><img src="https://1.bp.blogspot.com/-GYoCegVuku0/YGmlmlN3_dI/AAAAAAAAeDM/G8yTthhipZI8i_zpatL0m7t-dcEmDL2NgCNcBGAsYHQ/w552-h272/2.jpg"></a></p><p><strong>聽說還有很多功能，例如人臉辨識，也可置入一些參數，做刷臉門禁等等….</strong></p><p>**等有空再來找找這類資料。<br>**</p>]]></content>
      
      
      <categories>
          
          <category> esp32 cam </category>
          
      </categories>
      
      
        <tags>
            
            <tag> esp32 cam </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ESP32連上無線基地台（ＡＰ）</title>
      <link href="/2021/08/29/esp32-lian-shang-wu-xian-ji-di-tai-ap/"/>
      <url>/2021/08/29/esp32-lian-shang-wu-xian-ji-di-tai-ap/</url>
      
        <content type="html"><![CDATA[<h1 id="ESP32連上無線基地台（AP）"><a href="#ESP32連上無線基地台（AP）" class="headerlink" title="ESP32連上無線基地台（ＡＰ）"></a>ESP32連上無線基地台（ＡＰ）</h1><h6 id="tags-esp32-wifi"><a href="#tags-esp32-wifi" class="headerlink" title="tags: esp32 wifi"></a>tags: <code>esp32</code> <code>wifi</code></h6><hr><h2 id="實驗說明："><a href="#實驗說明：" class="headerlink" title="實驗說明："></a>實驗說明：</h2><p><strong>用 ESP32內建Wi-Fi連到基地台，程式使用while()迴圈</strong></p><p><strong>並以WiFi.staus()判斷是否已連線,如果正在連線，會印出</strong></p><p><strong>＂.＂，如回傳為否,每隔0.5秒會再進入回迴圈掃描附近</strong></p><p><strong>配對的基地台，直到連線成功為跳出迴圈並印出”已連線</strong></p><p><strong>成功”字樣。</strong></p><hr><ul><li><strong>連線中</strong></li></ul><p><a href="https://draft.blogger.com/blog/post/edit/3809681606094011522/1075448515665169120#"><img src="https://1.bp.blogspot.com/-pReU1rtq-8Q/YJyl1JGCz_I/AAAAAAAAeJA/qeYtYdCBIKwjeUF62PlEbad5mVj7kqmoACNcBGAsYHQ/w609-h194/1.jpg"></a></p><ul><li><strong>已連線</strong></li></ul><p><a href="https://draft.blogger.com/blog/post/edit/3809681606094011522/1075448515665169120#"><img src="https://1.bp.blogspot.com/--1iFhC4mnNU/YJyl98_zwgI/AAAAAAAAeJE/MNJ4WMupFAUL0d13nyJ-k-uzZTIpvhRVACNcBGAsYHQ/w645-h214/2.jpg"></a></p><hr><h1 id="ESP32連上無線基地台（AP）-1"><a href="#ESP32連上無線基地台（AP）-1" class="headerlink" title="ESP32連上無線基地台（ＡＰ）"></a>ESP32連上無線基地台（ＡＰ）</h1><hr><h2 id="實驗說明：-1"><a href="#實驗說明：-1" class="headerlink" title="實驗說明："></a>實驗說明：</h2><p><strong>用 ESP32內建Wi-Fi連到基地台，程式使用while()迴圈</strong></p><p><strong>並以WiFi.staus()判斷是否已連線,如果正在連線，會印出</strong></p><p><strong>＂.＂，如回傳為否,每隔0.5秒會再進入回迴圈掃描附近</strong></p><p><strong>配對的基地台，直到連線成功為跳出迴圈並印出”已連線</strong></p><p><strong>成功”字樣。</strong></p><hr><h3 id="連線中"><a href="#連線中" class="headerlink" title="連線中"></a>連線中</h3><p><a href="https://draft.blogger.com/blog/post/edit/3809681606094011522/1075448515665169120#"><img src="https://1.bp.blogspot.com/-pReU1rtq-8Q/YJyl1JGCz_I/AAAAAAAAeJA/qeYtYdCBIKwjeUF62PlEbad5mVj7kqmoACNcBGAsYHQ/w609-h194/1.jpg"></a></p><h3 id="已連線"><a href="#已連線" class="headerlink" title="已連線"></a>已連線</h3><p><a href="https://draft.blogger.com/blog/post/edit/3809681606094011522/1075448515665169120#"><img src="https://1.bp.blogspot.com/--1iFhC4mnNU/YJyl98_zwgI/AAAAAAAAeJE/MNJ4WMupFAUL0d13nyJ-k-uzZTIpvhRVACNcBGAsYHQ/w645-h214/2.jpg"></a></p><hr><h2 id="程式碼"><a href="#程式碼" class="headerlink" title="程式碼"></a>程式碼</h2><pre class="line-numbers language-c#" data-language="c#"><code class="language-c#">#include &lt;WiFi.h&gt; ———套用ＷｉＦｉ庫const char *ssid &#x3D; &quot;基地台名稱&quot;;const char *password &#x3D; &quot;基地台密碼&quot;;  void setup()&#123;    Serial.begin(115200);    WiFi.begin(ssid, password);    while (WiFi.status() !&#x3D; WL_CONNECTED)&#123; ———判斷是否已連線        delay(500);        Serial.print(&quot;.&quot;);    &#125;    Serial.println(&quot;已連線到Wi-Fi基地台&quot;);&#125;void loop()&#123;&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="獲取AP資訊"><a href="#獲取AP資訊" class="headerlink" title="  獲取AP資訊 "></a>  獲取AP資訊 </h2><p><strong>相關函式請參閱-<a href="https://draft.blogger.com/blog/post/edit/3809681606094011522/1075448515665169120#">ESP32函式筆記本</a></strong></p><p><strong>基本上和上面程式碼一樣，只是多套用了取得網路相關的資訊</strong></p><p><strong>，每個能連上網路的設備都會有這些相關訊息，例如電腦，在</strong></p><p><strong>終諯機輸入ipconfig就會出現下圖:</strong></p><p><a href="https://1.bp.blogspot.com/-1J2iaS1THkk/YJzRS-H6gyI/AAAAAAAAeJQ/Z8D0k_dYVtI1pmHiwtpn5cgkguvjwvubwCNcBGAsYHQ/s1456/1.jpg"><img src="https://1.bp.blogspot.com/-1J2iaS1THkk/YJzRS-H6gyI/AAAAAAAAeJQ/Z8D0k_dYVtI1pmHiwtpn5cgkguvjwvubwCNcBGAsYHQ/w544-h275/1.jpg"></a></p><p><strong>那麼ESP32同樣可做為網路設備來說也是會有這些資訊</strong></p><p>**將程式碼上傳後即會取得相關的資訊<br>**</p><p><a href="https://1.bp.blogspot.com/-Eb5_RJ8ay48/YJzR3ZC4AII/AAAAAAAAeJY/Qi9yLfNdupghRcPWGuw7KX0AR7HOWo9ZACNcBGAsYHQ/s1541/2.jpg"><img src="https://1.bp.blogspot.com/-Eb5_RJ8ay48/YJzR3ZC4AII/AAAAAAAAeJY/Qi9yLfNdupghRcPWGuw7KX0AR7HOWo9ZACNcBGAsYHQ/w469-h283/2.jpg"></a></p><pre class="line-numbers language-c#" data-language="c#"><code class="language-c#">#include &lt;WiFi.h&gt;const char *ssid &#x3D; &quot;基地台名稱&quot;;const char *password &#x3D; &quot;基地台密碼&quot;;  void setup()&#123;    Serial.begin(115200);    WiFi.begin(ssid, password);    while (WiFi.status() !&#x3D; WL_CONNECTED)    &#123;        delay(500);        Serial.print(&quot;.&quot;);    &#125;    Serial.println(&quot;已連上WiFi&quot;);    Serial.print(&quot;我的IP位址&quot;);    Serial.println(WiFi.localIP());      Serial.print(&quot;子遮罩網路: &quot;);    Serial.println(WiFi.subnetMask());      Serial.print(&quot;閘道網路: &quot;);    Serial.println(WiFi.gatewayIP());      Serial.print(&quot;DNS位址: &quot;);    Serial.println(WiFi.dnsIP());&#125;void loop()&#123;&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>]]></content>
      
      
      <categories>
          
          <category> esp32 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> wifi </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ESP32變成網頁伺服器,使客戶端連入網頁</title>
      <link href="/2021/08/29/esp32-bian-cheng-wang-ye-si-fu-qi-shi-ke-hu-duan-lian-ru-wang-ye/"/>
      <url>/2021/08/29/esp32-bian-cheng-wang-ye-si-fu-qi-shi-ke-hu-duan-lian-ru-wang-ye/</url>
      
        <content type="html"><![CDATA[<h1 id="ESP32變成網頁伺服器-使客戶端連入網頁"><a href="#ESP32變成網頁伺服器-使客戶端連入網頁" class="headerlink" title="ESP32變成網頁伺服器,使客戶端連入網頁"></a>ESP32變成網頁伺服器,使客戶端連入網頁</h1><h6 id="tags-esp32-WiFi"><a href="#tags-esp32-WiFi" class="headerlink" title="tags: esp32 WiFi"></a>tags: <code>esp32</code> <code>WiFi</code></h6><hr><h4 id="基本上就是這篇的延伸"><a href="#基本上就是這篇的延伸" class="headerlink" title="基本上就是這篇的延伸-"></a>基本上就是這篇的延伸-</h4><p><a href="https://draft.blogger.com/blog/post/edit/3809681606094011522/4116986106197766676?hl=zh-TW#">https://esp32-blairan.blogspot.com/2021/05/esp32ap.html</a>  </p><h2 id="流程思惟"><a href="#流程思惟" class="headerlink" title="流程思惟"></a>流程思惟</h2><p>要先有整個流程的概念，比較不會在寫程式時搞混</p><p>用我自己的解釋是，先連上ESP32基地台，萬一連</p><p>不上，就會一直出現點點點….，試圖連上，連線成</p><p>功後會顯示＂已連線成功＂(圖1)，並配發IP位址給客戶端</p><p>此時伺服器啓動等待客戶端請求根目錄的回覆,若客</p><p>戶端連上IP,伺服器將提供根目錄預設的回覆訊息(圖2)，</p><p>如果在IP後面隨意打字，因為根目錄下沒有這個預設</p><p>目標，將會顯查無這個網頁(圖3)。</p><p>(圖1)</p><p><a href="https://draft.blogger.com/blog/post/edit/3809681606094011522/4116986106197766676?hl=zh-TW#"><img src="https://1.bp.blogspot.com/-aHVdMYxdyUo/YLHndJOPIaI/AAAAAAAAeNU/-HZtR82h3JQIeA9oJ5JRNz8Phn_h1sDFgCNcBGAsYHQ/w500-h281/2.jpg"></a></p><p>(圖2)</p><p><a href="https://draft.blogger.com/blog/post/edit/3809681606094011522/4116986106197766676?hl=zh-TW#"><img src="https://1.bp.blogspot.com/-LNy_a5hKhTA/YLHni6wxvNI/AAAAAAAAeNY/GL8WBynD2FocPIgJVTmzzFJW7IxpR3LTACNcBGAsYHQ/w502-h269/1.jpg"></a></p><p>(圖3)</p><p><a href="https://draft.blogger.com/blog/post/edit/3809681606094011522/4116986106197766676?hl=zh-TW#"><img src="https://1.bp.blogspot.com/-F2vTjv5E6Uc/YLHoaliw3gI/AAAAAAAAeNk/JWP9Xp9d2h0-yFONJzfrqP3ZZdI-JHq1wCNcBGAsYHQ/w504-h267/3.jpg"></a></p><hr><h2 id="程式碼"><a href="#程式碼" class="headerlink" title="程式碼"></a>程式碼</h2><pre class="line-numbers language-c#" data-language="c#"><code class="language-c#">#include &lt;WiFi.h&gt;#include &lt;WebServer.h&gt;const char *ssid&#x3D;&quot;基地台名稱&quot;;const char *password&#x3D;&quot;基地台密碼&quot;;WebServer server(80);void handleRoot()&#123;  server.send(200, &quot;text&#x2F;html; charset&#x3D;UTF-8&quot;, &quot;客戶端收到訊息!!!&quot;);&#125;void handleNotFound()&#123;  server.send(400, &quot;text&#x2F;html; charset&#x3D;UTF-8&quot;, &quot;找不到回傳的訊息&quot;);&#125;void setup(void)&#123;  Serial.begin(115200);  WiFi.begin(ssid, password);  server.begin();  while (WiFi.status() !&#x3D; WL_CONNECTED)&#123;    Serial.print(&quot;.&quot;);    delay(500);  &#125;  Serial.print(&quot;已連線至基地台&quot;);  Serial.println(ssid)  Serial.print(&quot;請於瀏覽器中開啓這個IP位址: &quot;);  Serial.println(WiFi.localIP());    server.on(&quot;&#x2F;&quot;, handleRoot);  server.onNotFound(handleNotFound);  Serial.println(&quot;HTTP伺服器已啓動&quot;);&#125;  void loop() &#123;  server.handleClient();&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>]]></content>
      
      
      <categories>
          
          <category> esp32 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> webserver </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ESP32點亮內置LED</title>
      <link href="/2021/08/29/esp32-dian-liang-nei-zhi-led/"/>
      <url>/2021/08/29/esp32-dian-liang-nei-zhi-led/</url>
      
        <content type="html"><![CDATA[<h1 id="ESP32點亮內置LED"><a href="#ESP32點亮內置LED" class="headerlink" title="ESP32點亮內置LED"></a>ESP32點亮內置LED</h1><h6 id="tags-esp32"><a href="#tags-esp32" class="headerlink" title="tags: esp32"></a>tags: <code>esp32</code></h6><hr><h4 id="這是我第一次真正學習esp32系列-雖然之前有使用wemos-d1-mini但也只是照書做-用完還是覺得很模糊-玩了一陣子的Arduino-現在有空一邊研究esp系列和樹莓派-今天當做一個起始點亮板上的LED"><a href="#這是我第一次真正學習esp32系列-雖然之前有使用wemos-d1-mini但也只是照書做-用完還是覺得很模糊-玩了一陣子的Arduino-現在有空一邊研究esp系列和樹莓派-今天當做一個起始點亮板上的LED" class="headerlink" title="這是我第一次真正學習esp32系列,雖然之前有使用wemos d1 mini但也只是照書做,用完還是覺得很模糊,玩了一陣子的Arduino,現在有空一邊研究esp系列和樹莓派,今天當做一個起始點亮板上的LED."></a>這是我第一次真正學習esp32系列,雖然之前有使用wemos d1 mini但也只是照書做,用完還是覺得很模糊,玩了一陣子的Arduino,現在有空一邊研究esp系列和樹莓派,今天當做一個起始點亮板上的LED.</h4><hr><h4 id="我所使用的ESP32是淘-買的-因為這款有附單元課程-所以有一個集成板-很方便。"><a href="#我所使用的ESP32是淘-買的-因為這款有附單元課程-所以有一個集成板-很方便。" class="headerlink" title="我所使用的ESP32是淘*買的,因為這款有附單元課程,所以有一個集成板,很方便。"></a>我所使用的ESP32是淘*買的,因為這款有附單元課程,所以有一個集成板,很方便。</h4><p><a href="https://draft.blogger.com/blog/post/edit/3809681606094011522/5957928262171433878#"><img src="https://1.bp.blogspot.com/-EHIybPXQ1TQ/YESQWt2rOZI/AAAAAAAAd5g/dPueSjsi6HgMLS-72nLW0wTPYWWGqEHZACNcBGAsYHQ/w343-h762/20210307_162828.jpg"></a><br><a href="https://draft.blogger.com/blog/post/edit/3809681606094011522/5957928262171433878#"><img src="https://1.bp.blogspot.com/-WUH-nbqYfnU/YESTI1KqdqI/AAAAAAAAd58/5OAKs359y9spbLh5KE9AuOSuGQjegmF4ACNcBGAsYHQ/w542-h361/pyWiFi-ESP32_pinout.png"></a></p><h6 id="lt-圖片引用01Studio網站-gt"><a href="#lt-圖片引用01Studio網站-gt" class="headerlink" title="&lt;圖片引用01Studio網站&gt;"></a>&lt;圖片引用01Studio網站&gt;</h6><hr><h3 id="今天先來筆記一下使用micropython的語法"><a href="#今天先來筆記一下使用micropython的語法" class="headerlink" title="今天先來筆記一下使用micropython的語法"></a>今天先來筆記一下使用micropython的語法</h3><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">from</span> machine <span class="token keyword">import</span> Pin<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h3 id="這個是控制板上的gpio的套件"><a href="#這個是控制板上的gpio的套件" class="headerlink" title="這個是控制板上的gpio的套件"></a>這個是控制板上的gpio的套件</h3><pre class="line-numbers language-python" data-language="python"><code class="language-python">led<span class="token punctuation">(</span>變數<span class="token punctuation">)</span><span class="token operator">=</span>Pin<span class="token punctuation">(</span>腳位<span class="token punctuation">,</span> Pin<span class="token punctuation">.</span>OUT<span class="token punctuation">)</span>led<span class="token punctuation">.</span>on<span class="token punctuation">(</span>off<span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">)</span> 或 led<span class="token punctuation">.</span>value<span class="token punctuation">(</span><span class="token number">0</span> <span class="token keyword">or</span> <span class="token number">1</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><hr><h3 id="寫一個迴圈來控制LED閃爍"><a href="#寫一個迴圈來控制LED閃爍" class="headerlink" title="寫一個迴圈來控制LED閃爍"></a>寫一個迴圈來控制LED閃爍</h3><pre class="line-numbers language-py" data-language="py"><code class="language-py"><span class="token keyword">from</span> machine <span class="token keyword">import</span> Pin<span class="token keyword">import</span> timeled<span class="token operator">=</span>Pin<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> Pin<span class="token punctuation">.</span>OUT<span class="token punctuation">)</span>a<span class="token operator">=</span><span class="token number">0</span><span class="token keyword">while</span> a<span class="token operator">&lt;</span><span class="token number">5</span><span class="token punctuation">:</span>    led<span class="token punctuation">.</span>on<span class="token punctuation">(</span><span class="token punctuation">)</span>    time<span class="token punctuation">.</span>sleep<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>    led<span class="token punctuation">.</span>off<span class="token punctuation">(</span><span class="token punctuation">)</span>    time<span class="token punctuation">.</span>sleep<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>    a<span class="token operator">+=</span><span class="token number">1</span>    <span class="token keyword">print</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><div class="video-container"><iframe src="https://www.youtube.com/embed/X79o9kU_hh0" frameborder="0" loading="lazy" allowfullscreen></iframe></div>]]></content>
      
      
      <categories>
          
          <category> esp32 </category>
          
          <category> micropython </category>
          
      </categories>
      
      
        <tags>
            
            <tag> led </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>使用platformIO編輯esp32更改波特率</title>
      <link href="/2021/08/29/shi-yong-platformio-bian-ji-esp32-geng-gai-bo-te-lu/"/>
      <url>/2021/08/29/shi-yong-platformio-bian-ji-esp32-geng-gai-bo-te-lu/</url>
      
        <content type="html"><![CDATA[<h1 id="使用platformIO編輯esp32更改波特率"><a href="#使用platformIO編輯esp32更改波特率" class="headerlink" title="使用platformIO編輯esp32更改波特率"></a>使用platformIO編輯esp32更改波特率</h1><h6 id="tags-esp32"><a href="#tags-esp32" class="headerlink" title="tags: esp32"></a>tags: <code>esp32</code></h6><h2 id="原由"><a href="#原由" class="headerlink" title="原由:"></a>原由:</h2><p><strong>因為使用VScode的外掛platformIO編程ESP32時,遇到一個問題是,波特率的預設是9600,所以在上傳ESP32只要開啓串口窗,會出現亂碼,此時只要加</strong></p><p><strong>入一行設定代碼即可。</strong></p><h2 id="方法"><a href="#方法" class="headerlink" title="方法:"></a>方法:</h2><h3 id="在platformIO的專案資料夾裡有一個platformio-ini，打開此文件。"><a href="#在platformIO的專案資料夾裡有一個platformio-ini，打開此文件。" class="headerlink" title="在platformIO的專案資料夾裡有一個platformio.ini，打開此文件。"></a>在platformIO的專案資料夾裡有一個platformio.ini，打開此文件。</h3><p><a href="https://draft.blogger.com/blog/post/edit/3809681606094011522/5479708402450547329#"><img src="https://1.bp.blogspot.com/-vKAPXvvPExQ/YIYxS2l229I/AAAAAAAAeFQ/kfyB0nSsx1AbRjBkrwblppLarywketgVQCNcBGAsYHQ/w591-h332/but2.jpg"></a></p><h3 id="加入monitor-speed-115200，加入後存檔即可。"><a href="#加入monitor-speed-115200，加入後存檔即可。" class="headerlink" title="加入monitor_speed=115200，加入後存檔即可。"></a>加入monitor_speed=115200，加入後存檔即可。</h3><p><a href="https://draft.blogger.com/blog/post/edit/3809681606094011522/5479708402450547329#"><img src="https://1.bp.blogspot.com/-4fs9OT3YkHc/YIYxS_sPvSI/AAAAAAAAeFU/--QyhpQ7P844rjcXviYpBcSACr_9LYpdACNcBGAsYHQ/w580-h326/but.jpg"></a></p>]]></content>
      
      
      <categories>
          
          <category> esp32 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 波特率 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ESP32-CAM縮時錄影</title>
      <link href="/2021/08/29/esp32-cam-suo-shi-lu-ying/"/>
      <url>/2021/08/29/esp32-cam-suo-shi-lu-ying/</url>
      
        <content type="html"><![CDATA[<h1 id="ESP32-CAM縮時錄影"><a href="#ESP32-CAM縮時錄影" class="headerlink" title="ESP32-CAM縮時錄影"></a>ESP32-CAM縮時錄影</h1><h6 id="tags-esp32-esp32-cam縮時錄影"><a href="#tags-esp32-esp32-cam縮時錄影" class="headerlink" title="tags: esp32 esp32-cam縮時錄影"></a>tags: <code>esp32</code> <code>esp32-cam縮時錄影</code></h6><h2 id="準備"><a href="#準備" class="headerlink" title="準備"></a>準備</h2><p><strong>MicroSD卡 x1</strong></p><p><strong>ESP32-CAM x1</strong></p><p><strong>USB TTL傳輸線 或 USB TTL模組</strong></p><p><strong>雙母杜邦線 x1</strong></p><hr><h2 id="下載縮時錄影的庫"><a href="#下載縮時錄影的庫" class="headerlink" title="下載縮時錄影的庫"></a>下載縮時錄影的庫</h2><p><a href="https://draft.blogger.com/blog/post/edit/3809681606094011522/220625865150685015#">https://github.com/jameszah/ESP32-CAM-Video-Recorder</a>  </p><p><strong>下載完後，新增到Arduino IDE的library裡</strong></p><p><strong>打開編輯器裡的範例-&gt;TimeLapse</strong></p><p>**</p><p><a href="https://draft.blogger.com/blog/post/edit/3809681606094011522/220625865150685015#"><img src="https://1.bp.blogspot.com/-LjDyK9KNMpk/YGwIPQCplYI/AAAAAAAAeDY/mx4YiCbQDxIEx4VHjyYmzJwMRU_Gg9yrACNcBGAsYHQ/w438-h246/1.jpg"></a></p><hr><p><a href="https://draft.blogger.com/blog/post/edit/3809681606094011522/220625865150685015#"><img src="https://1.bp.blogspot.com/-vym3Op0cW0s/YGwI357s-KI/AAAAAAAAeDg/KZRbfinTtQESOD8tmqD9f-5VXMC4uvX2QCNcBGAsYHQ/w441-h248/1.jpg"></a></p><hr><p>將ESP32-CAM板子上的IO0和GND用雙母杜邦連接起來。**</p><h2 id="還有一些選擇的設定，往下看影片更清楚"><a href="#還有一些選擇的設定，往下看影片更清楚" class="headerlink" title="還有一些選擇的設定，往下看影片更清楚"></a><strong>還有一些選擇的設定，往下看影片更清楚</strong></h2><p>**</p><div class="video-container"><iframe src="https://www.youtube.com/embed/BJXV09NFz1U" frameborder="0" loading="lazy" allowfullscreen></iframe></div><p><a href="https://youtu.be/BJXV09NFz1U">https://youtu.be/BJXV09NFz1U</a></p><p>有空再來補如何用ffmpeg把縮時的照片整合起來**</p>]]></content>
      
      
      <categories>
          
          <category> esp32 </category>
          
          <category> esp32 cam </category>
          
      </categories>
      
      
        <tags>
            
            <tag> ESP32 CAM </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>初嚐ESP32-寫入軔體</title>
      <link href="/2021/08/29/chu-chang-esp32-xie-ru-ren-ti/"/>
      <url>/2021/08/29/chu-chang-esp32-xie-ru-ren-ti/</url>
      
        <content type="html"><![CDATA[<h1 id="初嚐ESP32—寫入軔體"><a href="#初嚐ESP32—寫入軔體" class="headerlink" title="初嚐ESP32—寫入軔體"></a>初嚐ESP32—寫入軔體</h1><h6 id="tags-esp32"><a href="#tags-esp32" class="headerlink" title="tags: esp32"></a>tags: <code>esp32</code></h6><h2 id="有點複雜但又另人想嚐試的ESP32"><a href="#有點複雜但又另人想嚐試的ESP32" class="headerlink" title="有點複雜但又另人想嚐試的ESP32"></a>有點複雜但又另人想嚐試的ESP32</h2><p>樂鑫科技-<a href="https://draft.blogger.com/blog/post/edit/3809681606094011522/7215718092950677692#">https://www.espressif.com/zh-hans/products/devkits/esp32-devkitc/overview</a>  </p><p>玩了一陣子Arduino後，看了幾個社團推ESP32系列，</p><p>於是入手了ESP32-CAM來玩玩，對比樹莓派的人臉</p><p>辨識，只要灌入範例就能跑人臉識別，所以開始關注</p><p>ESP32系列的板子。原來它是大陸一家叫樂鑫的大廠</p><p>做的開源板，上網看了他們的網站，發現頗豐富的，</p><p>其實很多前輩老師們都已做了很詳盡的介紹，我就</p><p>不多說了。</p><p>主要我是覺得ESP32感覺有同於Arduino系列，但又有</p><p>不一樣的地方，聽說它腳位有些不能給我們正常使用，</p><p>而且只接受3.3V輸入，但好處是集結了WIFI和藍芽。</p><p>可以用micropython和C語言來編譯，但這裡我就有點</p><p>難取捨，到底要用micropython或C來寫，雖然用ｃ比較</p><p>簡單而且又有強大的範例，但也我本身是從python開始</p><p>學起的，或許有空兩種都會學學。</p><hr><h2 id="我入手的ESP32-DOIT-DEVKIT-V1"><a href="#我入手的ESP32-DOIT-DEVKIT-V1" class="headerlink" title="我入手的ESP32-DOIT-DEVKIT-V1"></a>我入手的ESP32-DOIT-DEVKIT-V1</h2><p>這裡感覺很厲害的是有許多組”觸控接腳”，以＂TOUCH＂開頭為表示</p><p>另外GPIO用Arduino的方式寫一樣是D*，而ADC1 CH0就表示A0。</p><p>還有一個要注意的是，序列插孔左右有兩個按鍵，ＥＮ代表ＲＳＴ</p><p>ＢＯＯＴ代表寫入狀態</p><p><a href="https://draft.blogger.com/blog/post/edit/3809681606094011522/7215718092950677692#"><img src="https://1.bp.blogspot.com/-aqByH8jZaHU/YIZiXH3A6NI/AAAAAAAAeFk/ZHPxVHay7pgsHhz54ZGE8xA33kHgiIWxwCNcBGAsYHQ/w327-h294/c44b9f5d0a23649c7b352c7c1eb8b5d8.jpg"></a></p><p><a href="https://draft.blogger.com/blog/post/edit/3809681606094011522/7215718092950677692#"><img src="https://1.bp.blogspot.com/-uV84UOVkK8A/YIZij6ll2LI/AAAAAAAAeFs/jQsh0S-ZUswKm_V-HmN8tGN_i2G7bpQJwCNcBGAsYHQ/w496-h359/ESP32-DOIT-DEVKIT-V1-Board-Pinout-30-GPIOs-Copy.png"></a></p><hr><h2 id="如何寫入軔體"><a href="#如何寫入軔體" class="headerlink" title="如何寫入軔體"></a>如何寫入軔體</h2><p>參考網址</p><p><a href="https://draft.blogger.com/blog/post/edit/3809681606094011522/7215718092950677692#">下載 windows 專用 FlashTools</a>-取自JIMI大的教學網站  </p><p>這裡要注意的是ESP32燒錄工具若一打開就跳掉，請到</p><p>＂設定＂-“時間與語言”-“地區格式”選擇為”中文(簡體,中國)＂</p><p>重開機即可執行該軟體。</p>]]></content>
      
      
      <categories>
          
          <category> esp32 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 寫入軔體 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>0.96吋OLED基本顯示-ESP32</title>
      <link href="/2021/08/29/0-96-cun-oled-ji-ben-xian-shi-esp32/"/>
      <url>/2021/08/29/0-96-cun-oled-ji-ben-xian-shi-esp32/</url>
      
        <content type="html"><![CDATA[<h1 id="0-96吋OLED基本顯示-ESP32"><a href="#0-96吋OLED基本顯示-ESP32" class="headerlink" title="0.96吋OLED基本顯示-ESP32"></a>0.96吋OLED基本顯示-ESP32</h1><h6 id="tags-esp32-oled"><a href="#tags-esp32-oled" class="headerlink" title="tags: esp32 oled"></a>tags: <code>esp32</code> <code>oled</code></h6><p><a href="https://draft.blogger.com/blog/post/edit/3809681606094011522/6459347446114782211?hl=zh-TW#"><img src="https://lh3.googleusercontent.com/-SfRPMdP0feE/YMdKWUgpKzI/AAAAAAAAeTk/DtG0FqRB7hI4Xu0suyprVmf1lSZ2c6BpwCNcBGAsYHQ/s1600/1623673410135139-0.png"></a></p><h2 id="接線方式"><a href="#接線方式" class="headerlink" title="接線方式"></a>接線方式</h2><p><strong><em>OLED</em></strong>||<strong>ESP32</strong></p><p>-----------------</p><p>VCC----3V3</p><p>GND—-GND</p><p>SCL—–D22</p><p>SDA—-D21</p><h2 id="函式參考"><a href="#函式參考" class="headerlink" title="函式參考"></a>函式參考</h2><p><a href="https://draft.blogger.com/blog/post/edit/3809681606094011522/6459347446114782211?hl=zh-TW#">我的函式筆記本</a>  </p><hr><h2 id="須下載及匯入以下函式庫"><a href="#須下載及匯入以下函式庫" class="headerlink" title="須下載及匯入以下函式庫"></a>須下載及匯入以下函式庫</h2><p><a href="https://draft.blogger.com/blog/post/edit/3809681606094011522/6459347446114782211?hl=zh-TW#">Adafruit_SSD1306</a>  </p><p><a href="https://draft.blogger.com/blog/post/edit/3809681606094011522/6459347446114782211?hl=zh-TW#">Adafruit-GFX-Library</a>  </p><h2 id="程式碼"><a href="#程式碼" class="headerlink" title="程式碼"></a>程式碼</h2><pre class="line-numbers language-c#" data-language="c#"><code class="language-c#">#include &lt;Adafruit_GFX.h&gt;#include &lt;Adafruit_SSD1306.h&gt;#include &lt;Adafruit_GrayOLED.h&gt;#include &lt;Wire.h&gt;#define SCREEN_WIDTH 128 &#x2F;&#x2F; OLED display width, in pixels#define SCREEN_HEIGHT 64 &#x2F;&#x2F; OLED display height, in pixels  #define OLED_RESET -1 &#x2F;&#x2F; Reset pin # (or -1 if sharing Arduino reset pin)#define SCREEN_ADDRESS 0x3C &#x2F;&#x2F;&#x2F;&lt; See datasheet for Address; 0x3D for 128x64, 0x3C for 128x32Adafruit_SSD1306 display(SCREEN_WIDTH, SCREEN_HEIGHT, &amp;Wire, OLED_RESET);void setup()&#123;  Serial.begin(115200);  display.begin(SSD1306_SWITCHCAPVCC, SCREEN_ADDRESS, OLED_RESET);&#125;void loop()&#123;  display.clearDisplay();  display.setCursor(0, 0);  display.setTextSize(1);  display.setTextColor(BLACK, WHITE);  display.println(&quot;Hello!&quot;);  display.setCursor(0, 16);  display.setTextSize(2);  display.setTextColor(WHITE);  display.println(&quot;ESP32&quot;);  display.setTextSize(3);  display.setCursor(0, 32);  display.println(&quot;Arduino&quot;);  display.display();&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><hr><p><a href="https://draft.blogger.com/blog/post/edit/3809681606094011522/6459347446114782211?hl=zh-TW#"><img src="https://lh3.googleusercontent.com/-FEjaHLmo_yM/YMdNVhVTE-I/AAAAAAAAeTs/fbsZkMqTyR8UmjWzqETE6Bvx6Hce70NCACNcBGAsYHQ/s1600/1623674195093239-0.png"></a></p>]]></content>
      
      
      <categories>
          
          <category> esp32 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> oled </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>呼吸燈-ESP32</title>
      <link href="/2021/08/29/hu-xi-deng-esp32/"/>
      <url>/2021/08/29/hu-xi-deng-esp32/</url>
      
        <content type="html"><![CDATA[<h1 id="呼吸燈-ESP32"><a href="#呼吸燈-ESP32" class="headerlink" title="呼吸燈-ESP32"></a>呼吸燈-ESP32</h1><h2 id="接線方式"><a href="#接線方式" class="headerlink" title="接線方式"></a>接線方式</h2><h6 id="tags-esp32"><a href="#tags-esp32" class="headerlink" title="tags: esp32"></a>tags: <code>esp32</code></h6><ul><li>  <strong>電阻 10K歐姆 x1</strong></li><li>  <strong>LED x1</strong></li></ul><p><a href="https://draft.blogger.com/blog/post/edit/3809681606094011522/632666415205285811?hl=zh-TW#"><img src="https://1.bp.blogspot.com/-o7ZeTZikdPc/YMlLS_bH5VI/AAAAAAAAeT8/p-2FoevUIRQT9z24R3Dfjrq-w-hmE7rgwCNcBGAsYHQ/w594-h373/222251qialhmh1wlko8hz8.jpg"></a></p><h2 id="程式碼"><a href="#程式碼" class="headerlink" title="程式碼"></a>程式碼</h2><p><strong><em>函式說明請參考-</em></strong><a href="https://draft.blogger.com/blog/post/edit/3809681606094011522/632666415205285811?hl=zh-TW#">我的函式筆記本</a></p><pre class="line-numbers language-c#" data-language="c#"><code class="language-c#">void setup()&#123;    ledcSetup(0, 5000, 8);    ledcAttachPin(25, 0);&#125;void loop()&#123;    for (int i &#x3D; 0; i &lt;&#x3D;255 ; i++)    &#123;        ledcWrite(0, i);        delay(20);    &#125;    for (int j &#x3D; 255; j &gt; 0; j--)    &#123;        ledcWrite(0, j);        delay(20);    &#125;    delay(300);&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>]]></content>
      
      
      <categories>
          
          <category> esp32 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 呼吸燈 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>PIR人體感應器</title>
      <link href="/2021/08/29/pir-ren-ti-gan-ying-qi/"/>
      <url>/2021/08/29/pir-ren-ti-gan-ying-qi/</url>
      
        <content type="html"><![CDATA[<h1 id="PIR人體感應器"><a href="#PIR人體感應器" class="headerlink" title="PIR人體感應器"></a>PIR人體感應器</h1><h6 id="tags-esp32-PIR-motion"><a href="#tags-esp32-PIR-motion" class="headerlink" title="tags: esp32 PIR_motion"></a>tags: <code>esp32</code> <code>PIR_motion</code></h6><p><a href="https://draft.blogger.com/blog/post/edit/3809681606094011522/5742917802289246193?hl=zh-TW#"><img src="https://1.bp.blogspot.com/-IyjhCgpFA20/YMtNtZbtNII/AAAAAAAAeUI/Yxs-05vGkwQmMKGDMdRG4OWA72p9fYW-ACNcBGAsYHQ/w403-h333/pir-01.jpg"></a><br>實驗說明</p><hr><p><em>此次實驗，以PIR感應器檢測人體運動，在高電位時使LED亮，</em></p><p><em>到達設製的時間，自動滅掉。</em></p><p><em>同時我在這個實驗裡學到中斷函式attachInterrupt()和mills()的運用</em></p><p><em>中斷函式可以運用在PIR，當檢測到變化，中斷函式會被觸發去執行所</em></p><p><em>設定的動作。同時藉由mills()替化delay()而不至於所有的過程都被delay()</em></p><p><em>暫停。</em></p><hr><h2 id="接線方式"><a href="#接線方式" class="headerlink" title="接線方式"></a>接線方式</h2><p><a href="https://draft.blogger.com/blog/post/edit/3809681606094011522/5742917802289246193?hl=zh-TW#"><img src="https://1.bp.blogspot.com/-kZQEvtpmUs8/YMtRIIu7vbI/AAAAAAAAeUQ/cap6CtGU6xAU2z7SGzMpPxYlg-pUY5kZQCNcBGAsYHQ/w826-h457/0d48261252092c03a3a44e37cd427709.jpg"></a></p><h2 id="程式碼"><a href="#程式碼" class="headerlink" title="程式碼"></a>程式碼</h2><pre class="line-numbers language-c#" data-language="c#"><code class="language-c#">const int led&#x3D;18;const int motionSensor&#x3D;27;unsigned long oldTime;bool startTimer&#x3D;false;void IRAM_ATTR detectedMotion()&#123;    Serial.println(&quot;detected motion....&quot;);    digitalWrite(led, HIGH);    oldTime&#x3D;millis();    startTimer&#x3D;true;&#125;void setup()&#123;    Serial.begin(115200);    pinMode(led, OUTPUT);    pinMode(motionSensor, INPUT_PULLUP);    attachInterrupt(digitalPinToInterrupt(motionSensor), detectedMotion, RISING);&#125;void loop()&#123;    unsigned long now&#x3D;millis();    if (startTimer&amp;&amp;(now-oldTime&gt;5000))&#123;        Serial.println(&quot;motion stop!!!&quot;);        digitalWrite(led, LOW);        startTimer&#x3D;false;    &#125;&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><em>特別提到這裡有一個自定義函式，它的作用是當PIR偵測到動作後，就會去執行這部份</em></p><p><em>並且使startTimer開始紀錄執行後的时間。</em></p><p><strong>注意：IRAM_ATTR 用於運行 RAM 中的中斷代碼，否則代碼存儲在 flash 中，速度較慢。</strong></p><pre class="line-numbers language-c#" data-language="c#"><code class="language-c#">void IRAM_ATTR detectedMotion()&#123;    Serial.println(&quot;detected motion....&quot;);    digitalWrite(led, HIGH);    oldTime&#x3D;millis();    startTimer&#x3D;true;&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><em>中斷函式可以參考</em>-<a href="https://draft.blogger.com/blog/post/edit/3809681606094011522/5742917802289246193?hl=zh-TW#">我的函式筆記本</a></p><pre class="line-numbers language-none"><code class="language-none">attachInterrupt(digitalPinToInterrupt(motionSensor), detectedMotion, RISING);<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p><em>時間函式可以參考</em>-<a href="https://draft.blogger.com/blog/post/edit/3809681606094011522/5742917802289246193?hl=zh-TW#">我的函式筆記本</a></p><pre class="line-numbers language-c#" data-language="c#"><code class="language-c#">unsigned long now&#x3D;millis();    if (startTimer&amp;&amp;(now-oldTime&gt;5000))&#123;        Serial.println(&quot;motion stop!!!&quot;);        digitalWrite(led, LOW);        startTimer&#x3D;false;    &#125;  <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><div class="video-container"><iframe src="https://www.youtube.com/embed/xQr5rVHvR-k" frameborder="0" loading="lazy" allowfullscreen></iframe></div>]]></content>
      
      
      <categories>
          
          <category> esp32 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> PIR </tag>
            
            <tag> PIR人體感應器 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>網頁控制LED燈-ESP32</title>
      <link href="/2021/08/29/wang-ye-kong-zhi-led-deng-esp32/"/>
      <url>/2021/08/29/wang-ye-kong-zhi-led-deng-esp32/</url>
      
        <content type="html"><![CDATA[<h1 id="網頁控制LED燈-ESP32"><a href="#網頁控制LED燈-ESP32" class="headerlink" title="網頁控制LED燈-ESP32"></a>網頁控制LED燈-ESP32</h1><h6 id="tags-esp32"><a href="#tags-esp32" class="headerlink" title="tags: esp32"></a>tags: <code>esp32</code></h6><h2 id="先上程式碼"><a href="#先上程式碼" class="headerlink" title="先上程式碼"></a>先上程式碼</h2><pre class="line-numbers language-c#" data-language="c#"><code class="language-c#">#include &lt;WiFi.h&gt;const char* ssid&#x3D;&quot;基地台名稱&quot;;const char* password&#x3D;&quot;基地台密碼&quot;;WiFiServer server(80);String header;String output2&#x3D;&quot;off&quot;;const int output&#x3D;2;unsigned long currentTime&#x3D;millis();unsigned long previousTime&#x3D;0;void setup()&#123;  pinMode(output, OUTPUT);  digitalWrite(output, LOW);  WiFi.begin(ssid, password);  Serial.begin(115200);  while (WiFi.status() !&#x3D; WL_CONNECTED)  &#123;    delay(500);    Serial.print(&quot;.&quot;);  &#125;  Serial.println(&quot;已連線到基地台&quot;);  Serial.print(&quot;基地台名稱: &quot;);  Serial.println(ssid);  Serial.println(WiFi.localIP());  server.begin();&#125;void loop()&#123;  WiFiClient client&#x3D;server.available();  if (client)&#123;    currentTime&#x3D;millis();    previousTime&#x3D;currentTime;    Serial.println(&quot;新的客戶端&quot;);    String currentLine&#x3D;&quot;&quot;;    while (client.connected()&amp;&amp;currentTime-previousTime&lt;&#x3D;2000)    &#123;      currentTime&#x3D;millis();      if (client.available())&#123;        char c&#x3D;client.read();        Serial.write(c);        header+&#x3D;c;        if (c&#x3D;&#x3D;&#39;\n&#39;)&#123;          if (currentLine.length()&#x3D;&#x3D;0)&#123;            client.println(&quot;HTTP&#x2F;1.1 200 OK&quot;);            client.println(&quot;Content-type:text&#x2F;html&quot;);            client.println(&quot;Connection: close&quot;);            client.println();            if (header.indexOf(&quot;GET &#x2F;2&#x2F;on&quot;)&gt;&#x3D;0)&#123;              Serial.println(&quot;on&quot;);              output2&#x3D;&quot;on&quot;;              digitalWrite(output, HIGH);            &#125;else if (header.indexOf(&quot;GET &#x2F;2&#x2F;off&quot;)&gt;&#x3D;0)&#123;              Serial.println(&quot;off&quot;);              output2&#x3D;&quot;off&quot;;              digitalWrite(output, LOW);            &#125;            client.println(&quot;&lt;!DOCTYPE html&gt;&lt;html&gt;&quot;);            client.println(&quot;&lt;style&gt;html &#123;text-align: center;font-family: Arial;display: inline-block;margin: auto;&#125;&quot;);            client.println(&quot;.button &#123;background-color: #e0e252; border: none;color: white;padding: 15px 35px;&quot;);            client.println(&quot;text-align: center;text-decoration: none;display: inline-block;font-size: 16px;&#125;&quot;);            client.println(&quot;.button2 &#123;background-color: #b0b1a2;padding: 15px 32px;&#125;&lt;&#x2F;style&gt;&lt;&#x2F;head&gt;&quot;);                        client.println(&quot;&lt;body&gt;&lt;h1&gt;ESP32 Web Server&lt;&#x2F;h1&gt;&quot;);                        client.println(&quot;&lt;p&gt;GPIO-2  &quot;+output2+&quot;&lt;&#x2F;p&gt;&quot;);                           if (output2&#x3D;&#x3D;&quot;off&quot;) &#123;              client.println(&quot;&lt;p&gt;&lt;a href&#x3D;\&quot;&#x2F;2&#x2F;on\&quot;&gt;&lt;button class&#x3D;\&quot;button\&quot;&gt;ON&lt;&#x2F;button&gt;&lt;&#x2F;a&gt;&lt;&#x2F;p&gt;&quot;);              client.println(&quot;&lt;p&gt;&lt;a href&#x3D;\&quot;&#x2F;2&#x2F;off\&quot;&gt;&lt;button class&#x3D;\&quot;button button2\&quot;&gt;OFF&lt;&#x2F;button&gt;&lt;&#x2F;a&gt;&lt;&#x2F;p&gt;&quot;);            &#125; else if (output2&#x3D;&#x3D;&quot;on&quot;)&#123;              client.println(&quot;&lt;p&gt;&lt;a href&#x3D;\&quot;&#x2F;2&#x2F;on\&quot;&gt;&lt;button class&#x3D;\&quot;button button2\&quot;&gt;ON&lt;&#x2F;button&gt;&lt;&#x2F;a&gt;&lt;&#x2F;p&gt;&quot;);              client.println(&quot;&lt;p&gt;&lt;a href&#x3D;\&quot;&#x2F;2&#x2F;off\&quot;&gt;&lt;button class&#x3D;\&quot;button\&quot;&gt;OFF&lt;&#x2F;button&gt;&lt;&#x2F;a&gt;&lt;&#x2F;p&gt;&quot;);            &#125;            client.println(&quot;&lt;&#x2F;body&gt;&lt;&#x2F;html&gt;&quot;);            client.println();            break;          &#125;else&#123;            currentLine&#x3D;&quot;&quot;;          &#125;        &#125;      &#125;    &#125;  header&#x3D;&quot;&quot;;  client.stop();  Serial.println(&quot;Client disconnected.&quot;);  Serial.println(&quot;&quot;);  &#125;&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="解析"><a href="#解析" class="headerlink" title="解析"></a>解析</h2><p>匯入WIFI的庫</p><pre class="line-numbers language-c#" data-language="c#"><code class="language-c#">#include &lt;WiFi.h&gt;<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>定義基地台名稱和密碼</p><pre class="line-numbers language-c#" data-language="c#"><code class="language-c#">const char* ssid&#x3D;&quot;基地台名稱&quot;;const char* password&#x3D;&quot;基地台密碼&quot;;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>定義伺服器的端口</p><pre class="line-numbers language-c#" data-language="c#"><code class="language-c#">WiFiServer server(80);<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>建立存放接數到的檔頭</p><pre class="line-numbers language-c#" data-language="c#"><code class="language-c#">String header;<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>網址列預設內建LED為off<br>例如:<a href="http://localhost/off">http://localhost/off</a></p><pre class="line-numbers language-c#" data-language="c#"><code class="language-c#">String output2&#x3D;&quot;off&quot;;<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>建立LED腳位,紀錄當下時間,和過去的時間</p><pre class="line-numbers language-c#" data-language="c#"><code class="language-c#">const int output&#x3D;2;unsigned long currentTime&#x3D;millis();unsigned long previousTime&#x3D;0;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p>主要是建立WiFi連線到基地台的初始化<br>包含伺服端的初始化,如果連線成功後,<br>會在監控視窗上顯示IP</p><pre class="line-numbers language-c#" data-language="c#"><code class="language-c#">void setup()&#123;  pinMode(output, OUTPUT);  digitalWrite(output, LOW);  WiFi.begin(ssid, password);  Serial.begin(115200);  while (WiFi.status() !&#x3D; WL_CONNECTED)  &#123;    delay(500);    Serial.print(&quot;.&quot;);  &#125;  Serial.println(&quot;已連線到基地台&quot;);  Serial.print(&quot;基地台名稱: &quot;);  Serial.println(ssid);  Serial.println(WiFi.localIP());  server.begin();&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>在void loop(){}裡面<br>先建立客服端的監聽</p><pre class="line-numbers language-c#" data-language="c#"><code class="language-c#">WiFiClient client&#x3D;server.available();<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>如果客戶端和伺服端能成功建立溝通,伺服端會一直監聽客服端所給予的請求<br>這個請求是以字串被存入變數並存放於內,如果得到on就回應開燈,女果得到off<br>就關燈</p><pre class="line-numbers language-c#" data-language="c#"><code class="language-c#">if (client)&#123;    currentTime&#x3D;millis();    previousTime&#x3D;currentTime;    Serial.println(&quot;新的客戶端&quot;);    String currentLine&#x3D;&quot;&quot;;    while (client.connected()&amp;&amp;currentTime-previousTime&lt;&#x3D;2000)    &#123;      currentTime&#x3D;millis();      if (client.available())&#123;        char c&#x3D;client.read();        Serial.write(c);        header+&#x3D;c;        if (c&#x3D;&#x3D;&#39;\n&#39;)&#123;          if (currentLine.length()&#x3D;&#x3D;0)&#123;            client.println(&quot;HTTP&#x2F;1.1 200 OK&quot;);            client.println(&quot;Content-type:text&#x2F;html&quot;);            client.println(&quot;Connection: close&quot;);            client.println();             if (header.indexOf(&quot;GET &#x2F;2&#x2F;on&quot;)&gt;&#x3D;0)&#123;              Serial.println(&quot;on&quot;);              output2&#x3D;&quot;on&quot;;              digitalWrite(output, HIGH);            &#125;else if (header.indexOf(&quot;GET &#x2F;2&#x2F;off&quot;)&gt;&#x3D;0)&#123;              Serial.println(&quot;off&quot;);              output2&#x3D;&quot;off&quot;;              digitalWrite(output, LOW);            &#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>以下是html</p><pre class="line-numbers language-html" data-language="html"><code class="language-html">client.println("<span class="token doctype"><span class="token punctuation">&lt;!</span><span class="token doctype-tag">DOCTYPE</span> <span class="token name">html</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span><span class="token punctuation">></span></span>");client.println("<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>style</span><span class="token punctuation">></span></span><span class="token style"><span class="token language-css"><span class="token selector">html</span> <span class="token punctuation">&#123;</span><span class="token property">text-align</span><span class="token punctuation">:</span> center<span class="token punctuation">;</span><span class="token property">font-family</span><span class="token punctuation">:</span> Arial<span class="token punctuation">;</span><span class="token property">display</span><span class="token punctuation">:</span> inline-block<span class="token punctuation">;</span><span class="token property">margin</span><span class="token punctuation">:</span> auto<span class="token punctuation">;</span><span class="token punctuation">&#125;</span>"<span class="token punctuation">)</span><span class="token punctuation">;</span>client.<span class="token function">println</span><span class="token punctuation">(</span><span class="token string">".button &#123;background-color: #e0e252; border: none;color: white;padding: 15px 35px;"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>client.<span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"text-align: center;text-decoration: none;display: inline-block;font-size: 16px;&#125;"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>client.<span class="token function">println</span><span class="token punctuation">(</span>".button2 <span class="token punctuation">&#123;</span><span class="token property">background-color</span><span class="token punctuation">:</span> #b0b1a2<span class="token punctuation">;</span><span class="token property">padding</span><span class="token punctuation">:</span> 15px 32px<span class="token punctuation">;</span><span class="token punctuation">&#125;</span></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>style</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>head</span><span class="token punctuation">></span></span>");client.println("<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h1</span><span class="token punctuation">></span></span>ESP32 Web Server<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h1</span><span class="token punctuation">></span></span>");client.println("<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">></span></span>GPIO-2  "+output2+"<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">></span></span>");   if (output2=="off") &#123;  client.println("<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">></span></span>&lt;a href=\"/2/on\">&lt;button class=\"button\">ON<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">></span></span>");  client.println("<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">></span></span>&lt;a href=\"/2/off\">&lt;button class=\"button button2\">OFF<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">></span></span>");&#125; else if (output2=="on")&#123;  client.println("<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">></span></span>&lt;a href=\"/2/on\">&lt;button class=\"button button2\">ON<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">></span></span>");  client.println("<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">></span></span>&lt;a href=\"/2/off\">&lt;button class=\"button\">OFF<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">></span></span>");&#125;client.println("<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">></span></span>");<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>最後完成回應,終止客戶端對伺服端的請求</p><pre class="line-numbers language-c#" data-language="c#"><code class="language-c#">client.stop();<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h2 id="實驗結果"><a href="#實驗結果" class="headerlink" title="實驗結果"></a>實驗結果</h2><div class="video-container"><iframe src="https://www.youtube.com/embed/OmbY4UQ8Kcc" frameborder="0" loading="lazy" allowfullscreen></iframe></div>]]></content>
      
      
      <categories>
          
          <category> esp32 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> webserver </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>DeepSleep深度睡眠的實驗</title>
      <link href="/2021/08/29/deepsleep-shen-du-shui-mian-de-shi-yan/"/>
      <url>/2021/08/29/deepsleep-shen-du-shui-mian-de-shi-yan/</url>
      
        <content type="html"><![CDATA[<h2 id="為什麼要讓ESP32進入深度睡眠模式"><a href="#為什麼要讓ESP32進入深度睡眠模式" class="headerlink" title="為什麼要讓ESP32進入深度睡眠模式?"></a>為什麼要讓ESP32進入深度睡眠模式?</h2><p><strong><em>其實我也是最近剛學到這一塊，所以就順手紀錄下來。</em></strong></p><p><strong><em>記得以前做過一些要電池的成品，發現放一天半左右就</em></strong></p><p><strong><em>沒電了，後來網路上搜尋相關知識才知道Arduino和esp32</em></strong></p><p><strong><em>它們都有使其進入深度睡眠的方法。</em></strong></p><p><strong><em>在深度睡眠中，可以使機板降低功耗，CPU和WIFI都會</em></strong></p><p><strong>_停止運作，只有ULP還會以最低功耗運作，雖然 ESP32 _</strong></p><p><strong><em>處於深度睡眠模式，但 RTC 記憶體也仍然處於打開狀態，</em></strong></p><p><strong><em>因此我們可以為 ULP 共同處理器編寫一個程式，並將其</em></strong></p><p><strong><em>存儲在 RTC 記憶體中以訪問週邊設備、內部定時器和內</em></strong></p><p><strong><em>部感測器。</em></strong></p><h2 id="RTC引腳"><a href="#RTC引腳" class="headerlink" title="RTC引腳"></a>RTC引腳</h2><p><strong><em>下圖黃色區塊的都可以使用RTC</em></strong></p><p><a href="https://draft.blogger.com/blog/post/edit/3809681606094011522/4527766207386106731#"><img src="https://1.bp.blogspot.com/-Ap7xbLO-MAE/YM_mR7e9KwI/AAAAAAAAeUw/rcA6j1T1gKgaLSdPPXI5A2zfn467tEIJwCNcBGAsYHQ/w694-h412/ESP32-DOIT-DEVKIT-V1-Board-Pinout-30-GPIOs-Copy.png"></a></p><hr><h2 id="喚醒模式"><a href="#喚醒模式" class="headerlink" title="喚醒模式"></a>喚醒模式</h2><h3 id="主要有種喚醒模式"><a href="#主要有種喚醒模式" class="headerlink" title="主要有種喚醒模式"></a>主要有種喚醒模式</h3><ol><li> <em><strong>定時器喚醒</strong></em></li><li> <em><strong>觸摸喚醒</strong></em></li><li> <em><strong>外部喚醒/多種不同的外部喚醒</strong></em></li><li> <em><strong>ULP喚醒</strong></em></li></ol><hr><h2 id="1-定時器喚醒模式實驗"><a href="#1-定時器喚醒模式實驗" class="headerlink" title="1.定時器喚醒模式實驗"></a>1.定時器喚醒模式實驗</h2><p><strong><em>ESP32可進入深睡模式，並預設時間喚醒</em></strong></p><pre class="line-numbers language-c#" data-language="c#"><code class="language-c#">#define us_to_s 1000000#define time__to_sleep 5  RTC_DATA_ATTR int count &#x3D; 0;  void print_wakeup_reason()&#123;  esp_sleep_wakeup_cause_t wakeup_reason;  wakeup_reason &#x3D; esp_sleep_get_wakeup_cause();  switch (wakeup_reason)  &#123;  case ESP_SLEEP_WAKEUP_EXT0:    Serial.println(&quot;Wakeup caused by external signal using RTC_IO&quot;);    break;  case ESP_SLEEP_WAKEUP_EXT1:    Serial.println(&quot;Wakeup caused by external signal using RTC_CNTL&quot;);    break;  case ESP_SLEEP_WAKEUP_TIMER:    Serial.println(&quot;Wakeup caused by timer&quot;);    break;  case ESP_SLEEP_WAKEUP_TOUCHPAD:    Serial.println(&quot;Wakeup caused by touchpad&quot;);    break;  case ESP_SLEEP_WAKEUP_ULP:    Serial.println(&quot;Wakeup caused by ULP program&quot;);    break;  default:    Serial.printf(&quot;Wakeup was not caused by deep sleep: %d\n&quot;, wakeup_reason);    break;  &#125;&#125;  void setup()&#123;  Serial.begin(115200);  delay(1000);  ++count;  Serial.println(&quot;boot num: &quot; + String(count));  print_wakeup_reason();  esp_sleep_enable_timer_wakeup(us_to_s * time_to_sleep);  delay(1000);  esp_deep_sleep_start();&#125;void loop()&#123;&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><strong>一開始設定微秒轉成秒，也可以以直接寫成</strong>TIME_TO_SLEEP  5000000</p><pre class="line-numbers language-c#" data-language="c#"><code class="language-c#">#define us_TO_s 1000000#define TIME_TO_SLEEP  5   <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p><strong>這一段是說要在RTC上保存喚醒的次數，可以在最前面加上RTC_DATA_ATTR</strong></p><p>**_<em>但是在按下EN鍵重啓這個數據會流失掉_</em>*</p><pre class="line-numbers language-c#" data-language="c#"><code class="language-c#">RTC_DATA_ATTR int count &#x3D; 0;<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p><strong>這個函式主要是設定”被換醒的原因”</strong></p><pre class="line-numbers language-none"><code class="language-none">rst:0x5 (DEEPSLEEP_RESET),boot:0x17 (SPI_FAST_FLASH_BOOT)configsip: 0, SPIWP:0xeeclk_drv:0x00,q_drv:0x00,d_drv:0x00,cs0_drv:0x00,hd_drv:0x00,wp_drv:0x00mode:DIO, clock div:2load:0x3fff0018,len:4load:0x3fff001c,len:1044load:0x40078000,len:10124load:0x40080400,len:5828entry 0x400806a8boot num: 2Wakeup caused by timerets Jun  8 2016 00:22:57  rst:0x5 (DEEPSLEEP_RESET),boot:0x17 (SPI_FAST_FLASH_BOOT)configsip: 0, SPIWP:0xeeclk_drv:0x00,q_drv:0x00,d_drv:0x00,cs0_drv:0x00,hd_drv:0x00,wp_drv:0x00mode:DIO, clock div:2load:0x3fff0018,len:4load:0x3fff001c,len:1044load:0x40078000,len:10124load:0x40080400,len:5828entry 0x400806a8boot num: 3Wakeup caused by timerets Jun  8 2016 00:22:57  rst:0x5 (DEEPSLEEP\_RESET),boot:0x17 (SPI\_FAST\_FLASH\_BOOT)configsip: 0, SPIWP:0xeeclk_drv:0x00,q_drv:0x00,d_drv:0x00,cs0_drv:0x00,hd_drv:0x00,wp_drv:0x00mode:DIO, clock div:2load:0x3fff0018,len:4load:0x3fff001c,len:1044load:0x40078000,len:10124load:0x40080400,len:5828entry 0x400806a8boot num: 4Wakeup caused by timerets Jun  8 2016 00:22:57<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><hr><p><strong>進入到void setup(){}</strong></p><p><strong>設定序列埠的波特率</strong></p><pre class="line-numbers language-c#" data-language="c#"><code class="language-c#">Serial.begin(115200);<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p><strong>每次被喚醒，count就會加1，並被印出來</strong></p><pre class="line-numbers language-c#" data-language="c#"><code class="language-c#">++count; Serial.println(&quot;Boot number: &quot;   +   String(bootCount));<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p><strong>調用剛最前方那個被喚醒的原因函式</strong></p><pre class="line-numbers language-c#" data-language="c#"><code class="language-c#">print_wakeup_reason()<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p><strong>啓用幾秒後，調用睡眠模式的函式</strong></p><pre class="line-numbers language-c#" data-language="c#"><code class="language-c#">esp_sleep_enable_timer_wakeup(TIME_TO_SLEEP * uS_TO_S_FACTOR);esp_deep_sleep_start()<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><hr><h2 id="實驗結果"><a href="#實驗結果" class="headerlink" title="實驗結果"></a>實驗結果</h2><p>紅色字體是指進入深睡模式</p><p>土黃色字體是指被喚醒的次數</p><p>深藍色字體是被喚醒的原因</p><pre class="line-numbers language-none"><code class="language-none">rst:0x5 (DEEPSLEEP\_RESET),boot:0x17 (SPI\_FAST\_FLASH\_BOOT)configsip: 0, SPIWP:0xeeclk_drv:0x00,q_drv:0x00,d_drv:0x00,cs0_drv:0x00,hd_drv:0x00,wp_drv:0x00mode:DIO, clock div:2load:0x3fff0018,len:4load:0x3fff001c,len:1044load:0x40078000,len:10124load:0x40080400,len:5828entry 0x400806a8boot num: 2Wakeup caused by timerets Jun  8 2016 00:22:57  rst:0x5 (DEEPSLEEP\_RESET),boot:0x17 (SPI\_FAST\_FLASH\_BOOT)configsip: 0, SPIWP:0xeeclk_drv:0x00,q_drv:0x00,d_drv:0x00,cs0_drv:0x00,hd_drv:0x00,wp_drv:0x00mode:DIO, clock div:2load:0x3fff0018,len:4load:0x3fff001c,len:1044load:0x40078000,len:10124load:0x40080400,len:5828entry 0x400806a8boot num: 3Wakeup caused by timerets Jun  8 2016 00:22:57  rst:0x5 (DEEPSLEEP\_RESET),boot:0x17 (SPI\_FAST\_FLASH\_BOOT)configsip: 0, SPIWP:0xeeclk_drv:0x00,q_drv:0x00,d_drv:0x00,cs0_drv:0x00,hd_drv:0x00,wp_drv:0x00mode:DIO, clock div:2load:0x3fff0018,len:4load:0x3fff001c,len:1044load:0x40078000,len:10124load:0x40080400,len:5828entry 0x400806a8boot num: 4Wakeup caused by timerets Jun  8 2016 00:22:57<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><hr><h2 id="２-觸摸喚醒實驗"><a href="#２-觸摸喚醒實驗" class="headerlink" title="２.觸摸喚醒實驗"></a>２.觸摸喚醒實驗</h2><p><a href="https://draft.blogger.com/blog/post/edit/3809681606094011522/4527766207386106731#"><img src="https://i0.wp.com/randomnerdtutorials.com/wp-content/uploads/2019/02/Zero_Touch_Wake_Up_bb.png?w=858&quality=100&strip=all&ssl=1"></a></p><p>後來我發現來在Arduino IDE裡切換到ESP32的模式下，範例裡就有DEEP SLEEP的範例可用</p><p>將範例載入後，上傳。</p><p><a href="https://draft.blogger.com/blog/post/edit/3809681606094011522/4527766207386106731#"><img src="https://1.bp.blogspot.com/-3tHh0qOHWtA/YNFMzOX5NfI/AAAAAAAAeVY/oDALi3RFu_43L-nOaPyxfx28RiB_6ypmwCNcBGAsYHQ/w603-h647/1.jpg"></a></p><pre class="line-numbers language-c#" data-language="c#"><code class="language-c#">#define Threshold 40 RTC_DATA_ATTR int bootCount &#x3D; 0;touch_pad_t touchPin;void print_wakeup_reason()&#123;  esp_sleep_wakeup_cause_t wakeup_reason;  wakeup_reason &#x3D; esp_sleep_get_wakeup_cause();  switch(wakeup_reason)  &#123;    case ESP_SLEEP_WAKEUP_EXT0 : Serial.println(&quot;Wakeup caused by external signal using RTC_IO&quot;); break;    case ESP_SLEEP_WAKEUP_EXT1 : Serial.println(&quot;Wakeup caused by external signal using RTC_CNTL&quot;); break;    case ESP_SLEEP_WAKEUP_TIMER : Serial.println(&quot;Wakeup caused by timer&quot;); break;    case ESP_SLEEP_WAKEUP_TOUCHPAD : Serial.println(&quot;Wakeup caused by touchpad&quot;); break;    case ESP_SLEEP_WAKEUP_ULP : Serial.println(&quot;Wakeup caused by ULP program&quot;); break;    default : Serial.printf(&quot;Wakeup was not caused by deep sleep: %d\\n&quot;,wakeup_reason); break;  &#125;&#125;  void print_wakeup_touchpad()&#123;  touchPin &#x3D; esp_sleep_get_touchpad_wakeup_status();  switch(touchPin)  &#123;    case 0  : Serial.println(&quot;Touch detected on GPIO 4&quot;); break;    case 1  : Serial.println(&quot;Touch detected on GPIO 0&quot;); break;    case 2  : Serial.println(&quot;Touch detected on GPIO 2&quot;); break;    case 3  : Serial.println(&quot;Touch detected on GPIO 15&quot;); break;    case 4  : Serial.println(&quot;Touch detected on GPIO 13&quot;); break;    case 5  : Serial.println(&quot;Touch detected on GPIO 12&quot;); break;    case 6  : Serial.println(&quot;Touch detected on GPIO 14&quot;); break;    case 7  : Serial.println(&quot;Touch detected on GPIO 27&quot;); break;    case 8  : Serial.println(&quot;Touch detected on GPIO 33&quot;); break;    case 9  : Serial.println(&quot;Touch detected on GPIO 32&quot;); break;    default : Serial.println(&quot;Wakeup not by touchpad&quot;); break;  &#125;&#125;void callback()&#123;&#125;void setup()&#123;  Serial.begin(115200)  delay(1000);   ++bootCount;  Serial.println(&quot;Boot number: &quot; + String(bootCount));  print_wakeup_reason();  print_wakeup_touchpad();  touchAttachInterrupt(T4, callback, Threshold);  esp_sleep_enable_touchpad_wakeup();  Serial.println(&quot;Going to sleep now&quot;);  esp_deep_sleep_start();  Serial.println(&quot;This will never be printed&quot;);&#125;void loop()&#123;&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>程式碼裡面這個是給予觸摸觸發的值</p><pre class="line-numbers language-c#" data-language="c#"><code class="language-c#">#define Threshold   40<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>當在觸摸引腳上讀取的值低於 Threshold 變量上設置的值時，ESP32 喚醒並執行回調函數。<br>Callback() 函數只有在 ESP32 處於喚醒狀態時才會執行。</p><p>所以如果是在喚醒的狀態下壓著觸摸腳不放開，並不會執行callback()回調。</p><p>如果是在睡眠狀態下碰了一下引腳馬上放開，這樣也不會執行callback()回調。</p><pre class="line-numbers language-c#" data-language="c#"><code class="language-c#">touchAttachInterrupt(T3, callback, Threshold); <span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>callback() 函數是空的</p><pre class="line-numbers language-c#" data-language="c#"><code class="language-c#">void  callback()&#123;   &#x2F;&#x2F;placeholder callback function   &#125;<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>接下來，使用 esp_sleep_enable_touchpad_wakeup() 函數將觸摸引腳設置為喚醒源。</p><p>esp_sleep_enable_touchpad_wakeup()</p><p><a href="https://draft.blogger.com/blog/post/edit/3809681606094011522/4527766207386106731#"><img src="https://lh3.googleusercontent.com/-gTuSGE2uzFA/YNFSKM2L1WI/AAAAAAAAeVg/mSIR56s4R8QZhOw7ylC3CoBbSPiYcyoygCNcBGAsYHQ/s1600/1624330763119130-0.png"></a> </p><hr><h2 id="3-外部喚醒-ext0"><a href="#3-外部喚醒-ext0" class="headerlink" title="3.外部喚醒 (ext0)"></a>3.外部喚醒 (ext0)</h2><p>要使用此喚醒，請使用以下函數：  </p><p>Esp_sleep_enable_ext0_wakeup（GPIO_NUM_X，level）<br>此函數接受您要使用的引腳作為第一個參數，格式為 GPIO_NUM_X，其中 X 表示該引腳的 GPIO 編號。  </p><p>第二個參數 level 可以是 1 或 0。這表示將觸發喚醒的 GPIO 狀態。</p><p>注意：使用此喚醒，只能使用 RTC GPIO 引腳。</p><blockquote><p><a href="https://draft.blogger.com/blog/post/edit/3809681606094011522/4527766207386106731#"><img src="https://i1.wp.com/randomnerdtutorials.com/wp-content/uploads/2019/02/external_wake_up_button_bb.png?w=1134&quality=100&strip=all&ssl=1"></a></p></blockquote><p><strong>可以在範例裡載入如下程式碼</strong></p><p><a href="https://draft.blogger.com/blog/post/edit/3809681606094011522/4527766207386106731#"><img src="https://1.bp.blogspot.com/-E9SwEIStzFc/YNKgrFbR7fI/AAAAAAAAeVo/OtrrY-gkN-QraG7XaiuSA6VUX-pik6F2wCNcBGAsYHQ/w655-h549/2.jpg"></a></p><pre class="line-numbers language-c#" data-language="c#"><code class="language-c#">&gt; &#x2F;*&gt; &gt; Deep Sleep with External Wake Up&gt; &gt; &#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&gt; &gt; This code displays how to use deep sleep with&gt; &gt; an external trigger as a wake up source and how&gt; &gt; to store data in RTC memory to use it over reboots&gt; &gt;   &gt; &gt; This code is under Public Domain License.&gt; &gt; &gt; Hardware Connections&gt; &gt; &#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&gt; &gt; Push Button to GPIO 33 pulled down with a 10K Ohm&gt; &gt; resistor&gt;&gt; &gt; NOTE:&gt; &gt; &#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&gt; &gt; Only RTC IO can be used as a source for external wake&gt; &gt; source. They are pins: 0,2,4,12-15,25-27,32-39.&gt; &gt; &gt; Author:&gt; &gt; Pranav Cherukupalli &lt;cherukupallip@gmail.com&gt;&gt; &gt; *&#x2F;&gt; &gt; &gt; #define BUTTON_PIN_BITMASK 0x200000000 &#x2F;&#x2F; 2^33 in hex&gt; &gt;   &gt; &gt; RTC_DATA_ATTR int bootCount &#x3D; 0;&gt;&gt; &gt; &#x2F;*&gt; &gt; Method to print the reason by which ESP32&gt; &gt; has been awaken from sleep&gt; &gt; *&#x2F;&gt; &gt; void print_wakeup_reason()&#123;&gt; &gt;   esp_sleep_wakeup_cause_t wakeup_reason;&gt;&gt; &gt;   wakeup_reason &#x3D; esp_sleep_get_wakeup_cause();&gt; &gt; &gt;   switch(wakeup_reason)&gt; &gt;   &#123;&gt; &gt;     case ESP_SLEEP_WAKEUP_EXT0 : Serial.println(&quot;Wakeup caused by external signal using RTC_IO&quot;); break;&gt; &gt;     case ESP_SLEEP_WAKEUP_EXT1 : Serial.println(&quot;Wakeup caused by external signal using RTC_CNTL&quot;); break;&gt; &gt;     case ESP_SLEEP_WAKEUP_TIMER : Serial.println(&quot;Wakeup caused by timer&quot;); break;&gt; &gt;     case ESP_SLEEP_WAKEUP_TOUCHPAD : Serial.println(&quot;Wakeup caused by touchpad&quot;); break;&gt; &gt;     case ESP_SLEEP_WAKEUP_ULP : Serial.println(&quot;Wakeup caused by ULP program&quot;); break;&gt; &gt;     default : Serial.printf(&quot;Wakeup was not caused by deep sleep: %d\\n&quot;,wakeup_reason); break;&gt; &gt;   &#125;&gt; &gt; &#125;&gt; &gt;   &gt; &gt; void setup()&#123;&gt; &gt;   Serial.begin(115200);&gt; &gt;   delay(1000); &#x2F;&#x2F;Take some time to open up the Serial Monitor&gt; &gt; &gt;   &#x2F;&#x2F;Increment boot number and print it every reboot&gt; &gt;   ++bootCount;&gt; &gt;   Serial.println(&quot;Boot number: &quot; + String(bootCount));&gt; &gt;   &gt;   &#x2F;&#x2F;Print the wakeup reason for ESP32&gt; &gt;   print_wakeup_reason();&gt; &gt;  &gt;   &#x2F;*&gt; &gt;   First we configure the wake up source&gt; &gt;   We set our ESP32 to wake up for an external trigger.&gt; &gt;   There are two types for ESP32, ext0 and ext1 .&gt; &gt;   ext0 uses RTC_IO to wakeup thus requires RTC peripherals&gt; &gt;   to be on while ext1 uses RTC Controller so doesnt need&gt; &gt;   peripherals to be powered on.&gt; &gt;   Note that using internal pullups&#x2F;pulldowns also requires&gt; &gt;   RTC peripherals to be turned on.&gt; &gt;   *&#x2F;&gt; &gt;   esp_sleep_enable_ext0_wakeup(GPIO_NUM_33,1); &#x2F;&#x2F;1 &#x3D; High, 0 &#x3D; Low&gt; &gt;   &gt; &gt;   &#x2F;&#x2F;If you were to use ext1, you would use it like&gt; &gt;   &#x2F;&#x2F;esp_sleep_enable_ext1_wakeup(BUTTON_PIN_BITMASK,ESP_EXT1_WAKEUP_ANY_HIGH);&gt; &gt;   &gt; &gt;   &#x2F;&#x2F;Go to sleep now&gt; &gt;   Serial.println(&quot;Going to sleep now&quot;);&gt; &gt;   esp_deep_sleep_start();&gt; &gt;   Serial.println(&quot;This will never be printed&quot;);&gt; &gt; &#125;&gt; &gt;   &gt; &gt; void loop()&#123;&gt; &gt;   &#x2F;&#x2F;This is not going to be called&gt; &gt; &#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><blockquote><p>在這個例子中，我們使用了在代碼開頭定義的變量 BUTTON_PIN_BITMASK：</p></blockquote><pre class="line-numbers language-c#" data-language="c#"><code class="language-c#">#define   BUTTON\_PIN\_BITMASK   0x200000000 &#x2F;&#x2F; 2^33 in hex<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>按鈕連接到 GPIO 33。要獲取 GPIO 33 的十六進位碼：  </p><p>計算 2的33次方,應該得到 8589934592,將該數字 (8589934592) 轉換為十六進制。您可以轉到此轉換器來執行此操作。</p><pre class="line-numbers language-c#" data-language="c#"><code class="language-c#">esp_sleep_enable_ext0_wakeup(GPIO_NUM_33,1);   &#x2F;&#x2F;1 &#x3D; High, 0 &#x3D; Low<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>＃可以使用任何其他 RTC GPIO 引腳來代替 GPIO 33</p><div class="video-container"><iframe src="https://www.youtube.com/embed/twRIlLu60Y0" frameborder="0" loading="lazy" allowfullscreen></iframe></div><hr><h2 id="4-外部喚醒-ext1"><a href="#4-外部喚醒-ext1" class="headerlink" title="4.外部喚醒 (ext1)"></a>4.外部喚醒 (ext1)</h2><p>在這裡不使用esp_sleep_enable_ext0_wakeup()，而是使用</p><pre class="line-numbers language-c#" data-language="c#"><code class="language-c#">esp_sleep_enable_ext1_wakeup()&#96;&#96;&#96;c#&#x2F;*Deep Sleep with External Wake Up&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;This code displays how to use deep sleep withan external trigger as a wake up source and howto store data in RTC memory to use it over reboots  This code is under Public Domain License.  Hardware Connections&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;Push Button to GPIO 33 pulled down with a 10K Ohmresistor  NOTE:&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;Only RTC IO can be used as a source for external wakesource. They are pins: 0,2,4,12-15,25-27,32-39.  Author:Pranav Cherukupalli &lt;cherukupallip@gmail.com&gt;*&#x2F;#define BUTTON_PIN_BITMASK 0x8004 &#x2F;&#x2F; GPIOs 2 and 15RTC_DATA_ATTR int bootCount &#x3D; 0;&#x2F;*Method to print the reason by which ESP32has been awaken from sleep*&#x2F;void print_wakeup_reason()&#123;  esp_sleep_wakeup_cause_t wakeup_reason;  wakeup_reason &#x3D; esp_sleep_get_wakeup_cause();  switch(wakeup_reason)  &#123;    case ESP_SLEEP_WAKEUP_EXT0 : Serial.println(&quot;Wakeup caused by external signal using RTC_IO&quot;); break;    case ESP_SLEEP_WAKEUP_EXT1 : Serial.println(&quot;Wakeup caused by external signal using RTC_CNTL&quot;); break;    case ESP_SLEEP_WAKEUP_TIMER : Serial.println(&quot;Wakeup caused by timer&quot;); break;    case ESP_SLEEP_WAKEUP_TOUCHPAD : Serial.println(&quot;Wakeup caused by touchpad&quot;); break;    case ESP_SLEEP_WAKEUP_ULP : Serial.println(&quot;Wakeup caused by ULP program&quot;); break;    default : Serial.printf(&quot;Wakeup was not caused by deep sleep: %d\\n&quot;,wakeup_reason); break;  &#125;&#125;&#x2F;*Method to print the GPIO that triggered the wakeup*&#x2F;void print_GPIO_wake_up()&#123;  uint64_t GPIO_reason &#x3D; esp_sleep_get_ext1_wakeup_status();  Serial.print(&quot;GPIO that triggered the wake up: GPIO &quot;);  Serial.println((log(GPIO_reason))&#x2F;log(2), 0);&#125;void setup()&#123;  Serial.begin(115200);  delay(1000); &#x2F;&#x2F;Take some time to open up the Serial Monitor    &#x2F;&#x2F;Increment boot number and print it every reboot  ++bootCount;  Serial.println(&quot;Boot number: &quot; + String(bootCount));    &#x2F;&#x2F;Print the wakeup reason for ESP32  print_wakeup_reason();    &#x2F;&#x2F;Print the GPIO used to wake up  print\_GPIO\_wake_up();  &#x2F;*  First we configure the wake up source  We set our ESP32 to wake up for an external trigger.  There are two types for ESP32, ext0 and ext1 .  ext0 uses RTC_IO to wakeup thus requires RTC peripherals  to be on while ext1 uses RTC Controller so doesnt need  peripherals to be powered on.  Note that using internal pullups&#x2F;pulldowns also requires  RTC peripherals to be turned on.  *&#x2F;  &#x2F;&#x2F;esp_deep_sleep_enable_ext0_wakeup(GPIO\_NUM_15,1); &#x2F;&#x2F;1 &#x3D; High, 0 &#x3D; Low    &#x2F;&#x2F;If you were to use ext1, you would use it like  esp_sleep_enable_ext1_wakeup(BUTTON_PIN_BITMASK,ESP_EXT1_WAKEUP_ANY_HIGH);  &#x2F;&#x2F;Go to sleep now  Serial.println(&quot;Going to sleep now&quot;);  delay(1000);  esp_deep_sleep_start();  Serial.println(&quot;This will never be printed&quot;);&#125;  void loop()&#123;  &#x2F;&#x2F;This is not going to be called&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><strong>0x8004怎麼來的?</strong></p><p>計算 2^2 + 2^15。你應該得到 32772</p><p>將該數字轉換為十六進制。你應該得到：8004</p><p>在這個例子中，我們使用了在代碼開頭定義的變量 BUTTON_PIN_BITMASK</p><pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">BUTTON_PIN_BITMASK</span>   <span class="token expression"><span class="token number">0x8004</span></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>當您使用多個引腳來喚醒 ESP32 時，知道是哪個引腳引起了喚醒是很有用的。為此，您可以使用以下功能：</p><pre class="line-numbers language-c#" data-language="c#"><code class="language-c#">esp_sleep_get_ext1_wakeup_status()<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>該函數返回一個基數2，與GPIO號碼作為指數：2 ^（GPIO_NUMBER）。因此，在小數得到GPIO，你需要做以下計算：</p><pre class="line-numbers language-c#" data-language="c#"><code class="language-c#">GPIO &#x3D; log(GPIO_NUMBER)&#x2F;log(2)<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p><strong>其它程式碼如同前面試驗</strong></p><p><a href="https://draft.blogger.com/blog/post/edit/3809681606094011522/4527766207386106731#"><img src="https://i1.wp.com/randomnerdtutorials.com/wp-content/uploads/2019/02/external_wake_up_2buttons_bb.png?w=984&quality=100&strip=all&ssl=1"></a></p><p><strong>將程式碼上傳後可以看到按壓哪個GPIO會顯示在監測窗口</strong></p><p><a href="https://draft.blogger.com/blog/post/edit/3809681606094011522/4527766207386106731#"><img src="https://1.bp.blogspot.com/-YanqfR__Opo/YNWKA45FOQI/AAAAAAAAeWE/pkp3y8n5qa8WHrloC2ZCECaWWHN5kTwuACNcBGAsYHQ/w674-h314/1.jpg"></a></p>]]></content>
      
      
      <categories>
          
          <category> esp32 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> deep sleep </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>DHT11/DHT12溫溼度傳感器實驗</title>
      <link href="/2021/08/29/dht11-dht12-wen-shi-du-chuan-gan-qi-shi-yan/"/>
      <url>/2021/08/29/dht11-dht12-wen-shi-du-chuan-gan-qi-shi-yan/</url>
      
        <content type="html"><![CDATA[<h1 id="DHT11-DHT12溫溼度傳感器實驗"><a href="#DHT11-DHT12溫溼度傳感器實驗" class="headerlink" title="DHT11/DHT12溫溼度傳感器實驗"></a>DHT11/DHT12溫溼度傳感器實驗</h1><h6 id="tags-esp32-dht11-dht12"><a href="#tags-esp32-dht11-dht12" class="headerlink" title="tags: esp32 dht11/dht12"></a>tags: <code>esp32</code> <code>dht11/dht12</code></h6><p> <strong>參考網址</strong>-[<a href="https://randomnerdtutorials.com/esp32-dht11-dht22-temperature-humidity-sensor-arduino-ide/]">https://randomnerdtutorials.com/esp32-dht11-dht22-temperature-humidity-sensor-arduino-ide/]</a>(<a href="https://draft.blo/">https://draft.blo</a> gger.com/blog/post/edit/3809681606094011522/8795709619283851665?hl=zh-TW#)</p><p><em>溫溼度傳感器在控制板學習裡是必備入門實作的課題</em></p><p><em>它包含DHT11/DHT12這兩種形式,這些傳感器包含一個</em></p><p><em>芯片，可以進行模擬到數字的轉換，並輸出帶有溫度和濕度</em></p><p><em>的數字信號。這使得它們很容易與任何微控制器一起使用。</em></p><p>_DHT11 和 DHT22 非常相似，但它們的規格不同。</p><hr><p>_DHT11 的範圍更小，精度也更低。但是，您可以每秒請求傳感器讀數。它也便宜一點。<br>_</p><p><em>DHT22傳感器具有更好的分辨率和更寬的溫濕度測量範圍。但是，它有點貴，並且您</em></p><p><em>只能以 2 秒的間隔請求讀數。</em></p><h2 id="接腳"><a href="#接腳" class="headerlink" title="接腳"></a>接腳</h2><p><em>DHT 傳感器有四個引腳，如下圖所示。但是，如果您將 DHT 傳感器安裝在分線板中，則它只有三個引腳，並且在引腳 2 上帶有一個內部上拉電阻。</em></p><p><a href="https://draft.blogger.com/blog/post/edit/3809681606094011522/8795709619283851665?hl=zh-TW#"><img src="https://i2.wp.com/randomnerdtutorials.com/wp-content/uploads/2019/04/dht22-pinout.png?resize=138,300&quality=100&strip=all&ssl=1"></a></p><p><em>下表顯示了 DHT22/DHT11 引腳排列。當傳感器面向您時，引腳編號從左到右從 1 開始</em></p><p>| DHT pin | Connect to |<br>| 1 | 3.3V |<br>| 2 | Any digital GPIO; also connect a 10k Ohm pull-up resistor |<br>| 3 | Don’t connect |<br>| 4 | GND |</p><h2 id="所須材料"><a href="#所須材料" class="headerlink" title="所須材料"></a>所須材料</h2><ul><li>  ESP32</li><li>  DHT11或DHT22溫濕度傳感器</li><li>  10k 歐姆電阻</li><li>  麵包板</li><li>  跳線</li></ul><hr><h2 id="接線圖"><a href="#接線圖" class="headerlink" title="接線圖"></a>接線圖</h2><p><a href="https://draft.blogger.com/blog/post/edit/3809681606094011522/8795709619283851665?hl=zh-TW#"><img src="https://i0.wp.com/randomnerdtutorials.com/wp-content/uploads/2019/04/dht_esp32_bb.png?w=714&quality=100&strip=all&ssl=1"></a></p><hr><p>下載所須的函式庫</p><p><a href="https://draft.blogger.com/blog/post/edit/3809681606094011522/8795709619283851665?hl=zh-TW#">Adafruit_Sensor</a>  </p><p>匯入範例檔</p><pre class="line-numbers language-c#" data-language="c#"><code class="language-c#">#include &lt;Adafruit_Sensor.h&gt;#include &lt;DHT.h&gt;#include &lt;DHT_U.h&gt;  #define DHTPIN 4     &#x2F;&#x2F; Digital pin connected to the DHT sensor &#x2F;&#x2F; Feather HUZZAH ESP8266 note: use pins 3, 4, 5, 12, 13 or 14 --&#x2F;&#x2F; Pin 15 can work but DHT must be disconnected during program upload.  &#x2F;&#x2F; Uncomment the type of sensor in use:#define DHTTYPE DHT11     &#x2F;&#x2F; DHT 11&#x2F;&#x2F;#define DHTTYPE    DHT22     &#x2F;&#x2F; DHT 22 (AM2302)&#x2F;&#x2F;#define DHTTYPE    DHT21     &#x2F;&#x2F; DHT 21 (AM2301)  &#x2F;&#x2F; See guide for details on sensor wiring and usage:&#x2F;&#x2F;   https:&#x2F;&#x2F;learn.adafruit.com&#x2F;dht&#x2F;overview  DHT_Unified dht(DHTPIN, DHTTYPE);  uint32_t delayMS;  void setup() &#123;  Serial.begin(115200);  &#x2F;&#x2F; Initialize device.  dht.begin();&#125;  void loop() &#123;  &#x2F;&#x2F; Delay between measurements.  delay(2000);  &#x2F;&#x2F; Get temperature event and print its value.  sensors\_event\_t event;  dht.temperature().getEvent(&amp;event);  if (isnan(event.temperature)) &#123;    Serial.println(F(&quot;Error reading temperature!&quot;));  &#125;  else &#123;    Serial.print(F(&quot;Temperature: &quot;));    Serial.print(event.temperature);    Serial.println(F(&quot;°C&quot;));  &#125;  &#x2F;&#x2F; Get humidity event and print its value.  dht.humidity().getEvent(&amp;event);  if (isnan(event.relative_humidity)) &#123;    Serial.println(F(&quot;Error reading humidity!&quot;));  &#125;  else &#123;    Serial.print(F(&quot;Humidity: &quot;));    Serial.print(event.relative_humidity);    Serial.println(F(&quot;%&quot;));  &#125;&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><hr><p><a href="https://draft.blogger.com/blog/post/edit/3809681606094011522/8795709619283851665?hl=zh-TW#"><img src="https://1.bp.blogspot.com/-5Zp3nVebHME/YOPu0xLelvI/AAAAAAAAeZY/hXFOvxMB5WYGya2btew2FDpecuWGw4oUQCNcBGAsYHQ/w510-h226/DHT-C.jpg"></a></p>]]></content>
      
      
      <categories>
          
          <category> esp32 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> dht11/dht12 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>超音波&amp;0.96OLED-ESP32</title>
      <link href="/2021/08/29/chao-yin-bo-0-96oled-esp32/"/>
      <url>/2021/08/29/chao-yin-bo-0-96oled-esp32/</url>
      
        <content type="html"><![CDATA[<h1 id="超音波-amp-0-96OLED-ESP32"><a href="#超音波-amp-0-96OLED-ESP32" class="headerlink" title="超音波&amp;0.96OLED-ESP32"></a>超音波&amp;0.96OLED-ESP32</h1><h6 id="tags-esp32-HC-SR04-超音波模組"><a href="#tags-esp32-HC-SR04-超音波模組" class="headerlink" title="tags: esp32 HC-SR04 超音波模組"></a>tags: <code>esp32</code> <code>HC-SR04</code> <code>超音波模組</code></h6><p><strong>0.96OLED實作參考</strong>-<a href="https://draft.blogger.com/blog/post/edit/3809681606094011522/4510305853656321015#">https://esp32-blairan.blogspot.com/2021/05/091oled-esp32.html</a></p><p><strong>超音波(Arduino)實作參考</strong>-<a href="https://draft.blogger.com/blog/post/edit/3809681606094011522/4510305853656321015#">https://blairandreamwork.blogspot.com/2021/05/hc-sr04.html</a></p><p><strong>超音波和Arduino上的模組大同小義,不過我使用的模組比一般簡單多了,省去</strong></p><p><strong>計算,直接呼叫函式就能取得inc和cm。</strong></p><h2 id="接線"><a href="#接線" class="headerlink" title="接線"></a>接線</h2><p><a href="https://draft.blogger.com/blog/post/edit/3809681606094011522/4510305853656321015#"><img src="https://1.bp.blogspot.com/-vO1z_SK7Oh8/YOfhLRPWtII/AAAAAAAAeaw/vccMexvBlicqE1OUOSTG8UonqgV6fIe6wCNcBGAsYHQ/w698-h338/%25E4%25B8%258B%25E8%25BC%2589.jpg"></a></p><p>————————–      ———————     </p><p>//  * | HC-SC04 | ESP32  |     |  OLED | ESP32 |</p><p>//  * ———————     ———————     </p><p>//  * |   Vcc   |   3.3V  |     | Vcc | 3.3V |</p><p>//  * |   Trig  |   32    |     | Gnd | GND |</p><p>//  * |   Echo  |   33    |     | SCL | 21 |</p><p>//  * |   Gnd   |   GND   |     | SDA | 22 |</p><p>//  * --------------------- ———————-</p><hr><h2 id="程式碼"><a href="#程式碼" class="headerlink" title="程式碼"></a>程式碼</h2><pre class="line-numbers language-c#" data-language="c#"><code class="language-c#">#include &lt;Ultrasonic.h&gt;#include &lt;Adafruit_SSD1306.h&gt;#include &lt;Adafruit_GFX.h&gt;#include &lt;Adafruit_GrayOLED.h&gt;#include &lt;Wire.h&gt;Ultrasonic ultrasonic1(32, 33); &#x2F;&#x2F;ultrasonic(trig, echo)#define SCREEN_WIDTH 128#define SCREEN_HEIGHT 64#define OLED_RESET -1Adafruit_SSD1306 display(SCREEN_WIDTH, SCREEN_HEIGHT, &amp;Wire, OLED_RESET);void setup()&#123;    Serial.begin(115200);    display.begin(SSD1306_SWITCHCAPVCC, 0x3C, OLED_RESET);&#125;void loop()&#123;    unsigned int distance&#x3D;ultrasonic1.read(CM);    Serial.print(distance); Serial.println(&quot; CM&quot;);    display.clearDisplay();    display.setTextSize(3);    display.setTextColor(WHITE);    display.setCursor(0, 20);    display.print(distance);    display.setTextSize(2);    display.setCursor(60, 40);    display.println(&quot;CM&quot;);    display.display();    delay(500);&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><strong><em>這個模組是呼吸超音波用的</em></strong></p><pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;Ultrasonic.h></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p><strong><em>這些是OLED使用的模組</em></strong></p><pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;Adafruit_SSD1306.h></span></span><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;Adafruit_GFX.h></span></span><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;Adafruit_GrayOLED.h></span></span><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;Wire.h></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><strong><em>設制超音波腳位</em></strong></p><pre class="line-numbers language-c#" data-language="c#"><code class="language-c#">Ultrasonic ultrasonic1(32, 33); &#x2F;&#x2F;ultrasonic(trig, echo)<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p><strong><em>定義oled所須參數</em></strong></p><pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">SCREEN_WIDTH</span> <span class="token expression"><span class="token number">128</span></span></span><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">SCREEN_HEIGHT</span> <span class="token expression"><span class="token number">64</span></span></span><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">OLED_RESET</span> <span class="token expression"><span class="token operator">-</span><span class="token number">1</span></span></span>Adafruit_SSD1306 <span class="token function">display</span><span class="token punctuation">(</span>SCREEN_WIDTH<span class="token punctuation">,</span> SCREEN_HEIGHT<span class="token punctuation">,</span> <span class="token operator">&amp;</span>Wire<span class="token punctuation">,</span> OLED_RESET<span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><em><strong>初始化</strong></em></p><pre class="line-numbers language-c#" data-language="c#"><code class="language-c#">void setup()&#123;    Serial.begin(115200);    display.begin(SSD1306_SWITCHCAPVCC, 0x3C, OLED_RESET);&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><p>void loop(){}裡面</p><p><em><strong>讀取超音波數質並賦予變數</strong></em></p><pre class="line-numbers language-c#" data-language="c#"><code class="language-c#">unsigned int distance&#x3D;ultrasonic1.read(CM);<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p><strong>其中</strong></p><pre class="line-numbers language-c#" data-language="c#"><code class="language-c#">setTextSize(3),setTextColor(WHITE),setCursor(0, 20),display.display()<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><p><em><strong>一定要有,要不然不會顯示於OLED上</strong></em></p><pre class="line-numbers language-c#" data-language="c#"><code class="language-c#">display.clearDisplay();    display.setTextSize(3);    display.setTextColor(WHITE);    display.setCursor(0, 20);    display.print(distance);    display.setTextSize(2);    display.setCursor(60, 40);    display.println(&quot;CM&quot;);    display.display();    delay(500);<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><div class="video-container"><iframe src="https://www.youtube.com/embed/HDNld7TiiFQ" frameborder="0" loading="lazy" allowfullscreen></iframe></div>]]></content>
      
      
      <categories>
          
          <category> esp32 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 超音波模組 </tag>
            
            <tag> HC-SC04 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>DHT11/12網路監測-ESP32</title>
      <link href="/2021/08/29/dht11-12-wang-lu-jian-ce-esp32/"/>
      <url>/2021/08/29/dht11-12-wang-lu-jian-ce-esp32/</url>
      
        <content type="html"><![CDATA[<head>  <meta charset="utf-8" />  <meta name="viewport" content="width=device-width, initial-scale=1.0" />  <style>    h1  {text-align: center; background-color: orange; margin-right:5px;}    dl { width: 320px; margin: 12px auto; }    dt {       font-size: 20pt; color: #444; background-color: #ddd;      margin: 6pt 0; padding: 6pt 12pt;    }    dd {      text-align: right; padding-right: 6pt;    }    .num { font-size: 36pt; color: dodgerblue; }  </style>  </head><body>  <p><h1>ESP32 溫溼度顯示計</h1></p>  <dl>    <dt>溫度</dt>    <dd class=num>%TEMP% °C</dd>    <dt>濕度</dt>    <dd class=num>%HUMI% %</dd>  </dl></body></html><p>)===”;</p><hr><p><strong><em>其中有兩個函式一個是readTemp()和readHumi()是讀取溫度和濕度</em></strong></p><pre class="line-numbers language-c#" data-language="c#"><code class="language-c#">String readTemp()&#123;  dht.temperature().getEvent(&amp;event);  if (isnan(event.temperature)) &#123;    Serial.println(F(&quot;Error reading temperature!&quot;));    return &quot;--&quot;;  &#125;  else &#123;    Serial.print(F(&quot;Temperature: &quot;));    Serial.print(float(event.temperature));    Serial.println(F(&quot;°C&quot;));    return String(float(event.temperature));  &#125;&#125;String readHumi()&#123;  dht.humidity().getEvent(&amp;event);  if (isnan(event.relative_humidity)) &#123;    Serial.println(F(&quot;Error reading humidity!&quot;));    return &quot;--&quot;;  &#125;  else &#123;    Serial.print(F(&quot;Humidity: &quot;));    Serial.print(float(event.relative_humidity));    Serial.println(F(&quot;%&quot;));    return String(float(event.relative_humidity));  &#125;&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><strong><em>這個函式意指如果讀到網頁請求的字串是TEMP就回傳readTemp()裡的溫度數值以字串回傳</em></strong></p><p><strong><em>如果網頁請求的字串是HUMI就回傳readHumi()裡的濕度數值並以字串回傳</em></strong></p><pre class="line-numbers language-c#" data-language="c#"><code class="language-c#">String tmplProcessor(const String &amp; var)&#123;  if (var &#x3D;&#x3D; &quot;TEMP&quot;)&#123;    return readTemp();  &#125;else if (var &#x3D;&#x3D; &quot;HUMI&quot;)&#123;    return readHumi();  &#125;  return String();&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><strong><em>在void stup(){ }裡</em></strong></p><p><strong><em>先把esp32連到基地台的設制寫好</em></strong></p><pre class="line-numbers language-c#" data-language="c#"><code class="language-c#">Serial.begin(115200);dht.begin();WiFi.begin(ssid, password); Serial.print(&quot;基地台名稱: &quot;); Serial.println(ssid);while (WiFi.status() !&#x3D; WL_CONNECTED)&#123;   delay(1000);   Serial.println(&quot;.&quot;);&#125;Serial.print(&quot;IP: &quot;); Serial.println(WiFi.localIP());<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><strong><em>剩下就是伺服器的回應方式</em></strong></p><pre class="line-numbers language-c#" data-language="c#"><code class="language-c#">server.on(&quot;&#x2F;&quot;, HTTP_GET, [](AsyncWebServerRequest *request)&#123;    request-&gt;send_P(200, &quot;text&#x2F;html&quot;, indexHtml, tmplProcessor);&#125;);server.on(&quot;&#x2F;TEMP&quot;, HTTP_GET, [](AsyncWebServerRequest *request)&#123;    request-&gt;send_P(200, &quot;text&#x2F;plain&quot;, readTemp().c_str());  &#125;);server.on(&quot;&#x2F;HUMI&quot;, HTTP_GET, [](AsyncWebServerRequest *request)&#123;    request-&gt;send_P(200, &quot;text&#x2F;plain&quot;, readHumi().c_str());  &#125;);server.begin();<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><hr><p><strong><em>程式碼上傳後可以看在顯示的ip打開瀏覽器就會呈現如下:</em></strong></p><p><a href="https://draft.blogger.com/blog/post/edit/3809681606094011522/7172775240521960034?hl=zh-TW#"><img src="https://lh3.googleusercontent.com/-qC9CxO4i-Xc/YOZFdnar8PI/AAAAAAAAeaI/R8u1hTYwETYdszDZYvxurjlFGHujuNH6QCNcBGAsYHQ/s1600/1625703786581523-0.png"></a></p><p><a href="https://draft.blogger.com/blog/post/edit/3809681606094011522/7172775240521960034?hl=zh-TW#"><img src="https://1.bp.blogspot.com/-oOSgkfavhws/YOWz-Awpe-I/AAAAAAAAeZk/izEsvNIimRAk01_oxk-CKIQGdiK3c57YQCNcBGAsYHQ/w638-h349/1.jpg"></a></p>]]></content>
      
      
      <categories>
          
          <category> esp32 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> dht11/dht12 </tag>
            
            <tag> webserver </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>BMP280氣壓,溫度模組-ESP32</title>
      <link href="/2021/08/29/bmp280-qi-ya-wen-du-mo-zu-esp32/"/>
      <url>/2021/08/29/bmp280-qi-ya-wen-du-mo-zu-esp32/</url>
      
        <content type="html"><![CDATA[<h1 id="BMP280氣壓-溫度模組-ESP32"><a href="#BMP280氣壓-溫度模組-ESP32" class="headerlink" title="BMP280氣壓,溫度模組-ESP32"></a>BMP280氣壓,溫度模組-ESP32</h1><h6 id="tags-esp32-bmp280"><a href="#tags-esp32-bmp280" class="headerlink" title="tags: esp32 bmp280"></a>tags: <code>esp32</code> <code>bmp280</code></h6><p><a href="https://draft.blogger.com/blog/post/edit/3809681606094011522/2010016947036646160#"><img src="https://1.bp.blogspot.com/-4LdM2J8lnOY/YPV1dYnda-I/AAAAAAAAecQ/OXHYgyYLfkgCzpZzyPV9wC_xhR4CiLv2ACNcBGAsYHQ/s320/21805656779815_796.jpg"></a></p><p>**_BMP280,該傳感器可以非常準確地測量氣壓和溫度。  </p><p>您可以使用 I2C 或 SPI 連接協議將其與您的 Arduino 板連接。它有一個 3.3V 穩壓器和電平轉換，因此您可以毫無問題地將它與 3V 或 5V 邏輯微控制器一起使用。_**</p><hr><h2 id="接線"><a href="#接線" class="headerlink" title="接線"></a>接線</h2><p>*<strong>網路上很多教學都沒有說SDO要接VCC,因為我一開始是</strong></p><p><strong>沒有接,發現一直顯示找不到Addr,後來查一下國外有人說</strong></p><p><strong>接上去才會找的到位址。</strong></p><p>| BME280       | ESP32 |</p><p>| <strong>SDO–&gt;VCC</strong>|<br> |<br>| <strong>VCC</strong>———-| 3.3V |<br>| <strong>GND</strong>———| GND |<br>| <strong>SCL</strong>———-| GPIO 22 |<br>| <strong>SDA</strong>———| GPIO 21 |</p><p>There are other versions of this sensor that can use either SPI or I2C communication protocols, like the module shown in the next figure:</p><p><a href="https://draft.blogger.com/blog/post/edit/3809681606094011522/2010016947036646160#"><img src="https://1.bp.blogspot.com/-_kyGe2Iyy2E/YPV2DIT7ndI/AAAAAAAAecY/FaJYnuihXPEGxJyZgeP-KK2B7mx4DkzEgCNcBGAsYHQ/w653-h310/1.jpg"></a></p><hr><h2 id="下載函式庫"><a href="#下載函式庫" class="headerlink" title="下載函式庫"></a>下載函式庫</h2><p><a href="https://draft.blogger.com/blog/post/edit/3809681606094011522/2010016947036646160#">Adafruit_BME280_Library</a>  </p><p><a href="https://draft.blogger.com/blog/post/edit/3809681606094011522/2010016947036646160#">Adafruit_Sensor</a>  </p><p>將上面兩個檔解壓後,整個資料夾放入Arduino的library裡</p><hr><p>打開Arduino IDE–&gt;<strong><em>檔案</em></strong> &gt; <strong><em>範例</em></strong>&gt; <em>Adafruit BME280 library</em> &gt; <em>bme280 test</em></p><p>將此程式碼上傳</p><pre class="line-numbers language-c#" data-language="c#"><code class="language-c#">#include &lt;Wire.h&gt;#include &lt;SPI.h&gt;#include &lt;Adafruit_BMP280.h&gt;#define BMP_SCK  (13)#define BMP_MISO (12)#define BMP_MOSI (11)#define BMP_CS   (10)Adafruit_BMP280 bmp; &#x2F;&#x2F; I2C&#x2F;&#x2F;Adafruit_BMP280 bmp(BMP_CS); &#x2F;&#x2F; hardware SPI&#x2F;&#x2F;Adafruit_BMP280 bmp(BMP_CS, BMP_MOSI, BMP_MISO,  BMP_SCK);void setup() &#123; Serial.begin(9600); Serial.println(F(&quot;BMP280 test&quot;));  &#x2F;&#x2F;if (!bmp.begin(BMP280_ADDRESS_ALT, BMP280_CHIPID)) &#123; if (!bmp.begin()) &#123;    Serial.println(F(&quot;Could not find a valid BMP280 sensor, check wiring or &quot;    &quot;try a different address!&quot;)); while (1) delay(10);  &#125;    &#x2F;* Default settings from datasheet. *&#x2F; bmp.setSampling(Adafruit_BMP280::MODE_NORMAL,     &#x2F;* Operating Mode. *&#x2F; Adafruit_BMP280::SAMPLING_X2,     &#x2F;* Temp. oversampling *&#x2F; Adafruit_BMP280::SAMPLING_X16,    &#x2F;* Pressure oversampling *&#x2F; Adafruit_BMP280::FILTER_X16,      &#x2F;* Filtering. *&#x2F; Adafruit_BMP280::STANDBY_MS_500); &#x2F;* Standby time. *&#x2F;&#125;  void loop() &#123; Serial.print(F(&quot;Temperature &#x3D; &quot;)); Serial.print(bmp.readTemperature()); Serial.println(&quot; *C&quot;); Serial.print(F(&quot;Pressure &#x3D; &quot;)); Serial.print(bmp.readPressure()); Serial.println(&quot; Pa&quot;); Serial.print(F(&quot;Approx altitude &#x3D; &quot;)); Serial.print(bmp.readAltitude(1013.25)); &#x2F;* Adjusted to local forecast! *&#x2F; Serial.println(&quot; m&quot;); Serial.println(); delay(2000);&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><hr><p><a href="https://draft.blogger.com/blog/post/edit/3809681606094011522/2010016947036646160#"><img src="https://1.bp.blogspot.com/-uuCjmn1O69U/YPYNTBw5lXI/AAAAAAAAecg/PdiElAnsgXY-m87_nbhB_nYmHrFE8svHQCNcBGAsYHQ/w488-h261/bmp280-val.jpg"></a></p>]]></content>
      
      
      <categories>
          
          <category> esp32 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> bmp280 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>BMP280+ThingSpeak IoT</title>
      <link href="/2021/08/29/bmp280-thingspeak-iot/"/>
      <url>/2021/08/29/bmp280-thingspeak-iot/</url>
      
        <content type="html"><![CDATA[<h1 id="BMP280-ThingSpeak-IoT"><a href="#BMP280-ThingSpeak-IoT" class="headerlink" title="BMP280+ThingSpeak IoT"></a>BMP280+ThingSpeak IoT</h1><h6 id="tags-esp32-thingspeak-bmp280"><a href="#tags-esp32-thingspeak-bmp280" class="headerlink" title="tags: esp32 thingspeak bmp280"></a>tags: <code>esp32</code> <code>thingspeak</code> <code>bmp280</code></h6><p><em>ESP32真的是個方便又神奇的版子，3個月前我還在猶豫要不要跨足</em></p><p><em>研究ESP32，帶著一份不安的心，買了一些書開始學，至今約三個月</em></p><p><em>，覺得之前有玩Arduino因為語言相通，省去了一些時間，只是比較</em></p><p><em>略顯不足的是esp32沒有5V倒是有點可惜，另外我覺得優勢是內建WIFI</em></p><p><em>和藍芽，不用又外接，並且也支援mpython，這讓我無形中不會因為只</em></p><p><em>玩esp32用了C語言，而忘了Python。</em></p><hr><p>今天呢就心血來潮想玩一下云端數據圖形化，之前看了很多網上大神們</p><p>都有提及ThingSpeak這個和感測器結合一起用，昨天剛研究了BMP280剛好</p><p>可以派上用場。</p><p>筆記連結—<a href="https://draft.blogger.com/blog/post/edit/3809681606094011522/849309138521769078#">BMP280氣壓,溫度模組-ESP32</a></p><p><em><strong>這裡就直接接結合WIFI和ThingSpeak IoT的使用</strong></em></p><h2 id="如何申請ThingSpeak"><a href="#如何申請ThingSpeak" class="headerlink" title="如何申請ThingSpeak"></a>如何申請ThingSpeak</h2><p><strong><em>如何申請</em></strong><em><strong>ThingSpeak IoT帳號-<a href="https://draft.blogger.com/blog/post/edit/3809681606094011522/849309138521769078#">http://web.htjh.tp.edu.tw/B4/106iot/ThingSpeak%E7%89%A9%E8%81%AF%E7%B6%B2%E5%B9%B3%E5%8F%B0.pdf</a></strong></em></p><p>_</p><hr><p>_<strong>以下因節省時間，引用別的作者的文章，出處</strong>—<a href="https://draft.blogger.com/blog/post/edit/3809681606094011522/849309138521769078#">https://randomnerdtutorials.com/esp32-thingspeak-publish-arduino/</a></p><p>**轉到 ThingSpeak，然後單擊“免費入門”按鈕創建一個新帳戶。此帳戶與 Mathworks 帳戶相關聯。因此，如果您已有 Mathworks 帳戶，則應使用該帳戶登錄。  </p><p>創建新頻道<br>帳戶準備好後，登錄，打開“頻道”標籤並選擇“我的頻道”。**</p><p><a href="https://draft.blogger.com/blog/post/edit/3809681606094011522/849309138521769078#"><img src="https://lh3.googleusercontent.com/-XzTxSCPscZ0/YPa4xM-M8vI/AAAAAAAAedA/zy3dDY4cQDMSnSWEP6fOfBxrGtOgNea6wCNcBGAsYHQ/w437-h257/image.png"></a></p><p><strong>按“新頻道”按鈕創建一個新頻道。</strong></p><p><a href="https://draft.blogger.com/blog/post/edit/3809681606094011522/849309138521769078#"><img src="https://lh3.googleusercontent.com/-MJJR2oVyJQk/YPa45d0cVHI/AAAAAAAAedE/b4Qqx0Wvn7M8szBtL9iXxVv7XkY3g8KHACNcBGAsYHQ/w481-h346/image.png"></a></p><p><strong>為您的頻道輸入名稱並添加說明。</strong></p><p><a href="https://draft.blogger.com/blog/post/edit/3809681606094011522/849309138521769078#"><img src="https://lh3.googleusercontent.com/-7eVycTiCOuQ/YPa5Gv1-SJI/AAAAAAAAedM/Q1KRU-Rqu98pbo5kkSlP8yvRTnR_zCxoACNcBGAsYHQ/w481-h325/image.png"></a></p><p><strong>可以自定義圖表，轉到您的私人視圖選項卡，然後單擊編輯圖標。</strong></p><p><a href="https://draft.blogger.com/blog/post/edit/3809681606094011522/849309138521769078#"><img src="https://lh3.googleusercontent.com/-zJ909rDk0Lg/YPa5P7g5aiI/AAAAAAAAedU/g8BMvBNOgYIjFTkI6SE7I8gDnFP1Qs6YQCNcBGAsYHQ/w472-h474/image.png"></a></p><p><a href="https://draft.blogger.com/blog/post/edit/3809681606094011522/849309138521769078#"><img src="https://lh3.googleusercontent.com/-dT4teOJYE3I/YPa5XbOTmTI/AAAAAAAAedc/qFrNXBkcyLI_MEbT0y6lPsUrzW2qwS7cwCNcBGAsYHQ/w574-h477/image.png"></a></p><p><strong>完成後，按“保存”按鈕。</strong></p><p><strong>要將值從 ESP32 發送到 ThingSpeak，您需要寫入 API 密鑰。打開“API 密鑰”<br>選項卡並將寫入 API 密鑰複製到一個安全的地方，因為您稍後會需要它。</strong></p><p><a href="https://draft.blogger.com/blog/post/edit/3809681606094011522/849309138521769078#"><img src="https://lh3.googleusercontent.com/-35r-wuz8QZA/YPa5nUmuVSI/AAAAAAAAedo/UXDaOoHybCMW0cC2Si6Mj7d_uKNcDv1VACNcBGAsYHQ/w729-h351/image.png"></a></p><hr><p>安裝 ThingSpeak 庫<br>要將傳感器讀數發送到 ThingSpeak，我們將使用 thingspeak-arduino 庫。您可以通過 Arduino 庫管理器安裝此庫。轉到 Sketch Include Library Manage Libraries… 並在 Library Manager 中搜索“ThingSpeak”。安裝 MathWorks 的 ThingSpeak 庫。</p><hr><p><a href="https://draft.blogger.com/blog/post/edit/3809681606094011522/849309138521769078#"><img src="https://lh3.googleusercontent.com/-x91vImHJl_g/YPa9gniW-2I/AAAAAAAAedw/ta8IapxF41MfqYbYSXUOIlN3IY8f_pQUQCNcBGAsYHQ/w627-h353/image.png"></a></p><h2 id="程式碼"><a href="#程式碼" class="headerlink" title="程式碼"></a>程式碼</h2><pre class="line-numbers language-c#" data-language="c#"><code class="language-c#">#include &lt;WiFi.h&gt;#include &lt;Wire.h&gt;#include &lt;SPI.h&gt;#include &lt;Adafruit_BMP280.h&gt;#include &lt;ThingSpeak.h&gt;const char* ssid&#x3D;&quot;---&quot;;const char* password&#x3D;&quot;-----&quot;;const char* APIKey&#x3D;&quot;X0V369ZQ4VM9YGA8&quot;;WiFiClient client;Adafruit_BMP280 bmp; &#x2F;&#x2F; I2Cunsigned long lastTime&#x3D;0;unsigned long currenTime&#x3D;millis();void setup() &#123;  Serial.begin(115200);  if (!bmp.begin()) &#123;    Serial.println(F(&quot;Could not find a valid BMP280 sensor, check wiring or &quot;                      &quot;try a different address!&quot;));    while (1) delay(10);  &#125;  WiFi.mode(WIFI_STA);  ThingSpeak.begin(client);  WiFi.begin(ssid, password);  while (WiFi.status() !&#x3D; WL_CONNECTED)&#123;    Serial.print(&quot;.&quot;);  &#125;  Serial.println(&quot;Connected successful!&quot;);&#125;void loop() &#123;  float temp&#x3D;bmp.readTemperature();  int x&#x3D;ThingSpeak.writeField(1, 1, temp, APIKey);  if (x&#x3D;&#x3D;200)&#123;    Serial.println(&quot;request successful!&quot;);  &#125;&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="解析"><a href="#解析" class="headerlink" title="解析"></a>解析</h2><p><strong>匯入所須的模組</strong></p><pre class="line-numbers language-c#" data-language="c#"><code class="language-c#">#include &lt;WiFi.h&gt;#include &lt;Wire.h&gt;#include &lt;SPI.h&gt;#include &lt;Adafruit_BMP280.h&gt;#include &lt;ThingSpeak.h&gt;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><strong>WIFI和API的KEY</strong></p><pre class="line-numbers language-c#" data-language="c#"><code class="language-c#">const char* ssid&#x3D;&quot;基地台名稱&quot;;const char* password&#x3D;&quot;基地台密碼&quot;;const char* APIKey&#x3D;&quot;X0V36---------&quot;;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p><strong>WIFI的客戶端</strong></p><pre class="line-numbers language-c#" data-language="c#"><code class="language-c#">WiFiClient client;&#96;**BMP280指定對象**Adafruit_BMP280 bmp; &#x2F;&#x2F; I2C&#96;**BMP280初始化**&#96;&#96;&#96;c#if (!bmp.begin()) &#123;    Serial.println(F(&quot;Could not find a valid BMP280 sensor, check wiring or &quot;                      &quot;try a different address!&quot;));    while (1) delay(10);  &#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><strong>WIFI連線設定與設定成STA模式</strong></p><pre class="line-numbers language-c#" data-language="c#"><code class="language-c#">WiFi.mode(WIFI_STA);WiFi.begin(ssid, password);  while (WiFi.status() !&#x3D; WL_CONNECTED)&#123;    Serial.print(&quot;.&quot;);  &#125;  Serial.println(&quot;Connected successful!&quot;);&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><strong>ThingSpeak初始化</strong></p><pre class="line-numbers language-c#" data-language="c#"><code class="language-c#">ThingSpeak.begin(client);<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p><strong>loop()裡面</strong></p><p><strong>讀取溫度和上傳數至到ThingSpeak</strong></p><p><strong>如果成功發布讀數，此函數將返回代碼 200。</strong><br><strong>// 寫入 ThingSpeak。一個通道最多有 8 個字段，最多可以存儲 8 個不同的字段。<br>// 通道中的信息片段。在這裡，我們寫入字段 1。</strong></p><p><strong>//ThingSpeak.writeField(1, 1, temp, APIKey)第一個1代表頻道,第二個1代表字段</strong></p><pre class="line-numbers language-c#" data-language="c#"><code class="language-c#">float temp&#x3D;bmp.readTemperature();  int x&#x3D;ThingSpeak.writeField(1, 1, temp, APIKey);  if (x&#x3D;&#x3D;200)&#123;    Serial.println(&quot;request successful!&quot;);  &#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><hr><p><a href="https://draft.blogger.com/blog/post/edit/3809681606094011522/849309138521769078#"><img src="https://1.bp.blogspot.com/-I1rIMHBqD9I/YPbEIweD_4I/AAAAAAAAed4/g288Q1gyvFwLWDSlOo4WzL_wFCcgqypmgCNcBGAsYHQ/w687-h303/BMP280TEMP.jpg"></a></p>]]></content>
      
      
      <categories>
          
          <category> esp32 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> bmp280 </tag>
            
            <tag> ThingSpeak </tag>
            
            <tag> IOT </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>DS1306實時時鐘模組-ESP32</title>
      <link href="/2021/08/29/ds1306-shi-shi-shi-zhong-mo-zu-esp32/"/>
      <url>/2021/08/29/ds1306-shi-shi-shi-zhong-mo-zu-esp32/</url>
      
        <content type="html"><![CDATA[<h2 id="DS1306實時時鐘模組-ESP32"><a href="#DS1306實時時鐘模組-ESP32" class="headerlink" title="DS1306實時時鐘模組-ESP32"></a>DS1306實時時鐘模組-ESP32</h2><h6 id="tags-esp32-ds1302"><a href="#tags-esp32-ds1302" class="headerlink" title="tags: esp32 ds1302"></a>tags: <code>esp32</code> <code>ds1302</code></h6><p>這是廣華電子上的介紹<br>◎ 時鐘具有能計算2100 年之前的秒、分、時、日、星期、月、年的能力，還有閏年調整的能力<br>◎ 31 8 位暫存數據存儲RAM<br>◎ 串行 I/O 口方式使得管腳數量最少<br>◎ 寬範圍工作電壓2.0 5.5V<br>◎ 工作電流 2.0V 時,小於300nA<br>◎ 讀 / 寫時鐘或RAM 數據時有兩種傳送方式單字節傳送和多字節傳送字符組方式<br>◎ 8 腳DIP 封裝或可選的8 腳SOIC 封裝根據表面裝配<br>◎ 簡單 3 線接口<br>◎ 與 TTL 相容Vcc=5V<br>◎ 雙電源管用於主電源和備份電源供應<br>◎ 電池：CR2032 電壓3V，電流260mAh<br>◎ 晶振32.768KHz，匹配電容為6pF<br>◎ DS1302為8腳直插大晶片，晶片下面有IC座，方便更換及插拔片<br>6.模塊工作電壓兼容3.3V/5V，可與5V及3.3V單片機連接<br>◎帶4個定位孔，直徑3.1mm<br>◎工作溫度：0°～70°</p><p>◎ 安裝注意!<br>1.VCC與GND千萬不要接反，以免燒壞晶片<br>2.51系列單晶片P0接腳需要連接上拉電阻，如果單晶片沒有連接上拉電阻，可以將數據線接到其他接腳</p><p>步驟1:<br>在Arduino IDE下載程式庫DS1302，並選好版型，COM和波特率</p><p>接線</p><pre class="line-numbers language-c#" data-language="c#"><code class="language-c#">&#x2F;&#x2F; DS1302 CLK&#x2F;SCLK --&gt; 5&#x2F;&#x2F; DS1302 DAT&#x2F;IO --&gt; 4&#x2F;&#x2F; DS1302 RST&#x2F;CE --&gt; 2&#x2F;&#x2F; DS1302 VCC --&gt; 3.3v - 5v&#x2F;&#x2F; DS1302 GND --&gt; GND<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>程式碼</p><pre class="line-numbers language-c#" data-language="c#"><code class="language-c#">#include &lt;ThreeWire.h&gt;  #include &lt;RtcDS1302.h&gt; ThreeWire myWire(4,5,2); &#x2F;&#x2F; IO, SCLK, CE  &#x2F;&#x2F;对应接到ESP32的IO号RtcDS1302&lt;ThreeWire&gt; Rtc(myWire); void setup () &#123;    Serial.begin(57600);    Serial.print(&quot;compiled: &quot;);    Serial.print(__DATE__); &#x2F;&#x2F;打印系统日期    Serial.println(__TIME__); &#x2F;&#x2F;打印系统时间    Rtc.Begin();  &#x2F;&#x2F;用管脚声明来初始化RTC     RtcDateTime compiled &#x3D; RtcDateTime(__DATE__, __TIME__); &#x2F;&#x2F;将系统时间声明一个时间结构    printDateTime(compiled);  &#x2F;&#x2F;打印时间    Serial.println();     if (!Rtc.IsDateTimeValid())   &#x2F;&#x2F;读RTC时间，如果没读到，就是电池没电了    &#123;        &#x2F;&#x2F; Common Causes:        &#x2F;&#x2F;    1) first time you ran and the device wasn&#39;t running yet        &#x2F;&#x2F;    2) the battery on the device is low or even missing         Serial.println(&quot;RTC lost confidence in the DateTime!&quot;);        Rtc.SetDateTime(compiled);    &#x2F;&#x2F;设置系统时间为当前时间    &#125;     if (Rtc.GetIsWriteProtected())    &#x2F;&#x2F;检查是不是写保护了    &#123;        Serial.println(&quot;RTC was write protected, enabling writing now&quot;);        Rtc.SetIsWriteProtected(false);    &#125;     if (!Rtc.GetIsRunning())  &#x2F;&#x2F;检查是不是可读    &#123;        Serial.println(&quot;RTC was not actively running, starting now&quot;);        Rtc.SetIsRunning(true);    &#125;     RtcDateTime now &#x3D; Rtc.GetDateTime();  &#x2F;&#x2F;得到RTC的时间    if (now &lt; compiled) &#x2F;&#x2F;如果读出的时间早于系统时间，则重新设置RTC时间    &#123;        Serial.println(&quot;RTC is older than compile time!  (Updating DateTime)&quot;);        Rtc.SetDateTime(compiled);    &#125;    else if (now &gt; compiled) &#x2F;&#x2F;如果读出的时间晚于系统时间，则重新设置RTC时间    &#123;        Serial.println(&quot;RTC is newer than compile time. (this is expected)&quot;);    &#125;    else if (now &#x3D;&#x3D; compiled)     &#123;        Serial.println(&quot;RTC is the same as compile time! (not expected but all is fine)&quot;);    &#125;&#125; void loop () &#123;    RtcDateTime now &#x3D; Rtc.GetDateTime();    &#x2F;&#x2F;核心函数，读当前RTC时间    printDateTime(now);    Serial.println();    if (!now.IsValid())&#123;        &#x2F;&#x2F; Common Causes:        &#x2F;&#x2F;    1) the battery on the device is low or even missing and the power line was disconnected        Serial.println(&quot;RTC lost confidence in the DateTime!&quot;);    &#125;    delay(10000); &#x2F;&#x2F; ten seconds    &#x2F;&#x2F;延时10s&#125; #define countof(a) (sizeof(a) &#x2F; sizeof(a[0]))void printDateTime(const RtcDateTime&amp; dt)   &#x2F;&#x2F;一个通过串口格式化打印日期和时间的函数&#123;    char datestring[20];     snprintf_P(datestring,                &#x2F;&#x2F;avr的一个打印格式化函数            countof(datestring),            PSTR(&quot;%04u&#x2F;%02u&#x2F;%02u %02u:%02u:%02u&quot;),    &#x2F;&#x2F;和print类似，指定长度            dt.Year(),            dt.Month(),            dt.Day(),            dt.Hour(),            dt.Minute(),            dt.Second() );    Serial.print(datestring);&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>DS1306實時時鐘模組+0.96OLED<br>提示:先下載這些程式庫</p><pre class="line-numbers language-c#" data-language="c#"><code class="language-c#">#include &lt;Adafruit_SSD1306.h&gt;#include &lt;Adafruit_GFX.h&gt;#include &lt;Adafruit_GrayOLED.h&gt;#include &lt;Wire.h&gt;#include &lt;ThreeWire.h&gt;  #include &lt;RtcDS1302.h&gt;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>ds1302在範例裡面有</p><p>// CONNECTIONS:<br>// DS1302 CLK/SCLK –&gt; 5<br>// DS1302 DAT/IO –&gt; 4<br>// DS1302 RST/CE –&gt; 2<br>// DS1302 VCC –&gt; 3.3v - 5v<br>// DS1302 GND –&gt; GND</p><pre class="line-numbers language-c#" data-language="c#"><code class="language-c#">#include &lt;SPI.h&gt;#include &lt;Adafruit_SSD1306.h&gt;#include &lt;Adafruit_GFX.h&gt;#include &lt;Adafruit_GrayOLED.h&gt;#include &lt;Wire.h&gt;#include &lt;ThreeWire.h&gt;  #include &lt;RtcDS1302.h&gt;ThreeWire myWire(4,5,2); &#x2F;&#x2F; IO, SCLK, CERtcDS1302&lt;ThreeWire&gt; Rtc(myWire);#define SCREEN_WIDTH 128#define SCREEN_HEIGHT 64#define OLED_RESET -1Adafruit_SSD1306 display(SCREEN_WIDTH, SCREEN_HEIGHT, &amp;Wire, OLED_RESET);void setup () &#123;    Serial.begin(115200);    display.begin(SSD1306_SWITCHCAPVCC, 0x3C, OLED_RESET);    Serial.print(&quot;compiled: &quot;);    Serial.print(__DATE__);    Serial.println(__TIME__);    Rtc.Begin();    RtcDateTime compiled &#x3D; RtcDateTime(__DATE__, __TIME__);    printDateTime(compiled);    Serial.println();    if (!Rtc.IsDateTimeValid())     &#123;        &#x2F;&#x2F; Common Causes:        &#x2F;&#x2F;    1) first time you ran and the device wasn&#39;t running yet        &#x2F;&#x2F;    2) the battery on the device is low or even missing        Serial.println(&quot;RTC lost confidence in the DateTime!&quot;);        Rtc.SetDateTime(compiled);    &#125;    if (Rtc.GetIsWriteProtected())    &#123;        Serial.println(&quot;RTC was write protected, enabling writing now&quot;);        Rtc.SetIsWriteProtected(false);    &#125;    if (!Rtc.GetIsRunning())    &#123;        Serial.println(&quot;RTC was not actively running, starting now&quot;);        Rtc.SetIsRunning(true);    &#125;    RtcDateTime now &#x3D; Rtc.GetDateTime();    if (now &lt; compiled)     &#123;        Serial.println(&quot;RTC is older than compile time!  (Updating DateTime)&quot;);        Rtc.SetDateTime(compiled);    &#125;    else if (now &gt; compiled)     &#123;        Serial.println(&quot;RTC is newer than compile time. (this is expected)&quot;);    &#125;    else if (now &#x3D;&#x3D; compiled)     &#123;        Serial.println(&quot;RTC is the same as compile time! (not expected but all is fine)&quot;);    &#125;&#125;void loop () &#123;    RtcDateTime now &#x3D; Rtc.GetDateTime();    printDateTime(now);    Serial.println();    if (!now.IsValid())    &#123;        &#x2F;&#x2F; Common Causes:        &#x2F;&#x2F;    1) the battery on the device is low or even missing and the power line was disconnected        Serial.println(&quot;RTC lost confidence in the DateTime!&quot;);    &#125;    display.clearDisplay();    display.setTextSize(2);    display.setTextColor(WHITE);    display.setCursor(0, 0);    display.print(now.Year()); display.print(&quot;&#x2F;&quot;); display.print(now.Month()); display.print(&quot;&#x2F;&quot;); display.println(now.Day());    display.setCursor(0, 20);    display.setTextSize(2);    display.setTextColor(WHITE);    display.print(now.Hour()); display.print(&quot;:&quot;); display.print(now.Minute()); display.print(&quot;:&quot;); display.println(now.Second());    display.display();    delay(1000); &#x2F;&#x2F; ten seconds&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><div class="video-container"><iframe src="https://www.youtube.com/embed/8HeV3ZOpPSI" frameborder="0" loading="lazy" allowfullscreen></iframe></div>]]></content>
      
      
      <categories>
          
          <category> esp32 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> DS1306 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>搖桿模組-ESP32</title>
      <link href="/2021/08/29/yao-gan-mo-zu-esp32/"/>
      <url>/2021/08/29/yao-gan-mo-zu-esp32/</url>
      
        <content type="html"><![CDATA[<h1 id="搖桿模組-ESP32"><a href="#搖桿模組-ESP32" class="headerlink" title="搖桿模組-ESP32"></a>搖桿模組-ESP32</h1><h6 id="tags-esp32-搖桿"><a href="#tags-esp32-搖桿" class="headerlink" title="tags: esp32 搖桿"></a>tags: <code>esp32</code> <code>搖桿</code></h6><hr><h2 id="搖桿模組"><a href="#搖桿模組" class="headerlink" title="搖桿模組"></a>搖桿模組</h2><p><a href="https://draft.blogger.com/blog/post/edit/3809681606094011522/2467346807906815384#"><img src="https://1.bp.blogspot.com/-liS9OQ7lsPg/YIkRkqPRvrI/AAAAAAAAeGQ/AzkfR9Z0sy4i-gdxKveKbMqg4GFCYR4igCNcBGAsYHQ/w186-h331/20210428_152206.jpg"></a></p><h3 id="搖桿模組大都用於機械手臂或控制有伺服馬達的地方，它有２組軸（X和Y）和一個按鍵-，ESP32和Arduino上是使用類比訊號測量，不過在ESP32上只有3-3V所以類比訊號會到4059-必須轉換到1023，後來才發現ESP32有幾個內鍵轉換的函式不錯用，就不用一直死呆呆的用-map-來轉換。然後它的原理和可調電阻一樣，所以沒什麼特別要強調的。"><a href="#搖桿模組大都用於機械手臂或控制有伺服馬達的地方，它有２組軸（X和Y）和一個按鍵-，ESP32和Arduino上是使用類比訊號測量，不過在ESP32上只有3-3V所以類比訊號會到4059-必須轉換到1023，後來才發現ESP32有幾個內鍵轉換的函式不錯用，就不用一直死呆呆的用-map-來轉換。然後它的原理和可調電阻一樣，所以沒什麼特別要強調的。" class="headerlink" title="搖桿模組大都用於機械手臂或控制有伺服馬達的地方，它有２組軸（Ｘ和Ｙ）和一個按鍵 ，ESP32和Arduino上是使用類比訊號測量，不過在ESP32上只有3.3V所以類比訊號會到4059  必須轉換到1023，後來才發現ESP32有幾個內鍵轉換的函式不錯用，就不用一直死呆呆的用  map()來轉換。然後它的原理和可調電阻一樣，所以沒什麼特別要強調的。"></a>搖桿模組大都用於機械手臂或控制有伺服馬達的地方，它有２組軸（Ｘ和Ｙ）和一個按鍵 ，ESP32和Arduino上是使用類比訊號測量，不過在ESP32上只有3.3V所以類比訊號會到4059  必須轉換到1023，後來才發現ESP32有幾個內鍵轉換的函式不錯用，就不用一直死呆呆的用  map()來轉換。然後它的原理和可調電阻一樣，所以沒什麼特別要強調的。</h3><hr><h2 id="接線"><a href="#接線" class="headerlink" title="接線"></a>接線</h2><h3 id="X–-gt-D33-A5"><a href="#X–-gt-D33-A5" class="headerlink" title="X–&gt;D33(A5)"></a>X–&gt;D33(A5)</h3><h3 id="Y–-gt-D32-A4"><a href="#Y–-gt-D32-A4" class="headerlink" title="Y–&gt;D32(A4)"></a>Y–&gt;D32(A4)</h3><p><a href="https://draft.blogger.com/blog/post/edit/3809681606094011522/2467346807906815384#"><img src="https://1.bp.blogspot.com/-eo9WBofHtSo/YIkUVUGy3qI/AAAAAAAAeGY/UINLcUssojkL362WOFOI2wTBFM4P68OtACNcBGAsYHQ/w568-h472/1.jpg"></a></p><h2 id="程式碼"><a href="#程式碼" class="headerlink" title="程式碼"></a>程式碼</h2><p>esp32函式筆記本-<a href="https://draft.blogger.com/blog/post/edit/3809681606094011522/2467346807906815384#">https://esp32-blairan.blogspot.com/2021/04/esp32_26.html</a></p><pre class="line-numbers language-c#" data-language="c#"><code class="language-c#">#define posX 33#define posY 32void setup()&#123;  Serial.begin(115200);  analogSetAttenuation(ADC_11db);  analogSetWidth(10);&#125;void loop()&#123;  int valx&#x3D;analogRead(posX);  int valy&#x3D;analogRead(posY);  delay(500);  Serial.printf(&quot;posX的搖桿值為: %d  &#x2F;&#x2F; posY的搖桿值為: %d\\n&quot;,valx, valy);&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><hr><div class="video-container"><iframe src="https://www.youtube.com/embed/kJ70IxVJXVo" frameborder="0" loading="lazy" allowfullscreen></iframe></div>]]></content>
      
      
      <categories>
          
          <category> esp32 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 遙桿模組 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>按鈕開關控制LED明滅</title>
      <link href="/2021/08/29/an-niu-kai-guan-kong-zhi-led-ming-mie/"/>
      <url>/2021/08/29/an-niu-kai-guan-kong-zhi-led-ming-mie/</url>
      
        <content type="html"><![CDATA[<h1 id="按鈕開關控制LED明滅"><a href="#按鈕開關控制LED明滅" class="headerlink" title="按鈕開關控制LED明滅 "></a>按鈕開關控制LED明滅 </h1><h6 id="tags-esp32-按鈕開關-led"><a href="#tags-esp32-按鈕開關-led" class="headerlink" title="tags: esp32 按鈕開關 led"></a>tags: <code>esp32</code> <code>按鈕開關</code> <code>led</code></h6><h2 id="材料"><a href="#材料" class="headerlink" title="材料"></a>材料</h2><p><strong>LED x1</strong></p><p><strong>按鈕開關 x1</strong></p><p><strong>220歐姆電阻 x1</strong></p><p><strong>ESP32</strong></p><p><a href="https://lh3.googleusercontent.com/-Yc_T7233Jvo/YJDgE6FwwII/AAAAAAAAeHA/etFpI543t8ErXzzDlgCpLc3ME02Ex294gCNcBGAsYHQ/s1600/1620107250751841-0.png"><img src="https://lh3.googleusercontent.com/-Yc_T7233Jvo/YJDgE6FwwII/AAAAAAAAeHA/etFpI543t8ErXzzDlgCpLc3ME02Ex294gCNcBGAsYHQ/w204-h362/1620107250751841-0.png"></a></p><h3 id="按鈕開關原理"><a href="#按鈕開關原理" class="headerlink" title="按鈕開關原理"></a>按鈕開關原理</h3><p><a href="https://1.bp.blogspot.com/-KqBfr6zKGPs/YJDkUqq4rnI/AAAAAAAAeHI/RVPN3_dsIssR8ebADpEl8eSYkreF9OWXQCNcBGAsYHQ/s946/1715185-1FP216354U55.jpg"><img src="https://1.bp.blogspot.com/-KqBfr6zKGPs/YJDkUqq4rnI/AAAAAAAAeHI/RVPN3_dsIssR8ebADpEl8eSYkreF9OWXQCNcBGAsYHQ/w400-h240/1715185-1FP216354U55.jpg"></a></p><p><a href="https://1.bp.blogspot.com/-czSSM3yjims/YJDkaJ8V4yI/AAAAAAAAeHM/lfjKT3t-kiQRnBU3CUVd6fsRfUwBkLp5wCNcBGAsYHQ/s318/%25E4%25B8%258B%25E8%25BC%2589.jpg"><img src="https://1.bp.blogspot.com/-czSSM3yjims/YJDkaJ8V4yI/AAAAAAAAeHM/lfjKT3t-kiQRnBU3CUVd6fsRfUwBkLp5wCNcBGAsYHQ/w418-h209/%25E4%25B8%258B%25E8%25BC%2589.jpg"></a></p><h2 id="實驗目的"><a href="#實驗目的" class="headerlink" title="實驗目的"></a>實驗目的</h2><p><strong>利用按鈕開關切換ESP32內鍵LED明滅</strong></p><p><strong>主要是練習消除按下按鈕時的彈跳雜訊</strong></p><h3 id="動作要求"><a href="#動作要求" class="headerlink" title="動作要求"></a>動作要求</h3><p><strong>按一下開關:點亮LED</strong></p><p><strong>再按一下開關:關閉LED</strong></p><h2 id="接線圖"><a href="#接線圖" class="headerlink" title="接線圖"></a><strong>接線圖</strong></h2><p>**</p><p><a href="https://1.bp.blogspot.com/-VuvcXgXf6uw/YJDtVXFoJTI/AAAAAAAAeHY/Wi1KlYE0rOkmBEIeS1Ao7vAbXkUatJgiwCNcBGAsYHQ/s1187/B.jpg"><img src="https://1.bp.blogspot.com/-VuvcXgXf6uw/YJDtVXFoJTI/AAAAAAAAeHY/Wi1KlYE0rOkmBEIeS1Ao7vAbXkUatJgiwCNcBGAsYHQ/w453-h225/B.jpg"></a></p><p> **</p><h2 id="程式碼"><a href="#程式碼" class="headerlink" title="程式碼"></a>程式碼</h2><pre class="line-numbers language-c#" data-language="c#"><code class="language-c#">byte sw &#x3D; 4;byte button &#x3D; LOW; &#x2F;&#x2F;按鈕預設低電位byte toggle &#x3D; LOW; &#x2F;&#x2F;暫存紀錄預設低電位 void setup()&#123;    Serial.begin(115200);    pinMode(LED_BUILTIN, OUTPUT);    pinMode(sw, INPUT);&#125;void loop()&#123;    bool b &#x3D; digitalRead(sw);    if (b)&#123;        delay(20); &#x2F;&#x2F;消除彈跳        button &#x3D; b;    &#125;    if (b !&#x3D; button)&#123;        toggle &#x3D;! toggle;        digitalWrite(LED_BUILTIN, toggle);        button &#x3D; LOW;    &#125;&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="實驗結果"><a href="#實驗結果" class="headerlink" title="實驗結果"></a>實驗結果</h2><div class="video-container"><iframe src="https://www.youtube.com/embed/NGC4oxTKZm0" frameborder="0" loading="lazy" allowfullscreen></iframe></div>]]></content>
      
      
      <categories>
          
          <category> esp32 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 控鈕開關 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>LED跑馬燈-ESP32</title>
      <link href="/2021/08/29/led-pao-ma-deng-esp32/"/>
      <url>/2021/08/29/led-pao-ma-deng-esp32/</url>
      
        <content type="html"><![CDATA[<h1 id="LED跑馬燈-ESP32"><a href="#LED跑馬燈-ESP32" class="headerlink" title="LED跑馬燈-ESP32"></a>LED跑馬燈-ESP32</h1><h6 id="tags-esp32-led"><a href="#tags-esp32-led" class="headerlink" title="tags: esp32 led"></a>tags: <code>esp32</code> <code>led</code></h6><h2 id="實驗目的"><a href="#實驗目的" class="headerlink" title="實驗目的"></a>實驗目的</h2><h4 id="了解迴圈運用和陣列的宣告-https-esp32-blairan-blogspot-com-2021-04-esp32-26-html"><a href="#了解迴圈運用和陣列的宣告-https-esp32-blairan-blogspot-com-2021-04-esp32-26-html" class="headerlink" title="了解迴圈運用和陣列的宣告 -https://esp32-blairan.blogspot.com/2021/04/esp32_26.html"></a>了解<strong>迴圈</strong>運用和<strong>陣列</strong>的宣告 -<a href="https://draft.blogger.com/blog/post/edit/3809681606094011522/6656678562008851992#">https://esp32-blairan.blogspot.com/2021/04/esp32_26.html</a></h4><h2 id="材料"><a href="#材料" class="headerlink" title="材料"></a>材料</h2><p><strong>LED×4</strong></p><p><strong>220歐姆電阻×4</strong></p><p><strong>杜邦線</strong></p><p><strong>ESP32</strong></p><p><a href="https://draft.blogger.com/blog/post/edit/3809681606094011522/6656678562008851992#"><img src="https://lh3.googleusercontent.com/-_YYwfEof1D0/YI5jHSJ3t6I/AAAAAAAAeG0/_k5HrzCSfV80legdS9URTnUH0Ad7Kmo7QCNcBGAsYHQ/s1600/1619944218044458-0.png"></a></p><hr><h2 id="程式碼"><a href="#程式碼" class="headerlink" title="程式碼"></a>程式碼</h2><h4 id="陣列宣告-https-esp32-blairan-blogspot-com-2021-04-esp32-26-html"><a href="#陣列宣告-https-esp32-blairan-blogspot-com-2021-04-esp32-26-html" class="headerlink" title="陣列宣告 https://esp32-blairan.blogspot.com/2021/04/esp32_26.html"></a>陣列宣告 <a href="https://esp32-blairan.blogspot.com/2021/04/esp32_26.html">https://esp32-blairan.blogspot.com/2021/04/esp32_26.html</a></h4><h4 id="for迴圈-https-esp32-blairan-blogspot-com-2021-04-esp32-26-html"><a href="#for迴圈-https-esp32-blairan-blogspot-com-2021-04-esp32-26-html" class="headerlink" title="for迴圈 https://esp32-blairan.blogspot.com/2021/04/esp32_26.html"></a>for迴圈 <a href="https://esp32-blairan.blogspot.com/2021/04/esp32_26.html">https://esp32-blairan.blogspot.com/2021/04/esp32_26.html</a></h4><pre class="line-numbers language-c#" data-language="c#"><code class="language-c#">const byte led\[\]&#x3D;&#123;35, 32, 33, 25&#125;;void setup() &#123;  Serial.begin(115200);  for (int i &#x3D; 0; i &lt;&#x3D;3; i++)&#123;    pinMode(led\[i\], OUTPUT);  &#125;&#125;void loop() &#123;  for (int i &#x3D; 0; i &lt;&#x3D;3; i++)  &#123;    digitalWrite(led\[i\], HIGH);    delay(100);    digitalWrite(led\[i\], LOW);  &#125;   for (int i &#x3D; 3; i &gt;&#x3D; 0; i--)  &#123;    digitalWrite(led\[i\], HIGH);    delay(100);    digitalWrite(led\[i\], LOW);  &#125;&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><hr><div class="video-container"><iframe src="https://www.youtube.com/embed/lDSiaGsfrE4" frameborder="0" loading="lazy" allowfullscreen></iframe></div>]]></content>
      
      
      <categories>
          
          <category> esp32 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> led跑馬燈 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>DHT11/12網路監測溫濕度計-micropython</title>
      <link href="/2021/08/29/dht11-12-wang-lu-jian-ce-wen-shi-du-ji-micropython/"/>
      <url>/2021/08/29/dht11-12-wang-lu-jian-ce-wen-shi-du-ji-micropython/</url>
      
        <content type="html"><![CDATA[<h2 id="DHT11-12網路監測溫濕度計-micropython"><a href="#DHT11-12網路監測溫濕度計-micropython" class="headerlink" title="DHT11/12網路監測溫濕度計-micropython"></a>DHT11/12網路監測溫濕度計-micropython</h2><h6 id="tags-micropython-dht11-12-webserver"><a href="#tags-micropython-dht11-12-webserver" class="headerlink" title="tags: micropython dht11/12 webserver"></a>tags: <code>micropython</code> <code>dht11/12 webserver</code></h6><hr><p><strong><em>DHT11/12單純測試參考頁面-</em></strong></p><p><a href="https://draft.blogger.com/blog/post/edit/6280040346040914276/5661741645243406963?hl=zh-TW#">https://blairan-esp32-micropython.blogspot.com/2021/07/dht11dht12-micropython.html</a></p><p><em><strong>WiFi聯網參考-</strong></em><a href="https://draft.blogger.com/blog/post/edit/6280040346040914276/5661741645243406963?hl=zh-TW#">https://blairan-esp32-micropython.blogspot.com/2021/07/wifi.html</a></p><hr><h2 id="完整程式碼"><a href="#完整程式碼" class="headerlink" title="完整程式碼"></a>完整程式碼</h2><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> dht<span class="token keyword">import</span> network<span class="token punctuation">,</span> socket<span class="token keyword">from</span> machine <span class="token keyword">import</span> Pin<span class="token keyword">from</span> time <span class="token keyword">import</span> sleepssid<span class="token operator">=</span><span class="token string">"---"</span>password<span class="token operator">=</span><span class="token string">"------"</span>STA<span class="token operator">=</span>network<span class="token punctuation">.</span>WLAN<span class="token punctuation">(</span>network<span class="token punctuation">.</span>STA_IF<span class="token punctuation">)</span>STA<span class="token punctuation">.</span>active<span class="token punctuation">(</span><span class="token boolean">True</span><span class="token punctuation">)</span>STA<span class="token punctuation">.</span>connect<span class="token punctuation">(</span>ssid<span class="token punctuation">,</span> password<span class="token punctuation">)</span><span class="token keyword">while</span> STA<span class="token punctuation">.</span>isconnected<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">==</span><span class="token boolean">False</span><span class="token punctuation">:</span>    <span class="token keyword">pass</span><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"The connected successful!"</span><span class="token punctuation">)</span><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"IP:  &#123;&#125;"</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>STA<span class="token punctuation">.</span>ifconfig<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token keyword">def</span> readTempAndHumi<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">global</span> temp<span class="token punctuation">,</span> humi    <span class="token keyword">try</span><span class="token punctuation">:</span>        sensor<span class="token operator">=</span>dht<span class="token punctuation">.</span>DHT11<span class="token punctuation">(</span>Pin<span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">)</span>        sensor<span class="token punctuation">.</span>measure<span class="token punctuation">(</span><span class="token punctuation">)</span>        temp<span class="token operator">=</span>sensor<span class="token punctuation">.</span>temperature<span class="token punctuation">(</span><span class="token punctuation">)</span>        humi<span class="token operator">=</span>sensor<span class="token punctuation">.</span>humidity<span class="token punctuation">(</span><span class="token punctuation">)</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token builtin">isinstance</span><span class="token punctuation">(</span>temp<span class="token punctuation">,</span> <span class="token builtin">float</span><span class="token punctuation">)</span> <span class="token keyword">and</span> <span class="token builtin">isinstance</span><span class="token punctuation">(</span>humi<span class="token punctuation">,</span> <span class="token builtin">float</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">or</span> <span class="token punctuation">(</span><span class="token builtin">isinstance</span><span class="token punctuation">(</span>temp<span class="token punctuation">,</span> <span class="token builtin">int</span><span class="token punctuation">)</span> <span class="token keyword">and</span> <span class="token builtin">isinstance</span><span class="token punctuation">(</span>humi<span class="token punctuation">,</span> <span class="token builtin">int</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">:</span>          measureResult<span class="token operator">=</span><span class="token string">"&#123;&#125;,&#123;&#125;"</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>temp<span class="token punctuation">,</span> humi<span class="token punctuation">)</span>          <span class="token keyword">return</span> measureResult        <span class="token keyword">else</span><span class="token punctuation">:</span>          <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token string">"--"</span><span class="token punctuation">)</span>    <span class="token keyword">except</span> OSError <span class="token keyword">as</span> o<span class="token punctuation">:</span>        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"--"</span><span class="token punctuation">)</span><span class="token keyword">def</span> Htmlpage<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>  html<span class="token operator">=</span> <span class="token triple-quoted-string string">"""        &lt;html>    &lt;head>      &lt;meta charset="utf-8" />      &lt;meta name="viewport" content="width=device-width, initial-scale=1.0" />      &lt;style>        h1  &#123;text-align: center; background-color: orange; margin-right:5px;&#125;        dl &#123; width: 320px; margin: 12px auto; &#125;        dt &#123;           font-size: 20pt; color: #444; background-color: #ddd;          margin: 6pt 0; padding: 6pt 12pt;        &#125;        dd &#123;          text-align: right; padding-right: 6pt;        &#125;        .num &#123; font-size: 36pt; color: dodgerblue; &#125;      &lt;/style>      &lt;/head>    &lt;body>      &lt;p>&lt;h1>ESP32 DHT11/12&lt;/h1>&lt;/p>      &lt;dl>        &lt;dt>Temp&lt;/dt>        &lt;dd class=num>"""</span><span class="token operator">+</span><span class="token builtin">str</span><span class="token punctuation">(</span>temp<span class="token punctuation">)</span><span class="token operator">+</span><span class="token triple-quoted-string string">"""°C&lt;/dd>        &lt;dt>Humi&lt;/dt>        &lt;dd class=num>"""</span><span class="token operator">+</span><span class="token builtin">str</span><span class="token punctuation">(</span>humi<span class="token punctuation">)</span><span class="token operator">+</span><span class="token triple-quoted-string string">""" %&lt;/dd>      &lt;/dl>    &lt;/body>    &lt;/html>    """</span>  <span class="token keyword">return</span> htmls<span class="token operator">=</span>socket<span class="token punctuation">.</span>socket<span class="token punctuation">(</span>socket<span class="token punctuation">.</span>AF_INET<span class="token punctuation">,</span> socket<span class="token punctuation">.</span>SOCK_STREAM<span class="token punctuation">)</span>s<span class="token punctuation">.</span>bind<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token string">''</span><span class="token punctuation">,</span> <span class="token number">80</span><span class="token punctuation">)</span><span class="token punctuation">)</span>s<span class="token punctuation">.</span>listen<span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token keyword">while</span> <span class="token boolean">True</span><span class="token punctuation">:</span>    conn<span class="token punctuation">,</span> addr <span class="token operator">=</span> s<span class="token punctuation">.</span>accept<span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'Got a connection from %s'</span> <span class="token operator">%</span> <span class="token builtin">str</span><span class="token punctuation">(</span>addr<span class="token punctuation">)</span><span class="token punctuation">)</span>    req <span class="token operator">=</span> conn<span class="token punctuation">.</span>recv<span class="token punctuation">(</span><span class="token number">1024</span><span class="token punctuation">)</span>    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'Content = %s'</span> <span class="token operator">%</span> <span class="token builtin">str</span><span class="token punctuation">(</span>req<span class="token punctuation">)</span><span class="token punctuation">)</span>    sensor_reading <span class="token operator">=</span> readTempAndHumi<span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token keyword">print</span><span class="token punctuation">(</span>sensor_reading<span class="token punctuation">)</span>    respone <span class="token operator">=</span> Htmlpage<span class="token punctuation">(</span><span class="token punctuation">)</span>    conn<span class="token punctuation">.</span>send<span class="token punctuation">(</span><span class="token string">"http/1.1 200 OK\\n"</span><span class="token punctuation">)</span>    conn<span class="token punctuation">.</span>send<span class="token punctuation">(</span><span class="token string">"Content-Type: text/html; charset='utf-8'\\n"</span><span class="token punctuation">)</span>    conn<span class="token punctuation">.</span>send<span class="token punctuation">(</span><span class="token string">"Connection: close\\n\\n"</span><span class="token punctuation">)</span>    conn<span class="token punctuation">.</span>sendall<span class="token punctuation">(</span>respone<span class="token punctuation">)</span>    conn<span class="token punctuation">.</span>close<span class="token punctuation">(</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="解析"><a href="#解析" class="headerlink" title="解析"></a>解析</h2><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token operator">**</span>_載入dht<span class="token punctuation">,</span>wifi<span class="token punctuation">,</span>端口<span class="token punctuation">,</span>pin和時間模組_<span class="token operator">**</span><span class="token keyword">import</span> dht<span class="token keyword">import</span> network<span class="token punctuation">,</span> socket<span class="token keyword">from</span> machine <span class="token keyword">import</span> Pin<span class="token keyword">from</span> time <span class="token keyword">import</span> sleep<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><strong><em>這個部份是設制WiFi的流程</em></strong></p><pre class="line-numbers language-python" data-language="python"><code class="language-python">ssid<span class="token operator">=</span><span class="token string">"基地台名稱"</span>password<span class="token operator">=</span><span class="token string">"基地台密碼"</span>STA<span class="token operator">=</span>network<span class="token punctuation">.</span>WLAN<span class="token punctuation">(</span>network<span class="token punctuation">.</span>STA_IF<span class="token punctuation">)</span>STA<span class="token punctuation">.</span>active<span class="token punctuation">(</span><span class="token boolean">True</span><span class="token punctuation">)</span>STA<span class="token punctuation">.</span>connect<span class="token punctuation">(</span>ssid<span class="token punctuation">,</span> password<span class="token punctuation">)</span><span class="token keyword">while</span> STA<span class="token punctuation">.</span>isconnected<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">==</span><span class="token boolean">False</span><span class="token punctuation">:</span>    <span class="token keyword">pass</span><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"The connected successful!"</span><span class="token punctuation">)</span><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"IP:  &#123;&#125;"</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>STA<span class="token punctuation">.</span>ifconfig<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><strong><em>讀取溫溼度的函式</em></strong></p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">def</span> readTempAndHumi<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">global</span> temp<span class="token punctuation">,</span> humi    <span class="token keyword">try</span><span class="token punctuation">:</span>        sensor<span class="token operator">=</span>dht<span class="token punctuation">.</span>DHT11<span class="token punctuation">(</span>Pin<span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">)</span>        sensor<span class="token punctuation">.</span>measure<span class="token punctuation">(</span><span class="token punctuation">)</span>        temp<span class="token operator">=</span>sensor<span class="token punctuation">.</span>temperature<span class="token punctuation">(</span><span class="token punctuation">)</span>        humi<span class="token operator">=</span>sensor<span class="token punctuation">.</span>humidity<span class="token punctuation">(</span><span class="token punctuation">)</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token builtin">isinstance</span><span class="token punctuation">(</span>temp<span class="token punctuation">,</span> <span class="token builtin">float</span><span class="token punctuation">)</span> <span class="token keyword">and</span> <span class="token builtin">isinstance</span><span class="token punctuation">(</span>humi<span class="token punctuation">,</span> <span class="token builtin">float</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">or</span> <span class="token punctuation">(</span><span class="token builtin">isinstance</span><span class="token punctuation">(</span>temp<span class="token punctuation">,</span> <span class="token builtin">int</span><span class="token punctuation">)</span> <span class="token keyword">and</span> <span class="token builtin">isinstance</span><span class="token punctuation">(</span>humi<span class="token punctuation">,</span> <span class="token builtin">int</span><span class="token punctuation">)</span><span class="token punctuation">)</span>        measureResult<span class="token operator">=</span><span class="token string">"&#123;&#125;,&#123;&#125;"</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>temp<span class="token punctuation">,</span> humi<span class="token punctuation">)</span>            <span class="token keyword">return</span> measureResult        <span class="token keyword">else</span><span class="token punctuation">:</span>            <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token string">"--"</span><span class="token punctuation">)</span>     <span class="token keyword">except</span> OSError <span class="token keyword">as</span> o<span class="token punctuation">:</span>        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"--"</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><strong>網頁前端的布置,記得要讓其讀取時可返回(return)</strong></p><p><strong>其中須注意的是讓溫溼度的值可以正顯示要使用</strong>“””+str(溫/溼度變數)+”””</p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">def</span> Htmlpage<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>  html<span class="token operator">=</span> <span class="token triple-quoted-string string">"""        &lt;html>    &lt;head>      &lt;meta charset="utf-8" />      &lt;meta name="viewport" content="width=device-width, initial-scale=1.0" />      &lt;style>        h1  &#123;text-align: center; background-color: orange; margin-right:5px;&#125;        dl &#123; width: 320px; margin: 12px auto; &#125;        dt &#123;           font-size: 20pt; color: #444; background-color: #ddd;          margin: 6pt 0; padding: 6pt 12pt;        &#125;        dd &#123;          text-align: right; padding-right: 6pt;        &#125;        .num &#123; font-size: 36pt; color: dodgerblue; &#125;      &lt;/style>      &lt;/head>    &lt;body>      &lt;p>&lt;h1>ESP32 DHT11/12&lt;/h1>&lt;/p>      &lt;dl>        &lt;dt>Temp&lt;/dt>        &lt;dd class=num>"""</span><span class="token operator">+</span><span class="token builtin">str</span><span class="token punctuation">(</span>temp<span class="token punctuation">)</span><span class="token operator">+</span><span class="token triple-quoted-string string">"""°C&lt;/dd>        &lt;dt>Humi&lt;/dt>        &lt;dd class=num>"""</span><span class="token operator">+</span><span class="token builtin">str</span><span class="token punctuation">(</span>humi<span class="token punctuation">)</span><span class="token operator">+</span><span class="token triple-quoted-string string">""" %&lt;/dd>      &lt;/dl>    &lt;/body>    &lt;/html>    """</span>  <span class="token keyword">return</span> html<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><strong><em>設制監聽套接端口</em></strong></p><p><strong><em>函式參考-</em></strong><a href="https://draft.blogger.com/blog/post/edit/6280040346040914276/5661741645243406963?hl=zh-TW#">我的micropython函式筆記</a></p><pre class="line-numbers language-python" data-language="python"><code class="language-python">s<span class="token operator">=</span>socket<span class="token punctuation">.</span>socket<span class="token punctuation">(</span>socket<span class="token punctuation">.</span>AF_INET<span class="token punctuation">,</span> socket<span class="token punctuation">.</span>SOCK_STREAM<span class="token punctuation">)</span>s<span class="token punctuation">.</span>bind<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token string">''</span><span class="token punctuation">,</span> <span class="token number">80</span><span class="token punctuation">)</span><span class="token punctuation">)</span>s<span class="token punctuation">.</span>listen<span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span>  <span class="token keyword">while</span> <span class="token boolean">True</span><span class="token punctuation">:</span>    conn<span class="token punctuation">,</span> addr <span class="token operator">=</span> s<span class="token punctuation">.</span>accept<span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'Got a connection from %s'</span> <span class="token operator">%</span> <span class="token builtin">str</span><span class="token punctuation">(</span>addr<span class="token punctuation">)</span><span class="token punctuation">)</span>    req <span class="token operator">=</span> conn<span class="token punctuation">.</span>recv<span class="token punctuation">(</span><span class="token number">1024</span><span class="token punctuation">)</span>    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'Content = %s'</span> <span class="token operator">%</span> <span class="token builtin">str</span><span class="token punctuation">(</span>req<span class="token punctuation">)</span><span class="token punctuation">)</span>    sensor_reading <span class="token operator">=</span> readTempAndHumi<span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token keyword">print</span><span class="token punctuation">(</span>sensor_reading<span class="token punctuation">)</span>    respone <span class="token operator">=</span> Htmlpage<span class="token punctuation">(</span><span class="token punctuation">)</span>    conn<span class="token punctuation">.</span>send<span class="token punctuation">(</span><span class="token string">"http/1.1 200 OK\\n"</span><span class="token punctuation">)</span>    conn<span class="token punctuation">.</span>send<span class="token punctuation">(</span><span class="token string">"Content-Type: text/html; charset='utf-8'\\n"</span><span class="token punctuation">)</span>    conn<span class="token punctuation">.</span>send<span class="token punctuation">(</span><span class="token string">"Connection: close\\n\\n"</span><span class="token punctuation">)</span>    conn<span class="token punctuation">.</span>sendall<span class="token punctuation">(</span>respone<span class="token punctuation">)</span>    conn<span class="token punctuation">.</span>close<span class="token punctuation">(</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><a href="https://draft.blogger.com/blog/post/edit/6280040346040914276/5661741645243406963?hl=zh-TW#"><img src="https://lh3.googleusercontent.com/-stu-h6hdsgc/YOaaTDfLfOI/AAAAAAAAeaQ/NiNjk1xHXl0YOU_J8btvb9Qd3isHo6ZvwCNcBGAsYHQ/s1600/1625725506698515-0.png"></a></p>]]></content>
      
      
      <categories>
          
          <category> micropython </category>
          
          <category> esp32 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> webserver </tag>
            
            <tag> DHT11/DHT12 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>PWM控制板上內建LED-ESP32</title>
      <link href="/2021/08/29/pwm-kong-zhi-ban-shang-nei-jian-led-esp32/"/>
      <url>/2021/08/29/pwm-kong-zhi-ban-shang-nei-jian-led-esp32/</url>
      
        <content type="html"><![CDATA[<h1 id="PWM控制板上內建LED-ESP32"><a href="#PWM控制板上內建LED-ESP32" class="headerlink" title="PWM控制板上內建LED-ESP32"></a>PWM控制板上內建LED-ESP32</h1><h6 id="tags-esp32-led-pwm"><a href="#tags-esp32-led-pwm" class="headerlink" title="tags: esp32 led pwm"></a>tags: <code>esp32</code> <code>led</code> <code>pwm</code></h6><h2 id="材料"><a href="#材料" class="headerlink" title="材料"></a>材料</h2><ol><li><h4 id="ESP32控制板-x1"><a href="#ESP32控制板-x1" class="headerlink" title="ESP32控制板 x1"></a>ESP32控制板 x1</h4></li><li><h4 id="可變電阻-x1"><a href="#可變電阻-x1" class="headerlink" title="可變電阻 x1"></a>可變電阻 x1</h4></li><li><h4 id="10K歐姆電阻-x1"><a href="#10K歐姆電阻-x1" class="headerlink" title="10K歐姆電阻 x1"></a>10K歐姆電阻 x1</h4></li></ol><h2 id="接線"><a href="#接線" class="headerlink" title="接線"></a>接線</h2><p><a href="https://draft.blogger.com/blog/post/edit/3809681606094011522/5354569437760337966#"><img src="https://1.bp.blogspot.com/-lGkj-SvW41c/YId8HIPFBQI/AAAAAAAAeGI/P0q3-HrMSrI2FS2aWVSbTbB_09B4vGtpACNcBGAsYHQ/w718-h337/2.jpg"></a></p><hr><h2 id="程式碼"><a href="#程式碼" class="headerlink" title="程式碼"></a>程式碼</h2><pre><code class="c#">#define pwm1 A4void setup()&#123;  Serial.begin(115200);  ledcSetup(0, 5000, 10);  ledcAttachPin(LED_BUILTIN, 0);  pinMode(LED_BUILTIN, OUTPUT);&#125;void loop()&#123;  int val=analogRead(pwm1);  val=map(val, 0, 4095, 0, 1023);  Serial.printf(&quot;輸出值為: %u\\n&quot;, val);  ledcWrite(0, val);  delay(100);&#125;</code></pre><hr><h2 id="程式碼部份說明"><a href="#程式碼部份說明" class="headerlink" title="程式碼部份說明"></a>程式碼部份說明</h2><p><a href="https://draft.blogger.com/blog/post/edit/3809681606094011522/5354569437760337966#">ESP32函式筆記本</a>-PWM  </p><h3 id="和Arduino不一太一樣的地方是在多了設定PWM的通道和頻率-當中其實更完善的方法還有位元數的轉換，因為ESP32的類比數值是4095-而Arduino的數值是1023-所以在ledcSetup-裡的10是代表esp32的10位元-但我試著用原生的方式map-轉換測試後還可以-analogRead-一樣有-但少了analogWrite-這部份以ledcWrite-取代。"><a href="#和Arduino不一太一樣的地方是在多了設定PWM的通道和頻率-當中其實更完善的方法還有位元數的轉換，因為ESP32的類比數值是4095-而Arduino的數值是1023-所以在ledcSetup-裡的10是代表esp32的10位元-但我試著用原生的方式map-轉換測試後還可以-analogRead-一樣有-但少了analogWrite-這部份以ledcWrite-取代。" class="headerlink" title="和Arduino不一太一樣的地方是在多了設定PWM的通道和頻率,當中其實更完善的方法還有位元數的轉換，因為ESP32的類比數值是4095,而Arduino的數值是1023,所以在ledcSetup()裡的10是代表esp32的10位元,但我試著用原生的方式map()轉換測試後還可以,analogRead()一樣有,但少了analogWrite(),這部份以ledcWrite()取代。"></a>和Arduino不一太一樣的地方是在多了設定PWM的通道和頻率,當中其實更完善的方法還有位元數的轉換，因為ESP32的類比數值是4095,而Arduino的數值是1023,所以在ledcSetup()裡的10是代表esp32的10位元,但我試著用原生的方式map()轉換測試後還可以,analogRead()一樣有,但少了analogWrite(),這部份以ledcWrite()取代。</h3><hr><div class="video-container"><iframe src="https://www.youtube.com/embed/bO9G6uzPRcw" frameborder="0" loading="lazy" allowfullscreen></iframe></div>https://youtu.be/bO9G6uzPRcw]]></content>
      
      
      <categories>
          
          <category> esp32 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> esp32 </tag>
            
            <tag> led </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>MQTT&amp;node-RED控制二軸云台-mpython</title>
      <link href="/2021/08/28/mqtt-node-red-kong-zhi-er-zhou-yun-tai-mpython/"/>
      <url>/2021/08/28/mqtt-node-red-kong-zhi-er-zhou-yun-tai-mpython/</url>
      
        <content type="html"><![CDATA[<h1 id="MQTT-amp-node-RED控制二軸云台-mpython"><a href="#MQTT-amp-node-RED控制二軸云台-mpython" class="headerlink" title="MQTT&amp;node-RED控制二軸云台-mpython"></a>MQTT&amp;node-RED控制二軸云台-mpython</h1><p><a href="https://draft.blogger.com/blog/post/edit/6280040346040914276/4999901201185761586#"><img src="https://lh3.googleusercontent.com/-sqJOZzdBnks/YSjK1HOEkWI/AAAAAAAAe3o/ShJX8l8V20cmENfwoL0iij0uZm_wHfwaQCNcBGAsYHQ/w208-h349/1630063309993121-0.png"></a></p><p><em><strong>承接<a href="https://draft.blogger.com/blog/post/edit/6280040346040914276/4999901201185761586#">使用PWM控制伺服馬達-micropython</a>這篇，透過node-red加入mqtt訂閱主題控制二軸云台</strong></em></p><p><em><strong>有一些感想紀錄下來，我發現其實像mqtt或者wifi連網，大都是固定一個寫法，其它不同的模組分為讀取數值或用數值受控制的元件，只要套用上去就可以。</strong></em></p><p><em><strong>首先主要是被控制的伺服馬達，所以先把它測試一下，參考這篇（<a href="https://draft.blogger.com/blog/post/edit/6280040346040914276/4999901201185761586#">點我</a>）</strong></em></p><p><em><strong>測試好之後，就可以開始加入wifi和mqtt了，但因為我用的是樹莓派建立的ＭQTT，所以這陪分前提是要有樹苺派，如何在樹苺派上建立Ｎode-RED和MQTT，可以參考這篇（<a href="https://draft.blogger.com/blog/post/edit/6280040346040914276/4999901201185761586#">點我</a>）。</strong></em></p><hr><h2 id="Node-RED設定"><a href="#Node-RED設定" class="headerlink" title="Node-RED設定"></a>Node-RED設定</h2><p><a href="https://1.bp.blogspot.com/-GksKBPZ26_o/YSpWJWFmwhI/AAAAAAAAe4E/6peztH_jPDgTVkrbfKGBriWMdPbxcnCyACNcBGAsYHQ/s1920/3.jpg"><img src="https://1.bp.blogspot.com/-GksKBPZ26_o/YSpWJWFmwhI/AAAAAAAAe4E/6peztH_jPDgTVkrbfKGBriWMdPbxcnCyACNcBGAsYHQ/w654-h368/3.jpg"></a></p><p><a href="https://1.bp.blogspot.com/-bIpsZvvgG6Y/YSpVzj9SmhI/AAAAAAAAe34/-V-RirefCUETcVru84SLRomgYX3EzNOnQCNcBGAsYHQ/s1920/1.jpg"><img src="https://1.bp.blogspot.com/-bIpsZvvgG6Y/YSpVzj9SmhI/AAAAAAAAe34/-V-RirefCUETcVru84SLRomgYX3EzNOnQCNcBGAsYHQ/w661-h370/1.jpg"></a></p><p><a href="https://1.bp.blogspot.com/-AS8DJhdGX5Q/YSpV8K4e0hI/AAAAAAAAe38/1h6rhTpCw1wwJ_hmA4QAZDDkU-6MBBANwCNcBGAsYHQ/s1920/2.jpg"><img src="https://1.bp.blogspot.com/-AS8DJhdGX5Q/YSpV8K4e0hI/AAAAAAAAe38/1h6rhTpCw1wwJ_hmA4QAZDDkU-6MBBANwCNcBGAsYHQ/w654-h368/2.jpg"></a></p><h2 id="程式碼"><a href="#程式碼" class="headerlink" title="程式碼"></a>程式碼</h2><pre><code class="python">from machine import SLEEP, Pin, PWM, freqfrom time import sleep from umqtttsimple import MQTTClient  import binascii, micropython, network, time, socket, machine    ssid = &quot;------------&quot;password = &quot;-------&quot;mqtt_server = &quot;192.168.210.22&quot;    #將客戶端ID轉換為16進位,以便MQTT伺服端讀取    mqtt_id = binascii.hexlify(machine.unique_id())    #和Nord-RED上的主題一致    client_servoPan = b&#39;esp32/servoPan&#39;client_servoTilt = b&#39;esp32/servoTilt&#39;    servo_pan = PWM(Pin(13), freq=50)servo_tilt = PWM(Pin(14), freq=50)    #wifi連線    def wifiConn():    wifi = network.WLAN(network.STA_IF)    wifi.active(True)    wifi.connect(ssid, password)    while wifi.isconnected() == False:        pass    print(&quot;Connected successful!&quot;)    print(&quot;IP: &#123;&#125;&quot;.format(wifi.ifconfig()))    #樹莓派上的mqtt回應訂閱def callBack(topic, msg):    print((topic, msg))    if topic == client_servoPan:        servo_pan.duty(int(msg))        sleep(0.5)    elif topic == client_servoTilt:        servo_tilt.duty(int(msg))        sleep(0.5)    #連線MQTT,連線成功後訂閱主題def connToMqtt():    try:        client = MQTTClient(mqtt_id, mqtt_server)        client.set_callback(callBack)        client.connect()        client.subscribe(client_servoPan)        client.subscribe(client_servoTilt)        print(&quot;connect to %s&quot;%mqtt_server)        return client        #如果無法連線重新連線    except OSError as e:        print(&quot;not to connected for MQTT server!&quot;)        machine.reset()    wifiConn()client = connToMqtt()while True:    #檢查有無進來的訊息    client.check_msg()</code></pre><p>調過等待時間還是會偶爾抖動，雖然不知道抖動原在哪，先這樣好了，下次再來抓原因。</p><div class="video-container"><iframe src="https://www.youtube.com/embed/HxkOYhqcgaY" frameborder="0" loading="lazy" allowfullscreen></iframe></div>]]></content>
      
      
      <categories>
          
          <category> micropython </category>
          
          <category> esp32 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> mqtt </tag>
            
            <tag> node-red </tag>
            
            <tag> 二軸云台 </tag>
            
            <tag> servo </tag>
            
            <tag> 伺服馬達 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>搖桿控制云台-ESP32</title>
      <link href="/2021/08/28/yao-gan-kong-zhi-yun-tai-esp32/"/>
      <url>/2021/08/28/yao-gan-kong-zhi-yun-tai-esp32/</url>
      
        <content type="html"><![CDATA[<h1 id="搖桿控制云台-ESP32"><a href="#搖桿控制云台-ESP32" class="headerlink" title="搖桿控制云台-ESP32"></a>搖桿控制云台-ESP32</h1><h6 id="tags-esp32-搖桿-云台"><a href="#tags-esp32-搖桿-云台" class="headerlink" title="tags: esp32 搖桿 云台"></a>tags: <code>esp32</code> <code>搖桿</code> <code>云台</code></h6><h3 id="實驗目的"><a href="#實驗目的" class="headerlink" title="實驗目的"></a>實驗目的</h3><p><strong>以搖桿的讀值同步控制伺服馬達。</strong></p><p><strong>須注意值要轉換成角度。</strong></p><h3 id="伺服馬達"><a href="#伺服馬達" class="headerlink" title="伺服馬達"></a>伺服馬達</h3><p><a href="https://draft.blogger.com/blog/post/edit/3809681606094011522/3060329269915131288#"><img src="https://1.bp.blogspot.com/-qUFym3H-21Q/YIywjKU9TPI/AAAAAAAAeGk/_GiSq6LVWYA4sOlvfkGRHzt-lUoZgKjjwCNcBGAsYHQ/w315-h210/servo.jpg"></a></p><p><strong>伺服馬達被廣範運在微控板的控制上,幾乎這是學習微控板的基礎</strong></p><p><strong>具代表的實驗就是二軸云台,它是以兩個伺服馬達構成平移和上下</strong></p><p><strong>運動的裝置,至於SG90這種小型伺服馬達的運作網路上很多資源,</strong></p><p><strong>就不一一贅述。</strong></p><h2 id="搖桿模組"><a href="#搖桿模組" class="headerlink" title="搖桿模組"></a>搖桿模組</h2><h4 id="請參照這篇的實驗—https-esp32-blairan-blogspot-com-2021-04-esp32-28-html"><a href="#請參照這篇的實驗—https-esp32-blairan-blogspot-com-2021-04-esp32-28-html" class="headerlink" title="請參照這篇的實驗—https://esp32-blairan.blogspot.com/2021/04/esp32_28.html"></a>請參照這篇的實驗—<a href="https://draft.blogger.com/blog/post/edit/3809681606094011522/3060329269915131288#">https://esp32-blairan.blogspot.com/2021/04/esp32_28.html</a></h4><h2 id="接線圖"><a href="#接線圖" class="headerlink" title="接線圖"></a>接線圖</h2><p><strong>POSＸ-D33</strong></p><p><strong>POSＹ—D32</strong></p><p><strong>SERVO_PAN—-&gt;D12</strong></p><p><strong>SERVO_TIT—-&gt;D13</strong></p><p><strong>GND</strong></p><p><strong>3V3</strong></p><p><a href="https://draft.blogger.com/blog/post/edit/3809681606094011522/3060329269915131288#"><img src="https://1.bp.blogspot.com/-OySoM8bHU9s/YIyyJmCXZLI/AAAAAAAAeGs/G450OX409awrx2D8wMHg3dZGLJPPd5QLwCNcBGAsYHQ/w450-h467/1.jpg"></a></p><p><strong>須匯入</strong><a href="https://draft.blogger.com/blog/post/edit/3809681606094011522/3060329269915131288#">ESP32Servo.h</a></p><h2 id="程式碼"><a href="#程式碼" class="headerlink" title="程式碼"></a>程式碼</h2><pre><code class="c#">#include &lt;ESP32Servo.h&gt;Servo Pan;Servo Tit;#define servoPAN 12#define servoTIT 13#define posX 33#define posY 32 void setup()&#123;  Serial.begin(115200);  analogSetAttenuation(ADC_11db);  analogSetWidth(10);  Pan.setPeriodHertz(50);  Tit.setPeriodHertz(50);  Pan.attach(servoPAN, 500, 2400);  Tit.attach(servoTIT, 500, 2400);&#125;void loop()&#123;  int valx=analogRead(posX);  valx=map(valx, 0, 1023, 0, 180);  Pan.write(valx);  int valy=analogRead(posY);  valy=map(valy, 0, 1023, 0, 180);  Tit.write(valy);  delay(500);  Serial.printf(&quot;posX的搖桿值為: %d  // posY的搖桿值為: %d\\n&quot;,valx, valy);&#125;</code></pre><div class="video-container"><iframe src="https://www.youtube.com/embed/-CYCyibcFn0" frameborder="0" loading="lazy" allowfullscreen></iframe></div>]]></content>
      
      
      <categories>
          
          <category> esp32 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> esp32 </tag>
            
            <tag> 搖桿 </tag>
            
            <tag> 云台 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>藍芽基本通訊&amp;控制LED-ESP32</title>
      <link href="/2021/08/28/lan-ya-ji-ben-tong-xun-kong-zhi-led-esp32/"/>
      <url>/2021/08/28/lan-ya-ji-ben-tong-xun-kong-zhi-led-esp32/</url>
      
        <content type="html"><![CDATA[<h1 id="藍芽基本通訊-amp-控制LED-ESP32"><a href="#藍芽基本通訊-amp-控制LED-ESP32" class="headerlink" title="藍芽基本通訊&amp;控制LED-ESP32"></a>藍芽基本通訊&amp;控制LED-ESP32</h1><h6 id="tags-esp32-藍芽"><a href="#tags-esp32-藍芽" class="headerlink" title="tags: esp32 藍芽"></a>tags: <code>esp32</code> <code>藍芽</code></h6><hr><h4 id="Arduino本身也可以外接藍芽和WIFI，但是須要外掛，這點"><a href="#Arduino本身也可以外接藍芽和WIFI，但是須要外掛，這點" class="headerlink" title="Arduino本身也可以外接藍芽和WIFI，但是須要外掛，這點"></a>Arduino本身也可以外接藍芽和WIFI，但是須要外掛，這點</h4><h4 id="就顯得麻煩一些；ESP32系列都有內建藍芽和WIFI這樣就稍"><a href="#就顯得麻煩一些；ESP32系列都有內建藍芽和WIFI這樣就稍" class="headerlink" title="就顯得麻煩一些；ESP32系列都有內建藍芽和WIFI這樣就稍"></a>就顯得麻煩一些；ESP32系列都有內建藍芽和WIFI這樣就稍</h4><h4 id="能省事，而且語法和Arduino的藍芽用法幾乎一樣。"><a href="#能省事，而且語法和Arduino的藍芽用法幾乎一樣。" class="headerlink" title="能省事，而且語法和Arduino的藍芽用法幾乎一樣。"></a>能省事，而且語法和Arduino的藍芽用法幾乎一樣。</h4><hr><h2 id="操作方法"><a href="#操作方法" class="headerlink" title="操作方法:"></a>操作方法:</h2><p>:memo: <strong><em>首先寫好程式並上傳至ESP32</em></strong></p><pre class="line-numbers language-c#" data-language="c#"><code class="language-c#">#include &lt;BluetoothSerial.h&gt;BluetoothSerial myBT;char incomeData;void setup()&#123;    Serial.begin(115200);    myBT.begin(&quot;ctkBT-01&quot;);    pinMode(LED_BUILTIN, OUTPUT);&#125;void loop()&#123;    if (myBT.available())&#123;        incomeData&#x3D;myBT.read();        Serial.printf(&quot;從藍芽到: %d\&quot;, incomeData);    &#125;    if (incomeData&#x3D;&#x3D;&#39;1&#39;)&#123;        digitalWrite(LED_BUILTIN, HIGH);        myBT.printf(&quot;LED開啓囉!!!&quot;);  &#x2F;&#x2F;手機端收訊    &#125;else if (incomeData&#x3D;&#x3D;&#39;0&#39;)    &#123;        digitalWrite(LED_BUILTIN, LOW);        myBT.printf(&quot;LED關閉囉!!!&quot;); &#x2F;&#x2F;手機端收訊    &#125;&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><hr><p>:memo:<strong>手機端</strong></p><ol><li> <strong>手機藍芽配對ESP32</strong></li><li><strong>在google player下載Serial Bluetooth Terminal</strong></li></ol><p><strong>其它請看視頻操作</strong></p><div class="video-container"><iframe src="https://www.youtube.com/embed/G1-VYOFByYU" frameborder="0" loading="lazy" allowfullscreen></iframe></div>]]></content>
      
      
      <categories>
          
          <category> esp32 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> esp32 </tag>
            
            <tag> 藍芽 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ESP32設定無線基地台和固定IP</title>
      <link href="/2021/08/28/esp32-she-ding-wu-xian-ji-di-tai-he-gu-ding-ip/"/>
      <url>/2021/08/28/esp32-she-ding-wu-xian-ji-di-tai-he-gu-ding-ip/</url>
      
        <content type="html"><![CDATA[<h1 id="ESP32設定無線基地台和固定IP"><a href="#ESP32設定無線基地台和固定IP" class="headerlink" title="ESP32設定無線基地台和固定IP"></a>ESP32設定無線基地台和固定IP</h1><h6 id="tags-esp32-無線基地台"><a href="#tags-esp32-無線基地台" class="headerlink" title="tags: esp32 無線基地台"></a>tags: <code>esp32</code> <code>無線基地台</code></h6><p><strong>ESP32也能使自己變成無線基地台(AP)，使其它設備連上自己的網路，</strong></p><p><strong>雖然很方便，但不適合用於負荷高的應用。</strong></p><p><strong>只要一行短的指令就能辦到</strong></p><p><strong>WiFi.softAP(“SSID名稱”)</strong></p><pre class="line-numbers language-c#" data-language="c#"><code class="language-c#">#include &lt;WiFi.h&gt;  void setup()&#123;    WiFi.softAP(&quot;ESP32無線基地台&quot;);&#125;void loop()&#123;&#125;  <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><strong>上傳之後在手機端搜尋WiFi可以看到ESP32顯示為基地台名稱</strong></p><p><a href="https://draft.blogger.com/blog/post/edit/3809681606094011522/801948207668992406#"><img src="https://lh3.googleusercontent.com/-I6zVUPbh2t8/YKdSssq03vI/AAAAAAAAeLI/W5jfwPBtPwc887winp2CTalxbKSl_xSzwCNcBGAsYHQ/s1600/1621578415343300-0.png"></a></p><p><strong>嚐試跟ESP32連線之後，手機本身的網路功能將無法使用。</strong></p><hr><h2 id="自訂基地台並設定固定IP"><a href="#自訂基地台並設定固定IP" class="headerlink" title="自訂基地台並設定固定ＩＰ"></a>自訂基地台並設定固定ＩＰ</h2><p><strong>softAP(“SSID”, 密碼, 通道)</strong></p><p><strong>SSID:基地台名稱</strong></p><p><strong>密碼:基地台密碼</strong></p><p><strong>通道:1~13個通道可供選擇</strong></p><p><strong>softAPConfig(IP位址, 閘道IP位址, 子網路遮罩)</strong></p><p><strong>須注意上面挎號裡預設值分別為192.168.4.1，192.168.4.1，255.255.255.0</strong></p><p>*<strong>一般IP位置和閘道IP位址設定相同</strong></p><p><strong>因為IP設定的格式可能較為複雜，習慣上會使用IPAddress類別來</strong></p><p><strong>建立ip，閘道ip，子網路遮罩。</strong></p><pre class="line-numbers language-c#" data-language="c#"><code class="language-c#">#include &lt;WiFi.h&gt;IPAddress local_IP(192, 168, 4, 11);IPAddress gateway(192, 168, 4, 11);IPAddress subnet(255, 255 ,255, 0);const char *SSID &#x3D; &quot;ESP32基地台&quot;;const char *password &#x3D; &quot;ctk674011&quot;;void setup()&#123;    Serial.begin(115200);    WiFi.softAPConfig(local_IP, gateway, subnet);    while (!WiFi.softAP(SSID, password))&#123;    &#125;    Serial.println(&quot;啓動成功&quot;);    Serial.print(&quot;IP位址: &quot;);    Serial.println(WiFi.softAPIP());&#125;void loop()&#123;&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><strong>程式上傳後如果基地台啓動成功，瀏覽器會顯示如下資訊</strong></p><p><a href="https://draft.blogger.com/blog/post/edit/3809681606094011522/801948207668992406#"><img src="https://1.bp.blogspot.com/-crYRZRbaPA8/YKdRi7oX4PI/AAAAAAAAeK0/ivBD_2fyreYrHTiRHS59iVeQsWcfMqe7gCNcBGAsYHQ/w293-h303/%25E6%2593%25B7%25E5%258F%2596_2021_05_21_14_17_56_195.jpg"></a></p><p><strong>然後手機WiFi會搜尋到ESP32基地台的名稱，輸入剛設定的密碼即可連線</strong></p><p><strong>＊手機和ESP32連線後，手機將無法連外網。</strong></p><p><a href="https://draft.blogger.com/blog/post/edit/3809681606094011522/801948207668992406#"><img src="https://lh3.googleusercontent.com/-QeQlaToWUVE/YKdSr-Y4OTI/AAAAAAAAeLE/Sp1uUgsegwMhx-SmZM5HR8QFY5ZOZucLgCNcBGAsYHQ/s1600/1621578412456247-1.png"></a></p><p><a href="https://draft.blogger.com/blog/post/edit/3809681606094011522/801948207668992406#"><img src="https://lh3.googleusercontent.com/-cr2sa2BFcto/YKdSrfhHEkI/AAAAAAAAeLA/oA2qnepOO-MJL8S9LAJrvYemWHSvIk8vQCNcBGAsYHQ/s1600/1621578409821481-2.png"></a></p><p><a href="https://draft.blogger.com/blog/post/edit/3809681606094011522/801948207668992406#"><img src="https://lh3.googleusercontent.com/-6aaKJ8_SzlQ/YKdSqtnZGCI/AAAAAAAAeK8/56YBZ12PQnkLhIv9z09KUHIrM_lmV2yYACNcBGAsYHQ/s1600/1621578407212556-3.png"></a></p>]]></content>
      
      
      <categories>
          
          <category> esp32 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> esp32 </tag>
            
            <tag> wifi </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>0.91吋_OLED實驗</title>
      <link href="/2021/08/28/0-91-cun-oled-shi-yan/"/>
      <url>/2021/08/28/0-91-cun-oled-shi-yan/</url>
      
        <content type="html"><![CDATA[<h1 id="0-91吋-OLED實驗"><a href="#0-91吋-OLED實驗" class="headerlink" title="0.91吋_OLED實驗"></a>0.91吋_OLED實驗</h1><h6 id="tags-esp32-0-91oled"><a href="#tags-esp32-0-91oled" class="headerlink" title="tags: esp32 0.91oled"></a>tags: <code>esp32</code> <code>0.91oled</code></h6><hr><h2 id="曲折離奇的0-91OLED"><a href="#曲折離奇的0-91OLED" class="headerlink" title="曲折離奇的0.91OLED"></a><em>曲折離奇的0.91OLED</em></h2><p><strong>為什麼我這麼說它曲折離奇,因為我試了兩天了</strong></p><p><strong>從淘B買回來兩個,因為帶在身邊的一個,就拿來</strong></p><p><strong>開始研究,先是用Adafriut_SSD1306庫,結果都不</strong></p><p><strong>成功,後來使用u8g2lib也不行,整個莫名的💥💥💥</strong></p><p><strong>然後第二天衝回家拿另一個OLED來試,才發現</strong></p><p><strong>第一個OLED壞的，然後我又用Adafriut_SSD1306</strong></p><p><strong>庫試，一樣是不行，最後找到這個<a href="https://draft.blogger.com/blog/post/edit/3809681606094011522/1717125022706858388#">ssd1306</a>庫(非Adafruit)</strong></p><p><strong>終於可以顯示了。</strong></p><hr><p><strong>參考:</strong></p><p><a href="https://draft.blogger.com/blog/post/edit/3809681606094011522/1717125022706858388#">http://arduino-er.blogspot.com/2020/12/i2c-ssd1306-oledesp32-esp32-devkitc-v4.html?m=1</a>  </p><p><strong><em>先來看看實際上顯示的樣子</em></strong></p><p><strong>例1:</strong></p><div class="video-container"><iframe src="https://www.youtube.com/embed/se70n6MqrS0" frameborder="0" loading="lazy" allowfullscreen></iframe></div><p><strong>例2:</strong></p><div class="video-container"><iframe src="https://www.youtube.com/embed/oKcyi8UBHak" frameborder="0" loading="lazy" allowfullscreen></iframe></div><hr><p>h</p><p><a href="https://diyprojects.io/media/2020/10/091-inch-128x32-iic-i2c-blue-oled-lcd-display-diy-oled-module-ssd1306-driver-1-1024x1024.jpg"><img src="https://diyprojects.io/media/2020/10/091-inch-128x32-iic-i2c-blue-oled-lcd-display-diy-oled-module-ssd1306-driver-1-1024x1024.jpg"></a></p><p><strong>接線方很簡單,主要是使用I2C傳輸,所以只要把</strong></p><p>ESP32     OLED</p><p>--------------------</p><p>3V      |     VCC</p><p>GND  |     GND</p><p>SCL    |     D22</p><p>SDA   |     D21</p><hr><p><strong>然後將<a href="https://draft.blogger.com/blog/post/edit/3809681606094011522/1717125022706858388#">ssd1306</a>庫放入Arduino IDE庫裡就行</strong></p><h2 id="程式碼"><a href="#程式碼" class="headerlink" title="程式碼"></a>程式碼</h2><p><strong>例1:</strong></p><pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">"ssd1306.h"</span></span>  <span class="token keyword">void</span> <span class="token function">setup</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  <span class="token function">ssd1306_setFixedFont</span><span class="token punctuation">(</span>ssd1306xled_font8x16<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token function">ssd1306_128x32_i2c_init</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token function">ssd1306_clearScreen</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span>  <span class="token keyword">void</span> <span class="token function">loop</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  <span class="token function">ssd1306_setFixedFont</span><span class="token punctuation">(</span>ssd1306xled_font8x16<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token function">ssd1306_printFixed</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">,</span> <span class="token string">"Hello World!!!"</span><span class="token punctuation">,</span> STYLE_BOLD<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token function">delay</span><span class="token punctuation">(</span><span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token function">ssd1306_clearScreen</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token function">textDemo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token function">delay</span><span class="token punctuation">(</span><span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token function">ssd1306_clearScreen</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><strong>例2:</strong></p><pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">"ssd1306.h"</span></span><span class="token keyword">void</span> <span class="token function">setup</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  <span class="token function">ssd1306_setFixedFont</span><span class="token punctuation">(</span>ssd1306xled_font8x16<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token function">ssd1306_128x32_i2c_init</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token function">ssd1306_clearScreen</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">void</span> <span class="token function">loop</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  <span class="token function">ssd1306_setFixedFont</span><span class="token punctuation">(</span>ssd1306xled_font8x16<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token function">ssd1306_print</span><span class="token punctuation">(</span><span class="token string">"Hello World!!!"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token function">delay</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token function">ssd1306_clearScreen</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>]]></content>
      
      
      <categories>
          
          <category> esp32 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> esp32 </tag>
            
            <tag> OLED </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ESP32解決必須按BOOT才能上傳的小方法</title>
      <link href="/2021/08/28/esp32-jie-jue-bi-xu-an-boot-cai-neng-shang-chuan-de-xiao-fang-fa/"/>
      <url>/2021/08/28/esp32-jie-jue-bi-xu-an-boot-cai-neng-shang-chuan-de-xiao-fang-fa/</url>
      
        <content type="html"><![CDATA[<h1 id="ESP32解決必須按BOOT才能上傳的小方法"><a href="#ESP32解決必須按BOOT才能上傳的小方法" class="headerlink" title="ESP32解決必須按BOOT才能上傳的小方法"></a>ESP32解決必須按BOOT才能上傳的小方法</h1><h6 id="tags-esp32-自動上傳"><a href="#tags-esp32-自動上傳" class="headerlink" title="tags: esp32 自動上傳"></a>tags: <code>esp32</code> <code>自動上傳</code></h6><p><strong>最近開始玩ESP32發現有點麻煩的是每次一上傳到板子都要和跟….___….</strong></p><p><strong>賽跑,後來看到社團上有些大大教學使用10u~100uF的電容即可解決手動上傳</strong></p><p><strong>的困擾，正好公司有100uF 的電容,拿來試試果真可以呢!!!</strong></p><p><strong>參考:<a href="https://draft.blogger.com/blog/post/edit/3809681606094011522/7627629995084093339#">https://blog.darkthread.net/blog/esp32-upload-timeout-fix/?fbclid=IwAR2LK8WYw0P28fvPJDFXoARzUGvGylDiDCZUkpFhwD9u2TXvTX-yvM8yBGw</a></strong></p><p><strong>方法很簡單，只要拿到電容，將電容正端焊在EN，負端焊在GND，這樣就行了。</strong></p><p><a href="https://draft.blogger.com/blog/post/edit/3809681606094011522/7627629995084093339#"><img src="https://lh3.googleusercontent.com/-s_bry0zMywg/YK2yct35J8I/AAAAAAAAeM4/stIzQCfRT2cHLZNzMPnxxpC1YsXVbeS8ACNcBGAsYHQ/s1600/1621996128028104-0.png"></a></p><p><a href="https://draft.blogger.com/blog/post/edit/3809681606094011522/7627629995084093339#"><img src="https://lh3.googleusercontent.com/-jJ-hOL_8GZg/YK2yXokvQFI/AAAAAAAAeM0/PLUQjbiaHfsRFYvit0UBIWz6vVgwRqp5wCNcBGAsYHQ/s1600/1621996094011888-1.png"></a></p>]]></content>
      
      
      <categories>
          
          <category> esp32 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> esp32 </tag>
            
            <tag> 自動上傳 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>兩個ESP32藍芽主從端互聯</title>
      <link href="/2021/08/28/liang-ge-esp32-lan-ya-zhu-cong-duan-hu-lian/"/>
      <url>/2021/08/28/liang-ge-esp32-lan-ya-zhu-cong-duan-hu-lian/</url>
      
        <content type="html"><![CDATA[<h1 id="兩個ESP32藍芽主從端互聯"><a href="#兩個ESP32藍芽主從端互聯" class="headerlink" title="兩個ESP32藍芽主從端互聯"></a>兩個ESP32藍芽主從端互聯</h1><h6 id="tags-esp32-藍芽"><a href="#tags-esp32-藍芽" class="headerlink" title="tags: esp32 藍芽"></a>tags: <code>esp32</code> <code>藍芽</code></h6><hr><h2 id="從端程式碼可參考-藍芽基本通訊-amp-控制LED-ESP32"><a href="#從端程式碼可參考-藍芽基本通訊-amp-控制LED-ESP32" class="headerlink" title="從端程式碼可參考-藍芽基本通訊&amp;控制LED-ESP32"></a>從端程式碼可參考-<a href="https://draft.blogger.com/blog/post/edit/3809681606094011522/2055229884501562897#">藍芽基本通訊&amp;控制LED-ESP32</a></h2><hr><p>現在利用兩個ESP32的藍芽互相溝通，所以一個要當”主(Master)”,另一個</p><p>要當”從(slave)”。</p><h3 id="主端程式碼"><a href="#主端程式碼" class="headerlink" title="主端程式碼"></a>主端程式碼</h3><p>先將主端程式碼上傳至esp32-1</p><pre class="line-numbers language-c#" data-language="c#"><code class="language-c#">#include &lt;BluetoothSerial.h&gt;&#x2F;&#x2F;masterBluetoothSerial myBTmaster; --建立主端物件名const String slave&#x3D;&quot;myBTslave&quot;; --&quot; &quot;裡面是從端藍芽名  const char *PIN&#x3D;&quot;1234&quot;;--預設的pin碼bool connected; --void setup()&#123;    myBTmaster.begin(&quot;bt-master&quot;, true); --設定主端名和設成主控端    Serial.begin(115200);    Serial.printf(&quot;藍芽已啓動,進入master模式\\n&quot;);    Serial.println(&quot;連線中...&quot;);    connected&#x3D;myBTmaster.connect(slave); --檢查是否已連結從端藍芽    if (connected)&#123;        Serial.println(&quot;連線成功&quot;);    &#125;&#125;void loop()&#123;    myBTmaster.println(&quot;1&quot;);    delay(300);    myBTmaster.println(&quot;0&quot;);    delay(300);&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="從端程式碼"><a href="#從端程式碼" class="headerlink" title="從端程式碼"></a>從端程式碼</h3><p>再將從端程式碼上傳至esp32-2</p><pre class="line-numbers language-c#" data-language="c#"><code class="language-c#">#include &lt;BluetoothSerial.h&gt;&#x2F;&#x2F;slaveBluetoothSerial myBTslave;char incomeData;void setup()&#123;    myBTslave.begin(&quot;bt-slave&quot;); ——建立從端藍芽名稱    pinMode(LED_BUILTIN, OUTPUT);&#125;  void loop()&#123;    incomeData&#x3D;myBTslave.read();    if (incomeData&#x3D;&#x3D;&#39;1&#39;)&#123;        digitalWrite(LED_BUILTIN, HIGH);    &#125;else if (incomeData&#x3D;&#x3D;&#39;0&#39;)&#123;        digitalWrite(LED_BUILTIN, LOW);    &#125;&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><hr><p><strong>都上傳完之後將兩塊板子reset，如果成功，會看到從端板子上的內建LED閃爍</strong></p>]]></content>
      
      
      <categories>
          
          <category> esp32 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> esp32 </tag>
            
            <tag> 藍芽 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>WiFi網路連接</title>
      <link href="/2021/08/28/wifi-wang-lu-lian-jie/"/>
      <url>/2021/08/28/wifi-wang-lu-lian-jie/</url>
      
        <content type="html"><![CDATA[<h1 id="WiFi網路連接"><a href="#WiFi網路連接" class="headerlink" title="WiFi網路連接"></a>WiFi網路連接</h1><h6 id="tags-micropython-WiFi"><a href="#tags-micropython-WiFi" class="headerlink" title="tags: micropython WiFi"></a>tags: <code>micropython</code> <code>WiFi</code></h6><hr><h2 id="micropython-ESP32下網路連接的模式可分為"><a href="#micropython-ESP32下網路連接的模式可分為" class="headerlink" title="micropython ESP32下網路連接的模式可分為"></a>micropython ESP32下網路連接的模式可分為</h2><ul><li>  STA:做為站點接入WiFi</li><li>  AP:做為熱點,充許其它設備接入</li></ul><h2 id="函式參考-micropython函式筆記本"><a href="#函式參考-micropython函式筆記本" class="headerlink" title="函式參考-micropython函式筆記本"></a>函式參考-<a href="https://draft.blogger.com/blog/post/edit/6280040346040914276/8403042239316796526#">micropython函式筆記本</a></h2><h2 id="熱點模式-AP"><a href="#熱點模式-AP" class="headerlink" title="熱點模式(AP)"></a>熱點模式(AP)</h2><p>熱點模式允許用戶將自己的ESP32配置為熱點，這讓多個ESP32芯片之間的無線連接在不借助外部路由器網絡的情況下成為可能。 </p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> networkap <span class="token operator">=</span> network<span class="token punctuation">.</span>wifi<span class="token punctuation">(</span>network<span class="token punctuation">.</span>AP_IF<span class="token punctuation">)</span> <span class="token comment"># 創建熱點</span>ap<span class="token punctuation">.</span>active<span class="token punctuation">(</span><span class="token boolean">True</span><span class="token punctuation">)</span>         <span class="token comment"># 建立熱點</span>ap<span class="token punctuation">.</span>config<span class="token punctuation">(</span>ssid<span class="token operator">=</span><span class="token string">'ESP-AP'</span><span class="token punctuation">)</span> <span class="token comment"># 建立熱點名稱</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><hr><h2 id="站點模式-STA"><a href="#站點模式-STA" class="headerlink" title="站點模式(STA)"></a>站點模式(STA)</h2><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> networkssid<span class="token operator">=</span><span class="token string">"基地台名稱"</span>password<span class="token operator">=</span><span class="token string">"密碼"</span>wifi<span class="token operator">=</span>network<span class="token punctuation">.</span>WLAN<span class="token punctuation">(</span>network<span class="token punctuation">.</span>STA_IF<span class="token punctuation">)</span>wifi<span class="token punctuation">.</span>active<span class="token punctuation">(</span><span class="token boolean">True</span><span class="token punctuation">)</span>wifi<span class="token punctuation">.</span>connect<span class="token punctuation">(</span>ssid<span class="token punctuation">,</span> password<span class="token punctuation">)</span><span class="token keyword">while</span> wifi<span class="token punctuation">.</span>isconnected<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">==</span><span class="token boolean">False</span><span class="token punctuation">:</span>  <span class="token keyword">pass</span><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"connrcted success"</span><span class="token punctuation">)</span><span class="token keyword">print</span><span class="token punctuation">(</span>wifi<span class="token punctuation">.</span>ifconfig<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="結果顯示"><a href="#結果顯示" class="headerlink" title="結果顯示"></a>結果顯示</h3><p><em><strong>其中’192.168.243.124’就是localIP</strong></em></p><pre class="line-numbers language-c#" data-language="c#"><code class="language-c#">&gt;&gt;&gt; Trueconnrcted success(&#39;192.168.243.124&#39;, &#39;255.255.255.0&#39;, &#39;192.168.243.101&#39;, &#39;192.168.243.101&#39;)<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>]]></content>
      
      
      <categories>
          
          <category> micropython </category>
          
          <category> esp32 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> esp32 </tag>
            
            <tag> wifi </tag>
            
            <tag> micropython </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>按鈕控制LED-micropython</title>
      <link href="/2021/08/28/an-niu-kong-zhi-led-micropython/"/>
      <url>/2021/08/28/an-niu-kong-zhi-led-micropython/</url>
      
        <content type="html"><![CDATA[<h1 id="按鈕控制LED–micropython"><a href="#按鈕控制LED–micropython" class="headerlink" title="按鈕控制LED–micropython"></a>按鈕控制LED–micropython</h1><h6 id="tags-micropython"><a href="#tags-micropython" class="headerlink" title="tags: micropython"></a>tags: <code>micropython</code></h6><h2 id="接線"><a href="#接線" class="headerlink" title="接線"></a>接線</h2><p><a href="https://i0.wp.com/randomnerdtutorials.com/wp-content/uploads/2019/04/led_button_esp32_bb.png?w=1065&quality=100&strip=all&ssl=1"><img src="https://i0.wp.com/randomnerdtutorials.com/wp-content/uploads/2019/04/led_button_esp32_bb.png?w=1065&quality=100&strip=all&ssl=1"></a></p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">from</span> machine <span class="token keyword">import</span> Pin<span class="token keyword">from</span> time <span class="token keyword">import</span> sleep  led <span class="token operator">=</span> Pin<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> Pin<span class="token punctuation">.</span>OUT<span class="token punctuation">)</span>button <span class="token operator">=</span> Pin<span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">,</span> Pin<span class="token punctuation">.</span>IN<span class="token punctuation">)</span>  <span class="token keyword">while</span> <span class="token boolean">True</span><span class="token punctuation">:</span>    led<span class="token punctuation">.</span>value<span class="token punctuation">(</span>button<span class="token punctuation">.</span>value<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>    sleep<span class="token punctuation">(</span><span class="token number">0.5</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><hr><p><strong>首先從machine載入Pin，從time載入sleep</strong></p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">from</span> machine <span class="token keyword">import</span> Pin <span class="token keyword">from</span> time <span class="token keyword">import</span> sleep<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p><strong>下面跨號有兩個參數，５是esp32上的GPIO接腳，Pin.OUT表示第5腳位預設為輸出</strong></p><pre class="line-numbers language-python" data-language="python"><code class="language-python">led <span class="token operator">=</span> Pin<span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">,</span> Pin<span class="token punctuation">.</span>OUT<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p><strong>和上面一樣道理，只不過第二個參數是用Pin.IN表示按鈕是以輸入的方式設定</strong></p><pre class="line-numbers language-python" data-language="python"><code class="language-python">button <span class="token operator">=</span> Pin<span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">,</span> Pin<span class="token punctuation">.</span>IN<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p><strong>當我們按下按鈕時，button.value() 返回 1。因此，這與 led.value(1) 相同。這會將 LED 狀態設置為 1，點亮 LED。當按鈕未被按下時，button.value() 返回 0。因此，我們有 led.value(0)，並且 LED 保持關閉狀態。</strong></p><pre class="line-numbers language-python" data-language="python"><code class="language-python">led<span class="token punctuation">.</span>value<span class="token punctuation">(</span>button<span class="token punctuation">.</span>value<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><hr><h2 id="實作結果"><a href="#實作結果" class="headerlink" title="實作結果"></a>實作結果</h2><div class="video-container"><iframe src="https://www.youtube.com/embed/4boMaNGBm8I" frameborder="0" loading="lazy" allowfullscreen></iframe></div>]]></content>
      
      
      <categories>
          
          <category> micropython </category>
          
          <category> esp32 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> led </tag>
            
            <tag> micropython </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>MediaPipe+UNO手勢控制伺服馬達</title>
      <link href="/2021/08/28/mediapipe-uno-shou-shi-kong-zhi-si-fu-ma-da/"/>
      <url>/2021/08/28/mediapipe-uno-shou-shi-kong-zhi-si-fu-ma-da/</url>
      
        <content type="html"><![CDATA[<h1 id="MediaPipe-UNO手勢控制伺服馬達"><a href="#MediaPipe-UNO手勢控制伺服馬達" class="headerlink" title="MediaPipe+UNO手勢控制伺服馬達"></a>MediaPipe+UNO手勢控制伺服馬達</h1><h6 id="tags-mediapipe-arduino-servo"><a href="#tags-mediapipe-arduino-servo" class="headerlink" title="tags: mediapipe arduino servo"></a>tags: <code>mediapipe</code> <code>arduino</code> <code>servo</code></h6><p><strong>參考視頻網址:</strong></p><p><a href="https://draft.blogger.com/blog/post/edit/6959160158145357673/5177980124815283469#">https://youtu.be/9iEPzbG-xLE</a></p><h3 id="MediaPipe"><a href="#MediaPipe" class="headerlink" title="MediaPipe"></a><a href="https://draft.blogger.com/blog/post/edit/6959160158145357673/5177980124815283469#">MediaPipe</a></h3><p>簡單來說是google跨平台而且開源的機器學習運用</p><p>MediaPipe是一款由Google開發並開源的數據流處理機器學習應用開發框架。它是一個基於圖的數據處理管線，用於構建使用了多種形式的數據源，如視頻、音頻、傳感器數據以及任何時間序列數據。 MediaPipe是跨平台的，可以運行在嵌入式平台(樹莓派等)，移動設備(iOS和Android)，工作站和服務器上，並支持移動端GPU加速。使用MediaPipe，可以將機器學習任務構建為一個圖形的模塊表示的數據流管道，可以包括推理模型和流媒體處理功能。</p><h3 id="pinpong"><a href="#pinpong" class="headerlink" title="pinpong"></a><a href="https://draft.blogger.com/blog/post/edit/6959160158145357673/5177980124815283469#">pinpong</a></h3><p>pinpong庫是一套控制開源硬件主控板的Python庫</p><p>，基於Firmata協議並兼容MicroPython語法，5分鐘即可讓你上手使用Python控制開源硬件。</p><p>有興趣可以到<a href="https://draft.blogger.com/blog/post/edit/6959160158145357673/5177980124815283469#">pinpong官網</a>看一下，</p><p>我是使用pycharm，所以首先安裝opencv-python，mediapipe和pinpong這兩個主要的程式庫</p><h2 id="步驟1"><a href="#步驟1" class="headerlink" title="步驟1:"></a>步驟1:</h2><p><strong>先把這個程式庫命名為handutil.py和主程式放一起</strong></p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> cv2  <span class="token keyword">import</span> mediapipe <span class="token keyword">as</span> mp    <span class="token keyword">class</span> <span class="token class-name">HandDetector</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>  <span class="token triple-quoted-string string">'''     手势识别类  '''</span>   <span class="token keyword">def</span> <span class="token function">_init_</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> mode<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">,</span> max_hands<span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">,</span> detection_con<span class="token operator">=</span><span class="token number">0.5</span><span class="token punctuation">,</span> track_con<span class="token operator">=</span><span class="token number">0.5</span><span class="token punctuation">)</span><span class="token punctuation">:</span>  <span class="token triple-quoted-string string">'''     初始化     :param mode: 是否静态图片，默认为False     :param max_hands: 最多几只手，默认为2只     :param detection_con: 最小检测信度值，默认为0.5     :param track_con: 最小跟踪信度值，默认为0.5   '''</span>       self<span class="token punctuation">.</span>mode <span class="token operator">=</span> mode      self<span class="token punctuation">.</span>max_hands <span class="token operator">=</span> max_hands      self<span class="token punctuation">.</span>detection_con <span class="token operator">=</span> detection_con      self<span class="token punctuation">.</span>track_con <span class="token operator">=</span> track_con      self<span class="token punctuation">.</span>hands <span class="token operator">=</span> mp<span class="token punctuation">.</span>solutions<span class="token punctuation">.</span>hands<span class="token punctuation">.</span>Hands<span class="token punctuation">(</span>self<span class="token punctuation">.</span>mode<span class="token punctuation">,</span> self<span class="token punctuation">.</span>max_hands<span class="token punctuation">,</span> self<span class="token punctuation">.</span>detection_con<span class="token punctuation">,</span> self<span class="token punctuation">.</span>track_con<span class="token punctuation">)</span>        <span class="token keyword">def</span> <span class="token function">find_hands</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> img<span class="token punctuation">,</span> draw<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span><span class="token punctuation">:</span>          <span class="token triple-quoted-string string">'''     检测手势     :param img: 视频帧图片     :param draw: 是否画出手势中的节点和连接图     :return: 处理过的视频帧图片   '''</span>   imgRGB <span class="token operator">=</span> cv2<span class="token punctuation">.</span>cvtColor<span class="token punctuation">(</span>img<span class="token punctuation">,</span> cv2<span class="token punctuation">.</span>COLOR_BGR2RGB<span class="token punctuation">)</span>          <span class="token comment"># 处理图片，检测是否有手势，将数据存进self.results中  </span>        self<span class="token punctuation">.</span>results <span class="token operator">=</span> self<span class="token punctuation">.</span>hands<span class="token punctuation">.</span>process<span class="token punctuation">(</span>imgRGB<span class="token punctuation">)</span>                  <span class="token keyword">if</span> draw<span class="token punctuation">:</span>                      <span class="token keyword">if</span> self<span class="token punctuation">.</span>results<span class="token punctuation">.</span>multi_hand_landmarks<span class="token punctuation">:</span>                          <span class="token keyword">for</span> handlms <span class="token keyword">in</span> self<span class="token punctuation">.</span>results<span class="token punctuation">.</span>multi_hand_landmarks<span class="token punctuation">:</span>                              mp<span class="token punctuation">.</span>solutions<span class="token punctuation">.</span>drawing_utils<span class="token punctuation">.</span>draw_landmarks<span class="token punctuation">(</span>img<span class="token punctuation">,</span> handlms<span class="token punctuation">,</span> mp<span class="token punctuation">.</span>solutions<span class="token punctuation">.</span>hands<span class="token punctuation">.</span>HAND_CONNECTIONS<span class="token punctuation">)</span>          <span class="token keyword">return</span> img        <span class="token keyword">def</span> <span class="token function">find_positions</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> img<span class="token punctuation">,</span> hand_no<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">:</span>          <span class="token triple-quoted-string string">'''     获取手势数据     :param img: 视频帧图片     :param hand_no: 手编号（默认第1只手）     :return: 手势数据列表，每个数据成员由id, x, y组成，代码这个手势位置编号以及在屏幕中的位置      '''</span>           self<span class="token punctuation">.</span>lmslist <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>          <span class="token keyword">if</span> self<span class="token punctuation">.</span>results<span class="token punctuation">.</span>multi_hand_landmarks<span class="token punctuation">:</span>              hand <span class="token operator">=</span> self<span class="token punctuation">.</span>results<span class="token punctuation">.</span>multi_hand_landmarks<span class="token punctuation">[</span>hand_no<span class="token punctuation">]</span>              <span class="token keyword">for</span> <span class="token builtin">id</span><span class="token punctuation">,</span> lm <span class="token keyword">in</span> <span class="token builtin">enumerate</span><span class="token punctuation">(</span>hand<span class="token punctuation">.</span>landmark<span class="token punctuation">)</span><span class="token punctuation">:</span>                  h<span class="token punctuation">,</span> w<span class="token punctuation">,</span> c <span class="token operator">=</span> img<span class="token punctuation">.</span>shape                  cx<span class="token punctuation">,</span> cy <span class="token operator">=</span> <span class="token builtin">int</span><span class="token punctuation">(</span>lm<span class="token punctuation">.</span>x <span class="token operator">*</span> w<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token builtin">int</span><span class="token punctuation">(</span>lm<span class="token punctuation">.</span>y <span class="token operator">*</span> h<span class="token punctuation">)</span>                  self<span class="token punctuation">.</span>lmslist<span class="token punctuation">.</span>append<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token builtin">id</span><span class="token punctuation">,</span> cx<span class="token punctuation">,</span> cy<span class="token punctuation">]</span><span class="token punctuation">)</span>            <span class="token keyword">return</span> self<span class="token punctuation">.</span>lmslist<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><hr><h2 id="步驟2"><a href="#步驟2" class="headerlink" title="步驟2:"></a>步驟2:</h2><h2 id="複制貼上主程式"><a href="#複制貼上主程式" class="headerlink" title="複制貼上主程式"></a><strong>複制貼上主程式</strong></h2><h2 id="這裡留意一下計算斜角轉成角度的公式"><a href="#這裡留意一下計算斜角轉成角度的公式" class="headerlink" title="*這裡留意一下計算斜角轉成角度的公式"></a>*<strong>這裡留意一下計算斜角轉成角度的公式</strong></h2><h3 id="算出角度"><a href="#算出角度" class="headerlink" title="算出角度:"></a>算出角度:</h3><pre class="line-numbers language-none"><code class="language-none">假如两点坐标分别是（x1，y1）（x2，y2）那么斜率是：（y2-y1）&#x2F;（x2-x1）k&#x3D;(y2-y1)&#x2F;(x2-x1) 其中(x1,y1),(x2,y2) 是已知两点的坐标已知A(x1，y1)，B(x2，y2)  1、若x1&#x3D;x2，则斜率不存在；  2、若x1≠x2，则斜率k&#x3D;(y2－y1)&#x2F;(x2－x1)<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="算出弧度"><a href="#算出弧度" class="headerlink" title="算出弧度:"></a><strong>算出弧度:</strong></h3><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> mathmath<span class="token punctuation">.</span>degrees<span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token operator">**</span>x為一個值<span class="token operator">**</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> cv2  <span class="token keyword">from</span> HandTrackingMoudle <span class="token keyword">import</span> handDetector  <span class="token keyword">import</span> math  <span class="token keyword">import</span> numpy <span class="token keyword">as</span> np  <span class="token keyword">from</span> pinpong<span class="token punctuation">.</span>board <span class="token keyword">import</span> Board<span class="token punctuation">,</span> Pin<span class="token punctuation">,</span> Servo  <span class="token keyword">import</span> time    Board<span class="token punctuation">(</span><span class="token string">"uno"</span><span class="token punctuation">)</span><span class="token punctuation">.</span>begin<span class="token punctuation">(</span><span class="token punctuation">)</span>  myServo <span class="token operator">=</span> Servo<span class="token punctuation">(</span>Pin<span class="token punctuation">(</span>Pin<span class="token punctuation">.</span>A0<span class="token punctuation">)</span><span class="token punctuation">)</span>    cap <span class="token operator">=</span> cv2<span class="token punctuation">.</span>VideoCapture<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>    detector <span class="token operator">=</span> handDetector<span class="token punctuation">(</span><span class="token punctuation">)</span>  angle <span class="token operator">=</span> <span class="token number">0</span>  <span class="token keyword">while</span> <span class="token boolean">True</span><span class="token punctuation">:</span>      success<span class="token punctuation">,</span> img <span class="token operator">=</span> cap<span class="token punctuation">.</span>read<span class="token punctuation">(</span><span class="token punctuation">)</span>      img <span class="token operator">=</span> detector<span class="token punctuation">.</span>findHands<span class="token punctuation">(</span>img<span class="token punctuation">,</span> draw<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>      lmList <span class="token operator">=</span> detector<span class="token punctuation">.</span>findPosition<span class="token punctuation">(</span>img<span class="token punctuation">,</span> personDraw<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">)</span>      <span class="token keyword">if</span> <span class="token builtin">len</span><span class="token punctuation">(</span>lmList<span class="token punctuation">)</span> <span class="token operator">></span> <span class="token number">0</span><span class="token punctuation">:</span>          <span class="token keyword">print</span><span class="token punctuation">(</span>lmList<span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">]</span><span class="token punctuation">,</span> lmList<span class="token punctuation">[</span><span class="token number">8</span><span class="token punctuation">]</span><span class="token punctuation">)</span>          x1<span class="token punctuation">,</span> y1 <span class="token operator">=</span> lmList<span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> lmList<span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span>          x2<span class="token punctuation">,</span> y2 <span class="token operator">=</span> lmList<span class="token punctuation">[</span><span class="token number">8</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> lmList<span class="token punctuation">[</span><span class="token number">8</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span>          cv2<span class="token punctuation">.</span>circle<span class="token punctuation">(</span>img<span class="token punctuation">,</span> <span class="token punctuation">(</span>x1<span class="token punctuation">,</span> y1<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">15</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">200</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">,</span> cv2<span class="token punctuation">.</span>FILLED<span class="token punctuation">)</span>          cv2<span class="token punctuation">.</span>circle<span class="token punctuation">(</span>img<span class="token punctuation">,</span> <span class="token punctuation">(</span>x2<span class="token punctuation">,</span> y2<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">15</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">200</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">,</span> cv2<span class="token punctuation">.</span>FILLED<span class="token punctuation">)</span>          cv2<span class="token punctuation">.</span>line<span class="token punctuation">(</span>img<span class="token punctuation">,</span> <span class="token punctuation">(</span>x1<span class="token punctuation">,</span> y1<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>x2<span class="token punctuation">,</span> y2<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">200</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">)</span>            <span class="token keyword">if</span> <span class="token punctuation">(</span>x1 <span class="token operator">-</span> x2<span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token number">0</span><span class="token punctuation">:</span>              angle <span class="token operator">=</span> math<span class="token punctuation">.</span>degrees<span class="token punctuation">(</span>np<span class="token punctuation">.</span>arctan<span class="token punctuation">(</span><span class="token punctuation">(</span>y2 <span class="token operator">-</span> y1<span class="token punctuation">)</span><span class="token operator">/</span><span class="token punctuation">(</span>x2 <span class="token operator">-</span> x1<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>              a <span class="token operator">=</span> <span class="token number">180</span> <span class="token operator">-</span> angle              myServo<span class="token punctuation">.</span>write_angle<span class="token punctuation">(</span><span class="token builtin">int</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span><span class="token punctuation">)</span>              <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token builtin">int</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span><span class="token punctuation">)</span>          <span class="token keyword">if</span> angle <span class="token operator">&lt;</span> <span class="token number">0</span><span class="token punctuation">:</span>              angle <span class="token operator">=</span> <span class="token builtin">abs</span><span class="token punctuation">(</span>angle<span class="token punctuation">)</span>              myServo<span class="token punctuation">.</span>write_angle<span class="token punctuation">(</span><span class="token builtin">int</span><span class="token punctuation">(</span>angle<span class="token punctuation">)</span><span class="token punctuation">)</span>              <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token builtin">int</span><span class="token punctuation">(</span>angle<span class="token punctuation">)</span><span class="token punctuation">)</span>          cv2<span class="token punctuation">.</span>imshow<span class="token punctuation">(</span><span class="token string">"Image"</span><span class="token punctuation">,</span> img<span class="token punctuation">)</span>      cv2<span class="token punctuation">.</span>waitKey<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="步驟3"><a href="#步驟3" class="headerlink" title="步驟3:"></a>步驟3:</h2><h2 id="執行程式碼"><a href="#執行程式碼" class="headerlink" title="執行程式碼"></a>執行程式碼</h2><div class="video-container"><iframe src="https://www.youtube.com/embed/tTvcI0AKj-U" frameborder="0" loading="lazy" allowfullscreen></iframe></div><hr>]]></content>
      
      
      <categories>
          
          <category> mediapipe </category>
          
          <category> arduino </category>
          
      </categories>
      
      
        <tags>
            
            <tag> servo </tag>
            
            <tag> mediapipe </tag>
            
            <tag> arduino </tag>
            
        </tags>
      
    </entry>
    
    
  
  
</search>
